<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å·¥ç¨‹è°œé¢˜ï¼šæ‰©æ•£æ§åˆ¶ä¸‹çš„æ´—æ‰‹å®éªŒ v1.2</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --neon-blue: #00f2ff;
            --bg-dark: #0a0e14;
            --panel-bg: #151d27;
            --text-gray: #a0aec0;
            --dirty-color: #8B4513;
            --clean-color: #00f2ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Segoe UI', 'PingFang SC', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .hud-container {
            background: var(--panel-bg);
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.2);
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
            flex-grow: 1;
        }

        header {
            border-bottom: 2px solid var(--neon-blue);
            margin-bottom: 25px;
            padding-bottom: 15px;
            text-align: center;
        }

        h1 {
            margin: 0;
            font-size: 28px;
            letter-spacing: 1.5px;
            color: var(--neon-blue);
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--text-gray);
            font-size: 14px;
            opacity: 0.8;
        }

        /* å“åº”å¼ç½‘æ ¼å¸ƒå±€ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        /* å¾®è§‚è§†çª—åŒºåŸŸ */
        .visualization-area {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 6px;
            border: 1px solid rgba(0, 242, 255, 0.2);
        }

        .micro-view {
            background: #050a10;
            border: 1px solid #1a3a4a;
            position: relative;
            overflow: hidden;
            border-radius: 4px;
            min-height: 140px;
        }

        .groove-label {
            position: absolute;
            top: 8px;
            left: 12px;
            font-size: 11px;
            color: var(--neon-blue);
            opacity: 0.8;
            z-index: 2;
        }

        #grooveCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* æµ·ç»µæŒ‡ç¤ºå™¨ */
        .sponge-indicator {
            background: rgba(5, 10, 16, 0.8);
            border: 1px solid #1a3a4a;
            border-radius: 4px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .sponge-label {
            font-size: 12px;
            color: var(--text-gray);
            margin-bottom: 10px;
            text-align: center;
        }

        .sponge {
            width: 100%;
            height: 80px;
            border-radius: 6px;
            background-color: var(--dirty-color);
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
            transition: all 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .sponge::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            animation: sponge-shine 2s infinite;
        }

        @keyframes sponge-shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-left: 3px solid var(--neon-blue);
            border-radius: 0 6px 6px 0;
            transition: all 0.3s ease;
        }

        .control-group:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(2px);
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .param-name {
            font-size: 14px;
            color: var(--text-gray);
            font-weight: 500;
        }

        .param-value {
            color: var(--neon-blue);
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 16px;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--neon-blue);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.8);
            border: 2px solid #0a0e14;
        }

        /* å›¾è¡¨åŒºåŸŸ */
        .chart-area {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chart-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            padding: 15px;
            border: 1px solid rgba(0, 242, 255, 0.1);
            flex-grow: 1;
            min-height: 250px;
        }

        .comparison-container {
            margin-top: 10px;
        }

        .comparison-label {
            font-size: 12px;
            color: var(--text-gray);
            margin-bottom: 5px;
            text-align: center;
        }

        .comparison-bar {
            height: 40px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .bar-section {
            height: 100%;
            position: absolute;
            top: 0;
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 13px;
        }

        .ideal-bar {
            background: linear-gradient(90deg, rgba(0, 242, 255, 0.7), rgba(0, 242, 255, 0.9));
            left: 0;
        }

        .actual-bar {
            background: linear-gradient(90deg, rgba(255, 77, 77, 0.7), rgba(255, 77, 77, 0.9));
            left: 0;
        }

        /* è¯„æµ‹åŒºåŸŸ */
        .evaluation-panel {
            background: rgba(0, 34, 51, 0.8);
            border: 1px solid var(--neon-blue);
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
        }

        .evaluation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 242, 255, 0.3);
        }

        .eval-title {
            color: var(--neon-blue);
            font-size: 18px;
            font-weight: bold;
        }

        .eval-level {
            background: var(--neon-blue);
            color: var(--bg-dark);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        .eval-message {
            color: #ffbc00;
            font-size: 14px;
            line-height: 1.5;
            min-height: 1.5em;
        }

        /* çŸ¥è¯†æµ‹éªŒ */
        .quiz-panel {
            background: rgba(0, 0, 0, 0.3);
            border: 1px dashed rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
        }

        .quiz-title {
            color: var(--neon-blue);
            font-size: 16px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quiz-title::before {
            content: "ğŸ§ ";
            font-size: 18px;
        }

        .question {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .question:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .question-text {
            margin-bottom: 10px;
            font-size: 14px;
            color: white;
        }

        .question-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .option {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }

        .option:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--neon-blue);
        }

        .option.selected {
            background: rgba(0, 242, 255, 0.2);
            border-color: var(--neon-blue);
            color: var(--neon-blue);
        }

        /* èº«ä»½æ  */
        .identity-bar {
            background: rgba(0, 210, 255, 0.15);
            padding: 20px;
            border-bottom: 2px solid #00d2ff;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            align-items: center;
        }

        .identity-label {
            color: #ffcc00;
            font-weight: bold;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .identity-input {
            background: #050b14;
            color: white;
            border: 1px solid #00d2ff;
            padding: 10px 15px;
            border-radius: 6px;
            min-width: 200px;
            font-size: 14px;
        }

        .identity-input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(0, 210, 255, 0.5);
        }

        /* æŠ¥å‘ŠåŒºåŸŸ */
        .report-section {
            margin: 40px 0;
            padding: 30px;
            border: 2px solid #ffcc00;
            background: rgba(255, 204, 0, 0.05);
            border-radius: 12px;
        }

        .report-header {
            color: #ffcc00;
            text-align: center;
            margin-bottom: 25px;
            font-size: 22px;
        }

        .report-content {
            margin-bottom: 25px;
        }

        .report-textarea {
            width: 100%;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ffcc00;
            background: #050b14;
            color: white;
            font-family: inherit;
            line-height: 1.6;
            resize: vertical;
            min-height: 150px;
            font-size: 14px;
        }

        .report-button {
            width: 100%;
            padding: 18px;
            background: #ffcc00;
            color: #050b14;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(255, 204, 0, 0.3);
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .report-button:hover {
            background: #ffd633;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 204, 0, 0.4);
        }

        /* é¡µè„š */
        .site-footer {
            background: rgba(5, 11, 20, 0.95);
            border-top: 2px solid rgba(0, 242, 255, 0.3);
            padding: 40px 0 20px;
            margin-top: 40px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-section {
            padding: 0 15px;
        }

        .footer-title {
            color: var(--neon-blue);
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 242, 255, 0.3);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: var(--text-gray);
            text-decoration: none;
            transition: color 0.3s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-links a:hover {
            color: var(--neon-blue);
        }

        .footer-links a::before {
            content: "â€º";
            color: var(--neon-blue);
            font-size: 16px;
        }

        .footer-info p {
            color: var(--text-gray);
            margin-bottom: 10px;
            font-size: 14px;
            line-height: 1.6;
        }

        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-gray);
            font-size: 14px;
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-gray);
            font-size: 13px;
        }

        .copyright a {
            color: var(--neon-blue);
            text-decoration: none;
        }

        .copyright a:hover {
            text-decoration: underline;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .hud-container {
                padding: 15px;
            }
            
            .visualization-area {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .identity-bar {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .identity-input {
                min-width: 100%;
            }
            
            .report-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- èº«ä»½æ  -->
    <div class="identity-bar">
        <div class="identity-label">
            <span>ğŸ‘¤</span>
            <span>å­¦ç”Ÿèº«ä»½è®¤è¯</span>
        </div>
        <input type="text" id="global-name" class="identity-input" placeholder="è¯·è¾“å…¥å§“å">
        <input type="text" id="global-id" class="identity-input" placeholder="è¯·è¾“å…¥å­¦å·">
    </div>

    <div class="container">
        <!-- ä¸»æ¸¸æˆç•Œé¢ -->
        <div class="hud-container">
            <header>
                <h1>çº³ç±³æ²Ÿæ§½æ‰©æ•£ä¼ è´¨æ¨¡æ‹Ÿå™¨</h1>
                <div class="subtitle">è¯¾é¢˜ï¼šæ‰©æ•£æ§åˆ¶ä¸‹çš„æ²Ÿæ§½æ¸…æ´—æ•ˆç‡ç ”ç©¶ | æ¢ç´¢æ‰©æ•£æœºåˆ¶ä¸å·¥ç¨‹ä¼˜åŒ–ç­–ç•¥</div>
            </header>

            <!-- å¯è§†åŒ–åŒºåŸŸ -->
            <div class="visualization-area">
                <div class="micro-view">
                    <span class="groove-label">SCANNING: SKIN_FURROW_CROSS_SECTION</span>
                    <canvas id="grooveCanvas" width="600" height="140"></canvas>
                </div>
                <div class="sponge-indicator">
                    <div class="sponge-label">æ±¡æŸ“ç‰©å¸é™„çŠ¶æ€ç›‘æµ‹</div>
                    <div class="sponge" id="sponge-visual"></div>
                </div>
            </div>

            <!-- ä¸»å†…å®¹åŒºåŸŸ -->
            <div class="main-content">
                <!-- æ§åˆ¶é¢æ¿ -->
                <div class="control-panel">
                    <div class="control-group">
                        <div class="control-label">
                            <span class="param-name">æ‰©æ•£ç³»æ•° D (åˆ†å­æ´»æ€§)</span>
                            <span class="param-value" id="d-val">1.0</span>
                        </div>
                        <input type="range" id="param-D" min="0.1" max="5" step="0.1" value="1">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span class="param-name">æ‰©æ•£è·ç¦» L (æ²Ÿæ§½æ·±åº¦)</span>
                            <span class="param-value" id="l-val">10</span>
                        </div>
                        <input type="range" id="param-L" min="2" max="20" step="1" value="10">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span class="param-name">å†²æ´—æ—¶é—´ t (æ¥è§¦æ—¶é•¿)</span>
                            <span class="param-value" id="t-val">5</span>
                        </div>
                        <input type="range" id="param-T" min="1" max="60" step="1" value="5">
                    </div>
                    
                    <div class="control-group" style="opacity: 0.7; border-left-color: #666;">
                        <div class="control-label">
                            <span class="param-name">æ°´æµé€Ÿåº¦ u (å¤–éƒ¨å¯¹æµ)</span>
                            <span class="param-value" id="u-val">10</span>
                        </div>
                        <input type="range" id="param-U" min="1" max="100" step="1" value="10">
                        <div style="font-size: 12px; color: #888; margin-top: 5px;">*å¹²æ‰°é¡¹ï¼šåœ¨æ‰©æ•£æ§åˆ¶ä¸‹å½±å“æœ‰é™</div>
                    </div>

                    <!-- è¯„æµ‹é¢æ¿ -->
                    <div class="evaluation-panel">
                        <div class="evaluation-header">
                            <div class="eval-title">å·¥ç¨‹è¯„ä¼°</div>
                            <div class="eval-level" id="eval-level">L0</div>
                        </div>
                        <div class="eval-message" id="eval-message">
                            è°ƒæ•´å‚æ•°å¼€å§‹å®éªŒï¼Œè§‚å¯Ÿå¾®è§‚ä¼ è´¨è¿‡ç¨‹...
                        </div>
                    </div>
                </div>

                <!-- å›¾è¡¨åŒºåŸŸ -->
                <div class="chart-area">
                    <div class="chart-container">
                        <canvas id="residueChart"></canvas>
                    </div>
                    
                    <div class="comparison-container">
                        <div class="comparison-label">æ®‹ç•™ç‡å¯¹æ¯”ï¼šç†æƒ³æƒ…å†µ(è“) vs å®é™…æƒ…å†µ(çº¢)</div>
                        <div class="comparison-bar">
                            <div class="bar-section ideal-bar" id="ideal-bar" style="width: 0%">ç†æƒ³: 0%</div>
                            <div class="bar-section actual-bar" id="actual-bar" style="width: 0%">å®é™…: 0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- çŸ¥è¯†æµ‹éªŒ -->
            <div class="quiz-panel">
                <div class="quiz-title">çŸ¥è¯†æŒ‘æˆ˜</div>
                
                <div class="question">
                    <div class="question-text">1. åœ¨æ‰©æ•£æ§åˆ¶ä¸‹ï¼Œæé«˜æ°´æµé€Ÿåº¦ï¼ˆuï¼‰æ˜¯å¦èƒ½æ˜¾è‘—æé«˜æ¸…æ´—æ•ˆç‡ï¼Ÿ</div>
                    <div class="question-options">
                        <div class="option" data-for="q1-yes">æ˜¯ï¼Œæµé€Ÿè¶Šå¿«æ¸…æ´—è¶Šå½»åº•</div>
                        <div class="option" data-for="q1-no">å¦ï¼Œå¯¹æµå¯¹æ·±å±‚æ‰©æ•£å½±å“æœ‰é™</div>
                    </div>
                </div>
                
                <div class="question">
                    <div class="question-text">2. åœ¨ä¸æ”¹å˜æ‰©æ•£ç³»æ•°Dçš„æƒ…å†µä¸‹ï¼Œæœ€æœ‰æ•ˆçš„å¼ºåŒ–ç­–ç•¥æ˜¯ï¼Ÿ</div>
                    <div class="question-options">
                        <div class="option" data-for="q2-u">æ— é™å¢å¤§æµé€Ÿ</div>
                        <div class="option" data-for="q2-t">å»¶é•¿å†²æ´—æ—¶é—´</div>
                        <div class="option" data-for="q2-l">å‡å°æœ‰æ•ˆæ‰©æ•£è·ç¦»ï¼ˆé€šè¿‡æ‰æ“ï¼‰</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æŠ¥å‘ŠåŒºåŸŸ -->
        <section class="report-section">
            <h2 class="report-header">ğŸ› ï¸ å·¥ç¨‹å¸ˆå®è·µè¯„æµ‹æŠ¥å‘Š</h2>
            
            <div class="report-content">
                <label style="display:block; margin-bottom:15px; font-weight: bold; color: #ffcc00;">
                    å­¦ä¹ å®è·µå¿ƒå¾—ä¸å·¥ç¨‹æ€ç»´æ€»ç»“ï¼š
                </label>
                <textarea id="eval-content" class="report-textarea" 
                    placeholder="è¯·ç»“åˆä»¿çœŸè§‚å¯Ÿï¼Œåˆ†ææ‰©æ•£æ§åˆ¶çš„ä¼ è´¨ç‰¹ç‚¹ï¼Œæ€»ç»“å·¥ç¨‹ä¼˜åŒ–ç­–ç•¥..."></textarea>
            </div>
            
            <button onclick="executeFullWidthPrint()" id="print-btn" class="report-button">
                <span>ğŸ–¨ï¸</span>
                <span>ç”Ÿæˆå…¨å®½PDFæŠ¥å‘Š (åŒ…å«å½“å‰é¡µé¢+å¿ƒå¾—)</span>
            </button>
        </section>
    </div>

 

    <!-- æ‰“å°åŒºåŸŸ -->
    <div id="print-text-display" style="display: none;"></div>

    <script>
        // åˆå§‹åŒ–å›¾è¡¨
        const ctx = document.getElementById('residueChart').getContext('2d');
        let chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [0, 10, 20, 30, 40, 50, 60],
                datasets: [{
                    label: 'æ€»æ®‹ç•™é‡ (%)',
                    borderColor: '#00f2ff',
                    backgroundColor: 'rgba(0, 242, 255, 0.1)',
                    data: [100, 80, 60, 40, 20, 10, 5],
                    fill: true,
                    tension: 0.4,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { 
                        min: 0, 
                        max: 100, 
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: '#a0aec0' }
                    },
                    x: { 
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: '#a0aec0' }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        titleColor: '#00f2ff',
                        bodyColor: 'white'
                    }
                }
            }
        });

        // é¢œè‰²æ’å€¼å‡½æ•°
        function interpolateColor(color1, color2, factor) {
            let result = color1.slice();
            for (let i = 0; i < 3; i++) {
                result[i] = Math.round(result[i] + factor * (color2[i] - color1[i]));
            }
            return `rgb(${result[0]}, ${result[1]}, ${result[2]})`;
        }
        const dirtyRGB = [139, 69, 19];
        const cleanRGB = [0, 242, 255];

        // ç»˜åˆ¶å¾®è§‚è§†å›¾
        const gCanvas = document.getElementById('grooveCanvas');
        const gCtx = gCanvas.getContext('2d');
        
        function drawMicroView(D, L, t, actualResidue, u) {
            const width = gCanvas.width;
            const height = gCanvas.height;
            gCtx.clearRect(0, 0, width, height);

            // ç»˜åˆ¶èƒŒæ™¯
            const gradient = gCtx.createLinearGradient(0, 0, width, height);
            gradient.addColorStop(0, 'rgba(5, 10, 16, 0.8)');
            gradient.addColorStop(1, 'rgba(10, 20, 35, 0.8)');
            gCtx.fillStyle = gradient;
            gCtx.fillRect(0, 0, width, height);

            // ç»˜åˆ¶æ²Ÿæ§½
            const grooveWidth = Math.min(120, width * 0.7);
            const grooveDepth = Math.min(L * 4, height * 0.6);
            const startX = (width - grooveWidth) / 2;
            const startY = height * 0.2;

            // æ²Ÿæ§½è¾¹ç•Œ
            gCtx.strokeStyle = "rgba(0, 242, 255, 0.6)";
            gCtx.lineWidth = 2;
            gCtx.beginPath();
            gCtx.moveTo(startX, startY);
            gCtx.lineTo(startX, startY + grooveDepth);
            gCtx.lineTo(startX + grooveWidth, startY + grooveDepth);
            gCtx.lineTo(startX + grooveWidth, startY);
            gCtx.stroke();

            // æ±¡æŸ“ç‰©æµ“åº¦æ¢¯åº¦
            const bottomOpacity = Math.min(0.8, actualResidue / 100);
            const fillGradient = gCtx.createLinearGradient(0, startY, 0, startY + grooveDepth);
            fillGradient.addColorStop(0, `rgba(0, 242, 255, ${0.1 + (1-bottomOpacity)*0.1})`);
            fillGradient.addColorStop(1, `rgba(0, 242, 255, ${bottomOpacity * 0.7})`);
            
            gCtx.fillStyle = fillGradient;
            gCtx.fillRect(startX + 1, startY, grooveWidth - 2, grooveDepth);

            // æ°´æµæ•ˆæœ
            const flowIntensity = u / 100;
            gCtx.fillStyle = `rgba(0, 150, 255, ${0.1 + flowIntensity * 0.2})`;
            
            // ç»˜åˆ¶æ°´æµçº¿æ¡
            gCtx.strokeStyle = `rgba(0, 150, 255, ${0.2 + flowIntensity * 0.3})`;
            gCtx.lineWidth = 1;
            
            for (let i = 0; i < 5; i++) {
                const y = startY - 5 - i * 8;
                gCtx.beginPath();
                gCtx.moveTo(20, y);
                gCtx.lineTo(width - 20, y + Math.sin(Date.now()/1000 + i) * 3);
                gCtx.stroke();
            }
        }

        // æ›´æ–°å‡½æ•°
        function update() {
            const D = parseFloat(document.getElementById('param-D').value);
            const L = parseFloat(document.getElementById('param-L').value);
            const t = parseFloat(document.getElementById('param-T').value);
            const u = parseFloat(document.getElementById('param-U').value);

            // æ›´æ–°æ˜¾ç¤ºå€¼
            document.getElementById('d-val').textContent = D.toFixed(1);
            document.getElementById('l-val').textContent = L;
            document.getElementById('t-val').textContent = t;
            document.getElementById('u-val').textContent = u;

            // ç‰©ç†è®¡ç®—
            const k = 0.8;
            const actualResidue = Math.exp(-k * D * t / (L * L * 0.1)) * 100;
            const idealResidue = Math.max(0, 100 - (u * 0.8 + t * 3));

            // æ›´æ–°å¯¹æ¯”æ¡
            const idealWidth = Math.max(5, 100 - idealResidue);
            const actualWidth = Math.max(5, 100 - actualResidue);
            
            document.getElementById('ideal-bar').style.width = `${idealWidth}%`;
            document.getElementById('ideal-bar').textContent = `ç†æƒ³: ${idealWidth.toFixed(1)}%`;
            
            document.getElementById('actual-bar').style.width = `${actualWidth}%`;
            document.getElementById('actual-bar').textContent = `å®é™…: ${actualWidth.toFixed(1)}%`;

            // æ›´æ–°å¾®è§‚è§†å›¾
            drawMicroView(D, L, t, actualResidue, u);

            // æ›´æ–°æµ·ç»µé¢œè‰²
            const cleanFactor = (100 - actualResidue) / 100;
            const spongeColor = interpolateColor(dirtyRGB, cleanRGB, cleanFactor);
            document.getElementById('sponge-visual').style.backgroundColor = spongeColor;

            // æ›´æ–°å›¾è¡¨
            const timePoints = [0, 10, 20, 30, 40, 50, 60];
            chart.data.datasets[0].data = timePoints.map(tp => 
                Math.exp(-k * D * tp / (L * L * 0.1)) * 100
            );
            chart.update();

            // æ›´æ–°è¯„æµ‹ä¿¡æ¯
            updateEvaluation(D, L, t, u, actualResidue);
        }

        // æ›´æ–°è¯„æµ‹
        function updateEvaluation(D, L, t, u, actualResidue) {
            let level = "L0";
            let message = "è°ƒæ•´å‚æ•°å¼€å§‹å®éªŒï¼Œè§‚å¯Ÿå¾®è§‚ä¼ è´¨è¿‡ç¨‹...";

            if (actualResidue < 80) {
                level = "L1";
                message = "ä¼ è´¨è¿‡ç¨‹æ­£åœ¨è¿›è¡Œä¸­ï¼Œç»§ç»­è§‚å¯Ÿå‚æ•°å½±å“...";
            }
            
            if (t > 20 && actualResidue < 60) {
                level = "L2";
                message = "æ—¶é—´å› ç´ å¯¹æ‰©æ•£ä¼ è´¨æœ‰æ˜¾è‘—å½±å“ï¼Œä½†ä»æœ‰ä¼˜åŒ–ç©ºé—´";
            }
            
            if (L < 8) {
                level = "L3";
                message = "å‡å°æ‰©æ•£è·ç¦»æ˜¯é«˜æ•ˆç­–ç•¥ï¼ä½ å‘ç°äº†æ‰©æ•£æ§åˆ¶çš„æœ¬è´¨";
            }
            
            if (actualResidue < 30 && L < 6 && D > 2) {
                level = "L4";
                message = "ä¼˜ç§€ï¼ä½ æŒæ¡äº†æ‰©æ•£ä¼ è´¨çš„æ ¸å¿ƒä¼˜åŒ–ç­–ç•¥";
            }

            document.getElementById('eval-level').textContent = level;
            document.getElementById('eval-message').textContent = message;
        }

        // ç»‘å®šäº‹ä»¶
        document.querySelectorAll('input[type="range"]').forEach(el => {
            el.addEventListener('input', update);
        });

        // ç»‘å®šé€‰é¡¹æŒ‰é’®
        document.querySelectorAll('.option').forEach(option => {
            option.addEventListener('click', function() {
                // ç§»é™¤åŒç»„å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
                const question = this.closest('.question');
                question.querySelectorAll('.option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // é€‰ä¸­å½“å‰é€‰é¡¹
                this.classList.add('selected');
            });
        });

        // åˆå§‹æ›´æ–°
        setTimeout(update, 100);

        // æ‰“å°åŠŸèƒ½
        function executeFullWidthPrint() {
            const name = document.getElementById('global-name').value;
            const id = document.getElementById('global-id').value;
            const content = document.getElementById('eval-content').value;

            if (!name || !id || !content) {
                alert("âš ï¸ è¯·ç¡®ä¿å§“åã€å­¦å·å’Œå®è·µå¿ƒå¾—å‡å·²å¡«å†™ï¼");
                return;
            }

            const displayArea = document.getElementById('print-text-display');
            displayArea.innerHTML = `
                <div style="padding: 30px; font-family: Arial, sans-serif;">
                    <h2 style="color: #00f2ff; border-bottom: 2px solid #00f2ff; padding-bottom: 10px;">
                        å·¥ç¨‹ä¼ è´¨å®éªŒæŠ¥å‘Š
                    </h2>
                    <div style="margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 8px;">
                        <strong>å­¦ç”Ÿå§“åï¼š</strong>${name}<br>
                        <strong>å­¦å·ï¼š</strong>${id}<br>
                        <strong>å®éªŒé¡¹ç›®ï¼š</strong>${document.title}<br>
                        <strong>å®éªŒæ—¶é—´ï¼š</strong>${new Date().toLocaleString()}
                    </div>
                    <h3 style="color: #333; margin-top: 25px;">å®è·µå¿ƒå¾—æ€»ç»“ï¼š</h3>
                    <div style="padding: 15px; border: 1px solid #ddd; border-radius: 6px; margin-top: 10px; line-height: 1.6;">
                        ${content.replace(/\n/g, '<br>')}
                    </div>
                </div>
            `;

            window.print();
        }
    </script>



<!-- åº•éƒ¨ä¿¡æ¯æ  -->
<div style="
    text-align: center;
    padding: 20px 30px;
    margin-top: 40px;
    color: #e6f7ff;
    font-size: 0.9rem;
    border-top: 2px solid rgba(0, 180, 255, 0.5);
    background: linear-gradient(135deg, rgba(10, 15, 43, 0.95), rgba(18, 26, 58, 0.9));
    border-radius: 15px 15px 0 0;
    box-shadow: 0 -10px 30px rgba(0, 180, 255, 0.1);
    position: relative;
    overflow: hidden;
    box-sizing: border-box;
    width: 100%;
    max-width: none;
">
    <div style="position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, #00b4ff, #6c8cff, #00b4ff);"></div>
    
    <p style="font-size: 1.3rem; font-weight: bold; margin-bottom: 15px; color: #00b4ff;">
        çº³ç±³æ²Ÿæ§½æ‰©æ•£ä¼ è´¨æ¨¡æ‹Ÿå™¨ Â© 2025 | ä¼ è´¨ä»¿çœŸç³»ç»Ÿ | ç‰ˆæœ¬ 1.0 |
      <style="margin-bottom: 12px; color: #cbd5e1;">
        <strong>é‚®ç®±:</strong> xgyanger@qq.com
    </p>
    
    <div style="margin-top: 15px;">
        <span style="color: #ffcc00; font-weight: bold; font-size: 1.1rem;">
            ç‰ˆæƒÂ©2025 AIknow. ä¿ç•™æ‰€æœ‰æƒåˆ© | Copyright Â©2025 AIknow. All rights reserved.
        </span>
    </div>
</div>


</body>
</html>