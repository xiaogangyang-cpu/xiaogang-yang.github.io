<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>一维扩散传质教学仿真系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0d1b2a 0%, #1b3a4b 100%);
            color: #e0f7fa;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: rgba(13, 27, 42, 0.9);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 1px solid rgba(64, 156, 255, 0.3);
        }
        
        header {
            background: linear-gradient(90deg, #0a1128 0%, #1a3a5f 50%, #0066cc 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
            border-bottom: 5px solid #409cff;
            position: relative;
            overflow: hidden;
        }
        
        .header-decoration {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 30%, rgba(64, 156, 255, 0.1) 50%, transparent 70%);
            animation: shine 3s infinite linear;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 300;
            position: relative;
        }
        
        .level-tabs {
            display: flex;
            background-color: rgba(27, 58, 75, 0.8);
            border-bottom: 1px solid rgba(64, 156, 255, 0.3);
        }
        
        .tab {
            flex: 1;
            padding: 18px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-right: 1px solid rgba(64, 156, 255, 0.2);
            color: #b0e0e6;
            position: relative;
            overflow: hidden;
        }
        
        .tab:last-child {
            border-right: none;
        }
        
        .tab:hover {
            background-color: rgba(64, 156, 255, 0.2);
        }
        
        .tab.active {
            background-color: rgba(13, 27, 42, 0.9);
            color: #409cff;
            border-top: 3px solid #409cff;
            padding-top: 15px;
        }
        
        .tab-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #409cff;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .tab.active .tab-indicator {
            transform: translateX(0);
        }
        
        .level-content {
            padding: 25px;
            min-height: 700px;
            display: none;
        }
        
        .level-content.active {
            display: block;
        }
        
        .level-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px dashed rgba(64, 156, 255, 0.5);
        }
        
        .level-title {
            font-size: 1.8rem;
            color: #409cff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .level-subtitle {
            color: #b0e0e6;
            font-size: 1.1rem;
        }
        
        .simulation-area {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .visualization-row {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            width: 100%;
        }
        
        .visualization-container {
            border-radius: 10px;
            background-color: rgba(27, 58, 75, 0.7);
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(64, 156, 255, 0.2);
            height: 400px;
            display: flex;
            flex-direction: column;
            flex: 0.6;
        }
        
        .controls-container {
            border-radius: 10px;
            background-color: rgba(27, 58, 75, 0.7);
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(64, 156, 255, 0.2);
            height: 400px;
            overflow-y: auto;
            flex: 1;
        }
        
        .section-title {
            font-size: 1.3rem;
            color: #409cff;
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(64, 156, 255, 0.3);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        canvas {
            display: block;
            margin: 0 auto;
            background-color: rgba(13, 27, 42, 0.8);
            border-radius: 5px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            flex-grow: 1;
            max-height: 300px;
        }
        
        .info-tips-row {
            display: flex;
            gap: 30px;
            margin-top: 30px;
        }
        
        .level-info, .teaching-tips {
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(64, 156, 255, 0.2);
        }
        
        .level-info {
            background-color: rgba(27, 58, 75, 0.7);
            /* Level 1比例: 模拟区0.7:控制区1 = 0.7:1 */
            flex: 0.7;
        }
        
        .teaching-tips {
            background-color: rgba(27, 58, 75, 0.7);
            flex: 1;
        }
        
        .info-title {
            font-size: 1.3rem;
            color: #409cff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .info-title i {
            margin-right: 10px;
        }
        
        .equation {
            font-family: 'Times New Roman', serif;
            font-size: 1.2rem;
            color: #e0f7fa;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            overflow-x: auto;
        }
        
        .control-group {
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px dashed rgba(64, 156, 255, 0.2);
        }
        
        .control-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #b0e0e6;
            font-size: 1.05rem;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .slider-value {
            min-width: 60px;
            text-align: center;
            font-weight: bold;
            color: #409cff;
            background-color: rgba(64, 156, 255, 0.1);
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid rgba(64, 156, 255, 0.3);
        }
        
        input[type="range"] {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: rgba(64, 156, 255, 0.2);
            border-radius: 4px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #409cff;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            border: 2px solid #e0f7fa;
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #409cff;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            border: 2px solid #e0f7fa;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background-color: rgba(64, 156, 255, 0.2);
            color: #e0f7fa;
            border: 1px solid rgba(64, 156, 255, 0.5);
        }
        
        button i {
            font-size: 1.1rem;
        }
        
        button:hover {
            background-color: rgba(64, 156, 255, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(64, 156, 255, 0.3);
        }
        
        .btn-primary {
            background-color: rgba(64, 156, 255, 0.7);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: rgba(64, 156, 255, 0.9);
        }
        
        .btn-secondary {
            background-color: rgba(96, 125, 139, 0.7);
            color: #e0f7fa;
        }
        
        .btn-secondary:hover {
            background-color: rgba(96, 125, 139, 0.9);
        }
        
        .btn-success {
            background-color: rgba(46, 204, 113, 0.7);
            color: white;
        }
        
        .btn-success:hover {
            background-color: rgba(46, 204, 113, 0.9);
        }
        
        .btn-warning {
            background-color: rgba(241, 196, 15, 0.7);
            color: white;
        }
        
        .btn-warning:hover {
            background-color: rgba(241, 196, 15, 0.9);
        }
        
        .btn-next-level {
            background: linear-gradient(90deg, #0066cc, #409cff);
            color: white;
            font-size: 1.1rem;
            padding: 15px 30px;
            margin: 20px auto;
            display: block;
        }
        
        .tips-title {
            font-size: 1.2rem;
            color: #409cff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .tips-title i {
            margin-right: 10px;
        }
        
        .tips-content {
            color: #b0e0e6;
            line-height: 1.6;
        }
        
        .tips-content ul {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .tips-content li {
            margin-bottom: 8px;
        }
        
        .assessment-question {
            background-color: rgba(27, 58, 75, 0.7);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #409cff;
        }
        
        .question-text {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #e0f7fa;
        }
        
        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .answer-option {
            padding: 12px 15px;
            background-color: rgba(13, 27, 42, 0.8);
            border: 2px solid rgba(64, 156, 255, 0.3);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .answer-option:hover {
            background-color: rgba(64, 156, 255, 0.2);
            border-color: #409cff;
        }
        
        .answer-option.selected {
            background-color: rgba(64, 156, 255, 0.3);
            border-color: #409cff;
            color: #409cff;
            font-weight: bold;
        }
        
        .result-container {
            background-color: rgba(27, 58, 75, 0.9);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            display: none;
            margin-top: 30px;
            border: 2px solid #409cff;
        }
        
        .result-container.active {
            display: block;
        }
        
        .result-title {
            font-size: 1.8rem;
            color: #409cff;
            margin-bottom: 15px;
        }
        
        .result-level {
            font-size: 2.5rem;
            font-weight: bold;
            color: #409cff;
            margin: 20px 0;
            padding: 15px;
            background-color: rgba(13, 27, 42, 0.9);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .result-description {
            font-size: 1.1rem;
            color: #b0e0e6;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .next-steps {
            background-color: rgba(64, 156, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid rgba(64, 156, 255, 0.3);
        }
        
        .next-steps-title {
            font-size: 1.2rem;
            color: #409cff;
            margin-bottom: 10px;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            color: #89c2d9;
            font-size: 0.9rem;
            border-top: 1px solid rgba(64, 156, 255, 0.3);
        }
        
        .legend {
            display: flex;
            justify-content: center;
            margin-top: 2px;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-group input {
            width: 18px;
            height: 18px;
        }
        
        .level-completion {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background-color: rgba(46, 204, 113, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(46, 204, 113, 0.3);
            display: none;
        }
        
        .level-completion.active {
            display: block;
        }
        
        .completion-title {
            font-size: 1.5rem;
            color: #2ecc71;
            margin-bottom: 10px;
        }
        
        .completion-message {
            color: #b0e0e6;
            margin-bottom: 20px;
        }
        
        .dual-display {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            height: 300px;
        }
        
        .display-half {
            flex: 1;
            border-radius: 10px;
            background-color: rgba(27, 58, 75, 0.7);
            padding: 0px;
            border: 1px solid rgba(64, 156, 255, 0.2);
            display: flex;
            margin-top: -15px;
            flex-direction: column;
        }
        
        .display-title {
            font-size: 1.2rem;
            color: #409cff;
            margin-bottom: -5px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(64, 156, 255, 0.3);
        }
        
        .size-indicator {
            text-align: center;
            margin-top: -280px;
            color: #409cff;
            font-weight: bold;
        }
        
        /* Level 1 特殊调整 */
        #level1 .visualization-container {
            flex: 1;
        }
        
        #level1 .controls-container {
            flex: 1;
        }
        
        #level1 .level-info {
            flex: 1; /* 与模拟区宽度比例一致 */
        }
        
        #level1 .teaching-tips {
            flex: 1; /* 与控制区宽度比例一致 */
        }
        
        /* Level 2 特殊布局 - 紧凑设计 */
        #level2 .visualization-container {
            flex: 1;
            height: 380px;
        }
        
        #level2 .controls-container {
            flex: 1;
            height: 380px;
            overflow-y: auto;
            padding: 15px;
        }
        
        #level2 .level-info {
            flex: 1; /* 与模拟区宽度比例一致 */
        }
        
        #level2 .teaching-tips {
            flex: 1; /* 与控制区宽度比例一致 */
        }
        
        /* Level 2 紧凑型控件样式 - 改进版：同一行显示厚度和扩散系数 */
        #level2 .compact-layer-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 15px;
        }
        
        #level2 .compact-layer-control {
            background-color: rgba(13, 27, 42, 0.8);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(64, 156, 255, 0.3);
        }
        
        #level2 .compact-layer-title {
            text-align: center;
            color: #409cff;
            font-weight: bold;
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 1px dashed rgba(64, 156, 255, 0.3);
            font-size: 1rem;
        }
        
        #level2 .compact-param-row {
            display: flex;
            gap: 15px;
            margin-bottom: 8px;
        }
        
        #level2 .compact-param-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 10px;
            background-color: rgba(27, 58, 75, 0.5);
            border-radius: 6px;
            border: 1px solid rgba(64, 156, 255, 0.2);
        }
        
        #level2 .compact-param-label {
            font-weight: 600;
            color: #b0e0e6;
            font-size: 0.95rem;
            margin-bottom: 5px;
            text-align: center;
        }
        
        #level2 .compact-value-display {
            text-align: center;
            font-weight: bold;
            color: #409cff;
            background-color: rgba(64, 156, 255, 0.1);
            padding: 5px 8px;
            border-radius: 4px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            font-size: 0.9rem;
            margin-bottom: 8px;
            min-height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #level2 .compact-slider-wrapper {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        #level2 .compact-slider-wrapper input[type="range"] {
            width: 100%;
            height: 6px;
            margin: 0;
        }
        
        #level2 .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #89c2d9;
            margin-top: 2px;
        }
        
        /* Level 3 特殊布局 */
        #level3 .visualization-container {
            flex: 1;
        }
        
        #level3 .controls-container {
            flex: 1;
        }
        
        #level3 .level-info {
            flex: 1; /* 与模拟区宽度比例一致 */
        }
        
        #level3 .teaching-tips {
            flex: 1; /* 与控制区宽度比例一致 */
        }
        
        /* Level 3 参数行布局 */
        #level3 .parameter-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        #level3 .parameter-group {
            flex: 1;
        }
        
        #level3 .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 1rem;
            color: #b0e0e6;
            margin-top: 5px;
        }
        
        /* Level 3 仿真时间行布局 */
        #level3 .simulation-time-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 10px;
        }
        
        #level3 .mode-group {
            flex: 0.6;
        }
        
        #level3 .time-group {
            flex: 0.4;
        }
        
        #level3 .time-slider-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        #level3 .time-display {
            text-align: center;
            font-weight: bold;
            color: #409cff;
            background-color: rgba(64, 156, 255, 0.1);
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            font-size: 1.1rem;
        }
        
        /* 评测区特定样式 */
        #level4 .result-container {
            text-align: left;
        }
        
        #level4 .result-title, #level4 .result-level {
            text-align: center;
        }
        
        #level4 .result-description {
            background-color: rgba(13, 27, 42, 0.5);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #409cff;
        }
        
        #level4 .next-steps {
            background-color: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }
        
        #level4 .improvement-areas {
            background-color: rgba(241, 196, 15, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid rgba(241, 196, 15, 0.3);
        }
        
        #level4 .improvement-title {
            font-size: 1.1rem;
            color: #f39c12;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
        
        #level4 .improvement-title i {
            margin-right: 8px;
        }
        
        #level4 .improvement-content {
            color: #b0e0e6;
            line-height: 1.5;
            font-size: 0.95rem;
        }
        
        @media (max-width: 1200px) {
            .visualization-row {
                flex-direction: column;
            }
            
            .visualization-container, .controls-container {
                width: 100%;
                height: auto;
            }
            
            .controls-container {
                height: auto;
                max-height: 300px;
            }
            
            .info-tips-row {
                flex-direction: column;
            }
            
            .level-info, .teaching-tips {
                width: 100%;
                flex: 1 !important; /* 在移动端恢复等宽 */
            }
            
            .dual-display {
                flex-direction: column;
                height: auto;
            }
            
            #level2 .compact-layer-controls {
                grid-template-columns: 1fr;
            }
            
            #level2 .compact-layer-control {
                grid-template-columns: 1fr;
            }
            
            #level2 .visualization-container,
            #level2 .controls-container {
                width: 100%;
                height: auto;
                min-height: 300px;
            }
            
            #level2 .compact-param-row {
                flex-direction: column;
                gap: 10px;
            }
            
            #level3 .parameter-row {
                flex-direction: column;
                gap: 15px;
            }
            
            #level3 .simulation-time-row {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .tab {
                padding: 15px 5px;
                font-size: 0.9rem;
            }
            
            .level-tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 0 50%;
            }
            
            .tab:nth-child(2) {
                border-right: none;
            }
            
            #level2 .compact-param-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-decoration"></div>
            <h1><i class="fas fa-atom"></i> 一维扩散传质教学仿真系统</h1>
            <div class="subtitle">工程科技蓝风格 | 基于一维扩散模型的交互式可视化教学平台</div>
        </header>
        
        <div class="level-tabs">
            <div class="tab active" data-level="1">
                <i class="fas fa-home"></i> Level 1: 生活情境
                <div class="tab-indicator"></div>
            </div>
            <div class="tab" data-level="2">
                <i class="fas fa-industry"></i> Level 2: 工程情境
                <div class="tab-indicator"></div>
            </div>
            <div class="tab" data-level="3">
                <i class="fas fa-battery-full"></i> Level 3: 新能源情境
                <div class="tab-indicator"></div>
            </div>
            <div class="tab" data-level="4">
                <i class="fas fa-graduation-cap"></i> 工程师能力评测
                <div class="tab-indicator"></div>
            </div>
        </div>
        
        <!-- Level 1: 生活情境 -->
        <div class="level-content active" id="level1">
            <div class="level-header">
                <h2 class="level-title"><i class="fas fa-walking"></i> Level 1: 气味在狭长走廊中的扩散</h2>
                <div class="level-subtitle">生活情境 · 扩散直觉 | 一维瞬态扩散过程模拟</div>
            </div>
            
            <div class="simulation-area">
                <div class="visualization-row">
                    <div class="visualization-container">
                        <div class="section-title">
                            <i class="fas fa-chart-line"></i> 走廊中气味浓度分布
                        </div>
                        <canvas id="level1-canvas" width="500" height="300"></canvas>
                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: #409cff;"></div>
                                <span>当前浓度分布</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: rgba(64, 156, 255, 0.2);"></div>
                                <span>浓度梯度区域</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="controls-container">
                        <div class="section-title">
                            <i class="fas fa-sliders-h"></i> 仿真参数控制
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">走廊长度：<span id="length-value">中等</span></label>
                            <div class="slider-container">
                                <span>短</span>
                                <input type="range" id="length-slider" min="0" max="2" step="1" value="1">
                                <span>长</span>
                                <div class="slider-value" id="length-display">中等</div>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">扩散系数：<span id="diffusion-value">中等</span></label>
                            <div class="slider-container">
                                <span>低</span>
                                <input type="range" id="diffusion-slider" min="0" max="2" step="1" value="1">
                                <span>高</span>
                                <div class="slider-value" id="diffusion-display">中等</div>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">仿真控制</label>
                            <div class="button-group">
                                <button id="play-btn" class="btn-primary">
                                    <i class="fas fa-play"></i> 播放
                                </button>
                                <button id="pause-btn" class="btn-secondary">
                                    <i class="fas fa-pause"></i> 暂停
                                </button>
                                <button id="reset-btn" class="btn-secondary">
                                    <i class="fas fa-redo"></i> 重置
                                </button>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">当前时间：<span id="time-display">0.0</span> 秒</label>
                            <div class="slider-container">
                                <span>0s</span>
                                <input type="range" id="time-slider" min="0" max="100" step="1" value="0">
                                <span>100s</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="info-tips-row">
                    <div class="level-info">
                        <div class="info-title"><i class="fas fa-calculator"></i> 数学模型</div>
                        <div class="equation">
                            <p><strong>扩散方程（菲克第二定律）:</strong></p>
                            <p>∂C/∂t = D · ∂²C/∂x²</p>
                            <p>其中：C为浓度，t为时间，D为扩散系数，x为空间坐标</p>
                            <p><strong>边界条件:</strong></p>
                            <p>1. 初始条件（t=0）：C(x,0) = C₀δ(x) （点源释放）</p>
                            <p>2. 左边界（x=0）：∂C/∂x = 0 （封闭，无通量）</p>
                            <p>3. 右边界（x=L）：∂C/∂x = 0 （封闭，无通量）</p>
                        </div>
                    </div>
                    
                    <div class="teaching-tips">
                        <div class="tips-title">
                            <i class="fas fa-lightbulb"></i> 教学提示
                        </div>
                        <div class="tips-content">
                            <p>本关卡旨在帮助您建立扩散过程的直观理解：</p>
                            <ul>
                                <li><strong>扩散不是流动</strong>：气味分子从高浓度区域向低浓度区域随机运动，没有整体流动方向</li>
                                <li><strong>瞬态过程</strong>：浓度分布随时间变化，直到达到均匀状态</li>
                                <li><strong>距离与时间的关系</strong>：观察走廊长度如何影响气味扩散到整个空间所需的时间</li>
                                <li><strong>浓度梯度</strong>：注意浓度差异最大的区域，这是扩散驱动力所在</li>
                            </ul>
                            <p>尝试调节参数，观察扩散过程的变化规律。</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="level-completion" id="level1-completion">
                <div class="completion-title"><i class="fas fa-check-circle"></i> 关卡完成！</div>
                <div class="completion-message">您已经完成了Level 1的学习，理解了气味在走廊中的扩散过程。点击下方按钮进入Level 2，学习工程中的扩散应用。</div>
                <button id="to-level2" class="btn-next-level">
                    <i class="fas fa-arrow-right"></i> 进入 Level 2：工程情境
                </button>
            </div>
        </div>
        
        <!-- Level 2: 工程情境 - 改进版紧凑布局 -->
        <div class="level-content" id="level2">
            <div class="level-header">
                <h2 class="level-title"><i class="fas fa-building"></i> Level 2: 多层墙体中水蒸气的一维稳态扩散</h2>
                <div class="level-subtitle">工程情境 · 稳态建模 | 三层墙体扩散过程模拟</div>
            </div>
            
            <div class="simulation-area">
                <div class="visualization-row">
                    <div class="visualization-container">
                        <div class="section-title">
                            <i class="fas fa-chart-bar"></i> 三层墙体内部湿度分布
                        </div>
                        <canvas id="level2-canvas" width="500" height="300"></canvas>
                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: #2ecc71;"></div>
                                <span>湿度分布</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: #e74c3c;"></div>
                                <span>扩散通量指示</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="controls-container">
                        <div class="section-title">
                            <i class="fas fa-sliders-h"></i> 墙体参数控制
                        </div>
                        
                        <div class="compact-layer-controls">
                            <!-- 第一层控制 -->
                            <div class="compact-layer-control">
                                <div class="compact-layer-title">第一层（外层）</div>
                                <div class="compact-param-row">
                                    <div class="compact-param-group">
                                        <div class="compact-param-label">厚度</div>
                                        <div class="compact-value-display" id="layer1-thickness-display">中等</div>
                                        <div class="compact-slider-wrapper">
                                            <input type="range" id="layer1-thickness-slider" min="0" max="2" step="1" value="1">
                                            <div class="slider-labels">
                                                <span>薄</span>
                                                <span>中</span>
                                                <span>厚</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="compact-param-group">
                                        <div class="compact-param-label">扩散系数</div>
                                        <div class="compact-value-display" id="layer1-diffusion-display">中等</div>
                                        <div class="compact-slider-wrapper">
                                            <input type="range" id="layer1-diffusion-slider" min="0" max="2" step="1" value="1">
                                            <div class="slider-labels">
                                                <span>低</span>
                                                <span>中</span>
                                                <span>高</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 第二层控制 -->
                            <div class="compact-layer-control">
                                <div class="compact-layer-title">第二层（中间）</div>
                                <div class="compact-param-row">
                                    <div class="compact-param-group">
                                        <div class="compact-param-label">厚度</div>
                                        <div class="compact-value-display" id="layer2-thickness-display">中等</div>
                                        <div class="compact-slider-wrapper">
                                            <input type="range" id="layer2-thickness-slider" min="0" max="2" step="1" value="1">
                                            <div class="slider-labels">
                                                <span>薄</span>
                                                <span>中</span>
                                                <span>厚</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="compact-param-group">
                                        <div class="compact-param-label">扩散系数</div>
                                        <div class="compact-value-display" id="layer2-diffusion-display">中等</div>
                                        <div class="compact-slider-wrapper">
                                            <input type="range" id="layer2-diffusion-slider" min="0" max="2" step="1" value="1">
                                            <div class="slider-labels">
                                                <span>低</span>
                                                <span>中</span>
                                                <span>高</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 第三层控制 -->
                            <div class="compact-layer-control">
                                <div class="compact-layer-title">第三层（内层）</div>
                                <div class="compact-param-row">
                                    <div class="compact-param-group">
                                        <div class="compact-param-label">厚度</div>
                                        <div class="compact-value-display" id="layer3-thickness-display">中等</div>
                                        <div class="compact-slider-wrapper">
                                            <input type="range" id="layer3-thickness-slider" min="0" max="2" step="1" value="1">
                                            <div class="slider-labels">
                                                <span>薄</span>
                                                <span>中</span>
                                                <span>厚</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="compact-param-group">
                                        <div class="compact-param-label">扩散系数</div>
                                        <div class="compact-value-display" id="layer3-diffusion-display">中等</div>
                                        <div class="compact-slider-wrapper">
                                            <input type="range" id="layer3-diffusion-slider" min="0" max="2" step="1" value="1">
                                            <div class="slider-labels">
                                                <span>低</span>
                                                <span>中</span>
                                                <span>高</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">当前扩散通量：<span id="flux-value">中等</span></label>
                            <div class="slider-value" id="flux-display" style="width:100%; text-align:center; padding:6px; font-size:1.2rem;">中等</div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">控制层指示：<span id="control-layer">无</span></label>
                            <div class="slider-value" id="control-layer-display" style="width:100%; text-align:center; padding:6px; font-size:1.1rem;">所有层扩散阻力相近</div>
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-flux-checkbox" checked>
                            <label for="show-flux-checkbox">显示扩散通量指示</label>
                        </div>
                    </div>
                </div>
                
                <div class="info-tips-row">
                    <div class="level-info">
                        <div class="info-title"><i class="fas fa-calculator"></i> 数学模型</div>
                        <div class="equation">
                            <p><strong>稳态扩散方程（菲克第一定律）:</strong></p>
                            <p>J = -D · dC/dx</p>
                            <p>其中：J为扩散通量，D为扩散系数，dC/dx为浓度梯度</p>
                            <p><strong>三层墙体串联模型:</strong></p>
                            <p>总扩散阻力 R = L₁/D₁ + L₂/D₂ + L₃/D₃</p>
                            <p>扩散通量 J = (C₁ - C₄) / R</p>
                            <p>其中：Lᵢ为第i层厚度，Dᵢ为第i层扩散系数，C₁和C₄为墙体两侧浓度</p>
                        </div>
                    </div>
                    
                    <div class="teaching-tips">
                        <div class="tips-title">
                            <i class="fas fa-lightbulb"></i> 教学提示
                        </div>
                        <div class="tips-content">
                            <p>本关卡旨在帮助您理解多层介质中的稳态扩散：</p>
                            <ul>
                                <li><strong>稳态扩散 ≠ 无扩散</strong>：浓度分布不随时间变化，但扩散持续进行</li>
                                <li><strong>串联阻力模型</strong>：总扩散阻力等于各层阻力之和</li>
                                <li><strong>控制层效应</strong>：扩散阻力最大的层成为整个过程的控制步骤</li>
                                <li><strong>工程设计启示</strong>：通过优化各层材料和厚度，控制水蒸气扩散速率</li>
                            </ul>
                            <p>尝试调节各层参数，观察控制层的变化和扩散通量的响应。</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="level-completion" id="level2-completion">
                <div class="completion-title"><i class="fas fa-check-circle"></i> 关卡完成！</div>
                <div class="completion-message">您已经完成了Level 2的学习，理解了多层墙体中的稳态扩散过程。点击下方按钮进入Level 3，学习新能源材料中的扩散应用。</div>
                <button id="to-level3" class="btn-next-level">
                    <i class="fas fa-arrow-right"></i> 进入 Level 3：新能源情境
                </button>
            </div>
        </div>
        
        <!-- Level 3: 新能源情境 -->
        <div class="level-content" id="level3">
            <div class="level-header">
                <h2 class="level-title"><i class="fas fa-charging-station"></i> Level 3: 锂离子电池电极颗粒扩散过程</h2>
                <div class="level-subtitle">新能源/新材料情境 · 充放电过程扩散模拟 | 正负极电极颗粒对比</div>
            </div>
            
            <div class="simulation-area">
                <div class="visualization-row">
                    <div class="visualization-container">
                        <div class="section-title">
                            <i class="fas fa-chart-area"></i> 电池电极颗粒内部锂离子浓度分布
                        </div>
                        <div class="dual-display">
                            <div class="display-half">
                                <div class="display-title" id="anode-title"><i class="fas fa-minus-circle"></i> 负极（石墨）</div>
                                <canvas id="level3-anode-canvas" width="220" height="220"></canvas>
                                <div class="size-indicator" id="anode-size-indicator">粒径: 中等</div>
                            </div>
                            <div class="display-half">
                                <div class="display-title" id="cathode-title"><i class="fas fa-plus-circle"></i> 正极（钴酸锂）</div>
                                <canvas id="level3-cathode-canvas" width="220" height="220"></canvas>
                                <div class="size-indicator" id="cathode-size-indicator">粒径: 中等</div>
                            </div>
                        </div>
                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: #f39c12;"></div>
                                <span>锂离子浓度</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: rgba(243, 156, 18, 0.2);"></div>
                                <span>浓度梯度堆积区域</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="controls-container">
                        <div class="section-title">
                            <i class="fas fa-sliders-h"></i> 仿真参数控制
                        </div>
                        
                        <!-- 颗粒尺寸和充放电速度在同一行 -->
                        <div class="parameter-row">
                            <div class="parameter-group">
                                <div class="control-group">
                                    <label class="control-label">颗粒尺寸：<span id="particle-size-value">中等</span></label>
                                    <div class="slider-container">
                                        <input type="range" id="particle-size-slider" min="0" max="4" step="1" value="2">
                                        <div class="slider-value" id="particle-size-display">中等</div>
                                    </div>
                                    <div class="slider-labels">
                                        <span>很小</span>
                                        <span>小</span>
                                        <span>中等</span>
                                        <span>大</span>
                                        <span>很大</span>
                                    </div>
                                </div>
                            </div>
                            <div class="parameter-group">
                                <div class="control-group">
                                    <label class="control-label">充放电速度：<span id="charging-rate-value">中等</span></label>
                                    <div class="slider-container">
                                        <input type="range" id="charging-rate-slider" min="0" max="4" step="1" value="2">
                                        <div class="slider-value" id="charging-rate-display">中等</div>
                                    </div>
                                    <div class="slider-labels">
                                        <span>很慢</span>
                                        <span>慢</span>
                                        <span>中等</span>
                                        <span>快</span>
                                        <span>很快</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 仿真时间和仿真模式在同一行 -->
                        <div class="simulation-time-row">
                            <div class="mode-group">
                                <div class="control-group">
                                    <label class="control-label">仿真模式</label>
                                    <div class="button-group">
                                        <button id="charge-mode-btn" class="btn-primary">
                                            <i class="fas fa-bolt"></i> 充电模式
                                        </button>
                                        <button id="discharge-mode-btn" class="btn-secondary">
                                            <i class="fas fa-plug"></i> 放电模式
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="time-group">
                                <div class="control-group">
                                    <label class="control-label">仿真时间：</label>
                                    <div class="time-slider-container">
                                        <div class="time-display" id="process-time-display">0.0 秒</div>
                                        <div class="slider-container">
                                            <input type="range" id="process-time-slider" min="0" max="100" step="1" value="0">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">仿真控制</label>
                            <div class="button-group">
                                <button id="start-btn" class="btn-success">
                                    <i class="fas fa-play"></i> 开始
                                </button>
                                <button id="pause-process-btn" class="btn-secondary">
                                    <i class="fas fa-pause"></i> 暂停
                                </button>
                                <button id="reset-process-btn" class="btn-secondary">
                                    <i class="fas fa-redo"></i> 重置
                                </button>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">性能限制指示：<span id="performance-limit">无</span></label>
                            <div class="slider-value" id="performance-display" style="width:40%; text-align:center; padding:5px; font-size:1.2rem; background-color: rgba(46, 204, 113, 0.2);">正常</div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">当前状态：<span id="current-state">待机</span></label>
                            <div class="slider-value" id="state-display" style="width:40%; text-align:center; padding:5px; font-size:1.1rem; background-color: rgba(64, 156, 255, 0.2);">未开始</div>
                        </div>
                    </div>
                </div>
                
                <div class="info-tips-row">
                    <div class="level-info">
                        <div class="info-title"><i class="fas fa-calculator"></i> 数学模型</div>
                        <div class="equation">
                            <p><strong>球形颗粒扩散方程:</strong></p>
                            <p>∂C/∂t = D · (∂²C/∂r² + 2/r · ∂C/∂r)</p>
                            <p>其中：C为锂离子浓度，t为时间，D为扩散系数，r为径向坐标</p>
                            <p><strong>充放电过程:</strong></p>
                            <p>1. <strong>充电过程</strong>：正极脱锂，负极嵌锂</p>
                            <p>&nbsp;&nbsp;正极：C<sub>表面</sub>减少，颜色变浅</p>
                            <p>&nbsp;&nbsp;负极：C<sub>表面</sub>增加，颜色变深</p>
                            <p>2. <strong>放电过程</strong>：正极嵌锂，负极脱锂</p>
                            <p>&nbsp;&nbsp;正极：C<sub>表面</sub>增加，颜色变深</p>
                            <p>&nbsp;&nbsp;负极：C<sub>表面</sub>减少，颜色变浅</p>
                        </div>
                    </div>
                    
                    <div class="teaching-tips">
                        <div class="tips-title">
                            <i class="fas fa-lightbulb"></i> 教学提示
                        </div>
                        <div class="tips-content">
                            <p>本关卡旨在帮助您理解锂离子电池充放电过程中的扩散机理：</p>
                            <ul>
                                <li><strong>充电过程</strong>：正极脱锂（锂离子从正极材料脱出），负极嵌锂（锂离子嵌入负极材料）</li>
                                <li><strong>放电过程</strong>：负极脱锂（锂离子从负极材料脱出），正极嵌锂（锂离子嵌入正极材料）</li>
                                <li><strong>扩散限制</strong>：快速充放电时，锂离子扩散速度可能成为性能瓶颈</li>
                                <li><strong>浓度梯度堆积</strong>：表面浓度快速变化，内部扩散跟不上，形成较大浓度梯度</li>
                                <li><strong>粒径效应</strong>：减小颗粒尺寸可以缩短扩散距离，改善倍率性能</li>
                            </ul>
                            <p>选择充电或放电模式，观察正负极颗粒的浓度变化差异。</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="level-completion" id="level3-completion">
                <div class="completion-title"><i class="fas fa-check-circle"></i> 关卡完成！</div>
                <div class="completion-message">您已经完成了所有三个关卡的学习，掌握了不同情境下的扩散传质原理。点击下方按钮进入工程师能力评测关。</div>
                <button id="to-assessment" class="btn-next-level">
                    <i class="fas fa-graduation-cap"></i> 进入工程师能力评测关
                </button>
            </div>
        </div>
        
        <!-- Level 4: 工程师能力评测 -->
        <div class="level-content" id="level4">
            <div class="level-header">
                <h2 class="level-title"><i class="fas fa-user-tie"></i> 工程师能力评测关</h2>
                <div class="level-subtitle">基于前三关学习内容，评估您的扩散传质理解深度</div>
            </div>
            
            <div class="assessment-question" id="question1">
                <div class="question-text">1. 在气味扩散模拟中，当走廊长度增加时，达到均匀浓度分布所需的时间会如何变化？</div>
                <div class="answer-options">
                    <div class="answer-option" data-question="1" data-answer="A">A. 显著减少</div>
                    <div class="answer-option" data-question="1" data-answer="B">B. 显著增加</div>
                    <div class="answer-option" data-question="1" data-answer="C">C. 基本不变</div>
                    <div class="answer-option" data-question="1" data-answer="D">D. 先减少后增加</div>
                </div>
            </div>
            
            <div class="assessment-question" id="question2">
                <div class="question-text">2. 在三层墙体水蒸气扩散模拟中，什么情况下扩散通量最大？</div>
                <div class="answer-options">
                    <div class="answer-option" data-question="2" data-answer="A">A. 所有层扩散系数低，厚度大</div>
                    <div class="answer-option" data-question="2" data-answer="B">B. 所有层扩散系数高，厚度小</div>
                    <div class="answer-option" data-question="2" data-answer="C">C. 只有一层扩散系数高，其余低</div>
                    <div class="answer-option" data-question="2" data-answer="D">D. 各层参数对总通量无影响</div>
                </div>
            </div>
            
            <div class="assessment-question" id="question3">
                <div class="question-text">3. 在三层墙体中，扩散控制层通常是哪一层？</div>
                <div class="answer-options">
                    <div class="answer-option" data-question="3" data-answer="A">A. 扩散系数最高的层</div>
                    <div class="answer-option" data-question="3" data-answer="B">B. 厚度最小的层</div>
                    <div class="answer-option" data-question="3" data-answer="C">C. 扩散阻力最大的层（L/D最大）</div>
                    <div class="answer-option" data-question="3" data-answer="D">D. 最靠近高湿度侧的层</div>
                </div>
            </div>
            
            <div class="assessment-question" id="question4">
                <div class="question-text">4. 在锂离子电池电极中，快速充电可能导致什么问题？</div>
                <div class="answer-options">
                    <div class="answer-option" data-question="4" data-answer="A">A. 电极颗粒尺寸自动减小</div>
                    <div class="answer-option" data-question="4" data-answer="B">B. 锂离子扩散速度加快</div>
                    <div class="answer-option" data-question="4" data-answer="C">C. 电极表面浓度快速变化，内部扩散跟不上</div>
                    <div class="answer-option" data-question="4" data-answer="D">D. 电池容量自动增加</div>
                </div>
            </div>
            
            <div class="assessment-question" id="question5">
                <div class="question-text">5. 为了改善电池的倍率性能，从扩散角度可以采取什么设计策略？</div>
                <div class="answer-options">
                    <div class="answer-option" data-question="5" data-answer="A">A. 增加电极颗粒尺寸</div>
                    <div class="answer-option" data-question="5" data-answer="B">B. 减小电极颗粒尺寸</div>
                    <div class="answer-option" data-question="5" data-answer="C">C. 增加电极厚度</div>
                    <div class="answer-option" data-question="5" data-answer="D">D. 降低材料扩散系数</div>
                </div>
            </div>
            
            <div class="assessment-question" id="question6">
                <div class="question-text">6. 一维扩散模型的主要局限性是什么？</div>
                <div class="answer-options">
                    <div class="answer-option" data-question="6" data-answer="A">A. 无法描述浓度随时间变化</div>
                    <div class="answer-option" data-question="6" data-answer="B">B. 忽略了二维或三维空间效应</div>
                    <div class="answer-option" data-question="6" data-answer="C">C. 不能用于工程实际设计</div>
                    <div class="answer-option" data-question="6" data-answer="D">D. 无法解释稳态扩散</div>
                </div>
            </div>
            
            <div class="button-group" style="justify-content: center; margin-top: 30px;">
                <button id="submit-assessment" class="btn-success" style="padding: 15px 30px; font-size: 1.2rem;">
                    <i class="fas fa-paper-plane"></i> 提交评测
                </button>
            </div>
            
            <div class="result-container" id="result-container">
                <div class="result-title">工程师能力评测结果</div>
                <div class="result-level" id="result-level">助理工程师</div>
                <div class="result-description" id="result-description">
                    您能够正确描述浓度随空间和时间的变化趋势，区分稳态与瞬态扩散过程，指出长度、扩散能力等主要影响因素。
                </div>
                
                <div class="next-steps">
                    <div class="next-steps-title"><i class="fas fa-graduation-cap"></i> 建议的下一步学习方向</div>
                    <div id="next-steps-content">
                        建议深入学习扩散的基本数学模型（菲克定律），理解浓度梯度与扩散通量的定量关系，以及不同边界条件对扩散过程的影响。
                    </div>
                </div>
                
                <div class="improvement-areas" id="improvement-areas">
                    <div class="improvement-title"><i class="fas fa-lightbulb"></i> 需要加强的知识领域</div>
                    <div id="improvement-content">
                        建议重点复习扩散的基本概念，特别是浓度梯度与扩散速度的关系，以及影响扩散过程的主要因素。
                    </div>
                </div>
                
                <div class="button-group" style="justify-content: center; margin-top: 20px;">
                    <button id="retry-assessment" class="btn-warning">
                        <i class="fas fa-redo"></i> 重新评测
                    </button>
                    <button id="review-content" class="btn-secondary">
                        <i class="fas fa-book"></i> 复习学习内容
                    </button>
                </div>
            </div>
        </div>
        


    <script>
        // 全局变量定义
        let currentLevel = 1;
        let isPlaying = false;
        let animationId = null;
        
        // Level 1 变量
        let level1Time = 0;
        let level1Length = 1; // 0:短, 1:中, 2:长
        let level1Diffusion = 1; // 0:低, 1:中, 2:高
        let level1Concentration = [];
        let level1Completed = false;
        
        // Level 2 变量 - 更新为紧凑布局
        let level2Layers = [
            { thickness: 1, diffusion: 1 }, // 第一层
            { thickness: 1, diffusion: 1 }, // 第二层
            { thickness: 1, diffusion: 1 }  // 第三层
        ];
        let level2Completed = false;
        
        // Level 3 变量
        let level3IsProcessing = false;
        let level3ProcessTime = 0;
        let level3ParticleSize = 2; // 0:很小, 1:小, 2:中等, 3:大, 4:很大
        let level3Rate = 2; // 0:很慢, 1:慢, 2:中等, 3:快, 4:很快
        let level3IsChargingMode = true; // true:充电模式, false:放电模式
        let level3Completed = false;
        
        // 浓度数组
        let level3AnodeConcentration = [];
        let level3CathodeConcentration = [];
        
        // 评测答案
        const correctAnswers = {
            1: "B",
            2: "B",
            3: "C",
            4: "C",
            5: "B",
            6: "B"
        };
        
        // 等级描述 - 更新为更详细的反馈
        const levelDescriptions = {
            "assistant": "您能够正确描述浓度随空间和时间的变化趋势，区分稳态与瞬态扩散过程，指出长度、扩散能力等主要影响因素。对于一维扩散的基本概念有初步理解，能够识别扩散过程中的关键变量。",
            "engineer": "您能够判断扩散控制步骤，解释材料或结构改变对通量/性能的影响，并将模型结论用于工程情境解释。能够应用菲克定律分析简单工程问题，理解多层介质扩散中的串联阻力模型。",
            "senior": "您能够从扩散机理反推设计策略，权衡不同设计方案的利弊，指出模型假设的局限性，并提出改进方向。具备解决复杂扩散问题的能力，能够将一维扩散模型扩展到实际工程应用场景。"
        };
        
        // 下一步学习建议 - 根据等级不同提供不同建议
        const nextSteps = {
            "assistant": "建议深入学习扩散的基本数学模型（菲克定律），理解浓度梯度与扩散通量的定量关系，以及不同边界条件对扩散过程的影响。完成Level 1和Level 2的交互式练习，掌握扩散过程的核心参数影响。",
            "engineer": "建议研究包含对流、化学反应的多物理场传质模型，学习数值模拟方法，并将扩散理论应用于实际工程案例分析。可以进一步学习二维和三维扩散模型，理解更复杂的扩散场景。",
            "senior": "建议探索高级传质理论（非菲克扩散、多孔介质扩散），研究材料微结构设计与扩散性能的关联，以及多尺度建模方法。可以考虑学习计算流体动力学(CFD)工具进行复杂扩散过程模拟。"
        };
        
        // 需要加强的知识领域 - 针对不同等级提供具体建议
        const improvementAreas = {
            "assistant": "建议重点复习扩散的基本概念，特别是浓度梯度与扩散速度的关系，以及影响扩散过程的主要因素。需要加强对菲克第一定律和第二定律的理解，掌握稳态与瞬态扩散的区别。建议重新完成Level 1和Level 2的练习，重点关注参数变化对扩散过程的影响。",
            "engineer": "建议加强对多层介质扩散中控制层概念的理解，掌握串联阻力模型的计算方法。需要提高对工程实际问题的分析能力，特别是如何将扩散理论应用于材料选择和结构设计。可以进一步研究不同边界条件对扩散过程的影响。",
            "senior": "建议深入研究扩散模型的局限性，特别是二维和三维效应的影响。需要加强对复杂扩散问题的分析能力，包括非线性扩散、多组分扩散等高级主题。可以考虑学习更先进的数值模拟方法，提高解决实际工程问题的能力。"
        };
        
        // 初始化函数
        function init() {
            // 初始化标签页切换
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const level = this.getAttribute('data-level');
                    switchLevel(parseInt(level));
                });
            });
            
            // Level 1 初始化
            initLevel1();
            
            // Level 2 初始化 - 更新为紧凑布局
            initLevel2();
            
            // Level 3 初始化
            initLevel3();
            
            // 评测关初始化
            initAssessment();
            
            // 初始化导航按钮
            initNavigationButtons();
            
            // 初始化所有可视化
            updateAllVisualizations();
            
            // 检查关卡完成状态
            checkLevelCompletion();
        }
        
        // 初始化导航按钮
        function initNavigationButtons() {
            // Level 1 到 Level 2
            document.getElementById('to-level2').addEventListener('click', function() {
                switchLevel(2);
            });
            
            // Level 2 到 Level 3
            document.getElementById('to-level3').addEventListener('click', function() {
                switchLevel(3);
            });
            
            // Level 3 到评测关
            document.getElementById('to-assessment').addEventListener('click', function() {
                switchLevel(4);
            });
            
            // 评测关的复习按钮
            document.getElementById('review-content').addEventListener('click', function() {
                // 根据评测结果决定回到哪个关卡复习
                const resultLevel = document.getElementById('result-level').textContent;
                if (resultLevel.includes("助理工程师")) {
                    // 助理工程师需要从基础开始复习
                    switchLevel(1);
                } else if (resultLevel.includes("工程师")) {
                    // 工程师可以从Level 2开始复习
                    switchLevel(2);
                } else {
                    // 专业工程师可以从Level 3开始复习
                    switchLevel(3);
                }
            });
        }
        
        // 检查关卡完成状态
        function checkLevelCompletion() {
            // Level 1 完成条件：播放仿真至少30秒
            if (level1Time >= 30 && !level1Completed) {
                level1Completed = true;
                document.getElementById('level1-completion').classList.add('active');
            }
            
            // Level 2 完成条件：调整过所有参数
            if (currentLevel >= 2 && !level2Completed) {
                level2Completed = true;
                document.getElementById('level2-completion').classList.add('active');
            }
            
            // Level 3 完成条件：播放仿真至少20秒
            if (level3ProcessTime >= 20 && !level3Completed) {
                level3Completed = true;
                document.getElementById('level3-completion').classList.add('active');
            }
        }
        
        // 切换关卡
        function switchLevel(level) {
            // 停止所有动画
            stopAllAnimations();
            
            // 更新标签页状态
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.tab[data-level="${level}"]`).classList.add('active');
            
            // 更新内容显示
            document.querySelectorAll('.level-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`level${level}`).classList.add('active');
            
            // 更新当前关卡
            currentLevel = level;
            
            // 检查关卡完成状态
            checkLevelCompletion();
            
            // 更新可视化
            updateAllVisualizations();
        }
        
        // 停止所有动画
        function stopAllAnimations() {
            isPlaying = false;
            level3IsProcessing = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }
        
        // 初始化 Level 1
        function initLevel1() {
            // 初始化浓度数组
            initLevel1Concentration();
            
            // 绑定滑块事件
            document.getElementById('length-slider').addEventListener('input', function() {
                level1Length = parseInt(this.value);
                const values = ["短", "中等", "长"];
                document.getElementById('length-value').textContent = values[level1Length];
                document.getElementById('length-display').textContent = values[level1Length];
                initLevel1Concentration();
                updateLevel1Visualization();
            });
            
            document.getElementById('diffusion-slider').addEventListener('input', function() {
                level1Diffusion = parseInt(this.value);
                const values = ["低", "中等", "高"];
                document.getElementById('diffusion-value').textContent = values[level1Diffusion];
                document.getElementById('diffusion-display').textContent = values[level1Diffusion];
                updateLevel1Visualization();
            });
            
            document.getElementById('time-slider').addEventListener('input', function() {
                level1Time = parseFloat(this.value);
                document.getElementById('time-display').textContent = level1Time.toFixed(1);
                updateLevel1Concentration();
                updateLevel1Visualization();
                checkLevelCompletion();
            });
            
            // 绑定按钮事件
            document.getElementById('play-btn').addEventListener('click', function() {
                isPlaying = true;
                animateLevel1();
            });
            
            document.getElementById('pause-btn').addEventListener('click', function() {
                isPlaying = false;
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
            });
            
            document.getElementById('reset-btn').addEventListener('click', function() {
                isPlaying = false;
                level1Time = 0;
                document.getElementById('time-slider').value = 0;
                document.getElementById('time-display').textContent = "0.0";
                initLevel1Concentration();
                updateLevel1Visualization();
                
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
            });
        }
        
        // 初始化 Level 1 浓度数组
        function initLevel1Concentration() {
            const lengthMap = [30, 50, 80]; // 短、中、长对应的网格点数
            const n = lengthMap[level1Length];
            level1Concentration = new Array(n).fill(0);
            
            // 在左端设置初始浓度
            for (let i = 0; i < Math.min(5, n); i++) {
                level1Concentration[i] = 1.0;
            }
        }
        
        // 更新 Level 1 浓度分布（基于时间）
        function updateLevel1Concentration() {
            const diffusionCoeffMap = [0.01, 0.03, 0.05]; // 低、中、高扩散系数
            const D = diffusionCoeffMap[level1Diffusion];
            const dt = 0.1;
            const n = level1Concentration.length;
            
            // 模拟扩散过程（简化的一维扩散方程）
            let newConcentration = [...level1Concentration];
            
            // 执行多次迭代以模拟时间推进
            const iterations = Math.floor(level1Time / dt);
            for (let iter = 0; iter < iterations; iter++) {
                const temp = [...newConcentration];
                
                for (let i = 1; i < n - 1; i++) {
                    // 使用简单的有限差分法
                    const laplacian = temp[i-1] - 2*temp[i] + temp[i+1];
                    newConcentration[i] = temp[i] + D * laplacian;
                }
                
                // 边界条件：左端封闭（无通量）
                newConcentration[0] = newConcentration[1];
                // 右端封闭（无通量）
                newConcentration[n-1] = newConcentration[n-2];
                
                // 确保浓度在合理范围内
                for (let i = 0; i < n; i++) {
                    if (newConcentration[i] < 0) newConcentration[i] = 0;
                    if (newConcentration[i] > 1) newConcentration[i] = 1;
                }
            }
            
            level1Concentration = newConcentration;
        }
        
        // Level 1 动画函数
        function animateLevel1() {
            if (!isPlaying) return;
            
            // 更新时间
            level1Time += 0.1;
            if (level1Time > 100) level1Time = 100;
            
            // 更新UI
            document.getElementById('time-slider').value = level1Time;
            document.getElementById('time-display').textContent = level1Time.toFixed(1);
            
            // 更新浓度和可视化
            updateLevel1Concentration();
            updateLevel1Visualization();
            
            // 检查完成状态
            checkLevelCompletion();
            
            // 继续动画
            animationId = requestAnimationFrame(animateLevel1);
        }
        
        // 更新 Level 1 可视化
        function updateLevel1Visualization() {
            const canvas = document.getElementById('level1-canvas');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const n = level1Concentration.length;
            
            // 清空画布
            ctx.clearRect(0, 0, width, height);
            
            // 绘制背景（走廊）
            ctx.fillStyle = 'rgba(13, 27, 42, 0.8)';
            ctx.fillRect(0, 0, width, height);
            
            // 绘制走廊边界
            ctx.strokeStyle = 'rgba(64, 156, 255, 0.5)';
            ctx.lineWidth = 2;
            ctx.strokeRect(10, 10, width - 20, height - 20);
            
            // 绘制浓度分布
            const barWidth = (width - 40) / n;
            const maxBarHeight = height - 60;
            
            for (let i = 0; i < n; i++) {
                const x = 20 + i * barWidth;
                const barHeight = level1Concentration[i] * maxBarHeight;
                const y = height - 30 - barHeight;
                
                // 使用颜色表示浓度
                const colorValue = Math.floor(level1Concentration[i] * 255);
                ctx.fillStyle = `rgba(64, 156, 255, ${0.2 + level1Concentration[i] * 0.8})`;
                ctx.fillRect(x, y, barWidth - 2, barHeight);
                
                // 绘制浓度梯度区域
                if (i < n - 1) {
                    const gradient = Math.abs(level1Concentration[i] - level1Concentration[i+1]);
                    if (gradient > 0.1) {
                        ctx.fillStyle = `rgba(64, 156, 255, 0.1)`;
                        ctx.fillRect(x, y, barWidth * 2, barHeight);
                    }
                }
            }
            
            // 标注
            ctx.fillStyle = '#e0f7fa';
            ctx.font = '14px Arial';
            ctx.fillText('走廊起点（气味源）', 15, height - 15);
            ctx.fillText('走廊终点（封闭）', width - 120, height - 15);
            
            // 绘制时间指示
            ctx.fillStyle = '#409cff';
            ctx.font = 'bold 16px Arial';
            ctx.fillText(`时间: ${level1Time.toFixed(1)} 秒`, width / 2 - 50, 30);
            
            // 绘制浓度图例
            const gradient = ctx.createLinearGradient(20, 50, width - 20, 50);
            gradient.addColorStop(0, '#409cff');
            gradient.addColorStop(1, 'rgba(64, 156, 255, 0.2)');
            ctx.fillStyle = gradient;
            ctx.fillRect(20, 50, width - 40, 10);
            
            ctx.fillStyle = '#e0f7fa';
            ctx.font = '12px Arial';
            ctx.fillText('高浓度', 20, 45);
            ctx.fillText('低浓度', width - 60, 45);
        }
        
        // 初始化 Level 2 - 更新为紧凑布局
        function initLevel2() {
            // 绑定第一层滑块事件
            document.getElementById('layer1-thickness-slider').addEventListener('input', function() {
                level2Layers[0].thickness = parseInt(this.value);
                const values = ["薄", "中等", "厚"];
                document.getElementById('layer1-thickness-display').textContent = values[level2Layers[0].thickness];
                updateLevel2Visualization();
            });
            
            document.getElementById('layer1-diffusion-slider').addEventListener('input', function() {
                level2Layers[0].diffusion = parseInt(this.value);
                const values = ["低", "中等", "高"];
                document.getElementById('layer1-diffusion-display').textContent = values[level2Layers[0].diffusion];
                updateLevel2Visualization();
            });
            
            // 绑定第二层滑块事件
            document.getElementById('layer2-thickness-slider').addEventListener('input', function() {
                level2Layers[1].thickness = parseInt(this.value);
                const values = ["薄", "中等", "厚"];
                document.getElementById('layer2-thickness-display').textContent = values[level2Layers[1].thickness];
                updateLevel2Visualization();
            });
            
            document.getElementById('layer2-diffusion-slider').addEventListener('input', function() {
                level2Layers[1].diffusion = parseInt(this.value);
                const values = ["低", "中等", "高"];
                document.getElementById('layer2-diffusion-display').textContent = values[level2Layers[1].diffusion];
                updateLevel2Visualization();
            });
            
            // 绑定第三层滑块事件
            document.getElementById('layer3-thickness-slider').addEventListener('input', function() {
                level2Layers[2].thickness = parseInt(this.value);
                const values = ["薄", "中等", "厚"];
                document.getElementById('layer3-thickness-display').textContent = values[level2Layers[2].thickness];
                updateLevel2Visualization();
            });
            
            document.getElementById('layer3-diffusion-slider').addEventListener('input', function() {
                level2Layers[2].diffusion = parseInt(this.value);
                const values = ["低", "中等", "高"];
                document.getElementById('layer3-diffusion-display').textContent = values[level2Layers[2].diffusion];
                updateLevel2Visualization();
            });
            
            // 绑定复选框事件
            document.getElementById('show-flux-checkbox').addEventListener('change', function() {
                updateLevel2Visualization();
            });
        }
        
        // 更新 Level 2 可视化
        function updateLevel2Visualization() {
            const canvas = document.getElementById('level2-canvas');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // 清空画布
            ctx.clearRect(0, 0, width, height);
            
            // 绘制背景
            ctx.fillStyle = 'rgba(13, 27, 42, 0.8)';
            ctx.fillRect(0, 0, width, height);
            
            // 计算墙体参数
            const thicknessMap = [0.2, 0.3, 0.4]; // 薄、中、厚对应的比例
            const diffusionMap = [0.2, 0.5, 0.8]; // 低、中、高扩散能力
            
            // 计算各层厚度和扩散系数
            const layerThicknesses = level2Layers.map(layer => thicknessMap[layer.thickness]);
            const layerDiffusions = level2Layers.map(layer => diffusionMap[layer.diffusion]);
            
            // 计算总厚度和扩散阻力
            let totalThickness = layerThicknesses.reduce((a, b) => a + b, 0);
            let totalResistance = 0;
            let maxResistance = 0;
            let controlLayerIndex = 0;
            
            for (let i = 0; i < 3; i++) {
                const resistance = layerThicknesses[i] / layerDiffusions[i];
                totalResistance += resistance;
                if (resistance > maxResistance) {
                    maxResistance = resistance;
                    controlLayerIndex = i;
                }
            }
            
            // 计算扩散通量（假设两侧浓度差为1）
            const flux = 1.0 / totalResistance;
            
            // 更新通量显示
            let fluxText;
            if (flux > 1.2) {
                fluxText = "高";
                document.getElementById('flux-display').style.backgroundColor = "rgba(46, 204, 113, 0.3)";
            } else if (flux > 0.8) {
                fluxText = "中等";
                document.getElementById('flux-display').style.backgroundColor = "rgba(241, 196, 15, 0.3)";
            } else {
                fluxText = "低";
                document.getElementById('flux-display').style.backgroundColor = "rgba(231, 76, 60, 0.3)";
            }
            
            document.getElementById('flux-value').textContent = fluxText;
            document.getElementById('flux-display').textContent = fluxText;
            
            // 更新控制层显示
            const layerNames = ["第一层（外层）", "第二层（中间）", "第三层（内层）"];
            document.getElementById('control-layer').textContent = layerNames[controlLayerIndex];
            document.getElementById('control-layer-display').textContent = `控制层: ${layerNames[controlLayerIndex]}`;
            
            // 绘制墙体
            const wallX = width * 0.1;
            const wallWidth = width * 0.8;
            const wallY = height * 0.2;
            const wallHeight = height * 0.6;
            
            // 计算各层起始位置和宽度
            let currentX = wallX;
            const layerWidths = layerThicknesses.map(thickness => thickness * wallWidth / totalThickness);
            
            // 定义层颜色
            const layerColors = [
                'rgba(52, 152, 219, 0.8)',  // 第一层蓝色
                'rgba(46, 204, 113, 0.8)',   // 第二层绿色
                'rgba(155, 89, 182, 0.8)'    // 第三层紫色
            ];
            
            // 绘制各层墙体
            for (let i = 0; i < 3; i++) {
                const layerWidth = layerWidths[i];
                
                // 绘制墙体层
                ctx.fillStyle = layerColors[i];
                ctx.fillRect(currentX, wallY, layerWidth, wallHeight);
                
                // 如果是控制层，添加高亮效果
                if (i === controlLayerIndex) {
                    ctx.strokeStyle = '#e74c3c';
                    ctx.lineWidth = 3;
                    ctx.strokeRect(currentX, wallY, layerWidth, wallHeight);
                    
                    // 绘制控制层标识
                    ctx.fillStyle = '#e74c3c';
                    ctx.font = 'bold 14px Arial';
                    ctx.fillText('控制层', currentX + layerWidth/2 - 30, wallY + wallHeight/2);
                }
                
                // 绘制分界线
                if (i < 2) {
                    ctx.strokeStyle = '#34495e';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(currentX + layerWidth, wallY);
                    ctx.lineTo(currentX + layerWidth, wallY + wallHeight);
                    ctx.stroke();
                }
                
                currentX += layerWidth;
            }
            
            // 绘制湿度分布曲线
            ctx.strokeStyle = '#2ecc71';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            const leftHumidity = 1.0;  // 左侧高湿度
            const rightHumidity = 0.2; // 右侧低湿度
            
            // 计算各层分界点处的湿度
            let currentHumidity = leftHumidity;
            let currentXPos = wallX;
            
            ctx.moveTo(currentXPos, wallY + wallHeight * (1 - currentHumidity * 0.8));
            
            for (let i = 0; i < 3; i++) {
                const layerWidth = layerWidths[i];
                const resistance = layerThicknesses[i] / layerDiffusions[i];
                const humidityDrop = (leftHumidity - rightHumidity) * (resistance / totalResistance);
                
                currentXPos += layerWidth;
                currentHumidity -= humidityDrop;
                
                ctx.lineTo(currentXPos, wallY + wallHeight * (1 - currentHumidity * 0.8));
            }
            
            ctx.stroke();
            
            // 绘制湿度指示点
            ctx.fillStyle = '#2ecc71';
            ctx.beginPath();
            ctx.arc(wallX, wallY + wallHeight * (1 - leftHumidity * 0.8), 6, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(wallX + wallWidth, wallY + wallHeight * (1 - rightHumidity * 0.8), 6, 0, Math.PI * 2);
            ctx.fill();
            
            // 标注湿度值
            ctx.fillStyle = '#27ae60';
            ctx.font = 'bold 14px Arial';
            ctx.fillText('高湿度', wallX - 50, wallY + wallHeight * (1 - leftHumidity * 0.8));
            ctx.fillText('低湿度', wallX + wallWidth + 10, wallY + wallHeight * (1 - rightHumidity * 0.8));
            
            // 绘制扩散通量指示
            const showFlux = document.getElementById('show-flux-checkbox').checked;
            if (showFlux) {
                ctx.fillStyle = '#e74c3c';
                ctx.font = 'bold 18px Arial';
                ctx.fillText(`扩散通量: ${fluxText}`, width / 2 - 50, 30);
                
                // 绘制通量箭头
                const arrowCount = Math.floor(flux * 5) + 1;
                const arrowSpacing = wallHeight / (arrowCount + 1);
                
                for (let i = 1; i <= arrowCount; i++) {
                    const arrowY = wallY + arrowSpacing * i;
                    
                    // 绘制箭头
                    ctx.fillStyle = '#e74c3c';
                    ctx.beginPath();
                    ctx.moveTo(wallX + wallWidth + 20, arrowY);
                    ctx.lineTo(wallX + wallWidth + 40, arrowY - 8);
                    ctx.lineTo(wallX + wallWidth + 40, arrowY + 8);
                    ctx.closePath();
                    ctx.fill();
                    
                    // 绘制箭头线
                    ctx.strokeStyle = '#e74c3c';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(wallX - 20, arrowY);
                    ctx.lineTo(wallX + wallWidth + 20, arrowY);
                    ctx.stroke();
                }
            }
            
            // 绘制墙体标注
            ctx.fillStyle = '#b0e0e6';
            ctx.font = 'bold 18px Arial';
            ctx.fillText('三层复合墙体', wallX + wallWidth / 2 - 50, wallY + wallHeight + 40);
        }
        
        // 初始化 Level 3
        function initLevel3() {
            // 初始化浓度数组
            initLevel3Concentration();
            
            // 绑定滑块事件
            document.getElementById('particle-size-slider').addEventListener('input', function() {
                level3ParticleSize = parseInt(this.value);
                const values = ["很小", "小", "中等", "大", "很大"];
                document.getElementById('particle-size-value').textContent = values[level3ParticleSize];
                document.getElementById('particle-size-display').textContent = values[level3ParticleSize];
                initLevel3Concentration();
                updateLevel3Visualization();
            });
            
            document.getElementById('charging-rate-slider').addEventListener('input', function() {
                level3Rate = parseInt(this.value);
                const values = ["很慢", "慢", "中等", "快", "很快"];
                document.getElementById('charging-rate-value').textContent = values[level3Rate];
                document.getElementById('charging-rate-display').textContent = values[level3Rate];
                updateLevel3Visualization();
            });
            
            document.getElementById('process-time-slider').addEventListener('input', function() {
                level3ProcessTime = parseFloat(this.value);
                document.getElementById('process-time-display').textContent = level3ProcessTime.toFixed(1) + " 秒";
                updateLevel3Concentration();
                updateLevel3Visualization();
                checkLevelCompletion();
            });
            
            // 绑定模式切换按钮
            document.getElementById('charge-mode-btn').addEventListener('click', function() {
                level3IsChargingMode = true;
                document.getElementById('charge-mode-btn').classList.add('btn-primary');
                document.getElementById('charge-mode-btn').classList.remove('btn-secondary');
                document.getElementById('discharge-mode-btn').classList.add('btn-secondary');
                document.getElementById('discharge-mode-btn').classList.remove('btn-primary');
                updateLevel3Visualization();
            });
            
            document.getElementById('discharge-mode-btn').addEventListener('click', function() {
                level3IsChargingMode = false;
                document.getElementById('discharge-mode-btn').classList.add('btn-primary');
                document.getElementById('discharge-mode-btn').classList.remove('btn-secondary');
                document.getElementById('charge-mode-btn').classList.add('btn-secondary');
                document.getElementById('charge-mode-btn').classList.remove('btn-primary');
                updateLevel3Visualization();
            });
            
            // 绑定按钮事件
            document.getElementById('start-btn').addEventListener('click', function() {
                level3IsProcessing = true;
                animateLevel3();
            });
            
            document.getElementById('pause-process-btn').addEventListener('click', function() {
                level3IsProcessing = false;
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
            });
            
            document.getElementById('reset-process-btn').addEventListener('click', function() {
                level3IsProcessing = false;
                level3ProcessTime = 0;
                document.getElementById('process-time-slider').value = 0;
                document.getElementById('process-time-display').textContent = "0.0 秒";
                initLevel3Concentration();
                updateLevel3Visualization();
                
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
            });
        }
        
        // 初始化 Level 3 浓度数组
        function initLevel3Concentration() {
            const sizeMap = [15, 25, 40, 55, 70];
            const n = sizeMap[level3ParticleSize];
            
            // 初始状态：50%电荷状态
            level3AnodeConcentration = new Array(n).fill(0.5);
            level3CathodeConcentration = new Array(n).fill(0.5);
        }
        
        // 更新 Level 3 浓度分布
        function updateLevel3Concentration() {
            const rateMap = [0.002, 0.005, 0.01, 0.02, 0.03];
            const rate = rateMap[level3Rate];
            const n = level3AnodeConcentration.length;
            
            // 根据充放电模式更新表面浓度
            if (level3IsChargingMode) {
                // 充电模式：负极嵌锂（浓度增加），正极脱锂（浓度减少）
                const anodeSurfaceConcentration = Math.min(0.5 + level3ProcessTime * rate, 1.0);
                const cathodeSurfaceConcentration = Math.max(0.5 - level3ProcessTime * rate, 0.0);
                
                level3AnodeConcentration[n-1] = anodeSurfaceConcentration;
                level3CathodeConcentration[n-1] = cathodeSurfaceConcentration;
            } else {
                // 放电模式：负极脱锂（浓度减少），正极嵌锂（浓度增加）
                const anodeSurfaceConcentration = Math.max(0.5 - level3ProcessTime * rate, 0.0);
                const cathodeSurfaceConcentration = Math.min(0.5 + level3ProcessTime * rate, 1.0);
                
                level3AnodeConcentration[n-1] = anodeSurfaceConcentration;
                level3CathodeConcentration[n-1] = cathodeSurfaceConcentration;
            }
            
            // 模拟内部扩散
            const diffusionCoeff = 0.02;
            const dt = 0.1;
            
            // 执行多次迭代以模拟时间推进
            const iterations = Math.floor(level3ProcessTime / dt);
            for (let iter = 0; iter < iterations; iter++) {
                // 负极扩散
                const anodeTemp = [...level3AnodeConcentration];
                for (let i = 1; i < n - 1; i++) {
                    const laplacian = anodeTemp[i-1] - 2*anodeTemp[i] + anodeTemp[i+1];
                    level3AnodeConcentration[i] = anodeTemp[i] + diffusionCoeff * laplacian;
                }
                level3AnodeConcentration[0] = level3AnodeConcentration[1];
                
                // 正极扩散
                const cathodeTemp = [...level3CathodeConcentration];
                for (let i = 1; i < n - 1; i++) {
                    const laplacian = cathodeTemp[i-1] - 2*cathodeTemp[i] + cathodeTemp[i+1];
                    level3CathodeConcentration[i] = cathodeTemp[i] + diffusionCoeff * laplacian;
                }
                level3CathodeConcentration[0] = level3CathodeConcentration[1];
                
                // 确保浓度在合理范围内
                for (let i = 0; i < n; i++) {
                    if (level3AnodeConcentration[i] < 0) level3AnodeConcentration[i] = 0;
                    if (level3AnodeConcentration[i] > 1) level3AnodeConcentration[i] = 1;
                    
                    if (level3CathodeConcentration[i] < 0) level3CathodeConcentration[i] = 0;
                    if (level3CathodeConcentration[i] > 1) level3CathodeConcentration[i] = 1;
                }
            }
            
            // 检查性能限制
            const maxGradient = calculateMaxGradient();
            updatePerformanceIndicator(maxGradient);
            updateStateDisplay();
        }
        
        // 计算最大浓度梯度
        function calculateMaxGradient() {
            let maxGradient = 0;
            // 检查正负极中较大的梯度
            for (let i = 0; i < level3AnodeConcentration.length - 1; i++) {
                const anodeGradient = Math.abs(level3AnodeConcentration[i] - level3AnodeConcentration[i+1]);
                const cathodeGradient = Math.abs(level3CathodeConcentration[i] - level3CathodeConcentration[i+1]);
                
                if (anodeGradient > maxGradient) maxGradient = anodeGradient;
                if (cathodeGradient > maxGradient) maxGradient = cathodeGradient;
            }
            return maxGradient;
        }
        
        // 更新性能限制指示
        function updatePerformanceIndicator(maxGradient) {
            const performanceElement = document.getElementById('performance-display');
            const limitElement = document.getElementById('performance-limit');
            
            if (maxGradient > 0.15) {
                performanceElement.textContent = "严重受限";
                performanceElement.style.backgroundColor = "rgba(231, 76, 60, 0.3)";
                limitElement.textContent = "扩散限制严重";
            } else if (maxGradient > 0.08) {
                performanceElement.textContent = "受限";
                performanceElement.style.backgroundColor = "rgba(241, 196, 15, 0.3)";
                limitElement.textContent = "轻微扩散限制";
            } else {
                performanceElement.textContent = "正常";
                performanceElement.style.backgroundColor = "rgba(46, 204, 113, 0.3)";
                limitElement.textContent = "无";
            }
        }
        
        // 更新状态显示
        function updateStateDisplay() {
            const stateElement = document.getElementById('state-display');
            const currentStateElement = document.getElementById('current-state');
            
            if (level3ProcessTime === 0) {
                stateElement.textContent = "未开始";
                currentStateElement.textContent = "待机";
            } else if (level3IsChargingMode) {
                stateElement.textContent = "充电中";
                currentStateElement.textContent = "充电";
            } else {
                stateElement.textContent = "放电中";
                currentStateElement.textContent = "放电";
            }
        }
        
        // Level 3 动画函数
        function animateLevel3() {
            if (!level3IsProcessing) return;
            
            // 更新时间
            level3ProcessTime += 0.1;
            if (level3ProcessTime > 100) level3ProcessTime = 100;
            
            // 更新UI
            document.getElementById('process-time-slider').value = level3ProcessTime;
            document.getElementById('process-time-display').textContent = level3ProcessTime.toFixed(1) + " 秒";
            
            // 更新浓度和可视化
            updateLevel3Concentration();
            updateLevel3Visualization();
            
            // 检查完成状态
            checkLevelCompletion();
            
            // 继续动画
            animationId = requestAnimationFrame(animateLevel3);
        }
        
        // 更新 Level 3 可视化
        function updateLevel3Visualization() {
            // 更新负极可视化
            updateElectrodeVisualization('anode', level3AnodeConcentration, true);
            
            // 更新正极可视化
            updateElectrodeVisualization('cathode', level3CathodeConcentration, false);
            
            // 更新粒径指示
            updateSizeIndicators();
            
            // 更新模式指示
            updateModeIndicators();
        }
        
        // 更新电极可视化
        function updateElectrodeVisualization(electrode, concentration, isAnode) {
            const canvas = document.getElementById(`level3-${electrode}-canvas`);
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height /1.2;
            const n = concentration.length;
            
            // 清空画布
            ctx.clearRect(0, 0, width, height);
            
            // 绘制背景
            ctx.fillStyle = 'rgba(13, 27, 42, 0.8)';
            ctx.fillRect(0, 0, width, height);
            
            // 计算粒子半径（基于粒子大小）
            const sizeMap = [0.2, 0.35, 0.5, 0.65, 0.8];
            const radius = Math.min(width, height) * 0.3 * sizeMap[level3ParticleSize];
            const centerX = width / 2;
            const centerY = height / 2;
            
            // 绘制浓度分布
            for (let i = 0; i < n; i++) {
                const innerRadius = (i / n) * radius;
                const outerRadius = ((i + 1) / n) * radius;
                const conc = concentration[i];
                
                // 使用颜色表示浓度
                const alpha = 0.3 + conc * 0.7;
                
                // 负极和正极使用不同颜色
                if (isAnode) {
                    ctx.fillStyle = `rgba(52, 152, 219, ${alpha})`;
                } else {
                    ctx.fillStyle = `rgba(231, 76, 60, ${alpha})`;
                }
                
                // 绘制环形区域
                ctx.beginPath();
                ctx.arc(centerX, centerY, outerRadius, 0, Math.PI * 2);
                ctx.arc(centerX, centerY, innerRadius, Math.PI * 2, 0, true);
                ctx.fill();
                
                // 绘制浓度梯度区域
                if (i < n - 1) {
                    const gradient = Math.abs(concentration[i] - concentration[i+1]);
                    if (gradient > 0.1) {
                        ctx.fillStyle = isAnode ? 
                            `rgba(52, 152, 219, 0.2)` : 
                            `rgba(231, 76, 60, 0.2)`;
                        ctx.beginPath();
                        ctx.arc(centerX, centerY, outerRadius, 0, Math.PI * 2);
                        ctx.arc(centerX, centerY, innerRadius, Math.PI * 2, 0, true);
                        ctx.fill();
                    }
                }
            }
            
            // 绘制颗粒边界
            ctx.strokeStyle = isAnode ? '#3498db' : '#e74c3c';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctx.stroke();
            
            // 标注
            ctx.fillStyle = '#e0f7fa';
            ctx.font = '12px Arial';
            ctx.fillText('颗粒中心', centerX - 25, centerY);
            ctx.fillText('表面', centerX + radius * 0.7, centerY - radius * 0.7);
            
            // 绘制锂离子移动方向
            ctx.strokeStyle = isAnode ? '#3498db' : '#e74c3c';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius + 10, 0, Math.PI * 2);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // 绘制箭头表示锂离子移动
            for (let i = 0; i < 4; i++) {
                const angle = (i / 4) * Math.PI * 2;
                const x = centerX + (radius + 15) * Math.cos(angle);
                const y = centerY + (radius + 15) * Math.sin(angle);
                
                ctx.fillStyle = isAnode ? '#3498db' : '#e74c3c';
                ctx.beginPath();
                
                // 根据充放电模式和电极确定箭头方向
                if (level3IsChargingMode) {
                    // 充电模式：负极箭头向内（嵌锂），正极箭头向外（脱锂）
                    if (isAnode) {
                        // 负极：箭头向内
                        ctx.moveTo(x, y);
                        ctx.lineTo(x - 8 * Math.cos(angle + 0.3), y - 8 * Math.sin(angle + 0.3));
                        ctx.lineTo(x - 8 * Math.cos(angle - 0.3), y - 8 * Math.sin(angle - 0.3));
                    } else {
                        // 正极：箭头向外
                        ctx.moveTo(x, y);
                        ctx.lineTo(x + 8 * Math.cos(angle + 0.3), y + 8 * Math.sin(angle + 0.3));
                        ctx.lineTo(x + 8 * Math.cos(angle - 0.3), y + 8 * Math.sin(angle - 0.3));
                    }
                } else {
                    // 放电模式：负极箭头向外（脱锂），正极箭头向内（嵌锂）
                    if (isAnode) {
                        // 负极：箭头向外
                        ctx.moveTo(x, y);
                        ctx.lineTo(x + 8 * Math.cos(angle + 0.3), y + 8 * Math.sin(angle + 0.3));
                        ctx.lineTo(x + 8 * Math.cos(angle - 0.3), y + 8 * Math.sin(angle - 0.3));
                    } else {
                        // 正极：箭头向内
                        ctx.moveTo(x, y);
                        ctx.lineTo(x - 8 * Math.cos(angle + 0.3), y - 8 * Math.sin(angle + 0.3));
                        ctx.lineTo(x - 8 * Math.cos(angle - 0.3), y - 8 * Math.sin(angle - 0.3));
                    }
                }
                
                ctx.closePath();
                ctx.fill();
            }
            
            // 绘制浓度图例
            const gradient = ctx.createLinearGradient(20, height - 20, width - 20, height - 20);
            if (isAnode) {
                gradient.addColorStop(0, 'rgba(52, 152, 219, 0.3)');
                gradient.addColorStop(1, '#3498db');
            } else {
                gradient.addColorStop(0, 'rgba(231, 76, 60, 0.3)');
                gradient.addColorStop(1, '#e74c3c');
            }
            ctx.fillStyle = gradient;
            ctx.fillRect(20, height - 20, width - 40, 8);
            
            ctx.fillStyle = '#e0f7fa';
            ctx.font = '12px Arial';
            ctx.fillText('低浓度', 20, height - 25);
            ctx.fillText('高浓度', width - 45, height - 25);
        }
        
        // 更新粒径指示
        function updateSizeIndicators() {
            const sizeLabels = ["很小 (5μm)", "小 (10μm)", "中等 (20μm)", "大 (30μm)", "很大 (40μm)"];
            document.getElementById('anode-size-indicator').textContent = `粒径: ${sizeLabels[level3ParticleSize]}`;
            document.getElementById('cathode-size-indicator').textContent = `粒径: ${sizeLabels[level3ParticleSize]}`;
        }
        
        // 更新模式指示
        function updateModeIndicators() {
            if (level3IsChargingMode) {
                document.getElementById('anode-title').innerHTML = '<i class="fas fa-minus-circle"></i> 负极（石墨）- 嵌锂中';
                document.getElementById('cathode-title').innerHTML = '<i class="fas fa-plus-circle"></i> 正极（钴酸锂）- 脱锂中';
            } else {
                document.getElementById('anode-title').innerHTML = '<i class="fas fa-minus-circle"></i> 负极（石墨）- 脱锂中';
                document.getElementById('cathode-title').innerHTML = '<i class="fas fa-plus-circle"></i> 正极（钴酸锂）- 嵌锂中';
            }
        }
        
        // 初始化评测关
        function initAssessment() {
            // 为每个答案选项添加点击事件
            document.querySelectorAll('.answer-option').forEach(option => {
                option.addEventListener('click', function() {
                    const questionNum = this.getAttribute('data-question');
                    const answer = this.getAttribute('data-answer');
                    
                    // 清除同一问题的其他选项的选中状态
                    const options = document.querySelectorAll(`.answer-option[data-question="${questionNum}"]`);
                    options.forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // 设置当前选项为选中状态
                    this.classList.add('selected');
                    
                    // 存储答案
                    this.dataset.selected = "true";
                });
            });
            
            // 提交评测按钮事件
            document.getElementById('submit-assessment').addEventListener('click', function() {
                calculateAssessmentResult();
            });
            
            // 重新评测按钮事件
            document.getElementById('retry-assessment').addEventListener('click', function() {
                document.querySelectorAll('.answer-option').forEach(option => {
                    option.classList.remove('selected');
                    delete option.dataset.selected;
                });
                
                document.getElementById('result-container').classList.remove('active');
            });
        }
        
        // 计算评测结果
        function calculateAssessmentResult() {
            let score = 0;
            const totalQuestions = Object.keys(correctAnswers).length;
            
            // 检查每个问题的答案
            for (let i = 1; i <= totalQuestions; i++) {
                const selectedOption = document.querySelector(`.answer-option[data-question="${i}"].selected`);
                if (selectedOption && selectedOption.getAttribute('data-answer') === correctAnswers[i]) {
                    score++;
                }
            }
            
            // 确定等级
            let level, description, nextStep, improvement;
            
            if (score >= 5) {
                level = "专业工程师";
                description = levelDescriptions.senior;
                nextStep = nextSteps.senior;
                improvement = improvementAreas.senior;
            } else if (score >= 3) {
                level = "工程师";
                description = levelDescriptions.engineer;
                nextStep = nextSteps.engineer;
                improvement = improvementAreas.engineer;
            } else {
                level = "助理工程师";
                description = levelDescriptions.assistant;
                nextStep = nextSteps.assistant;
                improvement = improvementAreas.assistant;
            }
            
            // 显示结果
            document.getElementById('result-level').textContent = level;
            document.getElementById('result-description').textContent = description;
            document.getElementById('next-steps-content').textContent = nextStep;
            document.getElementById('improvement-content').textContent = improvement;
            document.getElementById('result-container').classList.add('active');
            
            // 滚动到结果区域
            document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
        }
        
        // 更新所有可视化
        function updateAllVisualizations() {
            if (currentLevel === 1) {
                updateLevel1Visualization();
            } else if (currentLevel === 2) {
                updateLevel2Visualization();
            } else if (currentLevel === 3) {
                updateLevel3Visualization();
            }
        }
        
        // 页面加载完成后初始化
        window.addEventListener('load', init);
    </script>



    <!-- 底部信息栏 -->
    <div style="
        text-align: center;
        padding: 20px 30px;
        margin-top: 40px;
        color: #93c5fd;
        font-size: 0.9rem;
        border-top: 2px solid rgba(56, 189, 248, 0.5);
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.9));
        border-radius: 15px 15px 0 0;
        box-shadow: 0 -10px 30px rgba(56, 189, 248, 0.1);
        position: relative;
        overflow: hidden;
    ">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, #38bdf8, #0ea5e9, #38bdf8);"></div>
        
        <p style="font-size: 1.3rem; font-weight: bold; margin-bottom: 15px; color: #38bdf8;">
            一维扩散传质仿真系统进阶 &copy; 2025 | 工程思维训练系统 | 版本 1.0 | 
        
        <style="margin-bottom: 12px; color: #cbd5e1;">
             <strong>邮箱:</strong> xgyanger@qq.com
        </p>
        
      
        <div style="margin-top: 15px; display: flex; justify-content: center; gap: 15px;">
            <span style="color: #ff9e00; font-weight: bold; font-size: 1.1rem;">
                版权©2025 AIknow. 保留所有权利 | Copyright ©2025 AIknow. All rights reserved.
            </span>
        </div>
    </div>


</body>
</html>