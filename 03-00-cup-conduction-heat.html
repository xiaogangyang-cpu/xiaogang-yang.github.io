<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŒ¶æ¯çƒ­å†²å‡»æ¨¡æ‹Ÿå®éªŒå®¤ - å·¥ç¨‹çƒ­ç‰©ç†ä¸ææ–™ç§‘å­¦</title>
    <style>
        :root {
            /* é¢œè‰²å˜é‡ä¼˜åŒ– - ä½¿ç”¨æ›´ç³»ç»Ÿçš„å‘½å */
            --color-primary: #00b4ff;
            --color-secondary: #6c8cff;
            --color-success: #00ff9d;
            --color-warning: #ffcc00;
            --color-danger: #ff3366;
            --color-highlight: #e94560;
            --color-light: #ecf0f1;
            --color-dark: #121212;
            
            /* èƒŒæ™¯é¢œè‰²å˜é‡ */
            --bg-dark: #0a0f2b;
            --bg-card: #121a3a;
            --bg-panel: rgba(30, 30, 46, 0.85);
            --bg-overlay: rgba(40, 40, 60, 0.7);
            
            /* æ–‡æœ¬é¢œè‰² */
            --text-light: #e6f7ff;
            --text-muted: rgba(230, 247, 255, 0.7);
            
            /* è¾¹æ¡†é¢œè‰² */
            --border-color: rgba(42, 58, 122, 0.3);
            --border-light: rgba(255, 255, 255, 0.1);
            
            /* ç‰¹æ•ˆé¢œè‰² */
            --glow-primary: rgba(0, 180, 255, 0.3);
            --glow-highlight: rgba(233, 69, 96, 0.3);
            
            /* ææ–™é¢œè‰² */
            --color-wood: #8B4513;
            --color-glass: rgba(135, 206, 235, 0.85);
            --color-copper: #b87333;
            --color-ceramic: #d8c7b5;
            --color-metal: #c0c0c0;
            
            /* é—´è·å˜é‡ */
            --spacing-xs: 5px;
            --spacing-sm: 10px;
            --spacing-md: 15px;
            --spacing-lg: 20px;
            --spacing-xl: 30px;
            --spacing-xxl: 40px;
            
            /* åœ†è§’å˜é‡ */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 25px;
            
            /* é˜´å½±å˜é‡ */
            --shadow-sm: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 6px 20px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.2);
            --shadow-xl: 0 20px 60px rgba(0, 0, 0, 0.3);
            
            /* åŠ¨ç”»é€Ÿåº¦ */
            --transition-fast: 0.2s;
            --transition-normal: 0.3s;
            --transition-slow: 0.5s;
            
            /* Z-indexå±‚çº§ */
            --z-background: -1;
            --z-base: 1;
            --z-content: 10;
            --z-overlay: 100;
            --z-modal: 1000;
        }

        /* é‡ç½®å’ŒåŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #151d40 100%);
            color: var(--text-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* æ€§èƒ½ä¼˜åŒ–ï¼šå‡å°‘é‡ç»˜åŒºåŸŸ */
        .will-change {
            will-change: transform, opacity;
        }

        /* å®¹å™¨æ ·å¼ */
        .container {
            width: 100%;
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 var(--spacing-lg);
        }

        /* å¤´éƒ¨æ ·å¼ */
        .header-container {
            padding: var(--spacing-xxl) var(--spacing-lg) var(--spacing-lg);
            text-align: center;
            position: relative;
            z-index: var(--z-content);
        }

        .page-title {
            font-size: clamp(2rem, 5vw, 2.5em);
            background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: var(--spacing-sm);
            font-weight: 700;
            line-height: 1.2;
            text-shadow: 0 0 20px var(--glow-primary);
        }

        .page-subtitle {
            font-size: clamp(0.9rem, 2vw, 1.1em);
            color: var(--text-muted);
            margin-bottom: var(--spacing-xl);
            font-style: italic;
        }

        /* å¯¼èˆªæ  */
        .navbar {
            background: rgba(10, 10, 26, 0.9);
            backdrop-filter: blur(10px);
            padding: var(--spacing-md) var(--spacing-xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(233, 69, 96, 0.3);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-lg);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .logo-icon {
            font-size: 2.5rem;
            color: var(--color-highlight);
            transition: transform var(--transition-normal);
        }

        .logo-icon:hover {
            transform: scale(1.1);
        }

        .logo-text h2 {
            font-size: 1.8rem;
            background: linear-gradient(90deg, var(--color-highlight), #3498db);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: var(--spacing-xs);
        }

        .nav-controls {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            background: rgba(233, 69, 96, 0.15);
            border: 1px solid rgba(233, 69, 96, 0.3);
            border-radius: var(--radius-md);
            color: var(--color-light);
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: 500;
            white-space: nowrap;
        }

        .nav-btn:hover:not(:disabled) {
            background: rgba(233, 69, 96, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(233, 69, 96, 0.2);
        }

        .nav-btn:active {
            transform: translateY(0);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-container {
            flex: 1;
            display: flex;
            gap: var(--spacing-lg);
            padding: var(--spacing-lg);
        }

        /* é¢æ¿é€šç”¨æ ·å¼ */
        .panel {
            background: var(--bg-panel);
            backdrop-filter: blur(15px);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-lg);
            z-index: var(--z-content);
        }

        .panel-header {
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--color-highlight);
        }

        .panel-header h2 {
            font-size: 1.6rem;
            color: var(--color-light);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            width: 380px;
            min-width: 320px;
            display: flex;
            flex-direction: column;
        }

        /* å…¬å¼å¡ç‰‡ */
        .formula-card {
            background: linear-gradient(135deg, 
                rgba(233, 69, 96, 0.15), 
                rgba(52, 152, 219, 0.15));
            border: 1px solid rgba(233, 69, 96, 0.3);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin: var(--spacing-md) 0;
            text-align: center;
            transition: all var(--transition-normal);
        }

        .formula-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(233, 69, 96, 0.2);
        }

        .formula-text {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--color-highlight);
            font-family: 'Cambria', 'Times New Roman', serif;
            text-shadow: 0 0 15px rgba(233, 69, 96, 0.3);
            margin-bottom: var(--spacing-sm);
        }

        /* æ§åˆ¶ç»„ */
        .control-group {
            margin-bottom: var(--spacing-xl);
            background: var(--bg-overlay);
            padding: var(--spacing-lg);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            font-weight: 600;
            font-size: 1.2rem;
        }

        /* é€‰æ‹©æ¡†æ ·å¼ä¼˜åŒ– */
        select {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            background: rgba(20, 20, 40, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            color: var(--color-light);
            font-size: 1rem;
            cursor: pointer;
            transition: all var(--transition-normal);
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            padding-right: 45px;
        }

        select:hover, select:focus {
            background-color: rgba(30, 30, 50, 0.9);
            border-color: var(--color-highlight);
            box-shadow: 0 0 15px rgba(233, 69, 96, 0.2);
            outline: none;
        }

        /* æ»‘å—æ ·å¼ä¼˜åŒ– */
        .slider-container {
            position: relative;
            margin-top: var(--spacing-sm);
            padding: var(--spacing-md) 0;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: linear-gradient(90deg, var(--color-primary), var(--color-highlight));
            border-radius: 3px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: var(--color-light);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(233, 69, 96, 0.8);
            transition: all var(--transition-fast);
            border: 3px solid var(--color-highlight);
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(233, 69, 96, 1);
        }

  .thickness-value {
    position: absolute;
    top: -15px;
    left: 20%;
    transform: translateX(-50%);
    /* ä½¿ç”¨rgbaè®¾ç½®èƒŒæ™¯é€æ˜åº¦ */
    background: rgba(233, 69, 96, 0.7);
    color: white;
    padding: var(--spacing-xs) var(--spacing-lg);
    border-radius: var(--radius-xl);
    font-weight: 700;
    font-size: 1rem;
    white-space: nowrap;
    /* è°ƒæ•´é˜´å½±é€æ˜åº¦ï¼Œä½¿å…¶ä¸èƒŒæ™¯åè°ƒ */
    box-shadow: 0 4px 12px rgba(233, 69, 96, 0.2);
    pointer-events: none;
}

        /* æŒ‰é’®ç»„ */
        .button-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }

        button {
            padding: var(--spacing-lg);
            font-size: 1.2rem;
            font-weight: 600;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-success), #27ae60);
            color: white;
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(46, 204, 113, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #7f8c8d, #95a5a6);
            color: white;
            box-shadow: 0 6px 20px rgba(149, 165, 166, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(149, 165, 166, 0.5);
        }

        /* æ¨¡æ‹ŸåŒºåŸŸ */
        .simulation-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 0;
            position: relative;
        }

        .simulation-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            width: 100%;
        }

        .simulation-header h1 {
            font-size: clamp(1.8rem, 4vw, 2.8rem);
            background: linear-gradient(90deg, var(--color-highlight), #3498db);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: var(--spacing-md);
        }

        #simContainer {
            position: relative;
            width: 100%;
            max-width: 900px;
            height: 500px;
            min-height: 400px;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            background: linear-gradient(145deg, #0f3460, #1a1a2e);
            border: 2px solid rgba(233, 69, 96, 0.2);
            contain: content; /* æ€§èƒ½ä¼˜åŒ– */
        }

        #simCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        /* æ¸©åº¦æ˜¾ç¤º */
        .temperature-display {
            position: absolute;
            bottom: 150px;
            left: 15%;
            transform: translateX(-50%);
            background: rgba(10, 10, 26, 0.35);
        
            padding: var(--spacing-lg) var(--spacing-xl);
            border-radius: var(--radius-md);
            text-align: center;
            min-width: 160px;
            z-index: var(--z-content);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: var(--shadow-lg);
        }

        .temp-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: var(--spacing-xs);
            transition: color var(--transition-normal);
        }

        /* è­¦å‘ŠæŒ‡ç¤ºå™¨ */
        .warning-indicator {
            position: absolute;
            top: var(--spacing-lg);
            right: var(--spacing-lg);
            background: linear-gradient(135deg, 
                rgba(231, 76, 60, 0.3), 
                rgba(243, 156, 18, 0.3));
            border: 1px solid rgba(231, 76, 60, 0.6);
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            font-weight: 700;
            display: none;
            animation: pulse 1.5s infinite;
            z-index: var(--z-overlay);
            backdrop-filter: blur(5px);
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 1;
                box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
            }
            50% { 
                opacity: 0.7;
                box-shadow: 0 0 30px rgba(231, 76, 60, 0.8);
            }
        }

        /* ä¿¡æ¯é¢æ¿ */
        .info-panel {
            width: 380px;
            min-width: 320px;
            display: flex;
            flex-direction: column;
        }

        /* åé¦ˆæ¡† */
        .feedback-box {
            background: var(--bg-overlay);
            border-radius: var(--radius-md);
            padding: var(--spacing-xl);
            flex: 1;
            margin-bottom: var(--spacing-xl);
            border: 1px solid var(--border-light);
       
            max-height: 300px;
        }

        .feedback-content {
            font-size: 1.1rem;
            line-height: 1.6;
        }

        /* å¾½ç« å®¹å™¨ */
        .badge-container {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }

        .badge {
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--radius-xl);
            font-weight: 700;
            font-size: 0.9rem;
            text-align: center;
            flex: 1;
            min-width: 140px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all var(--transition-normal);
        }

        .badge:hover {
            transform: translateY(-2px);
        }

        /* å‚æ•°æ˜¾ç¤º */
        .parameter-display {
            background: var(--bg-overlay);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin-top: var(--spacing-md);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .param-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-sm);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 1rem;
        }

   /* --- è¯„æµ‹ç¯èŠ‚æ ·å¼ --- */
        .evaluation-section {
            background: rgba(15, 52, 96, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 25px;
            border-left:  4px solid var(--color-highlight);
        }

        .evaluation-title {
            font-size: 1.3rem;
            color: var(--light);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .evaluation-criteria {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .criterion {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .criterion:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .criterion.met {
            border-left: 4px solid var(--success);
        }

        .criterion.not-met {
            border-left: 4px solid var(--danger);
        }

        .criterion-value {
            font-weight: 700;
        }

        .evaluation-result {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            text-align: center;
        }

        .evaluation-grade {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--highlight);
        }





        /* å®éªŒæ­¥éª¤ */
        .steps-container {
            display: flex;
            justify-content: space-between;
            margin: var(--spacing-lg) 0;
            position: relative;
        }

        .steps-container::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 10%;
            right: 10%;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            z-index: var(--z-base);
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: var(--z-content);
            width: 80px;
        }

        .step-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
            transition: all var(--transition-normal);
            border: 2px solid transparent;
        }

        .step-label {
            font-size: 0.85rem;
            text-align: center;
            color: var(--text-muted);
        }

        .step.active .step-number {
            background: var(--color-highlight);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(233, 69, 96, 0.5);
        }

        .step.completed .step-number {
            background: var(--color-success);
            color: white;
        }

        /* èƒŒæ™¯è£…é¥° */
        .bg-decoration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: var(--z-background);
            overflow: hidden;
        }

        .engineering-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 180, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 180, 255, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: var(--z-background);
        }

        /* åº•éƒ¨æ  */
        .footer {
            text-align: center;
            padding: var(--spacing-xl);
            margin-top: var(--spacing-xxl);
            color: var(--text-light);
            font-size: 0.9rem;
            border-top: 2px solid rgba(0, 180, 255, 0.5);
            background: linear-gradient(135deg, 
                rgba(10, 15, 43, 0.95), 
                rgba(18, 26, 58, 0.9));
            position: relative;
        }

        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                var(--color-primary), 
                var(--color-secondary), 
                var(--color-primary));
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1400px) {
            .main-container {
                flex-direction: column;
                align-items: center;
            }
            
            .control-panel,
            .info-panel {
                width: 100%;
                max-width: 900px;
            }
            
            .simulation-area {
                order: -1;
            }
            
            #simContainer {
                max-width: 800px;
                height: 450px;
            }
        }

        @media (max-width: 992px) {
            .navbar {
                flex-direction: column;
                gap: var(--spacing-md);
                padding: var(--spacing-md);
            }
            
            .nav-controls {
                width: 100%;
                justify-content: center;
            }
            
            .main-container {
                padding: var(--spacing-md);
            }
            
            .panel {
                padding: var(--spacing-lg);
            }
        }

        @media (max-width: 768px) {
            .header-container {
                padding: var(--spacing-lg) var(--spacing-md);
            }
            
            .page-title {
                font-size: 1.8rem;
            }
            
            .simulation-header h1 {
                font-size: 1.5rem;
            }
            
            #simContainer {
               
 font-size: 1.5rem;
 height: 400px;
            }
            
            .temperature-display {
                position: relative;
                left: 50%;
                bottom: auto;
                top: var(--spacing-lg);
                transform: translateX(-50%);
                width: 90%;
                min-width: auto;
            }
            
            .control-panel,
            .info-panel {
                padding: var(--spacing-md);
                min-width: auto;
            }
            
            .formula-text {
                font-size: 2rem;
            }
            
            .feedback-box {
                max-height: 250px;
            }
        }

        @media (max-width: 480px) {
            .main-container {
                padding: var(--spacing-sm);
            }
            
            .nav-btn {
                padding: var(--spacing-xs) var(--spacing-md);
                font-size: 0.9rem;
            }
            
            .formula-text {
                font-size: 1.8rem;
            }
            
            .temp-value {
                font-size: 1.8rem;
            }
            
            #simContainer {
                height: 350px;
            }
        }

        /* æ‰“å°æ ·å¼ */
        @media print {
            .navbar,
            .nav-controls,
            .warning-indicator,
            .bg-decoration,
            .engineering-grid {
                display: none !important;
            }
            
            body {
                background: white;
                color: black;
            }
            
            .panel {
                background: white;
                color: black;
                box-shadow: none;
                border: 1px solid #ddd;
            }
            
            .feedback-box {
                max-height: none;
                overflow: visible;
            }
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            position: relative;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* å·¥å…·æç¤º */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            white-space: nowrap;
            z-index: var(--z-overlay);
            margin-bottom: var(--spacing-xs);
        }

        /* é«˜äº®æ–‡æœ¬ */
        .highlight-text {
            color: var(--color-highlight);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯ç½‘æ ¼ -->
    <div class="engineering-grid"></div>

    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="header-container">
        <h1 class="page-title">èŒ¶æ¯çƒ­å†²å‡»æ¨¡æ‹Ÿå®éªŒå®¤</h1>
        <p class="page-subtitle">æ¢ç´¢ææ–™çƒ­ä¼ å¯¼ç‰¹æ€§ä¸çƒ­åº”åŠ›ç ´åæœºåˆ¶ | å·¥ç¨‹çƒ­ç‰©ç†ä¸ææ–™ç§‘å­¦ç»¼åˆå®éªŒ</p>
    </div>

    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar container" role="navigation" aria-label="ä¸»å¯¼èˆª">
        <div class="logo">
            <div class="logo-icon" role="img" aria-label="å®éªŒå®¤å›¾æ ‡">âš—ï¸</div>
            <div class="logo-text">
                <h2>çƒ­ä¼ é€’å½±å“æ¨¡æ‹Ÿæ¢ç´¢</h2>
            </div>
        </div>
        <div class="nav-controls">
            <button class="nav-btn" onclick="showInstructions()" aria-label="å®éªŒæŒ‡å—">
                <span>ğŸ“– å®éªŒæŒ‡å—</span>
            </button>
            <button class="nav-btn" onclick="showTheory()" aria-label="çƒ­ä¼ å¯¼ç†è®º">
                <span>ğŸ“š çƒ­ä¼ å¯¼ç†è®º</span>
            </button>
            <button class="nav-btn" onclick="showExportOptions()" aria-label="å¯¼å‡ºæ•°æ®">
                <span>ğŸ“Š å¯¼å‡ºæ•°æ®</span>
            </button>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-container container">
        <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
        <section class="control-panel panel" aria-labelledby="control-panel-title">
            <div class="panel-header">
                <h2 id="control-panel-title">ğŸ¯ è¯„æµ‹ç›®æ ‡ä¸è¦æ±‚</h2>
                <p>ç†è§£çƒ­é˜» R ä¸åšåº¦ dã€çƒ­å¯¼ç‡ k çš„å…³ç³»ã€‚é€šè¿‡æ§åˆ¶æè´¨å’Œåšåº¦ï¼Œä½¿ç»ç’ƒæ¡Œé¢äº§ç”Ÿ >40Â°C æ¸©å·®ä»¥è§¦å‘çƒ­å†²å‡»ç ´åã€‚</p>
            </div>
            
            <!-- å®éªŒæ­¥éª¤æŒ‡ç¤ºå™¨ -->
            <div class="steps-container">
                <div class="step active" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-label">å‚æ•°è®¾ç½®</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-label">å®éªŒè¿›è¡Œ</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-label">ç»“æœåˆ†æ</div>
                </div>
                <div class="step" id="step4">
                    <div class="step-number">4</div>
                    <div class="step-label">ç»¼åˆè¯„ä»·</div>
                </div>
            </div>
            
            <div class="formula-card" role="note" aria-label="çƒ­é˜»å…¬å¼">
                <div class="formula-text">R = d / k</div>
                <div class="formula-label">çƒ­é˜» = åšåº¦ / çƒ­å¯¼ç‡</div>
            </div>
            
            <!-- æè´¨é€‰æ‹© -->
            <div class="control-group">
                <div class="control-label">
                    <span class="tooltip" data-tooltip="ææ–™çš„çƒ­ä¼ å¯¼èƒ½åŠ›">1. é€‰æ‹©æè´¨ (çƒ­å¯¼ç‡ k)</span>
                    <span id="kValue">0.15 W/mÂ·K</span>
                </div>
                <select id="material" aria-label="é€‰æ‹©æè´¨">
                    <option value="0.03" data-color="#87CEEB">ç©ºæ°” (k=0.03) - æä½å¯¼çƒ­</option>
                    <option value="0.15" data-color="#8B4513" selected>å®æœ¨ (k=0.15) - ä½å¯¼çƒ­</option>
                    <option value="0.8" data-color="#d8c7b5">é™¶ç“· (k=0.8) - ä¸­ç­‰å¯¼çƒ­</option>
                    <option value="390" data-color="#b87333">é‡‘å±é“œ (k=390) - æé«˜å¯¼çƒ­</option>
                </select>
                <div style="margin-top: var(--spacing-sm); font-size: 0.95rem; color: var(--text-muted);">
                    æè´¨é¢„è§ˆ: <span id="materialPreview" style="color: #8B4513;">å®æœ¨è‰²</span>
                </div>
            </div>
            
            <!-- åšåº¦è°ƒæ•´ -->
            <div class="control-group">
                <div class="control-label">
                    <span class="tooltip" data-tooltip="èŒ¶æ¯æ‰˜çš„åšåº¦">2. è°ƒæ•´åšåº¦ (d)</span>
                    <span id="thickVal">10.0 mm</span>
                </div>
                <div class="slider-container">
                    <div class="thickness-value" id="thicknessDisplay">10.0 mm</div>
                    <input type="range" id="thickness" min="0.5" max="25" step="0.5" value="10" 
                           aria-label="è°ƒæ•´åšåº¦" aria-valuemin="0.5" aria-valuemax="25" aria-valuenow="10">
                </div>
                <div class="slider-labels">
                    <span>è–„ (0.5 mm)</span>
                    <span>åš (25 mm)</span>
                </div>
            </div>
            
            <!-- æ§åˆ¶æŒ‰é’® -->
            <div class="button-group">
                <button id="startBtn" class="btn-primary" onclick="startTest()" aria-label="å¼€å§‹å®éªŒ">
                    <span>ğŸ”¥ æ”¾ç½® 95Â°C çƒ­èŒ¶æ¯</span>
                </button>
                <button id="resetBtn" class="btn-secondary" onclick="resetLab()" aria-label="é‡ç½®å®éªŒ">
                    <span>ğŸ”„ é‡ç½®å®éªŒ</span>
                </button>
            </div>
      

            <!-- è¯„æµ‹æ ‡å‡† -->
            <div class="evaluation-section">
                <div class="evaluation-title">
                    <span>ğŸ“‹ è¯„æµ‹æ ‡å‡†</span>
                </div>
                <div class="evaluation-criteria" id="evaluationCriteria">
                    <div class="criterion" id="criterion1">
                        <span>æ¸©å·®è¾¾åˆ° 40Â°C</span>
                        <span class="criterion-value">æœªè¾¾æˆ</span>
                    </div>
                    <div class="criterion" id="criterion2">
                        <span>çƒ­é˜»å€¼åˆç†</span>
                        <span class="criterion-value">-</span>
                    </div>
                    <div class="criterion" id="criterion3">
                        <span>å®éªŒæ—¶é—´æ§åˆ¶</span>
                        <span class="criterion-value">-</span>
                    </div>
                </div>
            </div>
        </div>
        </section>

        <!-- ä¸­é—´æ¨¡æ‹ŸåŒºåŸŸ -->
        <section class="simulation-area" aria-labelledby="simulation-title">
            <div class="simulation-header">

                <p>è§‚å¯Ÿçƒ­ä¼ å¯¼è¿‡ç¨‹ï¼Œç›‘æµ‹æ¸©åº¦å˜åŒ–ï¼Œåˆ†æçƒ­åº”åŠ›ç ´å</p>
            </div>
            
            <div id="simContainer" role="application" aria-label="çƒ­å†²å‡»æ¨¡æ‹Ÿå™¨">
                <canvas id="simCanvas" width="900" height="500"></canvas>
                
                <div class="temperature-display" role="status" aria-live="polite">
                    <div class="temp-value" id="tempValue">25.0Â°C</div>
                    <div class="temp-label">ç»ç’ƒä¸Šè¡¨é¢æ¸©åº¦</div>
                    <div style="font-size: 1.1rem; margin-top: var(--spacing-xs);">
                        æ¸©å·® Î”T: <span id="deltaT" style="font-weight: 700;">0.0Â°C</span>
                    </div>
                </div>
                
                <div class="warning-indicator" id="warningIndicator" role="alert">
                    âš ï¸ ä¸´ç•ŒçŠ¶æ€ï¼æ¥è¿‘çƒ­å†²å‡»ç ´å
                </div>
            </div>
            
            <!-- å®éªŒçŠ¶æ€æŒ‡ç¤º -->
            <div class="experiment-status">
                <div class="status-box">
                    <div class="status-label">å®éªŒçŠ¶æ€</div>
                    <div id="experimentStatusDisplay" class="status-value">å¾…å¼€å§‹</div>
                </div>
            </div>
        </section>

        <!-- å³ä¾§ä¿¡æ¯é¢æ¿ -->
        <section class="info-panel panel" aria-labelledby="info-panel-title">
            <div class="panel-header">
                <h2 id="info-panel-title">ğŸ“Š å®éªŒåˆ†æä¸è¯„ä»·</h2>
                <p>åŸºäºå·¥ç¨‹çƒ­ç‰©ç†åŸç†çš„å®æ—¶åˆ†æç³»ç»Ÿ</p>
            </div>
            
            <div class="feedback-box">
                <div class="feedback-content" id="feedback">
                    <p>æ¬¢è¿ä½¿ç”¨èŒ¶æ¯çƒ­å†²å‡»æ¨¡æ‹Ÿå™¨ï¼</p>
                    <p>æœ¬å®éªŒæ—¨åœ¨å¸®åŠ©æ‚¨ç†è§£ææ–™çƒ­ä¼ å¯¼ç‰¹æ€§ä¸çƒ­åº”åŠ›ç ´åçš„å…³ç³»ã€‚</p>
                    <p style="margin-top: var(--spacing-md);"><strong>è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š</strong></p>
                    <ol style="margin-left: 20px; margin-top: var(--spacing-sm);">
                        <li>é€‰æ‹©èŒ¶æ¯æ‰˜æè´¨å¹¶è°ƒæ•´åšåº¦</li>
                        <li>ç‚¹å‡»"æ”¾ç½®çƒ­èŒ¶æ¯"å¼€å§‹å®éªŒ</li>
                        <li>è§‚å¯Ÿæ¸©åº¦å˜åŒ–å’Œçƒ­ä¼ å¯¼è¿‡ç¨‹</li>
                        <li>åˆ†æç»“æœå¹¶è·å¾—å·¥ç¨‹å¸ˆè¯„çº§</li>
                    </ol>
                </div>
                
                <!-- å®éªŒç»“æœè¯„çº§ -->
                <div id="resultRating" style="display: none; margin-top: var(--spacing-lg);">
                    <div style="font-size: 1.2rem; font-weight: 700; margin-bottom: var(--spacing-sm);">å®éªŒç»“æœè¯„çº§</div>
                    <div id="ratingDisplay" style="font-size: 2rem; font-weight: 800; color: #f39c12;">-</div>
                </div>
            </div>
            
            <!-- å‚æ•°æ˜¾ç¤º -->
            <div class="parameter-display">
                <div class="param-row">
                    <span>å½“å‰çƒ­é˜» R:</span>
                    <span id="rValue">66.67 mÂ²Â·K/W</span>
                </div>
                <div class="param-row">
                    <span>çƒ­æµé‡:</span>
                    <span id="heatFlow">1.05 W/mÂ²</span>
                </div>
                <div class="param-row">
                    <span>ä¸´ç•Œæ¸©å·®:</span>
                    <span>40.0 Â°C</span>
                </div>
                <div class="param-row">
                    <span>ææ–™å¯¼çƒ­æ•ˆç‡:</span>
                    <span id="conductionEfficiency">ä½</span>
                </div>
            </div>
            
            <!-- å¾½ç« åŒºåŸŸ -->
            <div id="badgeZone" class="badge-container"></div>
            
            <!-- è¯¦ç»†å‚æ•° -->
            <div class="parameter-display">
                <div class="param-row">
                    <span>å®éªŒæ—¶é—´:</span>
                    <span id="experimentTime">0.0 s</span>
                </div>
                <div class="param-row">
                    <span>æœ€å¤§æ¸©å·®:</span>
                    <span id="maxDeltaT">0.0Â°C</span>
                </div>
                <div class="param-row">
                    <span>çƒ­å†²å‡»å¼ºåº¦:</span>
                    <span id="thermalShock">æ— </span>
                </div>
            </div>
            
            <!-- ç»¼åˆè¯„ä»· -->
            <div class="evaluation-result" id="finalEvaluation" style="display: none;">
                <div class="evaluation-grade" id="finalGrade">-</div>
                <div id="evaluationText">ç­‰å¾…å®éªŒå®Œæˆ...</div>
            </div>
        </section>
    </main>

    <!-- åº•éƒ¨ä¿¡æ¯æ  -->
    <footer class="footer" role="contentinfo">
        <p style="font-size: 1.2rem; font-weight: bold; margin-bottom: var(--spacing-md); color: var(--color-primary);">
            èŒ¶æ¯çƒ­å†²å‡»æ¨¡æ‹Ÿå®éªŒå®¤ Â© 2025 | å·¥ç¨‹çƒ­ç‰©ç†ä¸ææ–™ç§‘å­¦ç»¼åˆå®éªŒå¹³å° | ç‰ˆæœ¬ 1.1 | 
        <style="margin-bottom: var(--spacing-sm); color: #cbd5e1;">
            <strong>é‚®ç®±:</strong> xgyanger@qq.com
        </p>
        <div style="margin-top: var(--spacing-md);">
            <span style="color: var(--color-warning); font-weight: bold; font-size: 1rem;">
                ç‰ˆæƒÂ©2025 AIknow. ä¿ç•™æ‰€æœ‰æƒåˆ© | Copyright Â©2025 AIknow. All rights reserved.
            </span>
        </div>
    </footer>

    <script>
        // ä¸¥æ ¼æ¨¡å¼
        'use strict';

        // ==================== å¸¸é‡å®šä¹‰ ====================
        const MATERIALS = {
            0.03: { name: "ç©ºæ°”", color: "#87CEEB", desc: "æä½å¯¼çƒ­" },
            0.15: { name: "å®æœ¨", color: "#8B4513", desc: "ä½å¯¼çƒ­" },
            0.8: { name: "é™¶ç“·", color: "#d8c7b5", desc: "ä¸­ç­‰å¯¼çƒ­" },
            390: { name: "é‡‘å±é“œ", color: "#b87333", desc: "æé«˜å¯¼çƒ­" }
        };

        const EVALUATION_CONFIG = {
            TEMPERATURE_THRESHOLD: 40,
            CRITICAL_THRESHOLD: 30,
            TIME_THRESHOLDS: { FAST: 5, NORMAL: 10, SLOW: 15 },
            SCORE_WEIGHTS: { TEMPERATURE: 40, RESISTANCE: 30, TIME: 30 }
        };

        const TEMPERATURE_CONFIG = {
            INITIAL: 25.0,
            CUP: 95.0,
            AMBIENT: 25.0,
            GRADIENT_COLORS: {
                LOW: "#3498db",
                MEDIUM: "#f39c12",
                HIGH: "#e67e22",
                CRITICAL: "#e74c3c"
            }
        };

        // ==================== DOM å…ƒç´ ç¼“å­˜ ====================
        const DOM = {
            canvas: document.getElementById('simCanvas'),
            ctx: null,
            feedback: document.getElementById('feedback'),
            badgeZone: document.getElementById('badgeZone'),
            tempValue: document.getElementById('tempValue'),
            deltaT: document.getElementById('deltaT'),
            warningIndicator: document.getElementById('warningIndicator'),
            thicknessSlider: document.getElementById('thickness'),
            thicknessDisplay: document.getElementById('thicknessDisplay'),
            materialSelect: document.getElementById('material'),
            kValue: document.getElementById('kValue'),
            rValue: document.getElementById('rValue'),
            heatFlow: document.getElementById('heatFlow'),
            conductionEfficiency: document.getElementById('conductionEfficiency'),
            startBtn: document.getElementById('startBtn'),
            experimentStatusDisplay: document.getElementById('experimentStatusDisplay'),
            experimentTime: document.getElementById('experimentTime'),
            maxDeltaT: document.getElementById('maxDeltaT'),
            thermalShock: document.getElementById('thermalShock'),
            finalEvaluation: document.getElementById('finalEvaluation'),
            finalGrade: document.getElementById('finalGrade'),
            evaluationText: document.getElementById('evaluationText'),
            resultRating: document.getElementById('resultRating'),
            ratingDisplay: document.getElementById('ratingDisplay')
        };

        // ==================== æ¨¡æ‹ŸçŠ¶æ€å¯¹è±¡ ====================
        const simulation = {
            active: false,
            shattered: false,
            tTop: TEMPERATURE_CONFIG.INITIAL,
            k: 0.15,
            d: 10.0,
            particles: [],
            steam: [],
            fragments: [],
            heatWave: 0,
            time: 0,
            maxDeltaT: 0,
            startTime: 0,
            evaluationDone: false,
            animationFrameId: null
        };

        // ==================== å·¥å…·å‡½æ•° ====================
        const Utils = {
            // æ ¼å¼åŒ–æ•°å­—
            formatNumber(num, decimals = 1) {
                return num.toFixed(decimals);
            },

            // é˜²æŠ–å‡½æ•°
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            // èŠ‚æµå‡½æ•°
            throttle(func, limit) {
                let inThrottle;
                return function(...args) {
                    if (!inThrottle) {
                        func.apply(this, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                };
            },

            // éšæœºæ•°ç”Ÿæˆ
            random(min, max) {
                return Math.random() * (max - min) + min;
            },

            // çº¿æ€§æ’å€¼
            lerp(start, end, t) {
                return start * (1 - t) + end * t;
            },

            // æ˜ å°„å€¼åˆ°èŒƒå›´
            map(value, inMin, inMax, outMin, outMax) {
                return (value - inMin) * (outMax - outMin) / (inMax - inMin) + outMin;
            }
        };

        // ==================== æ ¸å¿ƒå‡½æ•° ====================
        class ThermalSimulation {
            constructor() {
                this.init();
            }

            init() {
                // åˆå§‹åŒ–ç”»å¸ƒä¸Šä¸‹æ–‡
                DOM.ctx = DOM.canvas.getContext('2d', { alpha: true });
                
                // è®¾ç½®ç”»å¸ƒå°ºå¯¸
                this.resizeCanvas();
                
                // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
                this.initEventListeners();
                
                // åˆå§‹åŒ–æè´¨é€‰æ‹©
                this.updateMaterialDisplay();
                
                // å¼€å§‹åŠ¨ç”»å¾ªç¯
                this.animationLoop();
                
                // çª—å£å¤§å°è°ƒæ•´ç›‘å¬
                window.addEventListener('resize', Utils.debounce(() => {
                    this.resizeCanvas();
                }, 250));
            }

            resizeCanvas() {
                const container = document.getElementById('simContainer');
                DOM.canvas.width = container.offsetWidth * window.devicePixelRatio;
                DOM.canvas.height = container.offsetHeight * window.devicePixelRatio;
                
                // è®¾ç½®CSSå°ºå¯¸ä¸ºå®é™…å°ºå¯¸
                DOM.canvas.style.width = `${container.offsetWidth}px`;
                DOM.canvas.style.height = `${container.offsetHeight}px`;
            }

            initEventListeners() {
                // åšåº¦æ»‘å—
                DOM.thicknessSlider.addEventListener('input', () => {
                    simulation.d = parseFloat(DOM.thicknessSlider.value);
                    DOM.thicknessDisplay.textContent = `${Utils.formatNumber(simulation.d)} mm`;
                    document.getElementById('thickVal').textContent = `${Utils.formatNumber(simulation.d)} mm`;
                    this.updateCalculations();
                    this.updateSteps(1);
                });

                // æè´¨é€‰æ‹©
                DOM.materialSelect.addEventListener('change', () => {
                    simulation.k = parseFloat(DOM.materialSelect.value);
                    this.updateMaterialDisplay();
                    this.updateCalculations();
                    this.updateSteps(1);
                });

                // è§¦æ‘¸è®¾å¤‡æ”¯æŒ
                DOM.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (!simulation.active) {
                        this.startTest();
                    }
                });
            }

            updateMaterialDisplay() {
                const material = MATERIALS[simulation.k];
                DOM.kValue.textContent = `${simulation.k} W/mÂ·K`;
                const materialPreview = document.getElementById('materialPreview');
                materialPreview.textContent = material.name;
                materialPreview.style.color = material.color;
                
                // æ›´æ–°çƒ­ä¼ å¯¼æ•ˆç‡è¯„ä»·
                let efficiency;
                if (simulation.k < 0.1) efficiency = "æä½";
                else if (simulation.k < 1) efficiency = "ä½";
                else if (simulation.k < 10) efficiency = "ä¸­";
                else if (simulation.k < 100) efficiency = "é«˜";
                else efficiency = "æé«˜";
                
                DOM.conductionEfficiency.textContent = efficiency;
            }

            updateCalculations() {
                // çƒ­é˜»è®¡ç®— R = d/k (å•ä½è½¬æ¢: mm -> m)
                const R = (simulation.d / 1000) / simulation.k;
                DOM.rValue.textContent = `${Utils.formatNumber(R, 2)} mÂ²Â·K/W`;
                
                // çƒ­æµé‡è®¡ç®— q = (95 - tTop) / R
                const q = (TEMPERATURE_CONFIG.CUP - simulation.tTop) / (R || 0.001);
                DOM.heatFlow.textContent = `${Utils.formatNumber(Math.abs(q), 2)} W/mÂ²`;
                
                // æ›´æ–°çƒ­å†²å‡»å¼ºåº¦æ˜¾ç¤º
                const currentDeltaT = simulation.tTop - TEMPERATURE_CONFIG.AMBIENT;
                let shockLevel = "æ— ";
                let shockColor = TEMPERATURE_CONFIG.GRADIENT_COLORS.LOW;
                
                if (currentDeltaT >= 40) {
                    shockLevel = "é«˜";
                    shockColor = TEMPERATURE_CONFIG.GRADIENT_COLORS.CRITICAL;
                } else if (currentDeltaT >= 30) {
                    shockLevel = "ä¸­";
                    shockColor = TEMPERATURE_CONFIG.GRADIENT_COLORS.HIGH;
                } else if (currentDeltaT >= 10) {
                    shockLevel = "ä½";
                    shockColor = TEMPERATURE_CONFIG.GRADIENT_COLORS.MEDIUM;
                }
                
                DOM.thermalShock.textContent = shockLevel;
                DOM.thermalShock.style.color = shockColor;
            }

            updateSteps(step) {
                // é‡ç½®æ‰€æœ‰æ­¥éª¤
                document.querySelectorAll('.step').forEach(el => {
                    el.classList.remove('active', 'completed');
                });
                
                // è®¾ç½®å½“å‰æ­¥éª¤å’Œå·²å®Œæˆæ­¥éª¤
                for (let i = 1; i <= 4; i++) {
                    const stepEl = document.getElementById(`step${i}`);
                    if (i < step) {
                        stepEl.classList.add('completed');
                    } else if (i === step) {
                        stepEl.classList.add('active');
                    }
                }
            }

            startTest() {
                if (simulation.shattered) return;
                
                simulation.active = true;
                simulation.time = 0;
                simulation.maxDeltaT = 0;
                simulation.startTime = Date.now();
                simulation.evaluationDone = false;
                
                DOM.startBtn.disabled = true;
                DOM.experimentStatusDisplay.textContent = "è¿›è¡Œä¸­";
                DOM.experimentStatusDisplay.style.color = TEMPERATURE_CONFIG.GRADIENT_COLORS.MEDIUM;
                
                // éšè—æœ€ç»ˆè¯„ä»·
                DOM.finalEvaluation.style.display = 'none';
                DOM.resultRating.style.display = 'none';
                
                // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
                this.updateSteps(2);
                
                // æ›´æ–°åé¦ˆä¿¡æ¯
                const material = MATERIALS[simulation.k];
                DOM.feedback.innerHTML = `
                    <p style="color: #f39c12; font-weight: 600; font-size: 1.2rem;">ğŸ”¬ å®éªŒè¿›è¡Œä¸­...</p>
                    <p>çƒ­èŒ¶æ¯(95Â°C)å·²æ”¾ç½®ï¼Œæ­£åœ¨ç›‘æµ‹çƒ­ä¼ å¯¼è¿‡ç¨‹...</p>
                    <p style="margin-top: var(--spacing-md); font-size: 1.1rem;">
                        <strong>æè´¨:</strong> ${material.name}<br>
                        <strong>åšåº¦:</strong> ${simulation.d} mm<br>
                        <strong>çƒ­å¯¼ç‡:</strong> ${simulation.k} W/mÂ·K<br>
                        <strong>åˆå§‹çƒ­é˜»:</strong> ${Utils.formatNumber((simulation.d / 1000) / simulation.k, 2)} mÂ²Â·K/W
                    </p>
                `;
                
                DOM.warningIndicator.style.display = 'block';
            }

            resetLab() {
                // åœæ­¢åŠ¨ç”»å¾ªç¯
                if (simulation.animationFrameId) {
                    cancelAnimationFrame(simulation.animationFrameId);
                }
                
                // é‡ç½®çŠ¶æ€
                simulation.active = false;
                simulation.shattered = false;
                simulation.tTop = TEMPERATURE_CONFIG.INITIAL;
                simulation.particles = [];
                simulation.steam = [];
                simulation.fragments = [];
                simulation.heatWave = 0;
                simulation.time = 0;
                simulation.maxDeltaT = 0;
                simulation.evaluationDone = false;
                
                // æ›´æ–°UI
                DOM.startBtn.disabled = false;
                DOM.experimentStatusDisplay.textContent = "å¾…å¼€å§‹";
                DOM.experimentStatusDisplay.style.color = TEMPERATURE_CONFIG.GRADIENT_COLORS.LOW;
                DOM.warningIndicator.style.display = 'none';
                
                // é‡ç½®æ­¥éª¤æŒ‡ç¤ºå™¨
                this.updateSteps(1);
                
                // é‡ç½®åé¦ˆä¿¡æ¯
                DOM.feedback.innerHTML = `
                    <p>æ¬¢è¿ä½¿ç”¨èŒ¶æ¯çƒ­å†²å‡»æ¨¡æ‹Ÿå™¨ï¼</p>
                    <p>æœ¬å®éªŒæ—¨åœ¨å¸®åŠ©æ‚¨ç†è§£ææ–™çƒ­ä¼ å¯¼ç‰¹æ€§ä¸çƒ­åº”åŠ›ç ´åçš„å…³ç³»ã€‚</p>
                    <p style="margin-top: var(--spacing-md);"><strong>è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š</strong></p>
                    <ol style="margin-left: 20px; margin-top: var(--spacing-sm);">
                        <li>é€‰æ‹©èŒ¶æ¯æ‰˜æè´¨å¹¶è°ƒæ•´åšåº¦</li>
                        <li>ç‚¹å‡»"æ”¾ç½®çƒ­èŒ¶æ¯"å¼€å§‹å®éªŒ</li>
                        <li>è§‚å¯Ÿæ¸©åº¦å˜åŒ–å’Œçƒ­ä¼ å¯¼è¿‡ç¨‹</li>
                        <li>åˆ†æç»“æœå¹¶è·å¾—å·¥ç¨‹å¸ˆè¯„çº§</li>
                    </ol>
                `;
                
                // é‡ç½®å¾½ç« åŒºåŸŸ
                DOM.badgeZone.innerHTML = '';
                
                // é‡ç½®æ¸©åº¦æ˜¾ç¤º
                DOM.tempValue.textContent = "25.0Â°C";
                DOM.tempValue.style.color = TEMPERATURE_CONFIG.GRADIENT_COLORS.LOW;
                DOM.deltaT.textContent = "0.0Â°C";
                
                // é‡ç½®è¯„æµ‹æ ‡å‡†
                document.querySelectorAll('.criterion').forEach((c, i) => {
                    c.classList.remove('met', 'not-met');
                    c.querySelector('.criterion-value').textContent = i === 0 ? 'æœªè¾¾æˆ' : '-';
                    c.querySelector('.criterion-value').style.color = '';
                });
                
                // é‡ç½®å…¶ä»–æ˜¾ç¤º
                DOM.experimentTime.textContent = "0.0 s";
                DOM.maxDeltaT.textContent = "0.0Â°C";
                DOM.thermalShock.textContent = "æ— ";
                DOM.thermalShock.style.color = TEMPERATURE_CONFIG.GRADIENT_COLORS.LOW;
                
                this.updateCalculations();
                
                // é‡æ–°å¼€å§‹åŠ¨ç”»å¾ªç¯
                this.animationLoop();
            }

            update() {
                if (!simulation.active && !simulation.shattered) return;
                
                simulation.time++;
                
                // æ›´æ–°å®éªŒæ—¶é—´æ˜¾ç¤º
                if (simulation.active) {
                    DOM.experimentTime.textContent = `${Utils.formatNumber(simulation.time / 60)} s`;
                }
                
                // æ›´æ–°æ¸©åº¦è®¡ç®—
                if (simulation.active && !simulation.shattered) {
                    // æ¨¡æ‹Ÿçƒ­ä¼ å¯¼
                    const heatIn = simulation.k * (TEMPERATURE_CONFIG.CUP - simulation.tTop) / simulation.d;
                    const heatOut = 1.1 * (simulation.tTop - TEMPERATURE_CONFIG.AMBIENT) / 8;
                    simulation.tTop += (heatIn - heatOut) * 0.08;
                    
                    // é™åˆ¶æ¸©åº¦èŒƒå›´
                    simulation.tTop = Math.min(simulation.tTop, TEMPERATURE_CONFIG.CUP);
                    
                    // è®°å½•æœ€å¤§æ¸©å·®
                    const currentDeltaT = simulation.tTop - TEMPERATURE_CONFIG.AMBIENT;
                    if (currentDeltaT > simulation.maxDeltaT) {
                        simulation.maxDeltaT = currentDeltaT;
                        DOM.maxDeltaT.textContent = `${Utils.formatNumber(simulation.maxDeltaT)}Â°C`;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦è§¦å‘ç ´ç¢
                    if (currentDeltaT > EVALUATION_CONFIG.TEMPERATURE_THRESHOLD) {
                        this.triggerShatter();
                    }
                    
                    // ç”Ÿæˆçƒ­è’¸æ±½
                    if (Math.random() > 0.7) {
                        this.createSteamParticle();
                    }
                    
                    // çƒ­æµªæ•ˆæœ
                    simulation.heatWave = Math.sin(simulation.time * 0.1) * 0.3;
                }
                
                // æ›´æ–°è’¸æ±½ç²’å­
                this.updateParticles();
                
                // æ›´æ–°ç»ç’ƒç¢ç‰‡
                if (simulation.shattered) {
                    this.updateFragments();
                }
                
                // æ›´æ–°UIæ˜¾ç¤º
                this.updateDisplay();
                this.updateEvaluationCriteria();
            }

            createSteamParticle() {
                const centerX = DOM.canvas.width / 2;
                const steamY = 180 - simulation.d * 3;
                
                simulation.steam.push({
                    x: centerX + (Math.random() - 0.5) * 100,
                    y: steamY,
                    size: Math.random() * 18 + 10,
                    speedX: (Math.random() - 0.5) * 2,
                    speedY: -Math.random() * 4 - 1,
                    opacity: 0.3 + Math.random() * 0.5,
                    life: 1.0
                });
            }

            updateParticles() {
                for (let i = simulation.steam.length - 1; i >= 0; i--) {
                    const steam = simulation.steam[i];
                    steam.x += steam.speedX;
                    steam.y += steam.speedY;
                    steam.opacity -= 0.01;
                    steam.life -= 0.02;
                    
                    if (steam.opacity <= 0 || steam.life <= 0) {
                        simulation.steam.splice(i, 1);
                    }
                }
            }

            updateFragments() {
                simulation.fragments.forEach(fragment => {
                    fragment.x += fragment.vx;
                    fragment.y += fragment.vy;
                    fragment.vy += 0.15; // é‡åŠ›
                    fragment.rotation += fragment.rotationSpeed;
                    fragment.opacity -= 0.002;
                });
                
                // ç§»é™¤å®Œå…¨é€æ˜çš„ç¢ç‰‡
                simulation.fragments = simulation.fragments.filter(f => f.opacity > 0.05);
            }

            updateDisplay() {
                const currentDeltaT = simulation.tTop - TEMPERATURE_CONFIG.AMBIENT;
                
                // æ›´æ–°æ¸©åº¦æ˜¾ç¤º
                DOM.tempValue.textContent = `${Utils.formatNumber(simulation.tTop)}Â°C`;
                DOM.deltaT.textContent = `${Utils.formatNumber(currentDeltaT)}Â°C`;
                
                // æ ¹æ®æ¸©å·®æ”¹å˜æ¸©åº¦æ˜¾ç¤ºé¢œè‰²
                let tempColor;
                if (currentDeltaT < 10) {
                    tempColor = TEMPERATURE_CONFIG.GRADIENT_COLORS.LOW;
                } else if (currentDeltaT < 30) {
                    tempColor = TEMPERATURE_CONFIG.GRADIENT_COLORS.MEDIUM;
                } else if (currentDeltaT < 40) {
                    tempColor = TEMPERATURE_CONFIG.GRADIENT_COLORS.HIGH;
                } else {
                    tempColor = TEMPERATURE_CONFIG.GRADIENT_COLORS.CRITICAL;
                }
                
                DOM.tempValue.style.color = tempColor;
                
                // æ›´æ–°è­¦å‘ŠæŒ‡ç¤ºå™¨
                if (currentDeltaT > EVALUATION_CONFIG.CRITICAL_THRESHOLD && currentDeltaT <= EVALUATION_CONFIG.TEMPERATURE_THRESHOLD) {
                    DOM.warningIndicator.style.display = 'block';
                    const intensity = (currentDeltaT - EVALUATION_CONFIG.CRITICAL_THRESHOLD) / 10;
                    DOM.warningIndicator.style.background = `linear-gradient(135deg, rgba(243, 156, 18, ${0.2 + intensity * 0.3}), rgba(231, 76, 60, ${0.2 + intensity * 0.3}))`;
                    DOM.warningIndicator.style.borderColor = `rgba(231, 76, 60, ${0.4 + intensity * 0.3})`;
                    DOM.warningIndicator.textContent = currentDeltaT > 38 ? "âš ï¸ å³å°†ç ´åï¼" : "âš ï¸ ä¸´ç•ŒçŠ¶æ€ï¼";
                } else if (currentDeltaT > EVALUATION_CONFIG.TEMPERATURE_THRESHOLD) {
                    DOM.warningIndicator.style.display = 'block';
                    DOM.warningIndicator.style.background = 'linear-gradient(135deg, rgba(231, 76, 60, 0.4), rgba(192, 57, 43, 0.4))';
                    DOM.warningIndicator.style.borderColor = 'rgba(231, 76, 60, 0.8)';
                    DOM.warningIndicator.textContent = "ğŸ’¥ å·²å‘ç”Ÿç ´åï¼";
                }
                
                this.updateCalculations();
            }

            updateEvaluationCriteria() {
                const currentDeltaT = simulation.tTop - TEMPERATURE_CONFIG.AMBIENT;
                
                // æ¸©å·®æ ‡å‡†
                const criterion1 = document.getElementById('criterion1');
                if (currentDeltaT >= EVALUATION_CONFIG.TEMPERATURE_THRESHOLD) {
                    criterion1.classList.add('met');
                    criterion1.classList.remove('not-met');
                    criterion1.querySelector('.criterion-value').textContent = 'å·²è¾¾æˆ';
                    criterion1.querySelector('.criterion-value').style.color = '#2ecc71';
                } else if (simulation.active) {
                    criterion1.classList.remove('met');
                    criterion1.classList.add('not-met');
                    criterion1.querySelector('.criterion-value').textContent = `${Utils.formatNumber(currentDeltaT)}Â°C`;
                    criterion1.querySelector('.criterion-value').style.color = '#e74c3c';
                }
                
                // çƒ­é˜»å€¼æ ‡å‡†
                const criterion2 = document.getElementById('criterion2');
                const R = (simulation.d / 1000) / simulation.k;
                let rRating;
                if (R > 1) rRating = 'é«˜';
                else if (R > 0.1) rRating = 'ä¸­';
                else rRating = 'ä½';
                
                criterion2.querySelector('.criterion-value').textContent = rRating;
                
                // å®éªŒæ—¶é—´æ ‡å‡†
                const criterion3 = document.getElementById('criterion3');
                if (simulation.active) {
                    const timeSec = simulation.time / 60;
                    let timeRating;
                    if (timeSec < EVALUATION_CONFIG.TIME_THRESHOLDS.FAST) timeRating = 'å¿«';
                    else if (timeSec < EVALUATION_CONFIG.TIME_THRESHOLDS.NORMAL) timeRating = 'æ­£å¸¸';
                    else timeRating = 'æ…¢';
                    
                    criterion3.querySelector('.criterion-value').textContent = timeRating;
                }
            }

            triggerShatter() {
                simulation.shattered = true;
                simulation.active = false;
                DOM.experimentStatusDisplay.textContent = "å·²ç ´å";
                DOM.experimentStatusDisplay.style.color = TEMPERATURE_CONFIG.GRADIENT_COLORS.CRITICAL;
                
                this.updateSteps(3);
                this.createFragments();
                this.performFinalEvaluation();
            }

            createFragments() {
                simulation.fragments = [];
                const centerX = DOM.canvas.width / 2;
                const centerY = 250;
                const radius = 150;
                
                for (let i = 0; i < 60; i++) {
                    const angle1 = Math.random() * Math.PI * 2;
                    const angle2 = angle1 + Math.random() * Math.PI / 6 + 0.1;
                    const angle3 = angle2 + Math.random() * Math.PI / 6 + 0.1;
                    
                    const r1 = radius * (0.7 + Math.random() * 0.3);
                    const r2 = radius * (0.7 + Math.random() * 0.3);
                    const r3 = radius * (0.7 + Math.random() * 0.3);
                    
                    simulation.fragments.push({
                        x: centerX,
                        y: centerY,
                        points: [
                            { x: Math.cos(angle1) * r1, y: Math.sin(angle1) * r1 },
                            { x: Math.cos(angle2) * r2, y: Math.sin(angle2) * r2 },
                            { x: Math.cos(angle3) * r3, y: Math.sin(angle3) * r3 }
                        ],
                        vx: (Math.random() - 0.5) * 10,
                        vy: (Math.random() - 0.5) * 10 - 4,
                        rotation: 0,
                        rotationSpeed: (Math.random() - 0.5) * 0.3,
                        opacity: 0.8 + Math.random() * 0.2,
                        color: `rgba(135, 206, 235, ${0.7 + Math.random() * 0.3})`
                    });
                }
            }

            performFinalEvaluation() {
                if (simulation.evaluationDone) return;
                simulation.evaluationDone = true;
                
                const currentDeltaT = simulation.tTop - TEMPERATURE_CONFIG.AMBIENT;
                const experimentDuration = simulation.time / 60;
                const R = (simulation.d / 1000) / simulation.k;
                
                // è®¡ç®—è¯„åˆ†
                let score = 0;
                
                // æ¸©å·®å¾—åˆ† (0-40åˆ†)
                score += Math.min(EVALUATION_CONFIG.SCORE_WEIGHTS.TEMPERATURE, currentDeltaT);
                
                // çƒ­é˜»åˆç†æ€§å¾—åˆ† (0-30åˆ†)
                if (R > 0.5 && R < 5) score += EVALUATION_CONFIG.SCORE_WEIGHTS.RESISTANCE;
                else if (R > 0.1 && R < 10) score += EVALUATION_CONFIG.SCORE_WEIGHTS.RESISTANCE * 0.67;
                else score += EVALUATION_CONFIG.SCORE_WEIGHTS.RESISTANCE * 0.33;
                
                // å®éªŒæ—¶é—´å¾—åˆ† (0-30åˆ†)
                if (experimentDuration < EVALUATION_CONFIG.TIME_THRESHOLDS.FAST) {
                    score += EVALUATION_CONFIG.SCORE_WEIGHTS.TIME;
                } else if (experimentDuration < EVALUATION_CONFIG.TIME_THRESHOLDS.NORMAL) {
                    score += EVALUATION_CONFIG.SCORE_WEIGHTS.TIME * 0.67;
                } else {
                    score += EVALUATION_CONFIG.SCORE_WEIGHTS.TIME * 0.33;
                }
                
                // ç¡®å®šç­‰çº§
                const result = this.calculateGrade(score, currentDeltaT, experimentDuration, R);
                
                // æ›´æ–°åé¦ˆ
                DOM.feedback.innerHTML = `
                    <p style="color: #e74c3c; font-weight: 700; font-size: 1.4rem;">ğŸ’¥ çƒ­å†²å‡»ç ´åå·²å‘ç”Ÿï¼</p>
                    <p>ç»ç’ƒå› æ¸©å·®è¿‡å¤§(Î”T=${Utils.formatNumber(currentDeltaT)}Â°C)è€Œäº§ç”Ÿçƒ­åº”åŠ›ç ´åã€‚</p>
                    <p style="margin-top: var(--spacing-md); font-size: 1.1rem;"><strong>å®éªŒåˆ†æ:</strong> ${result.analysis}</p>
                    <p style="margin-top: var(--spacing-sm); font-size: 1rem;">
                        <strong>æœ€å¤§æ¸©å·®:</strong> ${Utils.formatNumber(simulation.maxDeltaT)}Â°C<br>
                        <strong>ç ´åæ—¶é—´:</strong> ${Utils.formatNumber(experimentDuration)}ç§’<br>
                        <strong>æœ€ç»ˆçƒ­é˜»:</strong> ${Utils.formatNumber(R, 2)} mÂ²Â·K/W
                    </p>
                `;
                
                // æ˜¾ç¤ºè¯„çº§
                DOM.resultRating.style.display = 'block';
                DOM.ratingDisplay.textContent = result.grade;
                DOM.ratingDisplay.style.color = result.gradeColor;
                
                // æ˜¾ç¤ºæœ€ç»ˆè¯„ä»·
                DOM.finalEvaluation.style.display = 'block';
                DOM.finalGrade.textContent = `ç»¼åˆè¯„åˆ†: ${Math.round(score)}/100`;
                DOM.finalGrade.style.color = result.gradeColor;
                
                DOM.evaluationText.innerHTML = `
                    <div><strong>ç­‰çº§:</strong> ${result.grade}</div>
                    <div style="margin-top: 5px;"><strong>å·¥ç¨‹å¸ˆè¯„çº§:</strong> ${result.rank}</div>
                    ${result.recommendations.length > 0 ? `
                        <div style="margin-top: 10px;"><strong>å»ºè®®:</strong>
                            <ul style="margin-left: 20px; margin-top: 5px;">
                                ${result.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                `;
                
                // æ›´æ–°å¾½ç« 
                DOM.badgeZone.innerHTML = `
                    <div class="badge ${result.badgeColor}">${result.badgeText}</div>
                    <div class="badge badge-engineer">Î”T: ${Utils.formatNumber(currentDeltaT)}Â°C</div>
                    <div class="badge badge-master">è¯„åˆ†: ${Math.round(score)}</div>
                `;
                
                // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
                this.updateSteps(4);
            }

            calculateGrade(score, deltaT, duration, resistance) {
                let grade, gradeColor, rank, badgeColor, badgeText, analysis, recommendations = [];
                
                if (score >= 80) {
                    grade = "A+ (ä¼˜ç§€)";
                    gradeColor = "#2ecc71";
                    analysis = "å‡ºè‰²çš„å®éªŒè®¾è®¡å’Œæ‰§è¡Œï¼æ‚¨æˆåŠŸå®ç°äº†æ˜¾è‘—çš„çƒ­å†²å‡»æ•ˆåº”ï¼Œå¹¶å±•ç¤ºäº†ä¼˜ç§€çš„å·¥ç¨‹åˆ¤æ–­åŠ›ã€‚";
                    recommendations.push("è€ƒè™‘æŒ‘æˆ˜æ›´é«˜éš¾åº¦çš„å®éªŒå‚æ•°");
                    recommendations.push("å°è¯•ä¸åŒææ–™çš„ç»„åˆæ•ˆåº”");
                    rank = "èµ„æ·±çƒ­åŠ›å­¦å·¥ç¨‹å¸ˆ";
                    badgeColor = "badge-expert";
                    badgeText = "ğŸ”§ èµ„æ·±çƒ­åŠ›å­¦å·¥ç¨‹å¸ˆ";
                } else if (score >= 70) {
                    grade = "A (è‰¯å¥½)";
                    gradeColor = "#3498db";
                    analysis = "è‰¯å¥½çš„å®éªŒè¡¨ç°ï¼æ‚¨ç†è§£äº†çƒ­ä¼ å¯¼çš„åŸºæœ¬åŸç†å¹¶æˆåŠŸè§¦å‘äº†çƒ­å†²å‡»ã€‚";
                    recommendations.push("ä¼˜åŒ–å‚æ•°ä»¥è·å¾—æ›´ç²¾ç¡®çš„ç»“æœ");
                    recommendations.push("å°è¯•æ›´å¤æ‚çš„ææ–™ç»„åˆ");
                    rank = "çƒ­åŠ›å­¦å·¥ç¨‹å¸ˆ";
                    badgeColor = "badge-master";
                    badgeText = "ğŸ”¥ çƒ­å†²å‡»ä¸“å®¶";
                } else if (score >= 60) {
                    grade = "B (åˆæ ¼)";
                    gradeColor = "#f39c12";
                    analysis = "åˆæ ¼çš„å®éªŒç»“æœã€‚æ‚¨å±•ç¤ºäº†åŸºæœ¬çš„çƒ­ä¼ å¯¼ç†è§£ï¼Œä½†è¿˜æœ‰æå‡ç©ºé—´ã€‚";
                    recommendations.push("å¤ä¹ çƒ­é˜»è®¡ç®—å…¬å¼");
                    recommendations.push("å°è¯•ä¸åŒçš„åšåº¦è®¾ç½®");
                    rank = "åŠ©ç†å·¥ç¨‹å¸ˆ";
                    badgeColor = "badge-engineer";
                    badgeText = "ğŸ“Š çƒ­åŠ›å­¦åˆ†æå‘˜";
                } else {
                    grade = "C (éœ€æ”¹è¿›)";
                    gradeColor = "#e74c3c";
                    analysis = "éœ€è¦è¿›ä¸€æ­¥å­¦ä¹ å’Œå®è·µã€‚å»ºè®®é‡æ–°å­¦ä¹ çƒ­ä¼ å¯¼çš„åŸºæœ¬æ¦‚å¿µã€‚";
                    recommendations.push("é‡æ–°å­¦ä¹ çƒ­é˜»è®¡ç®—å…¬å¼");
                    recommendations.push("ä»ç®€å•çš„ææ–™å¼€å§‹å®éªŒ");
                    rank = "å®ä¹ å·¥ç¨‹å¸ˆ";
                    badgeColor = "badge-engineer";
                    badgeText = "ğŸ“ çƒ­åŠ›å­¦å®ä¹ ç”Ÿ";
                }
                
                // æ ¹æ®å®éªŒæ•°æ®è°ƒæ•´è¯„çº§
                if (simulation.k > 100 && simulation.d < 5 && deltaT > 40) {
                    rank = "èµ„æ·±å·¥ç¨‹å¸ˆ";
                    badgeColor = "badge-expert";
                    badgeText = "ğŸ”§ èµ„æ·±çƒ­åŠ›å­¦å·¥ç¨‹å¸ˆ";
                } else if (simulation.k < 1 && simulation.d > 15 && deltaT < 30) {
                    rank = "å®‰å…¨å·¥ç¨‹å¸ˆ";
                    badgeColor = "badge-safety";
                    badgeText = "ğŸ›¡ï¸ å®‰å…¨è®¾è®¡ä¸“å®¶";
                }
                
                return {
                    grade,
                    gradeColor,
                    rank,
                    badgeColor,
                    badgeText,
                    analysis,
                    recommendations
                };
            }

            // ç»˜å›¾æ–¹æ³•
            draw() {
                // æ¸…ç©ºç”»å¸ƒ
                DOM.ctx.clearRect(0, 0, DOM.canvas.width, DOM.canvas.height);
                
                // ç»˜åˆ¶èƒŒæ™¯
                this.drawBackground();
                
                // ç»˜åˆ¶å®éªŒå°
                this.drawTable();
                
                // æ ¹æ®çŠ¶æ€ç»˜åˆ¶ä¸åŒå†…å®¹
                if (!simulation.shattered) {
                    this.drawGlassTable();
                    this.drawMaterialLayer();
                    this.drawCup();
                    this.drawSteam();
                    
                    if (simulation.active && simulation.heatWave > 0) {
                        this.drawHeatWave();
                    }
                } else {
                    this.drawFragments();
                }
                
                // ç»˜åˆ¶æ¸©åº¦è®¡æ•ˆæœ
                this.drawThermometer();
            }

            drawBackground() {
                const gradient = DOM.ctx.createLinearGradient(0, 0, 0, DOM.canvas.height);
                gradient.addColorStop(0, '#0a0a1a');
                gradient.addColorStop(1, '#1a1a2e');
                DOM.ctx.fillStyle = gradient;
                DOM.ctx.fillRect(0, 0, DOM.canvas.width, DOM.canvas.height);
            }

            drawTable() {
                const baseY = DOM.canvas.height * 0.7;
                const tableWidth = DOM.canvas.width * 0.8;
                const tableHeight = DOM.canvas.height * 0.2;
                
                // å®éªŒå°ä¸»ä½“
                DOM.ctx.fillStyle = '#1e1e2e';
                DOM.ctx.fillRect(
                    (DOM.canvas.width - tableWidth) / 2,
                    baseY,
                    tableWidth,
                    tableHeight
                );
                
                // å°é¢è¾¹ç¼˜é«˜å…‰
                DOM.ctx.fillStyle = '#252542';
                DOM.ctx.fillRect(
                    (DOM.canvas.width - tableWidth) / 2,
                    baseY,
                    tableWidth,
                    5
                );
            }

            drawGlassTable() {
                const baseY = DOM.canvas.height * 0.7;
                const glassWidth = DOM.canvas.width * 0.8;
                const glassHeight = 25;
                
                // æ ¹æ®æ¸©åº¦æ”¹å˜ç»ç’ƒé¢œè‰²
                const tempRatio = Math.min(1, (simulation.tTop - TEMPERATURE_CONFIG.AMBIENT) / EVALUATION_CONFIG.TEMPERATURE_THRESHOLD);
                const blue = Math.floor(206 - tempRatio * 80);
                const green = Math.floor(216 - tempRatio * 120);
                const red = Math.floor(135 + tempRatio * 100);
                
                // ç»ç’ƒæ¸å˜æ•ˆæœ
                const glassGradient = DOM.ctx.createLinearGradient(0, baseY, 0, baseY + glassHeight);
                glassGradient.addColorStop(0, `rgba(${red}, ${green}, ${blue}, 0.9)`);
                glassGradient.addColorStop(0.5, `rgba(${red - 20}, ${green - 20}, ${blue + 20}, 0.7)`);
                glassGradient.addColorStop(1, `rgba(${red - 40}, ${green - 40}, ${blue + 40}, 0.5)`);
                
                DOM.ctx.fillStyle = glassGradient;
                DOM.ctx.fillRect(
                    (DOM.canvas.width - glassWidth) / 2,
                    baseY,
                    glassWidth,
                    glassHeight
                );
            }

            drawMaterialLayer() {
                const baseY = DOM.canvas.height * 0.7;
                const materialHeight = simulation.d * 3;
                const materialWidth = 180;
                const centerX = DOM.canvas.width / 2;
                
                const material = MATERIALS[simulation.k];
                DOM.ctx.fillStyle = material.color;
                DOM.ctx.fillRect(
                    centerX - materialWidth / 2,
                    baseY - materialHeight,
                    materialWidth,
                    materialHeight
                );
                
                // æè´¨çº¹ç†
                this.drawMaterialTexture(centerX, baseY, materialWidth, materialHeight);
                
                // æ˜¾ç¤ºåšåº¦
                DOM.ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                DOM.ctx.font = 'bold 16px Arial';
                DOM.ctx.textAlign = 'center';
                DOM.ctx.fillText(
                    `${Utils.formatNumber(simulation.d)} mm`,
                    centerX,
                    baseY - materialHeight / 2
                );
            }

            drawMaterialTexture(centerX, baseY, width, height) {
                if (simulation.k === 0.15) { // æœ¨æçº¹ç†
                    DOM.ctx.strokeStyle = 'rgba(101, 67, 33, 0.5)';
                    DOM.ctx.lineWidth = 2;
                    for (let i = 0; i < 6; i++) {
                        const x = centerX - width / 2 + 10 + i * 30;
                        DOM.ctx.beginPath();
                        DOM.ctx.moveTo(x, baseY - height);
                        DOM.ctx.lineTo(x + 10, baseY);
                        DOM.ctx.stroke();
                    }
                } else if (simulation.k === 390) { // é‡‘å±å…‰æ³½
                    const metalGradient = DOM.ctx.createLinearGradient(
                        centerX - width / 2, baseY - height,
                        centerX + width / 2, baseY
                    );
                    metalGradient.addColorStop(0, '#d2691e');
                    metalGradient.addColorStop(0.5, '#ffa500');
                    metalGradient.addColorStop(1, '#d2691e');
                    
                    DOM.ctx.fillStyle = metalGradient;
                    DOM.ctx.fillRect(
                        centerX - width / 2,
                        baseY - height,
                        width,
                        height
                    );
                }
            }

            drawCup() {
                const baseY = DOM.canvas.height * 0.7;
                const materialHeight = simulation.d * 3;
                const centerX = DOM.canvas.width / 2;
                
                // èŒ¶æ¯åº•åº§
                DOM.ctx.fillStyle = '#7d5d4d';
                DOM.ctx.beginPath();
                DOM.ctx.ellipse(centerX, baseY - materialHeight - 10, 80, 18, 0, 0, Math.PI * 2);
                DOM.ctx.fill();
                
                // æ¯èº«
                DOM.ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                DOM.ctx.strokeStyle = '#7d5d4d';
                DOM.ctx.lineWidth = 4;
                
                DOM.ctx.beginPath();
                DOM.ctx.moveTo(centerX - 70, baseY - materialHeight - 10);
                DOM.ctx.lineTo(centerX - 70, baseY - materialHeight - 140);
                DOM.ctx.quadraticCurveTo(centerX - 50, baseY - materialHeight - 160, centerX, baseY - materialHeight - 160);
                DOM.ctx.quadraticCurveTo(centerX + 50, baseY - materialHeight - 160, centerX + 70, baseY - materialHeight - 140);
                DOM.ctx.lineTo(centerX + 70, baseY - materialHeight - 10);
                DOM.ctx.closePath();
                DOM.ctx.fill();
                DOM.ctx.stroke();
                
                // æ¸©åº¦æ ‡ç­¾
                DOM.ctx.fillStyle = '#e74c3c';
                DOM.ctx.font = 'bold 18px Arial';
                DOM.ctx.textAlign = 'center';
                DOM.ctx.fillText('95Â°C', centerX, baseY - materialHeight - 180);
            }

            drawSteam() {
                simulation.steam.forEach(steam => {
                    DOM.ctx.fillStyle = `rgba(255, 255, 255, ${steam.opacity})`;
                    DOM.ctx.beginPath();
                    DOM.ctx.arc(steam.x, steam.y, steam.size, 0, Math.PI * 2);
                    DOM.ctx.fill();
                });
            }

            drawHeatWave() {
                const centerX = DOM.canvas.width / 2;
                const baseY = DOM.canvas.height * 0.7;
                const materialHeight = simulation.d * 3;
                
                for (let i = 0; i < 4; i++) {
                    const radius = 70 + i * 25 + simulation.heatWave * 15;
                    const opacity = 0.15 - i * 0.04;
                    
                    DOM.ctx.strokeStyle = `rgba(255, 100, 0, ${opacity})`;
                    DOM.ctx.lineWidth = 3;
                    DOM.ctx.beginPath();
                    DOM.ctx.arc(centerX, baseY - materialHeight - 70, radius, 0, Math.PI * 2);
                    DOM.ctx.stroke();
                }
            }

            drawThermometer() {
                if (simulation.active && !simulation.shattered) {
                    const centerX = DOM.canvas.width / 2;
                    const baseY = DOM.canvas.height * 0.7;
                    const startY = baseY - simulation.d * 3 - 70;
                    const endY = baseY;
                    
                    const tempRatio = Math.min(1, (simulation.tTop - TEMPERATURE_CONFIG.AMBIENT) / EVALUATION_CONFIG.TEMPERATURE_THRESHOLD);
                    const pathColor = `rgb(255, ${Math.floor(100 + tempRatio * 155)}, 0)`;
                    
                    DOM.ctx.strokeStyle = pathColor;
                    DOM.ctx.lineWidth = 4;
                    DOM.ctx.setLineDash([5, 5]);
                    DOM.ctx.beginPath();
                    DOM.ctx.moveTo(centerX, startY);
                    DOM.ctx.lineTo(centerX, endY);
                    DOM.ctx.stroke();
                    DOM.ctx.setLineDash([]);
                }
            }

            drawFragments() {
                simulation.fragments.forEach(fragment => {
                    DOM.ctx.save();
                    DOM.ctx.translate(fragment.x, fragment.y);
                    DOM.ctx.rotate(fragment.rotation);
                    DOM.ctx.globalAlpha = fragment.opacity;
                    
                    DOM.ctx.fillStyle = fragment.color;
                    DOM.ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                    DOM.ctx.lineWidth = 1;
                    
                    DOM.ctx.beginPath();
                    DOM.ctx.moveTo(fragment.points[0].x, fragment.points[0].y);
                    for (let i = 1; i < fragment.points.length; i++) {
                        DOM.ctx.lineTo(fragment.points[i].x, fragment.points[i].y);
                    }
                    DOM.ctx.closePath();
                    DOM.ctx.fill();
                    DOM.ctx.stroke();
                    
                    DOM.ctx.restore();
                });
            }

            animationLoop() {
                this.update();
                this.draw();
                simulation.animationFrameId = requestAnimationFrame(() => this.animationLoop());
            }
        }

        // ==================== å¯¼å‡ºåŠŸèƒ½ ====================
        class ExportManager {
            static formatDataForExport() {
                const material = MATERIALS[simulation.k];
                const currentTime = new Date().toLocaleString('zh-CN');
                const R = (simulation.d / 1000) / simulation.k;
                const currentDeltaT = simulation.tTop - TEMPERATURE_CONFIG.AMBIENT;
                
                return {
                    title: "èŒ¶æ¯çƒ­å†²å‡»å®éªŒæŠ¥å‘Š",
                    timestamp: currentTime,
                    basicInfo: {
                        å®éªŒåç§°: "èŒ¶æ¯çƒ­å†²å‡»æ¨¡æ‹Ÿå®éªŒ",
                        å®éªŒæ—¶é—´: currentTime,
                        å®éªŒçŠ¶æ€: simulation.shattered ? "å·²ç ´å" : simulation.active ? "è¿›è¡Œä¸­" : "æœªå¼€å§‹",
                        æŠ¥å‘Šç”Ÿæˆæ—¶é—´: currentTime
                    },
                    parameters: {
                        æè´¨é€‰æ‹©: material.name,
                        çƒ­å¯¼ç‡: `${simulation.k} W/mÂ·K`,
                        æè´¨åšåº¦: `${Utils.formatNumber(simulation.d)} mm`,
                        åˆå§‹æ¸©åº¦: "25.0Â°C",
                        çƒ­èŒ¶æ¯æ¸©åº¦: "95.0Â°C",
                        ä¸´ç•Œæ¸©å·®: "40.0Â°C"
                    },
                    results: {
                        å½“å‰æ¸©åº¦: `${Utils.formatNumber(simulation.tTop)}Â°C`,
                        å½“å‰æ¸©å·®: `${Utils.formatNumber(currentDeltaT)}Â°C`,
                        æœ€å¤§æ¸©å·®: `${Utils.formatNumber(simulation.maxDeltaT)}Â°C`,
                        çƒ­é˜»å€¼: `${Utils.formatNumber(R, 2)} mÂ²Â·K/W`,
                        çƒ­æµé‡: `${Utils.formatNumber(Math.abs((TEMPERATURE_CONFIG.CUP - simulation.tTop) / (R || 0.001)), 2)} W/mÂ²`,
                        å®éªŒæ—¶é•¿: `${Utils.formatNumber(simulation.time / 60)} ç§’`,
                        çƒ­å†²å‡»å¼ºåº¦: DOM.thermalShock.textContent
                    }
                };
            }

            static exportAsTXT(data) {
                let content = "=".repeat(60) + "\n";
                content += "            èŒ¶æ¯çƒ­å†²å‡»å®éªŒæŠ¥å‘Š\n";
                content += "=".repeat(60) + "\n\n";
                
                content += "ä¸€ã€åŸºæœ¬ä¿¡æ¯\n";
                content += "-".repeat(40) + "\n";
                for (const [key, value] of Object.entries(data.basicInfo)) {
                    content += `${key}ï¼š${value}\n`;
                }
                content += "\n";
                
                content += "äºŒã€å®éªŒå‚æ•°\n";
                content += "-".repeat(40) + "\n";
                for (const [key, value] of Object.entries(data.parameters)) {
                    content += `${key}ï¼š${value}\n`;
                }
                content += "\n";
                
                content += "ä¸‰ã€å®éªŒç»“æœ\n";
                content += "-".repeat(40) + "\n";
                for (const [key, value] of Object.entries(data.results)) {
                    content += `${key}ï¼š${value}\n`;
                }
                content += "\n";
                
                content += "=".repeat(60) + "\n";
                content += "æŠ¥å‘Šç”Ÿæˆæ—¶é—´ï¼š" + new Date().toLocaleString('zh-CN') + "\n";
                content += "èŒ¶æ¯çƒ­å†²å‡»æ¨¡æ‹Ÿå®éªŒå®¤ Â© 2025\n";
                
                return content;
            }

            static exportAsHTML(data) {
                let content = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>${data.title}</title>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; margin: 40px; line-height: 1.6; }
        .header { text-align: center; margin-bottom: 40px; border-bottom: 3px solid #00b4ff; padding-bottom: 20px; }
        .section { margin-bottom: 30px; }
        .section-title { color: #00b4ff; font-size: 1.3em; border-left: 5px solid #00b4ff; padding-left: 15px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f5f5f5; color: #333; }
        .highlight { background-color: #e8f4fc; }
        .danger { color: #e74c3c; font-weight: bold; }
        .success { color: #2ecc71; font-weight: bold; }
        .footer { text-align: center; margin-top: 50px; color: #666; font-size: 0.9em; }
    </style>
</head>
<body>
    <div class="header">
        <h1>${data.title}</h1>
        <p>å®éªŒæ—¶é—´ï¼š${data.timestamp}</p>
    </div>
    
    <div class="section">
        <h2 class="section-title">åŸºæœ¬ä¿¡æ¯</h2>
        <table>
    `;
                
                for (const [key, value] of Object.entries(data.basicInfo)) {
                    content += `<tr><th>${key}</th><td>${value}</td></tr>`;
                }
                
                content += `
        </table>
    </div>
    
    <div class="section">
        <h2 class="section-title">å®éªŒå‚æ•°</h2>
        <table>
    `;
                
                for (const [key, value] of Object.entries(data.parameters)) {
                    content += `<tr><th>${key}</th><td>${value}</td></tr>`;
                }
                
                content += `
        </table>
    </div>
    
    <div class="section">
        <h2 class="section-title">å®éªŒç»“æœ</h2>
        <table>
    `;
                
                for (const [key, value] of Object.entries(data.results)) {
                    const isCritical = (key.includes("æ¸©å·®") && parseFloat(value) >= 40);
                    const rowClass = isCritical ? "class='danger'" : "";
                    content += `<tr ${rowClass}><th>${key}</th><td>${value}</td></tr>`;
                }
                
                content += `
        </table>
    </div>
    
    <div class="footer">
        <p>æŠ¥å‘Šç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}</p>
        <p>èŒ¶æ¯çƒ­å†²å‡»æ¨¡æ‹Ÿå®éªŒå®¤ Â© 2025 | å·¥ç¨‹çƒ­ç‰©ç†ä¸ææ–™ç§‘å­¦ç»¼åˆå®éªŒå¹³å°</p>
        <p>é‚®ç®±ï¼šxgyanger@qq.com</p>
    </div>
</body>
</html>`;
                
                return content;
            }

            static exportAsDOC(data) {
                let content = `{\\rtf1\\ansi\\ansicpg936\\deff0\\deflang1033\\deflangfe2052
{\\fonttbl{\\f0\\fnil\\fcharset134 Microsoft YaHei;}}
{\\colortbl;\\red0\\green180\\blue255;\\red231\\green76\\blue60;\\red46\\green204\\blue113;}
{\\*\\generator HTML2RTF 1.0;}

\\viewkind4\\uc1\\pard\\nowidctlpar\\sa200\\sl276\\slmult1\\qc\\b\\f0\\fs36 ${data.title}\\par
\\pard\\nowidctlpar\\sa200\\sl276\\slmult1\\qc\\fs20 å®éªŒæ—¶é—´ï¼š${data.timestamp}\\par
\\pard\\nowidctlpar\\sa200\\sl276\\slmult1\\fs24\\par

\\b\\fs28 ä¸€ã€åŸºæœ¬ä¿¡æ¯\\par
\\pard\\nowidctlpar\\sa200\\sl276\\slmult1\\fs20
`;

                for (const [key, value] of Object.entries(data.basicInfo)) {
                    content += `\\b ${key}ï¼š\\b0 ${value}\\par\n`;
                }

                content += `\\par
\\b\\fs28 äºŒã€å®éªŒå‚æ•°\\par
\\pard\\nowidctlpar\\sa200\\sl276\\slmult1\\fs20
`;

                for (const [key, value] of Object.entries(data.parameters)) {
                    content += `\\b ${key}ï¼š\\b0 ${value}\\par\n`;
                }

                content += `\\par
\\b\\fs28 ä¸‰ã€å®éªŒç»“æœ\\par
\\pard\\nowidctlpar\\sa200\\sl276\\slmult1\\fs20
`;

                for (const [key, value] of Object.entries(data.results)) {
                    const isCritical = (key.includes("æ¸©å·®") && parseFloat(value) >= 40);
                    if (isCritical) {
                        content += `\\b ${key}ï¼š\\cf2\\b0 ${value}\\cf0\\par\n`;
                    } else {
                        content += `\\b ${key}ï¼š\\b0 ${value}\\par\n`;
                    }
                }

                content += `\\par\\par
\\pard\\nowidctlpar\\sa200\\sl276\\slmult1\\qc\\fs18
æŠ¥å‘Šç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}\\par
èŒ¶æ¯çƒ­å†²å‡»æ¨¡æ‹Ÿå®éªŒå®¤ \\'a9 2025\\par
é‚®ç®±ï¼šxgyanger@qq.com\\par
}`;

                return content;
            }

            static exportData(format = '1') {
                const data = ExportManager.formatDataForExport();
                let content, filename, mimeType;
                
                switch(format) {
                    case "1":
                        content = ExportManager.exportAsTXT(data);
                        filename = `çƒ­å†²å‡»å®éªŒæŠ¥å‘Š_${new Date().toISOString().slice(0,10)}.txt`;
                        mimeType = 'text/plain';
                        break;
                    case "2":
                        content = ExportManager.exportAsHTML(data);
                        filename = `çƒ­å†²å‡»å®éªŒæŠ¥å‘Š_${new Date().toISOString().slice(0,10)}.html`;
                        mimeType = 'text/html';
                        break;
                    case "3":
                        content = ExportManager.exportAsDOC(data);
                        filename = `çƒ­å†²å‡»å®éªŒæŠ¥å‘Š_${new Date().toISOString().slice(0,10)}.doc`;
                        mimeType = 'application/msword';
                        break;
                    case "4":
                    default:
                        content = JSON.stringify(data, null, 2);
                        filename = `çƒ­å†²å‡»å®éªŒæ•°æ®_${new Date().toISOString().slice(0,10)}.json`;
                        mimeType = 'application/json';
                }
                
                ExportManager.downloadFile(content, filename, mimeType);
            }

            static downloadFile(content, filename, mimeType) {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert(`âœ… å®éªŒæ•°æ®å·²å¯¼å‡ºä¸º ${filename}\næ–‡ä»¶å·²å¼€å§‹ä¸‹è½½ï¼Œè¯·åœ¨æµè§ˆå™¨ä¸‹è½½æ–‡ä»¶å¤¹ä¸­æŸ¥çœ‹ã€‚`);
            }
        }

        // ==================== UI äº¤äº’å‡½æ•° ====================
        function showInstructions() {
            alert("ğŸ§ª å®éªŒæŒ‡å—ï¼š\n\n" +
                  "1. é€‰æ‹©èŒ¶æ¯æ‰˜æè´¨ï¼ˆå½±å“çƒ­å¯¼ç‡kï¼‰\n" +
                  "2. è°ƒæ•´èŒ¶æ¯æ‰˜åšåº¦ï¼ˆå½±å“çƒ­é˜»Rï¼‰\n" +
                  "3. ç‚¹å‡»'æ”¾ç½®çƒ­èŒ¶æ¯'å¼€å§‹å®éªŒ\n" +
                  "4. è§‚å¯Ÿæ¸©åº¦å˜åŒ–å’Œçƒ­ä¼ å¯¼è¿‡ç¨‹\n" +
                  "5. å½“ç»ç’ƒä¸Šä¸‹è¡¨é¢æ¸©å·®è¶…è¿‡40Â°Cæ—¶ï¼Œä¼šè§¦å‘çƒ­å†²å‡»ç ´å\n" +
                  "6. æ ¹æ®å®éªŒç»“æœè·å¾—å·¥ç¨‹å¸ˆè¯„çº§\n\n" +
                  "ğŸ“Œ å°è´´å£«ï¼šå°è¯•ä¸åŒææ–™å’Œåšåº¦çš„ç»„åˆï¼Œè§‚å¯Ÿçƒ­ä¼ å¯¼é€Ÿåº¦çš„å˜åŒ–ï¼");
        }

        function showTheory() {
            alert("ğŸ“š çƒ­ä¼ å¯¼ç†è®ºï¼š\n\n" +
                  "1. å‚…é‡Œå¶å®šå¾‹ï¼šq = -kÂ·âˆ‡T\n" +
                  "   - çƒ­æµé‡ä¸æ¸©åº¦æ¢¯åº¦æˆæ­£æ¯”\n" +
                  "   - kä¸ºææ–™çš„çƒ­å¯¼ç‡\n\n" +
                  "2. çƒ­é˜»å…¬å¼ï¼šR = d/k\n" +
                  "   - Rï¼šçƒ­é˜»ï¼Œå•ä½ mÂ²Â·K/W\n" +
                  "   - dï¼šææ–™åšåº¦ï¼Œå•ä½ m\n" +
                  "   - kï¼šçƒ­å¯¼ç‡ï¼Œå•ä½ W/mÂ·K\n\n" +
                  "3. çƒ­å†²å‡»ç°è±¡ï¼š\n" +
                  "   - å½“ææ–™å±€éƒ¨æ¸©å·®è¿‡å¤§æ—¶\n" +
                  "   - çƒ­åº”åŠ›è¶…è¿‡ææ–™å¼ºåº¦\n" +
                  "   - å¯¼è‡´ææ–™ç ´å\n\n" +
                  "4. ææ–™ç‰¹æ€§ï¼š\n" +
                  "   - çƒ­å¯¼ç‡kè¶Šé«˜ï¼Œçƒ­é‡ä¼ é€’è¶Šå¿«\n" +
                  "   - ææ–™åšåº¦dè¶Šå¤§ï¼Œçƒ­é˜»Rè¶Šå¤§\n" +
                  "   - çƒ­é˜»è¶Šå¤§ï¼Œçƒ­é‡ä¼ é€’è¶Šæ…¢");
        }

        function showExportOptions() {
            const format = prompt("ğŸ“¤ è¯·é€‰æ‹©å¯¼å‡ºæ ¼å¼ï¼š\n\n" +
                                  "1. ğŸ“„ TXT æ–‡æœ¬æ ¼å¼ - ç®€æ´æ˜“è¯»\n" +
                                  "2. ğŸŒ HTML ç½‘é¡µæ ¼å¼ - ç¾è§‚è¯¦ç»†\n" +
                                  "3. ğŸ“ DOC æ–‡æ¡£æ ¼å¼ - å…¼å®¹Office\n" +
                                  "4. ğŸ“Š JSON æ•°æ®æ ¼å¼ - ç¨‹åºå¯è¯»\n\n" +
                                  "è¯·è¾“å…¥æ•°å­—é€‰æ‹©ï¼š", "1");
            
            if (format) {
                ExportManager.exportData(format);
            }
        }

        // ==================== å…¨å±€å‡½æ•°ç»‘å®š ====================
        window.startTest = () => thermalSimulation.startTest();
        window.resetLab = () => thermalSimulation.resetLab();
        window.showInstructions = showInstructions;
        window.showTheory = showTheory;
        window.showExportOptions = showExportOptions;

        // ==================== åˆå§‹åŒ– ====================
        let thermalSimulation;
        
        document.addEventListener('DOMContentLoaded', () => {
            thermalSimulation = new ThermalSimulation();
            
            // é”®ç›˜å¿«æ·é”®æ”¯æŒ
            document.addEventListener('keydown', (e) => {
                // Ctrl+S å¼€å§‹å®éªŒ
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    thermalSimulation.startTest();
                }
                // Ctrl+R é‡ç½®å®éªŒ
                else if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    thermalSimulation.resetLab();
                }
                // F1 æ˜¾ç¤ºå¸®åŠ©
                else if (e.key === 'F1') {
                    e.preventDefault();
                    showInstructions();
                }
                // F2 æ˜¾ç¤ºç†è®º
                else if (e.key === 'F2') {
                    e.preventDefault();
                    showTheory();
                }
                // F3 å¯¼å‡ºæ•°æ®
                else if (e.key === 'F3') {
                    e.preventDefault();
                    showExportOptions();
                }
            });
            
            // æ€§èƒ½ç›‘æ§
            if (typeof window.PerformanceObserver !== 'undefined') {
                const observer = new PerformanceObserver((list) => {
                    for (const entry of list.getEntries()) {
                        if (entry.duration > 16) { // è¶…è¿‡16mså¯èƒ½æœ‰é—®é¢˜
                            console.warn(`Long task detected: ${entry.name} took ${entry.duration}ms`);
                        }
                    }
                });
                observer.observe({ entryTypes: ['longtask'] });
            }
        });

        // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
        window.addEventListener('beforeunload', () => {
            if (simulation.animationFrameId) {
                cancelAnimationFrame(simulation.animationFrameId);
            }
        });
    </script>
</body>
</html>