<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰›é¡¿ç²˜æ€§å®šå¾‹å·¥ç¨‹ä»¿çœŸ - æ•™å­¦è¯„ä»·ç‰ˆ</title>
    <style>
        :root { 
            --primary: #38bdf8; 
            --primary-dark: #0284c7;
            --primary-light: #7dd3fc;
            --secondary: #fbbf24;
            --danger: #ef4444; 
            --success: #22c55e;
            --expert: #8b5cf6;
            --advanced: #10b981;
            --bg: #020617; 
            --card-bg: #1e293b;
            --card-light: rgba(30, 41, 59, 0.8);
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --glow-blue: rgba(56, 189, 248, 0.3);
            --glow-yellow: rgba(251, 191, 36, 0.3);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: all 0.3s ease;
        }
        
        body { 
            font-family: 'Segoe UI', system-ui, 'Microsoft YaHei', sans-serif; 
            background: var(--bg); 
            color: var(--text-primary);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(56, 189, 248, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(251, 191, 36, 0.05) 0%, transparent 40%);
        }
        
        /* å¤´éƒ¨åŒºåŸŸ */
        .header {
            text-align: center;
            padding: 1.5rem 2rem;
            background: linear-gradient(90deg, rgba(15, 23, 42, 0.8), rgba(30, 41, 59, 0.8));
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 10;
        }
        
        .header h1 {
            font-size: 2.2rem;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        .header p {
            color: var(--text-secondary);
            max-width: 800px;
            margin: 0 auto;
            font-size: 1.1rem;
            line-height: 1.5;
        }
        
        /* ä¸»å®¹å™¨ */
        #app { 
            width: 100%; 
            max-width: 1200px; 
            margin: 0 auto;
            padding: 2rem;
            display: grid; 
            grid-template-columns: 1.3fr 0.7fr; 
            gap: 2rem; 
        }
        
        .card { 
            background: var(--card-light); 
            border-radius: 20px; 
            padding: 2rem; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
            border: 1px solid rgba(56, 189, 248, 0.1);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), transparent);
        }
        
        h2 { 
            color: var(--primary); 
            margin: 0 0 1.5rem 0; 
            font-size: 1.5rem; 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
        }
        
        .formula-display { 
            background: rgba(56, 189, 248, 0.05); 
            padding: 1.5rem; 
            border-radius: 12px; 
            text-align: center; 
            margin-bottom: 1.5rem; 
            border: 1px solid rgba(56, 189, 248, 0.2);
            position: relative;
        }
        
        .formula-display::after {
            content: 'Ï„ = å‰ªåˆ‡åº”åŠ› | Î· = ç²˜åº¦ | du/dy = é€Ÿåº¦æ¢¯åº¦';
            display: block;
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 0.75rem;
            font-style: italic;
        }
        
        .math { 
            font-family: "Cambria Math", "Times New Roman", serif; 
            font-size: 1.8rem; 
            color: var(--primary); 
            letter-spacing: 1px;
            text-shadow: 0 0 10px var(--glow-blue);
        }
        
        #sim-container { 
            position: relative; 
            background: linear-gradient(180deg, #000 0%, #0f172a 100%); 
            border-radius: 12px; 
            height: 400px; 
            overflow: hidden; 
            border: 2px solid rgba(71, 85, 105, 0.5);
            margin-bottom: 1.5rem;
        }
        
        canvas { 
            width: 100%; 
            height: 100%; 
            display: block;
        }
        
        .dashboard { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 1rem; 
            margin-top: 1rem; 
        }
        
        .stat-box { 
            background: linear-gradient(135deg, #0f172a 0%, var(--card-bg) 100%); 
            padding: 1.25rem 1rem; 
            border-radius: 12px; 
            text-align: center; 
            border: 1px solid rgba(71, 85, 105, 0.3);
            position: relative;
            transition: all 0.3s ease;
        }
        
        .stat-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .stat-label { 
            font-size: 0.9rem; 
            color: var(--text-muted); 
            margin-bottom: 0.5rem; 
        }
        
        .stat-value { 
            font-size: 1.5rem; 
            font-weight: bold; 
            font-family: 'Consolas', 'Monaco', monospace; 
        }
        
        .control-panel { 
            display: flex; 
            flex-direction: column; 
            gap: 1.5rem; 
        }
        
        .control-group { 
            background: rgba(255,255,255,0.03); 
            padding: 1.5rem; 
            border-radius: 12px; 
            border: 1px solid rgba(71, 85, 105, 0.2);
        }
        
        label { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 1rem; 
            font-weight: 500; 
            color: var(--text-primary);
        }
        
        input[type="range"] { 
            width: 100%; 
            height: 8px;
            background: linear-gradient(90deg, #0f172a, var(--card-bg));
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
            border: 1px solid #475569;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 10px var(--glow-blue);
            transition: all 0.2s;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--glow-blue);
        }
        
        select { 
            width: 100%; 
            padding: 0.75rem; 
            border-radius: 8px; 
            background: #0f172a; 
            color: white; 
            border: 1px solid #475569; 
            outline: none;
            font-family: inherit;
        }
        
        select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px var(--glow-blue);
        }
        
        .engineer-comment { 
            background: rgba(2, 8, 23, 0.7); 
            border-radius: 12px; 
            padding: 1.5rem; 
            border-left: 5px solid var(--primary); 
            min-height: 120px; 
        }
        
        .comment-title { 
            font-size: 1.1rem; 
            color: var(--primary); 
            font-weight: bold; 
            margin-bottom: 0.75rem; 
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .comment-text {
            line-height: 1.5;
            color: var(--text-secondary);
        }
        
        #finishBtn {
            margin-top: 0.5rem; 
            padding: 1rem; 
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
            color: white; 
            border-radius: 12px; 
            cursor: pointer; 
            font-weight: bold;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        
        #finishBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--glow-blue);
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
        }
        
        /* æ¨¡æ€çª—å£ */
        .modal-overlay { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.85); 
            z-index: 1000; 
            backdrop-filter: blur(5px);
        }
        
        #reportModal { 
            display: none; 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            width: 90%; 
            max-width: 700px; 
            background: var(--card-bg); 
            border: 2px solid var(--primary); 
            border-radius: 20px; 
            z-index: 1001; 
            padding: 2.5rem; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .report-section {
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .report-stat { 
            display: flex; 
            justify-content: space-between; 
            margin: 1rem 0; 
            border-bottom: 1px solid var(--border-color); 
            padding-bottom: 0.75rem;
            font-size: 1.1rem;
        }
        
        .stat-name {
            color: var(--text-muted);
        }
        
        .stat-value {
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .rank-badge { 
            font-size: 1.8rem; 
            font-weight: bold; 
            text-align: center; 
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            background: linear-gradient(135deg, rgba(56, 189, 248, 0.1), rgba(251, 191, 36, 0.1));
            border: 1px solid rgba(56, 189, 248, 0.2);
        }
        
        .suggestion-box {
            background: rgba(56, 189, 248, 0.05);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            border-left: 4px solid var(--primary);
        }
        
        .suggestion-title {
            color: var(--primary);
            font-weight: bold;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }
        
        .suggestion-list {
            padding-left: 1.5rem;
            margin: 0.75rem 0;
        }
        
        .suggestion-list li {
            margin-bottom: 0.5rem;
            line-height: 1.4;
            color: var(--text-secondary);
        }
        
        .exploration-tip {
            color: var(--secondary);
            font-style: italic;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(251, 191, 36, 0.2);
        }
        
        #closeReport { 
            width: 100%; 
            padding: 1rem; 
            background: linear-gradient(135deg, var(--primary), var(--primary-dark)); 
            border: none; 
            border-radius: 12px; 
            font-weight: bold; 
            cursor: pointer; 
            color: white;
            margin-top: 1.5rem;
            font-size: 1.1rem;
        }
        
        #closeReport:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
        }
        
        .visual-meter {
            height: 10px;
            background: #0f172a;
            border-radius: 5px;
            margin: 0.75rem 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            border-radius: 5px;
            transition: width 1s ease;
        }
        
        .highlight {
            color: var(--secondary);
            font-weight: bold;
        }
        
        .achievement-badge {
            display: inline-block;
            background: rgba(56, 189, 248, 0.1);
            color: var(--primary);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            margin: 0.25rem 0.5rem;
            border: 1px solid rgba(56, 189, 248, 0.3);
        }
        
        /* åº•éƒ¨ä¿¡æ¯æ  */
        .footer {
            text-align: center;
            padding: 1.5rem 2rem;
            color: var(--text-primary);
            font-size: 0.9rem;
            border-top: 2px solid rgba(56, 189, 248, 0.5);
            background: linear-gradient(135deg, rgba(2, 8, 23, 0.95), rgba(30, 41, 59, 0.9));
            margin-top: 2rem;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
            width: 100%;
        }
        
        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light), var(--primary));
        }
        
        .footer-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 0.75rem;
            color: var(--primary);
        }
        
        .footer-info {
            margin-bottom: 0.75rem;
            color: var(--text-secondary);
        }
        
        .footer-copyright {
            color: var(--secondary);
            font-weight: bold;
            font-size: 1rem;
            margin-top: 1rem;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 900px) {
            #app {
                grid-template-columns: 1fr;
                padding: 1.5rem;
                gap: 1.5rem;
            }
            
            .dashboard {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 600px) {
            .header {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            #app {
                padding: 1rem;
            }
            
            .card {
                padding: 1.5rem;
                border-radius: 16px;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            #reportModal {
                padding: 1.5rem;
                width: 95%;
                max-width: 95%;
            }
            
            .formula-display {
                padding: 1rem;
            }
            
            .math {
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 400px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .footer {
                padding: 1rem;
            }
            
            .footer-title {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>

<!-- å¤´éƒ¨åŒºåŸŸ -->
<header class="header">
    <h1>ğŸ”¬ ç‰›é¡¿ç²˜æ€§å®šå¾‹å·¥ç¨‹ä»¿çœŸ</h1>
    <p>æ¢ç´¢å‰ªåˆ‡åº”åŠ›ã€ç²˜åº¦ä¸é€Ÿåº¦æ¢¯åº¦çš„å…³ç³»ï¼Œç†è§£ç‰›é¡¿æµä½“åŠ›å­¦çš„åŸºæœ¬åŸç†</p>
</header>

<!-- ä¸»å†…å®¹åŒº -->
<div id="app">
    <!-- å·¦ä¾§ï¼šä»¿çœŸåŒºåŸŸ -->
    <div class="card">
        <div class="formula-display">
            <div style="font-size: 1.6rem; color: var(--primary); margin-bottom: 0.5rem; font-weight: bold;">ç‰›é¡¿ç²˜æ€§å®šå¾‹</div>
            <div class="math">Ï„ = Î· Â· (du / dy)</div>
        </div>
        <div id="sim-container"><canvas id="fluidCanvas"></canvas></div>
        <div class="dashboard">
            <div class="stat-box">
                <div class="stat-label">ç²˜åº¦ (Î·)</div>
                <div id="val-eta" class="stat-value" style="color:var(--secondary)">-</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">é€Ÿåº¦æ¢¯åº¦ (du/dy)</div>
                <div id="val-grad" class="stat-value" style="color:var(--primary)">-</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">å‰ªåˆ‡åº”åŠ› (Ï„)</div>
                <div id="val-tau" class="stat-value" style="color:var(--danger)">-</div>
            </div>
        </div>
    </div>

    <!-- å³ä¾§ï¼šæ§åˆ¶é¢æ¿ -->
    <div class="card control-panel">
        <h2>ğŸ› ï¸ å®éªŒæ§åˆ¶ç»ˆç«¯</h2>
        <div class="control-group">
            <label>æµä½“ä»‹è´¨</label>
            <select id="fluidSelect">
                <option value="0.001">çº¯æ°´ (1 mPaÂ·s)</option>
                <option value="0.06">å·¥ä¸šæ¶¦æ»‘æ²¹ (60 mPaÂ·s)</option>
                <option value="1.2">æµ“ç¼©ç”˜æ²¹ (1200 mPaÂ·s)</option>
                <option value="15">æ²¥é’ç†”ä½“ (15000 mPaÂ·s)</option>
            </select>
            <small style="color:var(--text-muted); display:block; margin-top:0.5rem;">ç²˜åº¦è¶Šå¤§ï¼Œæµä½“æµåŠ¨è¶Šå›°éš¾</small>
        </div>
        <div class="control-group">
            <label>ä¸Šæ¿é€Ÿåº¦ U (m/s) <span id="u-txt" style="color:var(--primary)">1.00</span></label>
            <input type="range" id="uRange" min="0" max="5" step="0.01" value="1.0">
            <small style="color:var(--text-muted); display:block; margin-top:0.5rem;">0 = é™æ­¢ | 5 = é«˜é€Ÿ</small>
        </div>
        <div class="control-group">
            <label>æ¿é—´è· h (m) <span id="h-txt" style="color:var(--primary)">0.10</span></label>
            <input type="range" id="hRange" min="0.02" max="0.2" step="0.01" value="0.1">
            <small style="color:var(--text-muted); display:block; margin-top:0.5rem;">é—´è·è¶Šå°ï¼Œå‰ªåˆ‡ä½œç”¨è¶Šå¼º</small>
        </div>
        <div class="engineer-comment" id="commentBox">
            <div class="comment-title">ğŸ‘¨â€ğŸ’» å®æ—¶å·¥ç¨‹è¯„ä»·</div>
            <div id="commentText" class="comment-text">ç³»ç»Ÿå°±ç»ªï¼Œè¯·è°ƒæ•´å‚æ•°å¼€å§‹å®éªŒ...</div>
        </div>
        <button id="finishBtn">
            <span>ğŸ“Š ç»“æŸæ¢ç´¢å¹¶è·å–è¯„ä¼°æŠ¥å‘Š</span>
        </button>
    </div>
</div>

<!-- åº•éƒ¨ä¿¡æ¯æ  -->
<footer class="footer">
    <div class="footer-title">ç‰›é¡¿ç²˜æ€§å®šå¾‹å·¥ç¨‹ä»¿çœŸç³»ç»Ÿ Â© 2025 | æµä½“åŠ›å­¦æ•™å­¦å®éªŒå¹³å° | ç‰ˆæœ¬ 1.0 | é‚®ç®±:</strong> xgyanger@qq.com</div>
    <div class="footer-copyright">ç‰ˆæƒÂ©2025 AIknow. ä¿ç•™æ‰€æœ‰æƒåˆ© | Copyright Â©2025 AIknow. All rights reserved.</div>
</footer>

<!-- è¯„ä¼°æŠ¥å‘Šæ¨¡æ€çª—å£ -->
<div id="reportOverlay" class="modal-overlay"></div>
<div id="reportModal">
    <h2 style="text-align: center; color: var(--primary); margin-bottom: 0.5rem;">ğŸ“ ç‰›é¡¿æµä½“åŠ›å­¦å®éªŒæ¢ç´¢æŠ¥å‘Š</h2>
    <p style="text-align: center; color: var(--text-muted); margin-bottom: 1.5rem;">åŸºäºæ‚¨çš„æ¢ç´¢è¡Œä¸ºç”Ÿæˆä¸ªæ€§åŒ–è¯„ä¼°</p>
    
    <div class="report-section">
        <div class="report-stat">
            <span class="stat-name">æ¢ç´¢æ—¶é•¿</span>
            <span id="duration" class="stat-value">-</span>
        </div>
        <div class="report-stat">
            <span class="stat-name">å®éªŒäº’åŠ¨æ¬¡æ•°</span>
            <span id="interactionCount" class="stat-value">-</span>
        </div>
    </div>
    
    <div class="report-section">
        <h3 style="color: var(--primary); margin-top: 0;">æ¢ç´¢è¦†ç›–ç‡</h3>
        
        <div class="report-stat">
            <span class="stat-name">æµä½“ç±»å‹è¦†ç›–ç‡</span>
            <span id="fluidCoverage" class="stat-value">-</span>
        </div>
        <div class="visual-meter">
            <div id="fluidMeter" class="meter-fill" style="width: 0%"></div>
        </div>
        
        <div class="report-stat">
            <span class="stat-name">å‚æ•°èŒƒå›´æ¢ç´¢åº¦</span>
            <span id="paramCoverage" class="stat-value">-</span>
        </div>
        <div class="visual-meter">
            <div id="paramMeter" class="meter-fill" style="width: 0%"></div>
        </div>
        
        <div class="report-stat">
            <span class="stat-name">ç°è±¡å‘ç°åº¦</span>
            <span id="phenomenaCoverage" class="stat-value">-</span>
        </div>
        <div class="visual-meter">
            <div id="phenomenaMeter" class="meter-fill" style="width: 0%"></div>
        </div>
    </div>
    
    <div id="rankDisplay" class="rank-badge"></div>
    
    <div class="suggestion-box">
        <div class="suggestion-title">ğŸ’¡ ä¸ªæ€§åŒ–å­¦ä¹ å»ºè®®</div>
        <div id="suggestions"></div>
    </div>
    
    <div class="suggestion-box" style="border-left-color: var(--secondary);">
        <div class="suggestion-title">ğŸ”¬ æ¨èæ¢ç´¢è·¯å¾„</div>
        <ul class="suggestion-list" id="recommendedPath"></ul>
    </div>
    
    <div class="report-section">
        <div class="suggestion-title">ğŸ† å·²è§£é”æˆå°±</div>
        <div id="achievements"></div>
    </div>
    
    <button id="closeReport">è¿”å›å®éªŒå®¤ç»§ç»­æ¢ç´¢</button>
</div>

<script>
    const canvas = document.getElementById('fluidCanvas');
    const ctx = canvas.getContext('2d');
    const uRange = document.getElementById('uRange');
    const hRange = document.getElementById('hRange');
    const fluidSelect = document.getElementById('fluidSelect');
    
    // --- æ”¹è¿›çš„è¿½è¸ªå™¨é€»è¾‘ ---
    const Tracker = {
        startTime: Date.now(),
        uniqueFluids: new Set(),
        speedPoints: new Set(),
        gapPoints: new Set(),
        interactionCount: 0,
        highStressExplored: false,
        lowStressExplored: false,
        highGradientExplored: false,
        lowGradientExplored: false,
        maxTau: 0,
        maxGradient: 0,
        exploredCombinations: new Set(),
        
        logInteraction(type, val) {
            this.interactionCount++;
            
            if(type === 'fluid') {
                this.uniqueFluids.add(val);
                
                // è®°å½•å…·ä½“æµä½“ç±»å‹
                const fluidNames = {
                    '0.001': 'çº¯æ°´',
                    '0.06': 'å·¥ä¸šæ¶¦æ»‘æ²¹',
                    '1.2': 'æµ“ç¼©ç”˜æ²¹',
                    '15': 'æ²¥é’ç†”ä½“'
                };
                
                if(!this.fluidNames) this.fluidNames = new Set();
                this.fluidNames.add(fluidNames[val] || 'æœªçŸ¥æµä½“');
            }
            
            if(type === 'speed') {
                const speedVal = Math.round(parseFloat(val) * 10) / 10;
                this.speedPoints.add(speedVal);
            }
            
            if(type === 'gap') {
                const gapVal = Math.round(parseFloat(val) * 100);
                this.gapPoints.add(gapVal);
            }
            
            // è®°å½•å‚æ•°ç»„åˆ
            const U = parseFloat(uRange.value);
            const h = parseFloat(hRange.value);
            const eta = parseFloat(fluidSelect.value);
            const comboKey = `${eta.toFixed(3)}_${U.toFixed(2)}_${h.toFixed(2)}`;
            this.exploredCombinations.add(comboKey);
        },
        
        updateExtremes(tau, grad) {
            if(tau > this.maxTau) this.maxTau = tau;
            if(grad > this.maxGradient) this.maxGradient = grad;
            
            if(tau > 45) this.highStressExplored = true;
            if(tau > 0 && tau < 0.1) this.lowStressExplored = true;
            if(grad > 120) this.highGradientExplored = true;
            if(grad > 0 && grad < 5) this.lowGradientExplored = true;
        },
        
        getCoverageScore() {
            // æµä½“è¦†ç›–ç‡ (0-40åˆ†)
            const fluidScore = (this.uniqueFluids.size / 4) * 40;
            
            // å‚æ•°æ¢ç´¢åº¦ (0-30åˆ†)
            const speedRange = this.speedPoints.size / 50 * 15; // æœ€å¤š15åˆ†
            const gapRange = this.gapPoints.size / 18 * 15;    // æœ€å¤š15åˆ†
            const paramScore = speedRange + gapRange;
            
            // ç°è±¡å‘ç°åº¦ (0-30åˆ†)
            let phenomenaScore = 0;
            if(this.highStressExplored) phenomenaScore += 10;
            if(this.lowStressExplored) phenomenaScore += 5;
            if(this.highGradientExplored) phenomenaScore += 10;
            if(this.lowGradientExplored) phenomenaScore += 5;
            
            return {
                total: Math.round(fluidScore + paramScore + phenomenaScore),
                fluid: Math.round(fluidScore),
                param: Math.round(paramScore),
                phenomena: phenomenaScore,
                maxTau: this.maxTau,
                maxGradient: this.maxGradient
            };
        }
    };

    let particles = [];
    
    function initParticles() {
        particles = [];
        for(let i = 0; i < 200; i++) {
            particles.push({ 
                x: Math.random() * 800, 
                y: Math.random(), 
                size: Math.random() * 2 + 1,
                speedMod: Math.random() * 0.5 + 0.5
            });
        }
    }

    function updatePhysics() {
        const U = parseFloat(uRange.value);
        const h = parseFloat(hRange.value);
        const eta = parseFloat(fluidSelect.value);
        const grad = U / h;
        const tau = eta * grad;

        // æ›´æ–°è¿½è¸ªå™¨
        Tracker.updateExtremes(tau, grad);

        // æ›´æ–°ä»ªè¡¨ç›˜
        document.getElementById('u-txt').textContent = U.toFixed(2);
        document.getElementById('h-txt').textContent = h.toFixed(2);
        document.getElementById('val-eta').textContent = (eta * 1000).toFixed(0) + " mPaÂ·s";
        document.getElementById('val-grad').textContent = grad.toFixed(1) + " sâ»Â¹";
        document.getElementById('val-tau').textContent = tau.toFixed(3) + " Pa";

        draw(U, h, tau, eta, grad);
        evalEngineer(tau, eta, grad);
    }

    function draw(U, h, tau, eta, grad) {
        const w = canvas.width = canvas.offsetWidth;
        const hc = canvas.height = canvas.offsetHeight;
        const visualH = h * 1200; 
        const topY = (hc - visualH) / 2;
        const bottomY = (hc + visualH) / 2;

        // æ¸…ç©ºç”»å¸ƒ
        ctx.clearRect(0, 0, w, hc);
        
        // ç»˜åˆ¶æ¸å˜èƒŒæ™¯
        const gradient = ctx.createLinearGradient(0, topY, 0, bottomY);
        gradient.addColorStop(0, 'rgba(56, 189, 248, 0.05)');
        gradient.addColorStop(0.5, 'rgba(0, 0, 0, 0)');
        gradient.addColorStop(1, 'rgba(56, 189, 248, 0.05)');
        ctx.fillStyle = gradient;
        ctx.fillRect(0, topY, w, visualH);

        // ç»˜åˆ¶æµå±‚
        for(let j = 0; j < visualH; j += 4) {
            let ratio = 1 - (j / visualH);
            let hue = 200 + ratio * 40;
            let lightness = 20 + ratio * 30;
            ctx.fillStyle = `hsl(${hue}, 80%, ${lightness}%)`;
            ctx.fillRect(0, topY + j, w, 4);
        }

        // ç»˜åˆ¶ç²’å­
        particles.forEach(p => {
            const verticalPos = p.y;
            const speedFactor = verticalPos * U * 20 * p.speedMod;
            p.x += speedFactor;
            
            if(p.x > w) {
                p.x = 0;
                p.y = Math.random();
            }
            
            // æ ¹æ®åº”åŠ›å¤§å°æ”¹å˜ç²’å­é¢œè‰²
            let particleColor;
            if(tau > 40) {
                particleColor = `rgba(239, 68, 68, ${0.5 + 0.3 * p.y})`;
            } else if(tau > 20) {
                particleColor = `rgba(251, 191, 36, ${0.4 + 0.3 * p.y})`;
            } else {
                particleColor = `rgba(56, 189, 248, ${0.3 + 0.3 * p.y})`;
            }
            
            ctx.fillStyle = particleColor;
            ctx.beginPath();
            ctx.arc(p.x, topY + p.y * visualH, p.size, 0, Math.PI * 2);
            ctx.fill();
        });

        // ç»˜åˆ¶é€Ÿåº¦çŸ¢é‡
        for(let k = 0; k <= 8; k++) {
            let r = k / 8;
            let py = bottomY - r * visualH;
            ctx.strokeStyle = `hsl(${200 + r * 60}, 100%, 75%)`;
            drawArrow(50, py, 50 + r * U * 80, py);
        }

        // ç»˜åˆ¶åº”åŠ›ç®­å¤´
        if(tau > 0.1) {
            let len = Math.min(tau * 30, 250);
            drawArrow(300 + U * 80, topY - 6, 300 + U * 80 - len, topY - 6, "#ef4444", 4);
            
            ctx.fillStyle = "#ef4444";
            ctx.font = "bold 16px Consolas";
            ctx.fillText(`Ï„: ${tau.toFixed(2)} Pa`, 300 + U * 80 - len, topY - 20);
        }

        // ç»˜åˆ¶æ¿å—
        ctx.fillStyle = "#475569";
        ctx.fillRect(0, topY - 12, w, 12);
        ctx.fillStyle = "#334155";
        ctx.fillRect(0, bottomY, w, 12);
        
        // æ ‡æ³¨
        ctx.fillStyle = "#94a3b8";
        ctx.font = "14px Segoe UI";
        ctx.fillText("ä¸Šæ¿ (ç§»åŠ¨)", 20, topY - 5);
        ctx.fillText("ä¸‹æ¿ (å›ºå®š)", 20, bottomY + 10);
    }

    function drawArrow(x1, y1, x2, y2, color = "#fff", width = 2) {
        const head = 7;
        const angle = Math.atan2(y2 - y1, x2 - x1);
        
        ctx.strokeStyle = color;
        ctx.lineWidth = width;
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
        
        ctx.beginPath();
        ctx.moveTo(x2, y2);
        ctx.lineTo(x2 - head * Math.cos(angle - Math.PI / 6), y2 - head * Math.sin(angle - Math.PI / 6));
        ctx.lineTo(x2 - head * Math.cos(angle + Math.PI / 6), y2 - head * Math.sin(angle + Math.PI / 6));
        ctx.closePath();
        ctx.fillStyle = color;
        ctx.fill();
    }

    function evalEngineer(tau, eta, grad) {
        const text = document.getElementById('commentText');
        const box = document.getElementById('commentBox');
        
        if (tau > 50) {
            text.innerHTML = "ğŸ’€ <b>è­¦å‘Šï¼š</b> å‰ªåˆ‡åº”åŠ›æé«˜ï¼å·¥ç¨‹åº”ç”¨ä¸­å¯èƒ½å¯¼è‡´ææ–™å¤±æ•ˆã€‚";
            box.style.borderLeftColor = "var(--danger)";
        } else if (grad > 120) {
            text.innerHTML = "ğŸŒªï¸ <b>æç¤ºï¼š</b> æé«˜å‰ªåˆ‡ç‡ï¼æ³¨æ„éç‰›é¡¿æµä½“æ•ˆåº”å¯èƒ½æ˜¾ç°ã€‚";
            box.style.borderLeftColor = "var(--secondary)";
        } else if (tau < 0.1 && grad < 5) {
            text.innerHTML = "ğŸŒ€ <b>çŠ¶æ€ï¼š</b> ä½å‰ªåˆ‡çŠ¶æ€ï¼Œæµä½“å‡ ä¹ä¸å—æ‰°åŠ¨ã€‚";
            box.style.borderLeftColor = "var(--primary)";
        } else {
            text.innerHTML = "ğŸ“‹ <b>çŠ¶æ€ï¼š</b> ç‰›é¡¿æµä½“ç¨³å®šå±‚æµï¼Œç¬¦åˆçº¿æ€§ç²˜æ€§å®šå¾‹ã€‚";
            box.style.borderLeftColor = "var(--success)";
        }
    }

    // --- æ”¹è¿›çš„æŠ¥å‘Šç³»ç»Ÿ ---
    document.getElementById('finishBtn').onclick = () => {
        const duration = Math.floor((Date.now() - Tracker.startTime) / 1000);
        const coverage = Tracker.getCoverageScore();
        
        // æ›´æ–°åŸºç¡€æ•°æ®
        document.getElementById('duration').textContent = `${duration} ç§’`;
        document.getElementById('interactionCount').textContent = Tracker.interactionCount;
        
        // æ›´æ–°è¦†ç›–ç‡
        const fluidPercentage = Math.round((Tracker.uniqueFluids.size / 4) * 100);
        document.getElementById('fluidCoverage').textContent = `${fluidPercentage}%`;
        document.getElementById('fluidMeter').style.width = `${fluidPercentage}%`;
        
        const paramPercentage = Math.min(100, Math.round((coverage.param / 30) * 100));
        document.getElementById('paramCoverage').textContent = `${paramPercentage}%`;
        document.getElementById('paramMeter').style.width = `${paramPercentage}%`;
        
        const phenomenaPercentage = Math.round((coverage.phenomena / 30) * 100);
        document.getElementById('phenomenaCoverage').textContent = `${phenomenaPercentage}%`;
        document.getElementById('phenomenaMeter').style.width = `${phenomenaPercentage}%`;
        
        // ç¡®å®šè¯„çº§
        let rank = "";
        let rankColor = "";
        let rankDescription = "";
        
        if(coverage.total >= 90 && Tracker.highStressExplored && Tracker.highGradientExplored) {
            rank = "ğŸ† èµ„æ·±æµä½“ä¸“å®¶";
            rankColor = "var(--expert)";
            rankDescription = "æ‚¨å·²å…¨é¢æŒæ¡ç‰›é¡¿æµä½“åŠ›å­¦ï¼Œç†è§£ç²˜æ€§ç³»æ•°çš„å·¥ç¨‹æ„ä¹‰ã€‚";
        } else if(coverage.total >= 70) {
            rank = "ğŸ› ï¸ ä¸“ä¸šå·¥ç¨‹å¸ˆ";
            rankColor = "var(--advanced)";
            rankDescription = "æ‚¨å·²ç†è§£åŸºç¡€è§„å¾‹ï¼Œå…·å¤‡å·¥ç¨‹åº”ç”¨èƒ½åŠ›ã€‚";
        } else if(coverage.total >= 40) {
            rank = "ğŸ“š å­¦ä¹ å·¥ç¨‹å¸ˆ";
            rankColor = "var(--primary)";
            rankDescription = "æ‚¨å·²æŒæ¡åŸºæœ¬æ¦‚å¿µï¼Œéœ€è¦è¿›ä¸€æ­¥æ¢ç´¢å‚æ•°å…³ç³»ã€‚";
        } else {
            rank = "ğŸ” è§ä¹ å·¥ç¨‹å¸ˆ";
            rankColor = "var(--secondary)";
            rankDescription = "æ‚¨å·²å¼€å§‹æ¢ç´¢ï¼Œå»ºè®®ç³»ç»ŸåŒ–å®éªŒè®¾è®¡ã€‚";
        }
        
        // æ˜¾ç¤ºè¯„çº§
        const rankDisplay = document.getElementById('rankDisplay');
        rankDisplay.innerHTML = `
            <div style="color:${rankColor}; font-size: 2rem; margin-bottom: 10px;">${rank}</div>
            <div style="font-size: 1.1rem; color: var(--text-secondary);">${rankDescription}</div>
        `;
        
        // ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®
        generateSuggestions(coverage);
        
        // æ˜¾ç¤ºæŠ¥å‘Š
        document.getElementById('reportOverlay').style.display = 'block';
        document.getElementById('reportModal').style.display = 'block';
    };

    function generateSuggestions(coverage) {
        const suggestionsDiv = document.getElementById('suggestions');
        const recommendedPathDiv = document.getElementById('recommendedPath');
        const achievementsDiv = document.getElementById('achievements');
        
        let suggestions = [];
        let recommendations = [];
        let achievements = [];
        
        // åŸºäºæ¢ç´¢ä¸è¶³ç»™å‡ºå»ºè®®
        if(Tracker.uniqueFluids.size < 3) {
            suggestions.push("å°è¯•æ›´å¤šæµä½“ç±»å‹ï¼Œç‰¹åˆ«æ˜¯<span class='highlight'>é«˜ç²˜åº¦æµä½“</span>ï¼ˆå¦‚æ²¥é’ï¼‰å’Œ<span class='highlight'>ä½ç²˜åº¦æµä½“</span>ï¼ˆå¦‚æ°´ï¼‰çš„å¯¹æ¯”ã€‚");
        }
        
        if(!Tracker.highStressExplored && coverage.maxTau < 30) {
            suggestions.push("å°è¯•<span class='highlight'>é«˜é€Ÿ(U>4)</span>ç»“åˆ<span class='highlight'>å°é—´è·(h<0.05)</span>å’Œé«˜ç²˜åº¦æµä½“ï¼Œè§‚å¯Ÿæé™å‰ªåˆ‡åº”åŠ›ã€‚");
        }
        
        if(!Tracker.lowStressExplored) {
            suggestions.push("å°è¯•<span class='highlight'>ä½é€Ÿ(U<0.5)</span>æˆ–<span class='highlight'>å¤§é—´è·(h>0.15)</span>ç»„åˆï¼Œè§‚å¯Ÿä½å‰ªåˆ‡ç°è±¡ã€‚");
        }
        
        if(Tracker.speedPoints.size < 5) {
            suggestions.push("ç³»ç»ŸåŒ–æ¢ç´¢é€Ÿåº¦å‚æ•°ï¼šå°è¯•<span class='highlight'>æä½é€Ÿåº¦(0-0.5)</span>ã€<span class='highlight'>ä¸­é€Ÿ(1-2)</span>å’Œ<span class='highlight'>é«˜é€Ÿ(3-5)</span>ã€‚");
        }
        
        // åŸºäºæˆå°±ç»™äºˆåé¦ˆ
        if(Tracker.highStressExplored) {
            achievements.push('<span class="achievement-badge">ğŸ’¥ æé™è½½è·æ¢ç´¢è€…</span>');
            recommendations.push("æ‚¨å·²æ¢ç´¢é«˜å‰ªåˆ‡åŒºåŸŸï¼Œæ¥ä¸‹æ¥å¯ä»¥ç ”ç©¶<span class='highlight'>ä¸åŒæµä½“</span>åœ¨ç›¸åŒæ¡ä»¶ä¸‹çš„è¡¨ç°å·®å¼‚ã€‚");
        }
        
        if(Tracker.uniqueFluids.size >= 4) {
            achievements.push('<span class="achievement-badge">ğŸ§ª å…¨æµä½“å®éªŒå‘˜</span>');
            recommendations.push("æ‚¨å·²å°è¯•æ‰€æœ‰æµä½“ï¼Œæ¥ä¸‹æ¥å¯ä»¥æ¢ç´¢<span class='highlight'>æ¸©åº¦å¯¹ç²˜åº¦çš„å½±å“</span>ï¼ˆå‡è®¾åœºæ™¯ï¼‰ã€‚");
        }
        
        if(coverage.maxTau > 50) {
            achievements.push('<span class="achievement-badge">âš¡ é«˜åº”åŠ›å·¥ç¨‹å¸ˆ</span>');
            recommendations.push("æ‚¨å·²è§¦è¾¾å·¥ç¨‹æé™ï¼Œæ¥ä¸‹æ¥å¯ä»¥æ€è€ƒ<span class='highlight'>å¦‚ä½•é™ä½ç³»ç»Ÿåº”åŠ›</span>ï¼ˆé€šè¿‡è°ƒæ•´å‚æ•°ï¼‰ã€‚");
        }
        
        if(Tracker.interactionCount > 30) {
            achievements.push('<span class="achievement-badge">ğŸ”¬ æ·±åº¦æ¢ç´¢è€…</span>');
        }
        
        // é€šç”¨å»ºè®®
        recommendations.push("ç³»ç»Ÿè®°å½•ä¸åŒ<span class='highlight'>å‚æ•°ç»„åˆ</span>ä¸‹çš„å‰ªåˆ‡åº”åŠ›å€¼ï¼Œå¯»æ‰¾è§„å¾‹ã€‚");
        recommendations.push("æ€è€ƒ<span class='highlight'>å·¥ç¨‹åº”ç”¨</span>ï¼šæ¶¦æ»‘ç³»ç»Ÿã€æ¶‚æ–™æ¶‚å¸ƒã€èšåˆç‰©åŠ å·¥ç­‰åœºæ™¯ã€‚");
        recommendations.push("å°è¯•å›ºå®šå‰ªåˆ‡åº”åŠ›ï¼Œè°ƒæ•´<span class='highlight'>å…¶ä»–ä¸¤ä¸ªå‚æ•°</span>ï¼Œè§‚å¯Ÿå˜åŒ–è§„å¾‹ã€‚");
        
        // å¦‚æœæ²¡æœ‰ç‰¹å®šæˆå°±
        if(achievements.length === 0) {
            achievements.push('<span class="achievement-badge">ğŸš€ æ¢ç´¢å¯ç¨‹è€…</span>');
        }
        
        // æ¸²æŸ“å»ºè®®
        if(suggestions.length > 0) {
            suggestionsDiv.innerHTML = `
                <div style="margin-bottom: 10px; color: var(--text-secondary);">ä»¥ä¸‹æ–¹é¢å¯ä»¥è¿›ä¸€æ­¥æ¢ç´¢ï¼š</div>
                <ul class="suggestion-list">
                    ${suggestions.map(s => `<li>${s}</li>`).join('')}
                </ul>
            `;
        } else {
            suggestionsDiv.innerHTML = `
                <div style="color: var(--success);">ğŸ¯ æ‚¨çš„æ¢ç´¢å·²ç›¸å½“å…¨é¢ï¼å»ºè®®æ·±åŒ–å·¥ç¨‹åº”ç”¨æ€è€ƒã€‚</div>
            `;
        }
        
        // æ¸²æŸ“æ¨èè·¯å¾„
        recommendedPathDiv.innerHTML = recommendations.map(r => `<li>${r}</li>`).join('');
        
        // æ¸²æŸ“æˆå°±
        achievementsDiv.innerHTML = achievements.join('');
    }

    document.getElementById('closeReport').onclick = () => {
        document.getElementById('reportOverlay').style.display = 'none';
        document.getElementById('reportModal').style.display = 'none';
    };

    // ç»‘å®šäº¤äº’ç›‘æ§
    uRange.addEventListener('input', () => { 
        Tracker.logInteraction('speed', uRange.value); 
        updatePhysics(); 
    });
    
    hRange.addEventListener('input', () => { 
        Tracker.logInteraction('gap', hRange.value); 
        updatePhysics(); 
    });
    
    fluidSelect.addEventListener('change', () => { 
        Tracker.logInteraction('fluid', fluidSelect.value); 
        updatePhysics(); 
    });

    // åˆå§‹åŒ–
    initParticles();
    
    function animate() { 
        updatePhysics(); 
        requestAnimationFrame(animate); 
    }
    
    // åˆå§‹æ›´æ–°
    updatePhysics();
    animate();
</script>
</body>
</html>