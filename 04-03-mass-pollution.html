<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>æ‰©æ•£ä¼ è´¨å·¥ç¨‹æ¨¡æ‹Ÿ | è²å…‹å®šå¾‹å®æˆ˜è®­ç»ƒ</title>
<style>
body{
    background: linear-gradient(135deg, #071824 0%, #0a2d46 100%);
    color:#e6f3ff;
    font-family:"Segoe UI", "Microsoft YaHei", sans-serif;
    margin:0;
    padding:20px;
    overflow-x: hidden;
}
h1{
    text-align:center;
    color:#7ce0ff;
    text-shadow:0 0 10px rgba(0,150,255,0.5);
    margin-bottom:25px;
    font-weight:300;
    letter-spacing:1px;
    font-size:28px;
}
.container{
    display:flex;
    padding:20px;
    gap:20px;
    max-width:1600px;
    margin:0 auto;
    height: calc(100vh - 220px);
}
.panel{
    width:320px;
    background:rgba(10,40,70,0.85);
    border-radius:15px;
    padding:25px;
    border:1px solid rgba(0,150,255,0.3);
    box-shadow:0 10px 30px rgba(0,0,0,0.5);
    backdrop-filter:blur(10px);
    overflow-y: auto;
}
.panel h3{
    margin-top:0;
    color:#7ce0ff;
    border-bottom:2px solid rgba(0,150,255,0.3);
    padding-bottom:10px;
    font-weight:400;
    font-size:20px;
}
label{
    display:block;
    margin-top:15px;
    color:#b3e0ff;
    font-size:16px;
}
input,select,button{
    width:100%;
    margin-top:8px;
    padding:12px;
    border-radius:8px;
    border:1px solid rgba(0,150,255,0.3);
    background:rgba(0,30,60,0.7);
    color:#e6f3ff;
    font-size:16px;
    transition:all 0.3s;
}
input:hover, select:hover{
    border-color:#00aaff;
    box-shadow:0 0 10px rgba(0,170,255,0.3);
}
button{
    background:linear-gradient(to right, #0088cc, #00aaff);
    border:none;
    color:#fff;
    padding:14px;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
    margin-top:18px;
    transition:all 0.3s;
    letter-spacing:1px;
    font-size:16px;
}
button:hover{
    background:linear-gradient(to right, #0077bb, #0099ee);
    box-shadow:0 5px 15px rgba(0,150,255,0.4);
    transform:translateY(-2px);
}
button:active{
    transform:translateY(0);
}
.canvas-container{
    flex:0 0 48%;
    max-width:48%;
    position:relative;
    background:linear-gradient(180deg, #0a1a2a 0%, #0f2d44 100%);
    border-radius:15px;
    border:2px solid rgba(0,150,255,0.3);
    box-shadow:0 10px 30px rgba(0,0,0,0.5);
    overflow:hidden;
    height: 100%;
}
#canvas {
    display:block;
    width:100%;
    height:100%;
}
.quiz{
    background:rgba(0,40,70,0.9);
    padding:15px;
    border-radius:12px;
    margin-top:15px;
    border:1px solid rgba(0,150,255,0.3);
}
.quiz p{
    margin:15px 0 10px 0;
    color:#cceeff;
    font-size:16px;
}
.result{
    margin-top:15px;
    padding:15px;
    border-radius:8px;
    font-weight:bold;
    text-align:center;
    background:rgba(0,30,60,0.8);
    border:1px solid rgba(0,150,255,0.3);
    font-size:16px;
}
.success{
    color:#4dffb8;
    background:rgba(0,100,80,0.3);
}
.warning{
    color:#ffcc00;
    background:rgba(100,80,0,0.3);
}
.error{
    color:#ff6666;
    background:rgba(100,0,0,0.3);
}
.small-text{
    color:#a3d5ff;
    font-size:14px;
    line-height:1.6;
    margin-top:15px;
    padding-top:15px;
    border-top:1px solid rgba(0,150,255,0.3);
}
.param-display{
    display:flex;
    justify-content:space-between;
    margin-top:8px;
    font-size:15px;
    color:#7ce0ff;
}
.theory-box{
    background:rgba(0,30,60,0.8);
    padding:15px;
    border-radius:10px;
    margin-bottom:20px;
    border:1px solid rgba(0,150,255,0.3);
    font-size:16px;
    line-height:1.7;
}
.theory-box b{
    color:#7ce0ff;
    display:block;
    margin-bottom:12px;
    font-size:18px;
}
.theory-box .formula{
    background:rgba(0,20,40,0.8);
    padding:15px;
    border-radius:8px;
    margin:12px 0;
    border-left:4px solid #00aaff;
    font-family:monospace;
    color:#a3e6ff;
    font-size:16px;
}
.theory-box .explanation{
    color:#cceeff;
    font-size:15px;
    margin-top:12px;
    padding-top:12px;
    border-top:1px dashed rgba(100,180,255,0.3);
}
.achievement{
    position:fixed;
    bottom:20px;
    right:20px;
    background:rgba(0,60,100,0.95);
    padding:20px;
    border-radius:12px;
    border:2px solid #00aaff;
    display:none;
    animation:popIn 0.5s;
    z-index:100;
    font-size:16px;
    max-width:300px;
}
@keyframes popIn{
    0%{transform:scale(0.5); opacity:0;}
    100%{transform:scale(1); opacity:1;}
}
.simulation-info {
    position: absolute;
    top: 20px;
    left: 50px;
    background: rgba(0,30,60,0.1);
    padding: 15px;
    border-radius: 10px;
    border: 1px solid rgba(0,150,255,0.3);
    font-size: 16px;
    z-index: 10;
    min-width: 160px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}
.flux-display {
    background: rgba(0,40,70,0.9);
    padding: 12px;
    border-radius: 8px;
    margin-top: 12px;
    border: 1px solid rgba(0,150,255,0.3);
}
.flux-value {
    color: #4dffb8;
    font-weight: bold;
    font-size: 18px;
}
.param-group {
    background: rgba(0,30,60,0.7);
    padding: 12px;
    border-radius: 10px;
    margin-top: 12px;
    border: 1px solid rgba(0,150,255,0.2);
}
.control-section {
    margin-bottom: 20px;
}

/* æ¸…æ™°çš„çŠ¶æ€æ˜¾ç¤º */
.status-display {
    position: absolute;
    top: 20px;
    left: 280px;
    background: rgba(0,30,60,0.1);
    padding: 15px;
    border-radius: 10px;
    border: 1px solid rgba(0,150,255,0.3);
    font-size: 16px;
    z-index: 10;
    min-width: 120px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}
.status-item {
    margin: 0px 0;
    display: flex;
    justify-content: space-between;
}
.status-label {
    color: #b3e0ff;
}
.status-value {
    color: #7ce0ff;
    font-weight: bold;
}

}

/* åæ ‡è½´æ ‡ç­¾ - ä½¿ç”¨HTMLå…ƒç´ ç¡®ä¿æ¸…æ™°åº¦ */
.axis-labels {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 5;
}
.x-axis-label {
    position: absolute;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    color: #7ce0ff;
    font-size: 18px;
    font-weight: bold;
    text-shadow: 0 0 3px rgba(0,0,0,0.8);
}
.y-axis-label {
    position: absolute;
    left: -10px;
    top: 50%;
    transform: translateY(-50%) rotate(-90deg);
    color: #7ce0ff;
    font-size: 18px;
    font-weight: bold;
    text-shadow: 0 0 3px rgba(0,0,0,0.8);
    white-space: nowrap;
}
.origin-label {
    position: absolute;
    bottom: 25px;
    left: 40px;
    color: #7ce0ff;
    font-size: 16px;
    font-weight: bold;
}
.unit-display {
    position: absolute;
    bottom: 25px;
    right: 40px;
    color: #7ce0ff;
    font-size: 16px;
    font-weight: bold;
}

/* å¼€å§‹è¯„æµ‹æŒ‰é’® - ç§»åˆ°é¡µé¢ä¸‹æ–¹ */
.start-assessment-container {
    display: flex;
    justify-content: center;
    margin: 30px auto;
    max-width: 1600px;
}
.start-assessment-button {
    background: linear-gradient(45deg, #ff8800, #ffaa00, #ffcc00);
    border: none;
    color: #fff;
    padding: 20px 40px;
    border-radius: 15px;
    cursor: pointer;
    font-weight: bold;
    font-size: 22px;
    transition: all 0.3s;
    letter-spacing: 2px;
    box-shadow: 0 10px 20px rgba(255, 136, 0, 0.3);
    display: flex;
    align-items: center;
    gap: 15px;
}
.start-assessment-button:hover {
    background: linear-gradient(45deg, #ff7700, #ff9900, #ffbb00);
    box-shadow: 0 15px 30px rgba(255, 136, 0, 0.5);
    transform: translateY(-5px) scale(1.05);
}
.start-assessment-button:active {
    transform: translateY(0) scale(1);
}
.start-assessment-icon {
    font-size: 28px;
}

/* è¯„æµ‹é¡µé¢æ ·å¼ */
.assessment-container {
    display: none;
    max-width: 900px;
    margin: 0 auto;
    padding: 30px;
    background: rgba(10,40,70,0.9);
    border-radius: 20px;
    border: 2px solid rgba(0,150,255,0.3);
    box-shadow: 0 15px 40px rgba(0,0,0,0.5);
}
.assessment-container h2 {
    text-align: center;
    color: #7ce0ff;
    margin-bottom: 30px;
    font-size: 28px;
}
.assessment-question {
    background: rgba(0,30,60,0.8);
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    border: 1px solid rgba(0,150,255,0.2);
}
.assessment-question h3 {
    color: #cceeff;
    margin-top: 0;
    font-size: 20px;
}
.assessment-options {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    margin-top: 15px;
}
.assessment-option {
    background: rgba(0,40,70,0.7);
    padding: 15px;
    border-radius: 8px;
    border: 1px solid rgba(0,150,255,0.2);
    cursor: pointer;
    transition: all 0.3s;
    font-size: 16px;
}
.assessment-option:hover {
    background: rgba(0,60,100,0.8);
    border-color: #00aaff;
    transform: translateY(-2px);
}
.assessment-option.selected {
    background: rgba(0,100,150,0.8);
    border-color: #00aaff;
    box-shadow: 0 0 15px rgba(0,170,255,0.4);
}
.assessment-result {
    display: none;
    text-align: center;
    padding: 30px;
    background: rgba(0,30,60,0.9);
    border-radius: 15px;
    margin-top: 30px;
    border: 2px solid rgba(0,150,255,0.3);
}
.engineer-level {
    font-size: 32px;
    font-weight: bold;
    margin: 20px 0;
    padding: 20px;
    border-radius: 10px;
}
.level-expert {
    color: #4dffb8;
    background: linear-gradient(45deg, rgba(0,80,60,0.3), rgba(0,120,80,0.3));
    border: 2px solid #4dffb8;
}
.level-senior {
    color: #7ce0ff;
    background: linear-gradient(45deg, rgba(0,60,100,0.3), rgba(0,100,150,0.3));
    border: 2px solid #7ce0ff;
}
.level-junior {
    color: #ffcc00;
    background: linear-gradient(45deg, rgba(100,80,0,0.3), rgba(150,120,0,0.3));
    border: 2px solid #ffcc00;
}
.level-trainee {
    color: #ff9966;
    background: linear-gradient(45deg, rgba(100,40,0,0.3), rgba(150,60,0,0.3));
    border: 2px solid #ff9966;
}
.assessment-suggestion {
    background: rgba(0,40,70,0.8);
    padding: 20px;
    border-radius: 10px;
    margin-top: 20px;
    text-align: left;
    font-size: 16px;
    line-height: 1.6;
}
.assessment-suggestion h4 {
    color: #7ce0ff;
    margin-top: 0;
    font-size: 18px;
}
.assessment-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 30px;
}
.assessment-buttons button {
    width: 48%;
    font-size: 16px;
}
.progress-bar {
    height: 10px;
    background: rgba(0,30,60,0.8);
    border-radius: 5px;
    margin: 20px 0;
    overflow: hidden;
}
.progress-fill {
    height: 100%;
    background: linear-gradient(to right, #0088cc, #00aaff);
    border-radius: 5px;
    width: 0%;
    transition: width 1s ease-in-out;
}
.progress-text {
    text-align: center;
    font-size: 16px;
    color: #b3e0ff;
    margin-bottom: 10px;
}

/* é›·è¾¾å›¾æ ·å¼ */
.radar-container {
    display: flex;
    justify-content: center;
    margin: 30px 0;
}
.radar-chart-container {
    position: relative;
    width: 300px;
    height: 300px;
}
.radar-canvas {
    width: 100%;
    height: 100%;
}
.radar-dimensions {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}
.dimension-label {
    position: absolute;
    font-size: 14px;
    color: #cceeff;
    text-align: center;
    width: 80px;
}
.dimension-score {
    position: absolute;
    font-size: 16px;
    font-weight: bold;
    color: #7ce0ff;
}
.skill-indicators {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-top: 20px;
}
.skill-indicator {
    background: rgba(0,40,70,0.8);
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #00aaff;
}
.skill-name {
    font-weight: bold;
    color: #7ce0ff;
    margin-bottom: 8px;
}
.skill-bar {
    height: 10px;
    background: rgba(0,30,60,0.8);
    border-radius: 5px;
    overflow: hidden;
}
.skill-fill {
    height: 100%;
    background: linear-gradient(to right, #0088cc, #00aaff);
    border-radius: 5px;
    transition: width 1s ease-in-out;
}
.skill-score {
    text-align: right;
    font-size: 14px;
    color: #b3e0ff;
    margin-top: 5px;
}
.assessment-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-top: 30px;
}

/* è°ƒæ§æ¢ç´¢åé¦ˆæ ·å¼ */
.exploration-feedback {
    background: rgba(0,40,70,0.9);
    padding: 20px;
    border-radius: 12px;
    margin-top: 25px;
    border: 2px solid rgba(255, 170, 0, 0.3);
}
.exploration-feedback h3 {
    color: #ffcc00;
    margin-top: 0;
    font-size: 22px;
    text-align: center;
    margin-bottom: 20px;
}
.exploration-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}
.exploration-stat {
    background: rgba(0,30,60,0.7);
    padding: 15px;
    border-radius: 8px;
    border: 1px solid rgba(0,150,255,0.2);
}
.stat-name {
    color: #b3e0ff;
    font-size: 14px;
    margin-bottom: 5px;
}
.stat-value {
    color: #7ce0ff;
    font-size: 18px;
    font-weight: bold;
}
.control-suggestions {
    background: rgba(0,30,60,0.7);
    padding: 15px;
    border-radius: 8px;
    margin-top: 15px;
    border-left: 4px solid #ffaa00;
}
.control-suggestions h4 {
    color: #ffcc00;
    margin-top: 0;
    font-size: 18px;
    margin-bottom: 10px;
}
.suggestion-list {
    padding-left: 20px;
    margin-bottom: 0;
}
.suggestion-list li {
    margin-bottom: 8px;
    color: #cceeff;
}
.suggestion-list li:last-child {
    margin-bottom: 0;
}
</style>
</head>

<body>
<!-- ä¸»æ¨¡æ‹Ÿç•Œé¢ -->
<div id="mainContainer">
    <h1>ğŸ”¬ æ‰©æ•£ä¼ è´¨å·¥ç¨‹æ¨¡æ‹Ÿ | è²å…‹å®šå¾‹å®æˆ˜è®­ç»ƒ</h1>

    <div class="container">
        <!-- å·¦ï¼šæ§åˆ¶åŒº -->
        <div class="panel">
            <h3>ğŸš€ æ‰©æ•£è°ƒæ§é¢æ¿</h3>
            
            <div class="control-section">
                <label>æ‰©æ•£æ¨¡å¼</label>
                <select id="mode">
                    <option value="dynamic">â³ éç¨³æ€æ‰©æ•£ (ç¬æ€è¿‡ç¨‹)</option>
                    <option value="steady">âš–ï¸ ç¨³æ€æ‰©æ•£ (å¹³è¡¡çŠ¶æ€)</option>
                </select>
            </div>
            
            <div class="param-group">
                <h4 style="color:#7ce0ff; margin-top:0;">æ‰©æ•£å‚æ•°</h4>
                <label>æ‰©æ•£ç³»æ•° D (mÂ²/s)</label>
                <input type="range" id="D" min="0.1" max="5" step="0.1" value="1">
                <div class="param-display">
                    <span>ä½æ‰©æ•£æ€§</span>
                    <span id="D-value">1.0</span>
                    <span>é«˜æ‰©æ•£æ€§</span>
                </div>
                
                <label>æ‰©æ•£è·ç¦» L (m)</label>
                <input type="range" id="L" min="5" max="30" step="1" value="15">
                <div class="param-display">
                    <span>çŸ­è·ç¦»</span>
                    <span id="L-value">15</span>
                    <span>é•¿è·ç¦»</span>
                </div>
                
                <label>åŠ¨ç”»é€Ÿåº¦</label>
                <input type="range" id="speed" min="1" max="10" step="1" value="5">
                <div class="param-display">
                    <span>æ…¢é€Ÿ</span>
                    <span id="speed-value">5</span>
                    <span>å¿«é€Ÿ</span>
                </div>
            </div>
            
            <div class="param-group" id="steady-state-controls" style="display:none;">
                <h4 style="color:#7ce0ff; margin-top:0;">ç¨³æ€å‚æ•°</h4>
                <label>æœ«ç«¯æµ“åº¦ C<sub>L</sub> (ç›¸å¯¹å€¼)</label>
                <input type="range" id="CL" min="0" max="1" step="0.1" value="0">
                <div class="param-display">
                    <span>0.0</span>
                    <span id="CL-value">0.0</span>
                    <span>1.0</span>
                </div>
                
                <div class="flux-display" id="flux-display" style="display:none;">
                    <label>ä¼ è´¨é€šé‡ J (mol/mÂ²Â·s)</label>
                    <div class="flux-value" id="flux-value">0.000</div>
                    <small>æ ¹æ®è²å…‹ç¬¬ä¸€å®šå¾‹: J = -DÂ·(Î”C/L)</small>
                </div>
            </div>
            
            <div class="control-section">
                <button onclick="startSimulation()">â–¶ å¯åŠ¨æ‰©æ•£æ¨¡æ‹Ÿ</button>
                <button onclick="pauseSimulation()">â¸ï¸ æš‚åœ</button>
                <button onclick="resetSimulation()">âŸ² é‡ç½®</button>
                <button onclick="showHint()">ğŸ’¡ å·¥ç¨‹æç¤º</button>
            </div>
            
            <div class="small-text">
                <b>å·¥ç¨‹ç›®æ ‡ï¼š</b>æ¢ç´¢ä¸åŒå‚æ•°ä¸‹çš„æ‰©æ•£è¿‡ç¨‹ï¼Œç†è§£è²å…‹å®šå¾‹çš„å·¥ç¨‹åº”ç”¨ã€‚<br><br>
                <b>æ“ä½œæŒ‡å—ï¼š</b><br>
                1. é€‰æ‹©æ‰©æ•£æ¨¡å¼ï¼ˆç¨³æ€/éç¨³æ€ï¼‰<br>
                2. è°ƒèŠ‚å‚æ•°è§‚å¯Ÿæ‰©æ•£å˜åŒ–<br>
                3. ç‚¹å‡»å¯åŠ¨æŒ‰é’®å¼€å§‹æ¨¡æ‹Ÿ<br>
                4. å®Œæˆæ¢ç´¢åç‚¹å‡»ä¸‹æ–¹è¯„æµ‹æŒ‰é’®
            </div>
        </div>
        
        <!-- ä¸­ï¼šå±•ç¤ºåŒºï¼ˆå®½åº¦48%ï¼Œé«˜åº¦è‡ªé€‚åº”ï¼‰ -->
        <div class="canvas-container">
            <canvas id="canvas" width="800" height="500"></canvas>
            
            <!-- åæ ‡è½´æ ‡ç­¾ - ä½¿ç”¨HTMLå…ƒç´ ç¡®ä¿æ¸…æ™°åº¦ -->
            <div class="axis-labels">
                <div class="x-axis-label">è·ç¦» x (m)</div>
                <div class="y-axis-label">æµ“åº¦ C/Câ‚€</div>
                <div class="origin-label">O</div>
                <div class="unit-display" id="unitDisplay">L = 15 m</div>
            </div>
            
            <!-- æ¸…æ™°çš„çŠ¶æ€æ˜¾ç¤ºé¢æ¿ -->
            <div class="simulation-info" id="simulationInfo"></div>
            <div class="status-display" id="statusDisplay">
                <div class="status-item">
                    <span class="status-label">çŠ¶æ€:</span>
                    <span class="status-value" id="statusValue">å‡†å¤‡å°±ç»ª</span>
                </div>
                <div class="status-item">
                    <span class="status-label">æ—¶é—´ t:</span>
                    <span class="status-value" id="timeValue">0.0 s</span>
                </div>
                <div class="status-item">
                    <span class="status-label">å‰æ²¿ä½ç½®:</span>
                    <span class="status-value" id="frontValue">0.0 m</span>
                </div>
                <div class="status-item">
                    <span class="status-label">å®Œæˆåº¦:</span>
                    <span class="status-value" id="completionValue">0%</span>
                </div>
            </div>
            <div class="concentration-display" id="concentrationDisplay">
                <div style="color:#00aaff; font-weight:bold; margin-bottom:8px;">Câ‚€ = 1.0</div>
                <div id="clValue" style="color:#4dffb8; font-weight:bold;">C_L = 0.0</div>
            </div>
        </div>
        
        <!-- å³ï¼šç†è®º + ä¿¡æ¯ -->
        <div class="panel">
            <h3>ğŸ“š æ‰©æ•£ç†è®ºæ ¸å¿ƒ</h3>
            <div class="theory-box" id="theory">
                <!-- ç†è®ºå†…å®¹é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <h3>ğŸ“Š å®æ—¶å‚æ•°åˆ†æ</h3>
            <div class="theory-box" id="parameterAnalysis">
                <!-- å‚æ•°åˆ†æå†…å®¹é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="small-text">
                <b>å·¥ç¨‹åº”ç”¨åœºæ™¯ï¼š</b><br>
                â€¢ æ±¡æŸ“ç‰©åœ¨åœ°ä¸‹æ°´çš„æ‰©æ•£<br>
                â€¢ è¯ç‰©åœ¨äººä½“ç»„ç»‡ä¸­çš„æ¸—é€<br>
                â€¢ åŠå¯¼ä½“åˆ¶é€ ä¸­çš„æºæ‚è¿‡ç¨‹<br>
                â€¢ ç‡ƒæ–™ç”µæ± ä¸­çš„æ°”ä½“ä¼ è¾“
            </div>
        </div>
    </div>
    
    <!-- å¼€å§‹è¯„æµ‹æŒ‰é’® - å•ç‹¬æ”¾åœ¨é¡µé¢ä¸‹æ–¹ -->
    <div class="start-assessment-container">
        <button class="start-assessment-button" onclick="startAssessment()">
            <span class="start-assessment-icon">ğŸ“</span>
            å®Œæˆæ¢ç´¢ï¼Œå¼€å§‹å·¥ç¨‹èƒ½åŠ›è¯„æµ‹
        </button>
    </div>
</div>

<!-- è¯„æµ‹ç•Œé¢ -->
<div class="assessment-container" id="assessmentContainer">
    <h2>ğŸ§ª å·¥ç¨‹èƒ½åŠ›è¯„æµ‹</h2>
    
    <div class="progress-text">å·²å®Œæˆ: <span id="progressPercent">0%</span></div>
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>
    
    <div id="questionContainer">
        <!-- è¯„æµ‹é¢˜ç›®å°†åŠ¨æ€ç”Ÿæˆ -->
    </div>
    
    <div class="assessment-buttons">
        <button onclick="prevQuestion()">â† ä¸Šä¸€é¢˜</button>
        <button onclick="nextQuestion()">ä¸‹ä¸€é¢˜ â†’</button>
    </div>
    
    <div class="assessment-result" id="assessmentResult">
        <!-- è¯„æµ‹ç»“æœå°†åŠ¨æ€ç”Ÿæˆ -->
    </div>
</div>

<div class="achievement" id="achievement"></div>

<script>
// ==================== ä¸»æ¨¡æ‹Ÿéƒ¨åˆ† ====================
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d", { alpha: false });
const mode = document.getElementById("mode");
const theoryBox = document.getElementById("theory");
const parameterAnalysis = document.getElementById("parameterAnalysis");
const achievementBox = document.getElementById("achievement");
const simulationInfo = document.getElementById("simulationInfo");
const statusDisplay = document.getElementById("statusDisplay");
const statusValue = document.getElementById("statusValue");
const timeValue = document.getElementById("timeValue");
const frontValue = document.getElementById("frontValue");
const completionValue = document.getElementById("completionValue");
const concentrationDisplay = document.getElementById("concentrationDisplay");
const clValue = document.getElementById("clValue");
const steadyStateControls = document.getElementById("steady-state-controls");
const fluxDisplay = document.getElementById("flux-display");
const fluxValue = document.getElementById("flux-value");
const mainContainer = document.getElementById("mainContainer");
const assessmentContainer = document.getElementById("assessmentContainer");
const unitDisplay = document.getElementById("unitDisplay");

// å‚æ•°æ˜¾ç¤º
const Dslider = document.getElementById("D");
const Lslider = document.getElementById("L");
const speedSlider = document.getElementById("speed");
const CLslider = document.getElementById("CL");
const Dvalue = document.getElementById("D-value");
const Lvalue = document.getElementById("L-value");
const speedValue = document.getElementById("speed-value");
const CLvalue = document.getElementById("CL-value");

// æ¨¡æ‹ŸçŠ¶æ€
let time = 0;
const N = 60; // æŸ±çŠ¶å›¾æ•°é‡
let simulationActive = false;
let simulationPaused = false;
let achievementUnlocked = false;
let animationId = null;
let lastTime = 0;
let isRealTimeUpdate = true; // æ»‘å—è°ƒèŠ‚æ—¶å®æ—¶æ›´æ–°

// è°ƒæ§æ¢ç´¢è®°å½•
let explorationData = {
    modeSwitches: 0,
    parameterChanges: 0,
    simulationStarts: 0,
    totalSimulationTime: 0,
    maxDvalue: 0,
    minDvalue: 5,
    maxLvalue: 0,
    minLvalue: 30,
    maxCLvalue: 0,
    minCLvalue: 1,
    exploredSteady: false,
    exploredDynamic: false,
    lastMode: null
};

// æ›´æ–°å‚æ•°æ˜¾ç¤º
function updateParamDisplays() {
    Dvalue.textContent = Dslider.value;
    Lvalue.textContent = Lslider.value;
    speedValue.textContent = speedSlider.value;
    CLvalue.textContent = CLslider.value;
    clValue.textContent = `C_L = ${CLslider.value}`;
    unitDisplay.textContent = `L = ${Lslider.value} m`;
}

// è®°å½•è°ƒæ§æ¢ç´¢æ•°æ®
function recordExploration(action, value = null) {
    switch(action) {
        case 'modeSwitch':
            explorationData.modeSwitches++;
            const currentMode = mode.value;
            if (currentMode === 'steady') explorationData.exploredSteady = true;
            if (currentMode === 'dynamic') explorationData.exploredDynamic = true;
            explorationData.lastMode = currentMode;
            break;
            
        case 'parameterChange':
            explorationData.parameterChanges++;
            
            // è®°å½•å‚æ•°èŒƒå›´
            const dVal = parseFloat(Dslider.value);
            if (dVal > explorationData.maxDvalue) explorationData.maxDvalue = dVal;
            if (dVal < explorationData.minDvalue) explorationData.minDvalue = dVal;
            
            const lVal = parseFloat(Lslider.value);
            if (lVal > explorationData.maxLvalue) explorationData.maxLvalue = lVal;
            if (lVal < explorationData.minLvalue) explorationData.minLvalue = lVal;
            
            const clVal = parseFloat(CLslider.value);
            if (clVal > explorationData.maxCLvalue) explorationData.maxCLvalue = clVal;
            if (clVal < explorationData.minCLvalue) explorationData.minCLvalue = clVal;
            break;
            
        case 'simulationStart':
            explorationData.simulationStarts++;
            break;
            
        case 'simulationTime':
            explorationData.totalSimulationTime += value;
            break;
    }
}

// æ›´æ–°ç†è®ºå±•ç¤ºå’Œå‚æ•°åˆ†æ
function updateTheoryAndAnalysis() {
    const D = parseFloat(Dslider.value);
    const L = parseFloat(Lslider.value);
    const CL = parseFloat(CLslider.value);
    const characteristicTime = (L * L / D).toFixed(1);
    
    if (mode.value === "steady") {
        // è®¡ç®—ä¼ è´¨é€šé‡
        const deltaC = 1 - CL; // C0=1, CL=ç”¨æˆ·è®¾å®šå€¼
        const flux = D * deltaC / L;
        fluxValue.textContent = flux.toFixed(4);
        
        theoryBox.innerHTML = `
            <b>âš–ï¸ ç¨³æ€æ‰©æ•£ç†è®º</b>
            <div class="formula">âˆ‚C/âˆ‚t = 0</div>
            <div class="formula">è²å…‹ç¬¬ä¸€å®šå¾‹ï¼šJ = -D Â· (dC/dx)</div>
            <div class="formula">ä¸€ç»´çº¿æ€§è§£ï¼šC(x) = Câ‚€ - (Câ‚€ - C_L)Â·(x/L)</div>
            <div class="formula">æ‰©æ•£é€šé‡ï¼šJ = D Â· (Câ‚€ - C_L) / L</div>
            <div class="explanation">
                <b>å‚æ•°è®¾å®šï¼š</b><br>
                â€¢ èµ·å§‹æµ“åº¦ Câ‚€ = 1.0<br>
                â€¢ æœ«ç«¯æµ“åº¦ C_L = ${CL}<br>
                â€¢ æµ“åº¦æ¢¯åº¦ Î”C/L = ${(deltaC/L).toFixed(4)}<br>
                <b>è®¡ç®—é€šé‡ï¼š</b> J = ${flux.toFixed(4)}Â·Câ‚€
            </div>
        `;
        
        parameterAnalysis.innerHTML = `
            <b>å½“å‰å‚æ•°åˆ†æ</b>
            <div class="explanation">
                <b>æµ“åº¦æ¢¯åº¦ï¼š</b> ${(deltaC/L).toFixed(4)} (Câ‚€/m)<br>
                <b>æ‰©æ•£é€šé‡ï¼š</b> ${flux.toFixed(4)} (mol/mÂ²Â·s)<br>
                <b>å·¥ç¨‹æ„ä¹‰ï¼š</b> æ‰©æ•£è¾¾åˆ°å¹³è¡¡ï¼Œé€šé‡æ’å®š<br>
                <b>åº”ç”¨å»ºè®®ï¼š</b> å¯ç”¨äºè®¡ç®—å›ºå®šè¾¹ç•Œæ¡ä»¶ä¸‹çš„ä¼ è´¨é€Ÿç‡
            </div>
        `;
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        statusValue.textContent = "ç¨³æ€æ‰©æ•£";
        timeValue.textContent = "âˆ";
        frontValue.textContent = L + " m";
        completionValue.textContent = "100%";
    } else {
        const currentFront = Math.sqrt(4 * D * Math.max(time, 0.1));
        const completion = Math.min(100, (currentFront / L * 100)).toFixed(1);
        
        theoryBox.innerHTML = `
            <b>â³ éç¨³æ€æ‰©æ•£ç†è®º</b>
            <div class="formula">âˆ‚C/âˆ‚t = D Â· (âˆ‚Â²C/âˆ‚xÂ²)</div>
            <div class="formula">ç‰¹å¾æ‰©æ•£æ—¶é—´ï¼šÏ„ â‰ˆ LÂ²/D = ${characteristicTime} s</div>
            <div class="formula">æ‰©æ•£å‰æ²¿ï¼šx_f â‰ˆ âˆš(4Dt)</div>
            <div class="formula">è¯¯å·®å‡½æ•°è§£ï¼šC(x,t) = Câ‚€ Â· erfc[x/âˆš(4Dt)]</div>
            <div class="explanation">
                <b>å·¥ç¨‹æ„ä¹‰ï¼š</b>æ‰©æ•£è¿‡ç¨‹æ­£åœ¨è¿›è¡Œï¼Œæµ“åº¦åœºéšæ—¶é—´æ¼”å˜ã€‚<br>
                <b>å…³é”®åˆ¤æ–­ï¼š</b>æ—¶é—´t vs ç‰¹å¾æ—¶é—´Ï„ = ${characteristicTime} s
            </div>
        `;
        
        parameterAnalysis.innerHTML = `
            <b>å½“å‰å‚æ•°åˆ†æ</b>
            <div class="explanation">
                <b>å½“å‰æ—¶é—´ï¼š</b> ${time.toFixed(1)} s<br>
                <b>ç‰¹å¾æ—¶é—´ï¼š</b> ${characteristicTime} s<br>
                <b>æ‰©æ•£å‰æ²¿ï¼š</b> ${currentFront.toFixed(2)} m<br>
                <b>å®Œæˆåº¦ï¼š</b> ${completion} %<br>
                <b>çŠ¶æ€ï¼š</b> ${time < parseFloat(characteristicTime) ? "æ‰©æ•£è¿›è¡Œä¸­" : "æ¥è¿‘ç¨³æ€"}
            </div>
        `;
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        statusValue.textContent = simulationPaused ? "å·²æš‚åœ" : (simulationActive ? "æ‰©æ•£ä¸­" : "å·²åœæ­¢");
        timeValue.textContent = time.toFixed(1) + " s";
        frontValue.textContent = currentFront.toFixed(2) + " m";
        completionValue.textContent = completion + "%";
    }
}

// ç»˜åˆ¶åæ ‡ç³»
function drawCoordinateSystem() {
    const width = canvas.width;
    const height = canvas.height;
    
    // æ¸…ç©ºç”»å¸ƒ
    ctx.clearRect(0, 0, width, height);
    
    // ç»˜åˆ¶èƒŒæ™¯
    ctx.fillStyle = "#0a1a2a";
    ctx.fillRect(0, 0, width, height);
    
    // ç»˜åˆ¶ç½‘æ ¼
    ctx.strokeStyle = "rgba(0, 100, 200, 0.15)";
    ctx.lineWidth = 1;
    
    // æ°´å¹³ç½‘æ ¼çº¿
    for (let y = 50; y < height - 50; y += 50) {
        ctx.beginPath();
        ctx.moveTo(50, y);
        ctx.lineTo(width - 50, y);
        ctx.stroke();
    }
    
    // å‚ç›´ç½‘æ ¼çº¿
    for (let x = 50; x < width - 50; x += 50) {
        ctx.beginPath();
        ctx.moveTo(x, 50);
        ctx.lineTo(x, height - 50);
        ctx.stroke();
    }
    
    // ç»˜åˆ¶åæ ‡è½´
    ctx.strokeStyle = "rgba(0, 200, 255, 0.8)";
    ctx.lineWidth = 2;
    
    // xè½´
    ctx.beginPath();
    ctx.moveTo(50, height - 50);
    ctx.lineTo(width - 50, height - 50);
    ctx.stroke();
    
    // yè½´
    ctx.beginPath();
    ctx.moveTo(50, 50);
    ctx.lineTo(50, height - 50);
    ctx.stroke();
    
    // åæ ‡è½´ç®­å¤´
    ctx.fillStyle = "rgba(0, 200, 255, 0.8)";
    ctx.beginPath();
    ctx.moveTo(width - 50, height - 50);
    ctx.lineTo(width - 60, height - 45);
    ctx.lineTo(width - 60, height - 55);
    ctx.closePath();
    ctx.fill();
    
    ctx.beginPath();
    ctx.moveTo(50, 50);
    ctx.lineTo(45, 60);
    ctx.lineTo(55, 60);
    ctx.closePath();
    ctx.fill();
}

// ç»˜åˆ¶æŸ±çŠ¶å›¾
function drawBarChart(D, L, t) {
    const width = canvas.width;
    const height = canvas.height;
    const barCount = N;
    const barWidth = (width - 100) / barCount;
    const chartHeight = height - 100;
    
    const characteristicLength = Math.sqrt(4 * D * Math.max(t, 0.1));
    const CL = parseFloat(CLslider.value);
    
    // ç»˜åˆ¶æŸ±çŠ¶å›¾
    for (let i = 0; i < barCount; i++) {
        const x = (i / barCount) * L;
        let concentration;
        
        if (mode.value === "steady") {
            // ç¨³æ€çº¿æ€§åˆ†å¸ƒ
            concentration = 1 - (1 - CL) * (x / L);
        } else {
            // éç¨³æ€æ‰©æ•£ï¼ˆè¯¯å·®å‡½æ•°è¿‘ä¼¼ï¼‰
            const xi = x / characteristicLength;
            concentration = Math.exp(-xi * xi);
        }
        
        concentration = Math.max(0, Math.min(1, concentration));
        
        // è®¡ç®—æŸ±çŠ¶å›¾ä½ç½®å’Œé«˜åº¦
        const barX = 50 + i * barWidth;
        const barHeight = concentration * chartHeight;
        const barY = height - 50 - barHeight;
        
        // åˆ›å»ºæ¸å˜é¢œè‰²
        const gradient = ctx.createLinearGradient(barX, barY, barX, height - 50);
        const hue = 200 + concentration * 40; // è“è‰²åˆ°é’è‰²æ¸å˜
        gradient.addColorStop(0, `hsla(${hue}, 100%, 60%, 0.9)`);
        gradient.addColorStop(1, `hsla(${hue}, 100%, 40%, 0.7)`);
        
        // ç»˜åˆ¶æŸ±çŠ¶
        ctx.fillStyle = gradient;
        ctx.fillRect(barX, barY, barWidth * 0.8, barHeight);
        
        // æ·»åŠ æŸ±çŠ¶å›¾è¾¹æ¡†
        ctx.strokeStyle = `hsla(${hue}, 100%, 70%, 0.5)`;
        ctx.lineWidth = 1;
        ctx.strokeRect(barX, barY, barWidth * 0.8, barHeight);
        
        // åœ¨æŸ±çŠ¶å›¾é¡¶éƒ¨æ·»åŠ é«˜å…‰
        ctx.fillStyle = `hsla(${hue}, 100%, 80%, 0.3)`;
        ctx.fillRect(barX, barY, barWidth * 0.8, 2);
    }
    
    // ç»˜åˆ¶æ‰©æ•£å‰æ²¿æ ‡è®°ï¼ˆä»…éç¨³æ€ï¼‰
    if (mode.value === "dynamic") {
        const frontX = 50 + (characteristicLength / L) * (width - 100);
        
        // ç»˜åˆ¶å‰æ²¿çº¿
        ctx.strokeStyle = "rgba(255, 100, 100, 0.7)";
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 3]);
        ctx.beginPath();
        ctx.moveTo(frontX, 50);
        ctx.lineTo(frontX, height - 50);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // å‰æ²¿æ ‡è®°
        ctx.fillStyle = "#ff6666";
        ctx.beginPath();
        ctx.arc(frontX, height - 50, 6, 0, Math.PI * 2);
        ctx.fill();
        
        // å‰æ²¿æ ‡è®°æ–‡å­— - ä½¿ç”¨æ¸…æ™°å­—ä½“
        ctx.fillStyle = "#ff9999";
        ctx.font = "bold 16px Arial";
        ctx.fillText(`x_f = ${characteristicLength.toFixed(2)} m`, frontX + 10, height - 40);
    }
    
    // ç»˜åˆ¶ç›®æ ‡è·ç¦»Læ ‡è®°
    const targetX = width - 50;
    ctx.strokeStyle = "rgba(0, 255, 150, 0.7)";
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(targetX, 50);
    ctx.lineTo(targetX, height - 50);
    ctx.stroke();
    
    // ç›®æ ‡è·ç¦»æ–‡å­—æ ‡è®° - ä½¿ç”¨æ¸…æ™°å­—ä½“
    ctx.fillStyle = "#4dffb8";
    ctx.font = "bold 18px Arial";
    ctx.fillText(`L = ${L} m`, targetX - 50, 75);
    
    return {characteristicLength};
}

// ä¸»ç»˜åˆ¶å‡½æ•°
function drawDiffusion(D, L, t) {
    drawCoordinateSystem();
    const {characteristicLength} = drawBarChart(D, L, t);
    
    // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
    updateStatusDisplay(D, L, t, characteristicLength);
}

// æ›´æ–°çŠ¶æ€æ˜¾ç¤º
function updateStatusDisplay(D, L, t, characteristicLength) {
    const targetDistance = parseFloat(L);
    const timeRatio = t / (targetDistance * targetDistance / D);
    const reachedTarget = characteristicLength >= targetDistance * 0.95;
    const completion = Math.min(100, (characteristicLength / targetDistance * 100)).toFixed(1);
    
    // æ›´æ–°æ¨¡æ‹Ÿä¿¡æ¯
    let statusText = reachedTarget ? "å·²è¾¾åˆ°ç›®æ ‡" : "æ‰©æ•£ä¸­";
    if (mode.value === "steady") statusText = "ç¨³æ€æ‰©æ•£";
    
    simulationInfo.innerHTML = `
        <b>æ‰©æ•£çŠ¶æ€:</b> ${statusText}<br>
        <b>æ‰©æ•£ç³»æ•°:</b> ${D} mÂ²/s<br>
        <b>ç›®æ ‡è·ç¦»:</b> ${targetDistance} m<br>
        <b>ç‰¹å¾æ—¶é—´:</b> ${(targetDistance * targetDistance / D).toFixed(1)} s
    `;
    
    // æ›´æ–°çŠ¶æ€æ˜¾ç¤ºé¢æ¿
    if (mode.value === "dynamic") {
        statusValue.textContent = simulationPaused ? "å·²æš‚åœ" : (simulationActive ? "æ‰©æ•£ä¸­" : "å·²åœæ­¢");
        timeValue.textContent = t.toFixed(1) + " s";
        frontValue.textContent = characteristicLength.toFixed(2) + " m";
        completionValue.textContent = completion + "%";
        
        if (reachedTarget && !achievementUnlocked) {
            showAchievement("æ‰©æ•£ç›®æ ‡è¾¾æˆ!", `æ±¡æŸ“ç‰©åœ¨ ${t.toFixed(1)} s å†…æˆåŠŸæ‰©æ•£åˆ°ç›®æ ‡è·ç¦»!`);
            achievementUnlocked = true;
        }
    }
}

// å®æ—¶æ›´æ–°å‡½æ•°
function realTimeUpdate() {
    if (!isRealTimeUpdate) return;
    
    const D = parseFloat(Dslider.value);
    const L = parseFloat(Lslider.value);
    
    if (simulationActive && !simulationPaused) {
        // å¦‚æœæ¨¡æ‹Ÿæ­£åœ¨è¿è¡Œï¼ŒåŠ¨ç”»å¾ªç¯ä¼šå¤„ç†æ›´æ–°
        return;
    }
    
    // å¦åˆ™ï¼Œç›´æ¥ç»˜åˆ¶å½“å‰çŠ¶æ€
    drawDiffusion(D, L, time);
    updateTheoryAndAnalysis();
}

// åŠ¨ç”»å¾ªç¯
function animationLoop(timestamp) {
    if (!lastTime) lastTime = timestamp;
    
    if (simulationActive && !simulationPaused) {
        const D = parseFloat(Dslider.value);
        const L = parseFloat(Lslider.value);
        const speed = parseFloat(speedSlider.value);
        
        // æ ¹æ®åŠ¨ç”»é€Ÿåº¦è°ƒæ•´æ—¶é—´æ­¥é•¿
        const deltaTime = (timestamp - lastTime) * 0.001 * speed;
        time += deltaTime;
        
        // è®°å½•æ¨¡æ‹Ÿæ—¶é—´
        recordExploration('simulationTime', deltaTime);
        
        // é™åˆ¶æœ€å¤§æ—¶é—´
        const maxTime = L * L / D * 3;
        if (time > maxTime) {
            time = maxTime;
        }
        
        drawDiffusion(D, L, time);
        updateTheoryAndAnalysis();
        
        // ç»§ç»­åŠ¨ç”»å¾ªç¯
        animationId = requestAnimationFrame(animationLoop);
    }
    
    lastTime = timestamp;
}

// å¼€å§‹æ¨¡æ‹Ÿ
function startSimulation() {
    if (!simulationActive) {
        simulationActive = true;
        simulationPaused = false;
        achievementUnlocked = false;
        
        // è®°å½•æ¨¡æ‹Ÿå¼€å§‹
        recordExploration('simulationStart');
        
        if (mode.value === "dynamic") {
            time = 0.01;
            lastTime = 0;
            animationId = requestAnimationFrame(animationLoop);
            showAchievement("æ¨¡æ‹Ÿå¯åŠ¨!", "å¼€å§‹è§‚å¯Ÿéç¨³æ€æ‰©æ•£è¿‡ç¨‹");
        } else {
            // ç¨³æ€æ¨¡å¼ç›´æ¥ç»˜åˆ¶
            drawDiffusion(parseFloat(Dslider.value), parseFloat(Lslider.value), 1000);
            showAchievement("ç¨³æ€æ¨¡å¼", "è§‚å¯Ÿç¨³å®šçš„æµ“åº¦åˆ†å¸ƒå’Œä¼ è´¨é€šé‡");
        }
    } else if (simulationPaused) {
        simulationPaused = false;
        lastTime = 0;
        animationId = requestAnimationFrame(animationLoop);
    }
}

// æš‚åœæ¨¡æ‹Ÿ
function pauseSimulation() {
    simulationPaused = true;
    if (animationId) {
        cancelAnimationFrame(animationId);
        animationId = null;
    }
    drawDiffusion(parseFloat(Dslider.value), parseFloat(Lslider.value), time);
}

// é‡ç½®æ¨¡æ‹Ÿ
function resetSimulation() {
    simulationActive = false;
    simulationPaused = false;
    time = 0.01;
    
    if (animationId) {
        cancelAnimationFrame(animationId);
        animationId = null;
    }
    
    drawDiffusion(parseFloat(Dslider.value), parseFloat(Lslider.value), time);
    updateTheoryAndAnalysis();
}

// æ˜¾ç¤ºæˆå°±/æç¤º
function showAchievement(title, message) {
    achievementBox.innerHTML = `<b>${title}</b><br>${message}`;
    achievementBox.style.display = "block";
    
    setTimeout(() => {
        achievementBox.style.display = "none";
    }, 3000);
}

// æ˜¾ç¤ºå·¥ç¨‹æç¤º
function showHint() {
    const hints = [
        "ğŸ’¡ æç¤º: æ‰©æ•£æ—¶é—´ä¸è·ç¦»çš„å¹³æ–¹æˆæ­£æ¯” (t âˆ LÂ²)",
        "ğŸ’¡ æç¤º: ç¨³æ€æ‰©æ•£ä¸­ï¼Œé€šé‡ä¸æµ“åº¦æ¢¯åº¦æˆæ­£æ¯”ï¼Œä¸è·ç¦»æˆåæ¯”",
        "ğŸ’¡ æç¤º: è²å…‹ç¬¬ä¸€å®šå¾‹: J = -DÂ·(dC/dx)",
        "ğŸ’¡ æç¤º: ç‰¹å¾æ‰©æ•£æ—¶é—´ Ï„ = LÂ²/D",
        "ğŸ’¡ æç¤º: éç¨³æ€æ‰©æ•£å‰æ²¿ x_f â‰ˆ âˆš(4Dt)"
    ];
    
    const randomHint = hints[Math.floor(Math.random() * hints.length)];
    showAchievement("å·¥ç¨‹æ´å¯Ÿ", randomHint);
}

// æ¨¡å¼åˆ‡æ¢å¤„ç†
function handleModeChange() {
    const isSteady = mode.value === "steady";
    
    // æ˜¾ç¤º/éšè—ç¨³æ€æ§åˆ¶å‚æ•°
    steadyStateControls.style.display = isSteady ? "block" : "none";
    fluxDisplay.style.display = isSteady ? "block" : "none";
    
    // è®°å½•æ¨¡å¼åˆ‡æ¢
    recordExploration('modeSwitch');
    
    // æ›´æ–°ç†è®º
    updateTheoryAndAnalysis();
    
    // é‡ç½®æ¨¡æ‹Ÿ
    resetSimulation();
    achievementUnlocked = false;
}

// ==================== è¯„æµ‹éƒ¨åˆ† ====================
let currentQuestionIndex = 0;
let userAnswers = [];
let assessmentStarted = false;

const assessmentQuestions = [
    {
        question: "æ ¹æ®è²å…‹ç¬¬ä¸€å®šå¾‹ï¼Œè‹¥æ‰©æ•£è·ç¦»LåŠ å€ï¼Œç¨³æ€æ‰©æ•£é€šé‡å°†å¦‚ä½•å˜åŒ–ï¼Ÿ",
        options: [
            { text: "ä¿æŒä¸å˜", correct: false },
            { text: "å‡å°ä¸ºåŸæ¥çš„ä¸€åŠ", correct: true },
            { text: "å¢åŠ ä¸ºåŸæ¥çš„ä¸¤å€", correct: false },
            { text: "ä¸è·ç¦»å¹³æ–¹æˆåæ¯”", correct: false }
        ],
        explanation: "æ ¹æ®è²å…‹ç¬¬ä¸€å®šå¾‹ J = -DÂ·(dC/dx)ï¼Œåœ¨æµ“åº¦æ¢¯åº¦Î”C/Lå›ºå®šçš„æƒ…å†µä¸‹ï¼Œå½“LåŠ å€æ—¶ï¼Œæµ“åº¦æ¢¯åº¦å‡åŠï¼Œå› æ­¤æ‰©æ•£é€šé‡ä¹Ÿå‡åŠã€‚",
        skill: "ç¨³æ€æ‰©æ•£"
    },
    {
        question: "è²å…‹ç¬¬ä¸€å®šå¾‹çš„æ•°å­¦è¡¨è¾¾å¼æ˜¯ä»€ä¹ˆï¼Ÿ",
        options: [
            { text: "J = DÂ·C", correct: false },
            { text: "J = -DÂ·(dC/dx)", correct: true },
            { text: "J = DÂ·t/L", correct: false },
            { text: "J = CÂ·L/t", correct: false }
        ],
        explanation: "è²å…‹ç¬¬ä¸€å®šå¾‹æè¿°çš„æ˜¯æ‰©æ•£é€šé‡ä¸æµ“åº¦æ¢¯åº¦æˆæ­£æ¯”ï¼Œæ¯”ä¾‹ç³»æ•°ä¸ºæ‰©æ•£ç³»æ•°Dï¼Œè´Ÿå·è¡¨ç¤ºæ‰©æ•£æ–¹å‘ä¸æµ“åº¦æ¢¯åº¦æ–¹å‘ç›¸åã€‚",
        skill: "åŸºæœ¬æ¦‚å¿µ"
    },
    {
        question: "éç¨³æ€æ‰©æ•£çš„ç‰¹å¾æ—¶é—´Ï„ä¸æ‰©æ•£è·ç¦»Lçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ",
        options: [
            { text: "Ï„ âˆ L", correct: false },
            { text: "Ï„ âˆ LÂ²", correct: true },
            { text: "Ï„ âˆ 1/L", correct: false },
            { text: "Ï„ âˆ âˆšL", correct: false }
        ],
        explanation: "ç‰¹å¾æ‰©æ•£æ—¶é—´ Ï„ = LÂ²/Dï¼Œè¡¨ç¤ºæ‰©æ•£å‰æ²¿åˆ°è¾¾è·ç¦»Læ‰€éœ€çš„æ—¶é—´ï¼Œä¸è·ç¦»çš„å¹³æ–¹æˆæ­£æ¯”ã€‚",
        skill: "æ—¶é—´å°ºåº¦"
    },
    {
        question: "åœ¨ç¨³æ€æ‰©æ•£ä¸­ï¼Œæµ“åº¦åˆ†å¸ƒæ›²çº¿æ˜¯ä»€ä¹ˆå½¢çŠ¶ï¼Ÿ",
        options: [
            { text: "æŒ‡æ•°è¡°å‡æ›²çº¿", correct: false },
            { text: "çº¿æ€§ç›´çº¿", correct: true },
            { text: "æŠ›ç‰©çº¿", correct: false },
            { text: "æ­£å¼¦æ›²çº¿", correct: false }
        ],
        explanation: "ç¨³æ€æ‰©æ•£æ»¡è¶³âˆ‚C/âˆ‚t = 0ï¼Œåœ¨ä¸€ç»´æƒ…å†µä¸‹ï¼Œæµ“åº¦åˆ†å¸ƒæ˜¯çº¿æ€§çš„ï¼ŒC(x) = Câ‚€ - (Câ‚€ - C_L)Â·(x/L)ã€‚",
        skill: "æµ“åº¦åˆ†å¸ƒ"
    },
    {
        question: "æ‰©æ•£ç³»æ•°Dçš„ä¸»è¦å½±å“å› ç´ ä¸åŒ…æ‹¬ä»¥ä¸‹å“ªé¡¹ï¼Ÿ",
        options: [
            { text: "æ¸©åº¦", correct: false },
            { text: "ä»‹è´¨æ€§è´¨", correct: false },
            { text: "æµ“åº¦å¤§å°", correct: true },
            { text: "åˆ†å­å°ºå¯¸", correct: false }
        ],
        explanation: "æ‰©æ•£ç³»æ•°Dä¸»è¦å–å†³äºæ¸©åº¦ã€ä»‹è´¨ç²˜åº¦å’Œåˆ†å­å°ºå¯¸ï¼Œä¸æµ“åº¦å¤§å°å…³ç³»ä¸å¤§ï¼ˆé™¤éæµ“åº¦æé«˜ï¼‰ã€‚",
        skill: "å½±å“å› ç´ "
    }
];

// ç»˜åˆ¶é›·è¾¾å›¾
function drawRadarChart(scores, dimensions, canvasId) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = Math.min(centerX, centerY) - 30;
    const numPoints = scores.length;
    const angleStep = (2 * Math.PI) / numPoints;
    
    // æ¸…ç©ºç”»å¸ƒ
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // ç»˜åˆ¶ç½‘æ ¼çº¿
    ctx.strokeStyle = 'rgba(0, 150, 255, 0.3)';
    ctx.lineWidth = 1;
    
    // ç»˜åˆ¶åŒå¿ƒå¤šè¾¹å½¢
    for (let level = 1; level <= 4; level++) {
        ctx.beginPath();
        for (let i = 0; i <= numPoints; i++) {
            const angle = i * angleStep - Math.PI / 2;
            const r = radius * level / 4;
            const x = centerX + r * Math.cos(angle);
            const y = centerY + r * Math.sin(angle);
            
            if (i === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
        }
        ctx.closePath();
        ctx.stroke();
    }
    
    // ç»˜åˆ¶è½´çº¿
    ctx.strokeStyle = 'rgba(0, 200, 255, 0.5)';
    ctx.lineWidth = 1;
    
    for (let i = 0; i < numPoints; i++) {
        const angle = i * angleStep - Math.PI / 2;
        const x = centerX + radius * Math.cos(angle);
        const y = centerY + radius * Math.sin(angle);
        
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.lineTo(x, y);
        ctx.stroke();
    }
    
    // ç»˜åˆ¶æ•°æ®å¤šè¾¹å½¢
    ctx.fillStyle = 'rgba(0, 170, 255, 0.3)';
    ctx.strokeStyle = '#00aaff';
    ctx.lineWidth = 2;
    
    ctx.beginPath();
    for (let i = 0; i < numPoints; i++) {
        const angle = i * angleStep - Math.PI / 2;
        const score = scores[i];
        const r = radius * score;
        const x = centerX + r * Math.cos(angle);
        const y = centerY + r * Math.sin(angle);
        
        if (i === 0) {
            ctx.moveTo(x, y);
        } else {
            ctx.lineTo(x, y);
        }
        
        // ç»˜åˆ¶æ•°æ®ç‚¹
        ctx.fillStyle = '#00aaff';
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fill();
    }
    
    ctx.closePath();
    ctx.fill();
    ctx.stroke();
    
    // ç»˜åˆ¶ç»´åº¦æ ‡ç­¾
    ctx.fillStyle = '#cceeff';
    ctx.font = 'bold 14px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    
    for (let i = 0; i < numPoints; i++) {
        const angle = i * angleStep - Math.PI / 2;
        const labelRadius = radius + 20;
        const x = centerX + labelRadius * Math.cos(angle);
        const y = centerY + labelRadius * Math.sin(angle);
        
        // è°ƒæ•´æ–‡æœ¬ä½ç½®
        let textAlign = 'center';
        if (Math.abs(Math.cos(angle)) > 0.5) {
            textAlign = Math.cos(angle) > 0 ? 'left' : 'right';
        }
        
        ctx.textAlign = textAlign;
        ctx.fillText(dimensions[i], x, y);
    }
}

// å¼€å§‹è¯„æµ‹
function startAssessment() {
    mainContainer.style.display = "none";
    assessmentContainer.style.display = "block";
    assessmentStarted = true;
    currentQuestionIndex = 0;
    userAnswers = [];
    
    loadQuestion(currentQuestionIndex);
    updateProgress();
}

// è¿”å›ä¸»ç•Œé¢
function returnToMain() {
    assessmentContainer.style.display = "none";
    mainContainer.style.display = "block";
    assessmentStarted = false;
}

// åŠ è½½é¢˜ç›®
function loadQuestion(index) {
    if (index < 0 || index >= assessmentQuestions.length) return;
    
    currentQuestionIndex = index;
    const question = assessmentQuestions[index];
    
    let optionsHtml = "";
    question.options.forEach((option, i) => {
        const isSelected = userAnswers[index] === i;
        optionsHtml += `
            <div class="assessment-option ${isSelected ? 'selected' : ''}" onclick="selectOption(${i})">
                ${option.text}
            </div>
        `;
    });
    
    document.getElementById("questionContainer").innerHTML = `
        <div class="assessment-question">
            <h3>ç¬¬${index + 1}é¢˜ï¼š${question.question}</h3>
            <div class="assessment-options">
                ${optionsHtml}
            </div>
        </div>
    `;
    
    updateProgress();
}

// é€‰æ‹©é€‰é¡¹
function selectOption(optionIndex) {
    userAnswers[currentQuestionIndex] = optionIndex;
    
    // æ›´æ–°é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
    const options = document.querySelectorAll('.assessment-option');
    options.forEach((option, i) => {
        if (i === optionIndex) {
            option.classList.add('selected');
        } else {
            option.classList.remove('selected');
        }
    });
}

// ä¸‹ä¸€é¢˜
function nextQuestion() {
    if (currentQuestionIndex < assessmentQuestions.length - 1) {
        currentQuestionIndex++;
        loadQuestion(currentQuestionIndex);
    } else {
        // å¦‚æœæ˜¯æœ€åä¸€é¢˜ï¼Œæ˜¾ç¤ºç»“æœ
        showAssessmentResult();
    }
}

// ä¸Šä¸€é¢˜
function prevQuestion() {
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        loadQuestion(currentQuestionIndex);
    }
}

// æ›´æ–°è¿›åº¦
function updateProgress() {
    const progress = ((currentQuestionIndex + 1) / assessmentQuestions.length) * 100;
    document.getElementById("progressFill").style.width = `${progress}%`;
    document.getElementById("progressPercent").textContent = `${Math.round(progress)}%`;
}

// ç”Ÿæˆè°ƒæ§å»ºè®®
function generateControlSuggestions(explorationScore) {
    let suggestions = [];
    
    if (explorationData.modeSwitches < 2) {
        suggestions.push("å°è¯•åˆ‡æ¢ç¨³æ€å’Œéç¨³æ€æ¨¡å¼ï¼Œè§‚å¯Ÿä¸¤ç§æ¨¡å¼ä¸‹çš„æ‰©æ•£å·®å¼‚");
    }
    
    if (explorationData.parameterChanges < 10) {
        suggestions.push("å¤šè°ƒæ•´æ‰©æ•£ç³»æ•°Då’Œè·ç¦»Lï¼Œè§‚å¯Ÿå®ƒä»¬å¯¹æ‰©æ•£é€Ÿç‡çš„å½±å“");
    }
    
    if (!explorationData.exploredSteady) {
        suggestions.push("å°è¯•ç¨³æ€æ‰©æ•£æ¨¡å¼ï¼Œè°ƒèŠ‚æœ«ç«¯æµ“åº¦C_Lï¼Œè§‚å¯Ÿä¼ è´¨é€šé‡çš„å˜åŒ–");
    }
    
    if (!explorationData.exploredDynamic) {
        suggestions.push("å°è¯•éç¨³æ€æ‰©æ•£æ¨¡å¼ï¼Œè§‚å¯Ÿæ‰©æ•£å‰æ²¿éšæ—¶é—´æ¨è¿›çš„è¿‡ç¨‹");
    }
    
    if (explorationData.simulationStarts < 3) {
        suggestions.push("å¤šå¯åŠ¨å‡ æ¬¡æ¨¡æ‹Ÿï¼Œè§‚å¯Ÿä¸åŒå‚æ•°ç»„åˆä¸‹çš„æ‰©æ•£è¿‡ç¨‹");
    }
    
    if (explorationData.maxDvalue - explorationData.minDvalue < 2) {
        suggestions.push("å°è¯•æ›´å¤§èŒƒå›´åœ°è°ƒæ•´æ‰©æ•£ç³»æ•°Dï¼ˆä»0.1åˆ°5ï¼‰ï¼Œè§‚å¯Ÿæ‰©æ•£é€Ÿåº¦çš„å˜åŒ–");
    }
    
    if (explorationData.maxLvalue - explorationData.minLvalue < 15) {
        suggestions.push("å°è¯•æ›´å¤§èŒƒå›´åœ°è°ƒæ•´æ‰©æ•£è·ç¦»Lï¼ˆä»5åˆ°30ï¼‰ï¼Œè§‚å¯Ÿæ‰©æ•£æ—¶é—´çš„å¹³æ–¹å…³ç³»");
    }
    
    // å¦‚æœå»ºè®®å¤ªå¤šï¼Œåªå–å‰3æ¡
    if (suggestions.length > 3) {
        suggestions = suggestions.slice(0, 3);
    }
    
    // å¦‚æœæ²¡æœ‰å»ºè®®ï¼Œæ·»åŠ é»˜è®¤å»ºè®®
    if (suggestions.length === 0) {
        suggestions = [
            "å°è¯•æç«¯å‚æ•°ç»„åˆï¼Œå¦‚é«˜Då€¼+é•¿Lå€¼ï¼Œè§‚å¯Ÿæ‰©æ•£è¡Œä¸º",
            "æ¯”è¾ƒç¨³æ€å’Œéç¨³æ€åœ¨ç›¸åŒå‚æ•°ä¸‹çš„æµ“åº¦åˆ†å¸ƒå·®å¼‚",
            "è®¡ç®—ä¸åŒå‚æ•°ä¸‹çš„ç‰¹å¾æ‰©æ•£æ—¶é—´Ï„ï¼ŒéªŒè¯Ï„ = LÂ²/Då…³ç³»"
        ];
    }
    
    return suggestions;
}

// æ˜¾ç¤ºè¯„æµ‹ç»“æœ
function showAssessmentResult() {
    // è®¡ç®—å¾—åˆ†
    let score = 0;
    const skillScores = {
        "ç¨³æ€æ‰©æ•£": 0,
        "åŸºæœ¬æ¦‚å¿µ": 0,
        "æ—¶é—´å°ºåº¦": 0,
        "æµ“åº¦åˆ†å¸ƒ": 0,
        "å½±å“å› ç´ ": 0,
        "æ¢ç´¢èƒ½åŠ›": 0
    };
    
    const skillCounts = {
        "ç¨³æ€æ‰©æ•£": 0,
        "åŸºæœ¬æ¦‚å¿µ": 0,
        "æ—¶é—´å°ºåº¦": 0,
        "æµ“åº¦åˆ†å¸ƒ": 0,
        "å½±å“å› ç´ ": 0,
        "æ¢ç´¢èƒ½åŠ›": 1
    };
    
    assessmentQuestions.forEach((question, index) => {
        if (userAnswers[index] !== undefined) {
            const isCorrect = question.options[userAnswers[index]].correct;
            if (isCorrect) {
                score++;
                skillScores[question.skill] += 1;
            }
            skillCounts[question.skill] += 1;
        }
    });
    
    // è®¡ç®—æ¢ç´¢èƒ½åŠ›å¾—åˆ†
    let explorationScore = 0;
    explorationScore += Math.min(explorationData.modeSwitches, 5) * 2; // æœ€å¤š10åˆ†
    explorationScore += Math.min(explorationData.parameterChanges, 20) * 0.5; // æœ€å¤š10åˆ†
    explorationScore += Math.min(explorationData.simulationStarts, 5) * 2; // æœ€å¤š10åˆ†
    explorationScore += (explorationData.exploredSteady ? 10 : 0);
    explorationScore += (explorationData.exploredDynamic ? 10 : 0);
    explorationScore = Math.min(explorationScore, 50); // æœ€å¤š50åˆ†
    skillScores["æ¢ç´¢èƒ½åŠ›"] = explorationScore / 50; // è½¬æ¢ä¸º0-1æ¯”ä¾‹
    
    // è®¡ç®—æŠ€èƒ½å¾—åˆ†æ¯”ä¾‹
    const skillPercentages = {};
    for (const skill in skillScores) {
        skillPercentages[skill] = skillCounts[skill] > 0 ? skillScores[skill] / skillCounts[skill] : 0;
    }
    
    // è½¬æ¢ä¸ºæ•°ç»„ç”¨äºé›·è¾¾å›¾
    const dimensions = ["ç¨³æ€æ‰©æ•£", "åŸºæœ¬æ¦‚å¿µ", "æ—¶é—´å°ºåº¦", "æµ“åº¦åˆ†å¸ƒ", "å½±å“å› ç´ ", "æ¢ç´¢èƒ½åŠ›"];
    const radarData = dimensions.map(dim => skillPercentages[dim]);
    
    const percentage = (score / assessmentQuestions.length) * 100;
    
    // ç¡®å®šå·¥ç¨‹å¸ˆç­‰çº§
    let level, levelClass, levelDescription, suggestions;
    
    if (percentage >= 90 && explorationScore >= 40) {
        level = "ğŸ§  èµ„æ·±æ‰©æ•£ä¼ è´¨å·¥ç¨‹å¸ˆ";
        levelClass = "level-expert";
        levelDescription = "æ‚¨å¯¹æ‰©æ•£ä¼ è´¨åŸç†æœ‰æ·±å…¥çš„ç†è§£ï¼Œèƒ½å¤Ÿç†Ÿç»ƒè¿ç”¨è²å…‹å®šå¾‹è§£å†³å¤æ‚å·¥ç¨‹é—®é¢˜ï¼Œä¸”æ¢ç´¢èƒ½åŠ›å‡ºè‰²ã€‚";
        suggestions = `
            <h4>ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®ï¼š</h4>
            <ul>
                <li>æ·±å…¥ç ”ç©¶å¤šç»´æ‰©æ•£ä¼ è´¨é—®é¢˜</li>
                <li>å­¦ä¹ æ‰©æ•£-å¯¹æµè€¦åˆä¼ è¾“æ¨¡å‹</li>
                <li>æ¢ç´¢éæ’å®šè¾¹ç•Œæ¡ä»¶ä¸‹çš„æ‰©æ•£é—®é¢˜</li>
                <li>ç ”ç©¶å®é™…å·¥ç¨‹ä¸­çš„æ‰©æ•£ç³»æ•°æµ‹å®šæ–¹æ³•</li>
            </ul>
        `;
    } else if (percentage >= 70 && explorationScore >= 30) {
        level = "ğŸ“Š ä¸­çº§æ‰©æ•£ä¼ è´¨å·¥ç¨‹å¸ˆ";
        levelClass = "level-senior";
        levelDescription = "æ‚¨æŒæ¡äº†æ‰©æ•£ä¼ è´¨çš„åŸºæœ¬åŸç†ï¼Œèƒ½å¤Ÿæ­£ç¡®åº”ç”¨è²å…‹å®šå¾‹è§£å†³å¸¸è§å·¥ç¨‹é—®é¢˜ï¼Œå…·å¤‡è‰¯å¥½çš„æ¢ç´¢èƒ½åŠ›ã€‚";
        suggestions = `
            <h4>ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®ï¼š</h4>
            <ul>
                <li>åŠ å¼ºå¯¹éç¨³æ€æ‰©æ•£ç‰¹å¾æ—¶é—´çš„ç†è§£</li>
                <li>å­¦ä¹ ä¸åŒè¾¹ç•Œæ¡ä»¶ä¸‹çš„æ‰©æ•£è§£</li>
                <li>äº†è§£å®é™…å·¥ç¨‹ä¸­æ‰©æ•£ç³»æ•°çš„å–å€¼</li>
                <li>ç ”ç©¶æ‰©æ•£ä¼ è´¨ä¸çƒ­é‡ä¼ é€’çš„ç±»æ¯”</li>
            </ul>
        `;
    } else if (percentage >= 50 && explorationScore >= 20) {
        level = "ğŸ”§ åˆçº§æ‰©æ•£ä¼ è´¨å·¥ç¨‹å¸ˆ";
        levelClass = "level-junior";
        levelDescription = "æ‚¨å¯¹æ‰©æ•£ä¼ è´¨æœ‰åŸºæœ¬äº†è§£ï¼Œä½†åœ¨æŸäº›æ¦‚å¿µç†è§£ä¸Šè¿˜éœ€åŠ å¼ºï¼Œæ¢ç´¢èƒ½åŠ›æœ‰å¾…æé«˜ã€‚";
        suggestions = `
            <h4>ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®ï¼š</h4>
            <ul>
                <li>é‡æ–°å­¦ä¹ è²å…‹ç¬¬ä¸€å®šå¾‹å’Œç¬¬äºŒå®šå¾‹</li>
                <li>ç†è§£ç¨³æ€ä¸éç¨³æ€æ‰©æ•£çš„æœ¬è´¨åŒºåˆ«</li>
                <li>æŒæ¡ç‰¹å¾æ‰©æ•£æ—¶é—´çš„è®¡ç®—æ–¹æ³•</li>
                <li>ç»ƒä¹ æ›´å¤šæ‰©æ•£ä¼ è´¨è®¡ç®—ä¾‹é¢˜</li>
            </ul>
        `;
    } else {
        level = "ğŸ“ æ‰©æ•£ä¼ è´¨å®ä¹ ç”Ÿ";
        levelClass = "level-trainee";
        levelDescription = "æ‚¨åˆšå¼€å§‹å­¦ä¹ æ‰©æ•£ä¼ è´¨ï¼Œéœ€è¦ç³»ç»Ÿå­¦ä¹ ç›¸å…³åŸºç¡€çŸ¥è¯†ï¼Œå¹¶åŠ å¼ºå‚æ•°æ¢ç´¢ã€‚";
        suggestions = `
            <h4>ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®ï¼š</h4>
            <ul>
                <li>ç³»ç»Ÿå­¦ä¹ è²å…‹å®šå¾‹çš„åŸºæœ¬æ¦‚å¿µ</li>
                <li>ç†è§£æµ“åº¦æ¢¯åº¦ä¸æ‰©æ•£é€šé‡çš„å…³ç³»</li>
                <li>æŒæ¡ç¨³æ€æ‰©æ•£çš„åŸºæœ¬è®¡ç®—</li>
                <li>é€šè¿‡æ¨¡æ‹Ÿå·¥å…·åŠ æ·±å¯¹æ‰©æ•£è¿‡ç¨‹çš„ç†è§£</li>
            </ul>
        `;
    }
    
    // ç”Ÿæˆè°ƒæ§æ¢ç´¢åé¦ˆ
    const explorationStatsHtml = `
        <div class="exploration-stats">
            <div class="exploration-stat">
                <div class="stat-name">æ¨¡å¼åˆ‡æ¢æ¬¡æ•°</div>
                <div class="stat-value">${explorationData.modeSwitches} æ¬¡</div>
            </div>
            <div class="exploration-stat">
                <div class="stat-name">å‚æ•°è°ƒæ•´æ¬¡æ•°</div>
                <div class="stat-value">${explorationData.parameterChanges} æ¬¡</div>
            </div>
            <div class="exploration-stat">
                <div class="stat-name">æ¨¡æ‹Ÿå¯åŠ¨æ¬¡æ•°</div>
                <div class="stat-value">${explorationData.simulationStarts} æ¬¡</div>
            </div>
            <div class="exploration-stat">
                <div class="stat-name">æ¢ç´¢æ¨¡å¼</div>
                <div class="stat-value">${explorationData.exploredSteady && explorationData.exploredDynamic ? "ç¨³æ€+éç¨³æ€" : explorationData.exploredSteady ? "ä»…ç¨³æ€" : explorationData.exploredDynamic ? "ä»…éç¨³æ€" : "æœªæ¢ç´¢"}</div>
            </div>
        </div>
    `;
    
    // ç”Ÿæˆè°ƒæ§å»ºè®®
    const controlSuggestions = generateControlSuggestions(explorationScore);
    const suggestionsHtml = controlSuggestions.map(suggestion => `<li>${suggestion}</li>`).join('');
    
    // æŠ€èƒ½æŒ‡æ ‡æ˜¾ç¤º
    let skillIndicatorsHtml = '';
    dimensions.forEach(skill => {
        const score = skillPercentages[skill] * 100;
        skillIndicatorsHtml += `
            <div class="skill-indicator">
                <div class="skill-name">${skill}</div>
                <div class="skill-bar">
                    <div class="skill-fill" style="width: ${score}%"></div>
                </div>
                <div class="skill-score">${score.toFixed(0)}%</div>
            </div>
        `;
    });
    
    document.getElementById("assessmentResult").innerHTML = `
        <h2>è¯„æµ‹å®Œæˆï¼</h2>
        
        <div class="assessment-grid">
            <div>
                <div class="engineer-level ${levelClass}">
                    ${level}
                </div>
                <p>ç†è®ºå¾—åˆ†: ${score}/${assessmentQuestions.length} (${percentage.toFixed(1)}%)</p>
                <p>æ¢ç´¢èƒ½åŠ›: ${explorationScore.toFixed(0)}/50 åˆ†</p>
                <p>${levelDescription}</p>
                
                <div class="assessment-suggestion">
                    ${suggestions}
                </div>
                
                <div class="exploration-feedback">
                    <h3>è°ƒæ§æ¢ç´¢åé¦ˆ</h3>
                    ${explorationStatsHtml}
                    <div class="control-suggestions">
                        <h4>è°ƒæ§ä¼˜åŒ–å»ºè®®</h4>
                        <ul class="suggestion-list">
                            ${suggestionsHtml}
                        </ul>
                    </div>
                </div>
            </div>
            
            <div>
                <h3>æŠ€èƒ½é›·è¾¾å›¾</h3>
                <div class="radar-container">
                    <div class="radar-chart-container">
                        <canvas id="radarCanvas" width="300" height="300"></canvas>
                    </div>
                </div>
                
                <div class="skill-indicators">
                    ${skillIndicatorsHtml}
                </div>
            </div>
        </div>
        
        <div class="assessment-buttons">
            <button onclick="returnToMain()">â† è¿”å›æ¨¡æ‹Ÿç•Œé¢</button>
            <button onclick="retryAssessment()">ğŸ”„ é‡æ–°è¯„æµ‹</button>
        </div>
    `;
    
    document.getElementById("assessmentResult").style.display = "block";
    
    // ç»˜åˆ¶é›·è¾¾å›¾
    setTimeout(() => {
        drawRadarChart(radarData, dimensions, "radarCanvas");
    }, 100);
}

// é‡æ–°è¯„æµ‹
function retryAssessment() {
    currentQuestionIndex = 0;
    userAnswers = [];
    document.getElementById("assessmentResult").style.display = "none";
    loadQuestion(currentQuestionIndex);
}

// ==================== åˆå§‹åŒ– ====================
// åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
mode.onchange = handleModeChange;

Dslider.oninput = () => { 
    updateParamDisplays(); 
    updateTheoryAndAnalysis();
    realTimeUpdate();
    recordExploration('parameterChange');
};

Lslider.oninput = () => { 
    updateParamDisplays(); 
    updateTheoryAndAnalysis();
    realTimeUpdate();
    recordExploration('parameterChange');
};

speedSlider.oninput = () => { 
    updateParamDisplays(); 
};

CLslider.oninput = () => { 
    updateParamDisplays(); 
    updateTheoryAndAnalysis();
    realTimeUpdate();
    recordExploration('parameterChange');
};

// è°ƒæ•´canvaså¤§å°ä»¥é€‚åº”å®¹å™¨
function resizeCanvas() {
    const container = document.querySelector('.canvas-container');
    canvas.width = container.clientWidth;
    canvas.height = container.clientHeight;
    
    // é‡æ–°ç»˜åˆ¶
    realTimeUpdate();
}

// çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´canvas
window.addEventListener('resize', resizeCanvas);

// åˆå§‹åŒ–
updateParamDisplays();
handleModeChange(); // åˆå§‹è°ƒç”¨ä»¥è®¾ç½®æ­£ç¡®çŠ¶æ€
resizeCanvas(); // åˆå§‹è°ƒæ•´canvaså¤§å°

// åˆå§‹åŒ–æ¢ç´¢æ•°æ®
explorationData.lastMode = mode.value;
if (mode.value === 'steady') explorationData.exploredSteady = true;
if (mode.value === 'dynamic') explorationData.exploredDynamic = true;
</script>

    <!-- åº•éƒ¨ä¿¡æ¯æ  -->
    <div style="
        text-align: center;
        padding: 20px 30px;
        margin-top: 40px;
        color: #93c5fd;
        font-size: 0.9rem;
        border-top: 2px solid rgba(56, 189, 248, 0.5);
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.9));
        border-radius: 15px 15px 0 0;
        box-shadow: 0 -10px 30px rgba(56, 189, 248, 0.1);
        position: relative;
        overflow: hidden;
    ">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, #38bdf8, #0ea5e9, #38bdf8);"></div>
        
        <p style="font-size: 1.3rem; font-weight: bold; margin-bottom: 15px; color: #38bdf8;">
            è²å…‹å®šå¾‹æ‰©æ•£ä¼ è´¨å®æˆ˜è®­ç»ƒ &copy; 2025 | å·¥ç¨‹æ€ç»´è®­ç»ƒç³»ç»Ÿ | ç‰ˆæœ¬ 1.0 | 
        
        <style="margin-bottom: 12px; color: #cbd5e1;">
             <strong>é‚®ç®±:</strong> xgyanger@qq.com
        </p>
        
      
        <div style="margin-top: 15px; display: flex; justify-content: center; gap: 15px;">
            <span style="color: #ff9e00; font-weight: bold; font-size: 1.1rem;">
                ç‰ˆæƒÂ©2025 AIknow. ä¿ç•™æ‰€æœ‰æƒåˆ© | Copyright Â©2025 AIknow. All rights reserved.
            </span>
        </div>
    </div>



</body>
</html>