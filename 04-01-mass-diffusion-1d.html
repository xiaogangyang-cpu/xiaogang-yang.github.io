<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸€ç»´æ‰©æ•£ä¼ è´¨ï¼šä»å¾®è§‚åˆ°å®è§‚æ¨¡æ‹Ÿç³»ç»Ÿ</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            background: linear-gradient(135deg, #0a0a1f 0%, #1a1a3f 100%);
            color: #ffffff;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        h1 {
            text-align: center;
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: #88ffff;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        /* ä¸»å®¹å™¨ï¼š4:6åˆ†æ å¸ƒå±€ */
        .main-container {
            display: flex;
            gap: 20px;
            max-width: 1800px;
            margin: 0 auto;
            height: calc(100vh - 150px);
        }
        
        /* å·¦ä¾§æ§åˆ¶é¢æ¿ - 40% */
        .control-panel {
            flex: 0 0 40%;
            background: rgba(0, 20, 40, 0.85);
            border: 2px solid #00aaff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0, 170, 255, 0.3);
            backdrop-filter: blur(5px);
            overflow-y: auto;
        }
        
        /* å³ä¾§å±•ç¤ºåŒºåŸŸ - 60% */
        .display-area {
            flex: 0 0 60%;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        /* å±•ç¤ºå†…å®¹å®¹å™¨ - å…±ç”¨åŒä¸€ä½ç½® */
        .display-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 10, 20, 0.9);
            border: 2px solid #00aaff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0, 170, 255, 0.3);
            backdrop-filter: blur(5px);
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .display-content.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* æ¨¡æ‹Ÿå±•ç¤ºé¡µé¢ */
        .simulation-display {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* æµ‹è¯•é¡µé¢ */
        .test-display {
            padding: 25px;
        }
        
        /* è¯„æµ‹é¡µé¢ */
        .evaluation-display {
            padding: 25px;
        }
        
        .panel-title {
            color: #00aaff;
            border-bottom: 1px solid #00aaff;
            padding-bottom: 10px;
            margin-top: 0;
            font-size: 1.3em;
        }
        
        /* æ»‘å—å’Œæ§ä»¶æ ·å¼ */
        .slider-container {
            margin: 15px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
        label {
            display: block;
            color: #00ccff;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="range"] {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: linear-gradient(90deg, #003366 0%, #00aaff 100%);
            border-radius: 4px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #00aaff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 8px #00aaff;
        }
        .value {
            color: #ffff66;
            font-weight: bold;
            margin-left: 10px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 8px;
            border-radius: 3px;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .control-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        button {
            background: linear-gradient(135deg, #0088cc 0%, #00aaff 100%);
            color: #000;
            padding: 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 170, 255, 0.3);
            font-size: 14px;
        }
        button:hover {
            background: linear-gradient(135deg, #00aaff 0%, #88ddff 100%);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(0, 170, 255, 0.5);
        }
        button:disabled {
            background: #555;
            color: #888;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .button-danger {
            background: linear-gradient(135deg, #cc3300 0%, #ff5500 100%);
            box-shadow: 0 0 10px rgba(255, 85, 0, 0.3);
        }
        .button-danger:hover {
            background: linear-gradient(135deg, #ff5500 0%, #ffaa88 100%);
            box-shadow: 0 0 15px rgba(255, 85, 0, 0.5);
        }
        .button-info {
            background: linear-gradient(135deg, #6633cc 0%, #9966ff 100%);
            box-shadow: 0 0 10px rgba(153, 102, 255, 0.3);
        }
        .button-info:hover {
            background: linear-gradient(135deg, #9966ff 0%, #ccbbff 100%);
            box-shadow: 0 0 15px rgba(153, 102, 255, 0.5);
        }
        .button-success {
            background: linear-gradient(135deg, #00aa33 0%, #00ff66 100%);
            box-shadow: 0 0 10px rgba(0, 255, 102, 0.3);
        }
        .button-success:hover {
            background: linear-gradient(135deg, #00ff66 0%, #88ffaa 100%);
            box-shadow: 0 0 15px rgba(0, 255, 102, 0.5);
        }
        .button-warning {
            background: linear-gradient(135deg, #ffaa00 0%, #ffcc00 100%);
            box-shadow: 0 0 10px rgba(255, 204, 0, 0.3);
        }
        .button-warning:hover {
            background: linear-gradient(135deg, #ffcc00 0%, #ffdd88 100%);
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.5);
        }
        
        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        .stat-item {
            background: rgba(0, 30, 60, 0.7);
            padding: 8px;
            border-radius: 5px;
            border-left: 4px solid #00ffff;
        }
        .stat-label {
            color: #88ffff;
            font-size: 0.85em;
        }
        .stat-value {
            color: #ffff66;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        /* ç”»å¸ƒåŒºåŸŸ */
        .canvas-section {
            background: rgba(0, 10, 20, 0.7);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #00aaff;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .canvas-title {
            color: #00aaff;
            margin-top: 0;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        canvas {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            border: 1px solid #00aaff;
            display: block;
            margin: 10px auto;
            width: 100%;
            flex: 1;
        }
        
        /* è¿›åº¦æ¡ */
        .progress-container {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-bar {
            height: 10px;
            background: linear-gradient(90deg, #003366, #00aaff, #00ffff);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        /* æ—¶é—´æ˜¾ç¤º */
        .time-display {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #ffff66;
            font-size: 0.9em;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        /* æŸ±çŠ¶å›¾æ ‡ç­¾ */
        .bar-label {
            position: absolute;
            bottom: 25px;
            color: #88ffff;
            font-size: 0.7em;
            text-align: center;
            width: 100%;
        }
        
        /* æŸ±çŠ¶å›¾æ•°å€¼æ˜¾ç¤º */
        .bar-value {
            position: absolute;
            top: -20px;
            color: #ffff66;
            font-size: 0.7em;
            text-align: center;
            width: 100%;
            font-weight: bold;
        }
        
        /* é—®é¢˜æ ·å¼ */
        .question {
            background: rgba(0, 30, 60, 0.7);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #ff66ff;
        }
        .question h4 {
            color: #ff99ff;
            margin-top: 0;
            font-size: 1.1em;
        }
        .question-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }
        .question-options label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            color: #aaddff;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            transition: background 0.3s;
        }
        .question-options label:hover {
            background: rgba(0, 100, 200, 0.3);
        }
        textarea {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00aaff;
            color: white;
            font-family: inherit;
            resize: vertical;
        }
        
        /* ç­”æ¡ˆè§£é‡Š */
        .answer-explanation {
            background: rgba(0, 40, 80, 0.7);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #00ffaa;
            display: none;
        }
        .answer-explanation.show {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* é›·è¾¾å›¾å®¹å™¨ */
        .radar-container {
            width: 100%;
            height: 300px;
            position: relative;
            margin: 20px 0;
        }
        
        /* æŠ€èƒ½é¡¹ */
        .skill-item {
            background: rgba(0, 30, 60, 0.7);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #00ffff;
        }
        .skill-name {
            color: #88ffff;
            font-weight: bold;
        }
        .skill-value {
            color: #ffff66;
            float: right;
            font-weight: bold;
        }
        
        /* å»ºè®®æ¡† - ä¿®æ”¹ä¸ºå…¨å®½ */
        .recommendation {
            background: rgba(0, 40, 80, 0.7);
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
            border-left: 6px solid #ffaa00;
            width: 100%;
            grid-column: 1 / -1; /* å æ®å…¨éƒ¨åˆ— */
        }
        
        /* è¯„æµ‹é¡µé¢æ–°çš„ç½‘æ ¼å¸ƒå±€ */
        .evaluation-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        .radar-section, .skills-section {
            background: rgba(0, 20, 40, 0.6);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #00aaff;
        }
        
        /* å¯¼èˆªæŒ‰é’® */
        .navigation-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        /* è¯´æ˜æ–‡æœ¬ */
        .explanation {
            background: rgba(0, 40, 80, 0.5);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        /* æµ‹è¯•ç»“æœ */
        .test-result {
            background: linear-gradient(135deg, rgba(0, 100, 200, 0.3), rgba(100, 0, 200, 0.3));
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #ff66ff;
            text-align: center;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 5px #ff66ff; }
            50% { box-shadow: 0 0 20px #ff66ff; }
            100% { box-shadow: 0 0 5px #ff66ff; }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .main-container {
                flex-direction: column;
                height: auto;
            }
            .control-panel, .display-area {
                flex: none;
                width: 100%;
            }
            .display-area {
                height: 800px;
            }
            
            .evaluation-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>ä¸€ç»´æ‰©æ•£ä¼ è´¨ï¼šä»å¾®è§‚åˆ°å®è§‚æ¨¡æ‹Ÿç³»ç»Ÿ</h1>
    <div class="subtitle">æ¢ç´¢æ‰©æ•£ç°è±¡çš„å¤šå°ºåº¦è¡¨ç°ä¸å·¥ç¨‹åº”ç”¨</div>
    
    <!-- ä¸»å®¹å™¨ï¼š4:6åˆ†æ  -->
    <div class="main-container">
        <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ (40%) -->
        <div class="control-panel">
            <h2 class="panel-title">æ§åˆ¶é¢æ¿</h2>
            
            <div class="slider-container">
                <label>æ‰©æ•£ç³»æ•° D: <span class="value" id="d-value">2.0</span> (mÂ²/s)</label>
                <input type="range" id="d-slider" min="0.1" max="10" step="0.1" value="2.0">
                <div class="progress-container">
                    <div class="progress-bar" id="d-progress"></div>
                </div>
                <div class="explanation">
                    æ§åˆ¶ç²’å­è¿åŠ¨çš„æ´»è·ƒç¨‹åº¦ã€‚å€¼è¶Šå¤§ï¼Œæ‰©æ•£è¶Šå¿«ã€‚<br>
                    <small>æ³¨æ„ï¼šå®è§‚æ‰©æ•£ä½¿ç”¨è¿ç»­ä»‹è´¨Dï¼Œå·²è‡ªåŠ¨ç¼©å°1000å€</small>
                </div>
            </div>
            
            <div class="slider-container">
                <label>ç²’å­æ•°é‡ N: <span class="value" id="n-value">300</span></label>
                <input type="range" id="n-slider" min="10" max="1000" step="10" value="300">
                <div class="progress-container">
                    <div class="progress-bar" id="n-progress"></div>
                </div>
                <div class="explanation">
                    æ¨¡æ‹Ÿçš„ç²’å­æ€»æ•°ã€‚æ•°é‡è¶Šå¤šï¼Œç»Ÿè®¡è§„å¾‹è¶Šæ˜æ˜¾ã€‚
                </div>
            </div>
            
            <div class="slider-container">
                <label>æ—¶é—´æ­¥é•¿ Î”t: <span class="value" id="dt-value">0.03</span> (s)</label>
                <input type="range" id="dt-slider" min="0.01" max="0.2" step="0.01" value="0.03">
                <div class="progress-container">
                    <div class="progress-bar" id="dt-progress"></div>
                </div>
                <div class="explanation">
                    æ¨¡æ‹Ÿçš„æ—¶é—´é—´éš”ã€‚å€¼è¶Šå°ï¼Œæ¨¡æ‹Ÿè¶Šç²¾ç»†ã€‚
                </div>
            </div>
            
            <div class="slider-container">
                <label>æŸ±çŠ¶å›¾æ•°é‡: <span class="value" id="bar-value">20</span></label>
                <input type="range" id="bar-slider" min="5" max="40" step="1" value="20">
                <div class="progress-container">
                    <div class="progress-bar" id="bar-progress"></div>
                </div>
                <div class="explanation">
                    å®è§‚æµ“åº¦åˆ†å¸ƒçš„æŸ±çŠ¶å›¾æ•°é‡ã€‚æ•°é‡è¶Šå¤šï¼Œæ˜¾ç¤ºè¶Šç²¾ç»†ã€‚
                </div>
            </div>
            
            <div class="control-buttons">
                <button id="start-btn">â–¶ å¼€å§‹æ¨¡æ‹Ÿ</button>
                <button id="pause-btn" style="display:none">â¸ æš‚åœæ¨¡æ‹Ÿ</button>
                <button id="remove-barrier-btn" class="button-danger" disabled>ç§»é™¤éš”æ¿</button>
                <button id="reset-btn" class="button-info">â†» é‡ç½®æ¨¡æ‹Ÿ</button>
                <button id="step-btn" class="button-info">â­ å•æ­¥æ‰§è¡Œ</button>
                <button id="test-btn" class="button-success">ğŸ“ è¿›å…¥æµ‹è¯•</button>
                <button id="eval-btn" class="button-warning" disabled>ğŸ“Š å·¥ç¨‹å¸ˆè¯„æµ‹</button>
                <button id="back-btn" class="button-info" style="display:none">â† è¿”å›æ¨¡æ‹Ÿ</button>
            </div>
            
            <div class="stats-panel">
                <div class="stat-item">
                    <div class="stat-label">æ¨¡æ‹Ÿæ—¶é—´</div>
                    <div class="stat-value" id="sim-time">0.0 ç§’</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å·¦ä¾§æµ“åº¦</div>
                    <div class="stat-value" id="left-conc">100%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å³ä¾§æµ“åº¦</div>
                    <div class="stat-value" id="right-conc">0%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">æ‰©æ•£æ—¶é—´</div>
                    <div class="stat-value" id="diffusion-time">0.0 ç§’</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å¹³è¡¡è¿›åº¦</div>
                    <div class="stat-value" id="equilibrium">0%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å®è§‚D(ç¼©æ”¾)</div>
                    <div class="stat-value" id="macro-d-value">0.002</div>
                </div>
            </div>
            
            <div class="explanation" style="margin-top: 20px;">
                <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
                1. è°ƒæ•´å‚æ•°ï¼Œç‚¹å‡»"å¼€å§‹æ¨¡æ‹Ÿ"è§‚å¯Ÿæ‰©æ•£ç°è±¡<br>
                2. ç‚¹å‡»"ç§»é™¤éš”æ¿"è§‚å¯Ÿæ‰©æ•£å¹³è¡¡è¿‡ç¨‹<br>
                3. å®Œæˆæ¢ç´¢åç‚¹å‡»"è¿›å…¥æµ‹è¯•"è¿›è¡ŒçŸ¥è¯†è¯„ä¼°<br>
                4. æµ‹è¯•å®Œæˆåå¯è¿›è¡Œ"å·¥ç¨‹å¸ˆè¯„æµ‹"è·å¾—èƒ½åŠ›è¯„ä¼°<br>
                <br>
                <strong>å®è§‚æ‰©æ•£æ¨¡å‹ï¼š</strong><br>
                ä½¿ç”¨è²å…‹ç¬¬äºŒå®šå¾‹è¯¯å·®å‡½æ•°è§£ï¼š<br>
                C(x,t) = 0.5Â·erfc[x/âˆš(4D_macroÂ·t)]<br>
                <small>D_macro = D Ã— 0.00005 (è¿ç»­ä»‹è´¨æ‰©æ•£ç³»æ•°)</small>
            </div>
        </div>
        
        <!-- å³ä¾§å±•ç¤ºåŒºåŸŸ (60%) - æ‰€æœ‰å†…å®¹å…±ç”¨åŒä¸€ä½ç½® -->
        <div class="display-area">
            <!-- æ¨¡æ‹Ÿå±•ç¤ºé¡µé¢ -->
            <div class="display-content simulation-display active" id="simulation-display">
                <h2 class="panel-title">æ‰©æ•£ç°è±¡æ¨¡æ‹Ÿ</h2>
                
                <div class="canvas-section">
                    <h3 class="canvas-title">å¾®è§‚å±‚é¢ (å•ç²’å­éšæœºæ¸¸èµ°)</h3>
                    <div style="position: relative; flex: 1;">
                        <canvas id="microCanvas"></canvas>
                        <div class="time-display" style="top: 15px; right: 60px;">ç²’å­ä½ç½®: <span id="micro-pos">(0,0)</span></div>
                    </div>
                    <div class="explanation">
                        è§‚å¯Ÿå•ä¸ªç²’å­çš„å¸ƒæœ—è¿åŠ¨ï¼šå®Œå…¨éšæœºï¼Œæ— æ–¹å‘æ€§ã€‚è¿™æ˜¯æ‰©æ•£çš„å¾®è§‚æœ¬è´¨ã€‚
                    </div>
                </div>
                
                <div class="canvas-section">
                    <h3 class="canvas-title">ä»‹è§‚å±‚é¢ (å¤šç²’å­ç»Ÿè®¡è¡Œä¸º)</h3>
                    <div style="position: relative; flex: 1;">
                        <canvas id="mesoCanvas"></canvas>
                        <div class="time-display"style="top: 15px; right: 60px;">å·¦ä¾§ç²’å­: <span id="left-particles">300</span></div>
                        <div class="time-display" style="top: 40px; right: 40px;">å³ä¾§ç²’å­: <span id="right-particles">0</span></div>
                        <div class="time-display" style="top: 70px; right: 10px; background: rgba(255,102,255,0.7);" id="barrier-indicator">éš”æ¿æ¿€æ´»</div>
                    </div>
                    <div class="explanation">
                        å¤šä¸ªç²’å­çš„é›†ä½“è¡Œä¸ºå‘ˆç°ç»Ÿè®¡è§„å¾‹ï¼šä»é«˜æµ“åº¦åŒºåŸŸå‘ä½æµ“åº¦åŒºåŸŸæ‰©æ•£ã€‚
                    </div>
                </div>
                
                <div class="canvas-section">
                    <h3 class="canvas-title">å®è§‚å±‚é¢ (è¯¯å·®å‡½æ•°è§£æè§£ - è²å…‹å®šå¾‹)</h3>
                    <div style="position: relative; flex: 1;">
                        <canvas id="macroCanvas"></canvas>
                        <div class="time-display" style="top: 15px; right: 40px;">æ‰©æ•£çŠ¶æ€: <span id="macro-state">ç­‰å¾…éš”æ¿ç§»é™¤</span></div>
                        <div class="time-display" style="top: 40px; right: 40px;">ç‰¹å¾é•¿åº¦: <span id="diffusion-length">0.0</span> m</div>
                    </div>
                    <div class="explanation">
                        ä½¿ç”¨è²å…‹ç¬¬äºŒå®šå¾‹è¯¯å·®å‡½æ•°è§£ï¼šC(x,t) = 0.5Â·erfc[x/âˆš(4D_macroÂ·t)]ã€‚è¿ç»­ä»‹è´¨æ‰©æ•£ç³»æ•°D_macro = DÃ—0.00005ï¼Œæ‰©æ•£è¿‡ç¨‹åœ¨åˆç†æ—¶é—´å°ºåº¦å‘ç”Ÿã€‚
                    </div>
                </div>
            </div>
            
            <!-- æµ‹è¯•é¡µé¢ -->
            <div class="display-content test-display" id="test-display">
                <h2 class="panel-title">æ‰©æ•£çŸ¥è¯†æµ‹è¯•</h2>
                <p style="color: #88ffff; text-align: center;">å®Œæˆä»¥ä¸‹é—®é¢˜ä»¥æµ‹è¯•æ‚¨å¯¹æ‰©æ•£ç°è±¡çš„ç†è§£</p>
                
                <div class="question">
                    <h4>é—®é¢˜1: åœ¨å¾®è§‚å±‚é¢ï¼Œå•ä¸ªç²’å­çš„è¿åŠ¨å…·æœ‰ä»€ä¹ˆç‰¹å¾ï¼Ÿ</h4>
                    <div class="question-options">
                        <label><input type="radio" name="q1" value="a"> A. æ²¿æµ“åº¦æ¢¯åº¦æ–¹å‘å®šå‘è¿åŠ¨</label>
                        <label><input type="radio" name="q1" value="b"> B. å®Œå…¨éšæœºçš„å¸ƒæœ—è¿åŠ¨</label>
                        <label><input type="radio" name="q1" value="c"> C. å‘¨æœŸæ€§æŒ¯è¡è¿åŠ¨</label>
                        <label><input type="radio" name="q1" value="d"> D. é™æ­¢ä¸åŠ¨</label>
                    </div>
                    <div class="answer-explanation" id="explanation-q1">
                        <strong>æ­£ç¡®ç­”æ¡ˆï¼šB</strong><br>
                        å¾®è§‚å±‚é¢å•ä¸ªç²’å­çš„è¿åŠ¨æ˜¯å®Œå…¨éšæœºçš„å¸ƒæœ—è¿åŠ¨ï¼Œæ²¡æœ‰æ–¹å‘æ€§ã€‚åªæœ‰å½“å¤§é‡ç²’å­é›†ä½“ä½œç”¨æ—¶ï¼Œæ‰ä¼šè¡¨ç°å‡ºä»é«˜æµ“åº¦å‘ä½æµ“åº¦æ‰©æ•£çš„å®è§‚è¶‹åŠ¿ã€‚
                    </div>
                </div>
                
                <div class="question">
                    <h4>é—®é¢˜2: æ ¹æ®è²å…‹ç¬¬ä¸€å®šå¾‹ï¼Œæ‰©æ•£é€šé‡ä¸ä»€ä¹ˆæˆæ­£æ¯”ï¼Ÿ</h4>
                    <div class="question-options">
                        <label><input type="radio" name="q2" value="a"> A. æµ“åº¦</label>
                        <label><input type="radio" name="q2" value="b"> B. æµ“åº¦æ¢¯åº¦</label>
                        <label><input type="radio" name="q2" value="c"> C. æ¸©åº¦</label>
                        <label><input type="radio" name="q2" value="d"> D. å‹åŠ›</label>
                    </div>
                    <div class="answer-explanation" id="explanation-q2">
                        <strong>æ­£ç¡®ç­”æ¡ˆï¼šB</strong><br>
                        è²å…‹ç¬¬ä¸€å®šå¾‹ï¼šJ = -D * (âˆ‚C/âˆ‚x)ï¼Œå…¶ä¸­Jæ˜¯æ‰©æ•£é€šé‡ï¼ŒDæ˜¯æ‰©æ•£ç³»æ•°ï¼Œâˆ‚C/âˆ‚xæ˜¯æµ“åº¦æ¢¯åº¦ã€‚è´Ÿå·è¡¨ç¤ºæ‰©æ•£æ–¹å‘ä¸æµ“åº¦æ¢¯åº¦æ–¹å‘ç›¸åã€‚
                    </div>
                </div>
                
                <div class="question">
                    <h4>é—®é¢˜3: è²å…‹ç¬¬äºŒå®šå¾‹çš„éç¨³æ€æ‰©æ•£è¯¯å·®å‡½æ•°è§£æ˜¯ä»€ä¹ˆå½¢å¼ï¼Ÿ</h4>
                    <div class="question-options">
                        <label><input type="radio" name="q3" value="a"> A. C(x,t) = AÂ·sin(Ï‰t-kx)</label>
                        <label><input type="radio" name="q3" value="b"> B. C(x,t) = Câ‚€Â·exp(-xÂ²/4Dt)</label>
                        <label><input type="radio" name="q3" value="c"> C. C(x,t) = Câ‚€Â·erfc[x/âˆš(4Dt)]</label>
                        <label><input type="radio" name="q3" value="d"> D. C(x,t) = Câ‚€Â·(1 - x/L)</label>
                    </div>
                    <div class="answer-explanation" id="explanation-q3">
                        <strong>æ­£ç¡®ç­”æ¡ˆï¼šC</strong><br>
                        è²å…‹ç¬¬äºŒå®šå¾‹åœ¨ä¸€ç»´åŠæ— é™ç©ºé—´ä¸­çš„éç¨³æ€æ‰©æ•£è§£ä¸ºè¯¯å·®å‡½æ•°å½¢å¼ï¼šC(x,t) = Câ‚€Â·erfc[x/âˆš(4Dt)]ï¼Œå…¶ä¸­erfcæ˜¯äº’è¡¥è¯¯å·®å‡½æ•°ã€‚
                    </div>
                </div>
                
                <div class="question">
                    <h4>é—®é¢˜4: åœ¨è¾¾åˆ°æ‰©æ•£å¹³è¡¡æ—¶ï¼Œç³»ç»Ÿçš„æµ“åº¦åˆ†å¸ƒå¦‚ä½•ï¼Ÿ</h4>
                    <div class="question-options">
                        <label><input type="radio" name="q4" value="a"> A. æµ“åº¦æ¢¯åº¦æœ€å¤§</label>
                        <label><input type="radio" name="q4" value="b"> B. æµ“åº¦å‡åŒ€åˆ†å¸ƒ</label>
                        <label><input type="radio" name="q4" value="c"> C. æµ“åº¦å‘¨æœŸæ€§å˜åŒ–</label>
                        <label><input type="radio" name="q4" value="d"> D. æµ“åº¦æ¢¯åº¦æ’å®š</label>
                    </div>
                    <div class="answer-explanation" id="explanation-q4">
                        <strong>æ­£ç¡®ç­”æ¡ˆï¼šB</strong><br>
                        æ‰©æ•£å¹³è¡¡æ—¶ï¼Œç³»ç»Ÿä¸­å„å¤„çš„æµ“åº¦è¾¾åˆ°å‡åŒ€åˆ†å¸ƒï¼Œæµ“åº¦æ¢¯åº¦ä¸ºé›¶ï¼Œæ‰©æ•£é€šé‡ä¸ºé›¶ã€‚
                    </div>
                </div>
                
                <div class="navigation-buttons">
                    <button onclick="submitTest()" class="button-success">æäº¤æµ‹è¯•ç­”æ¡ˆ</button>
                    <button onclick="showAnswers()" class="button-info">æŸ¥çœ‹æ­£ç¡®ç­”æ¡ˆ</button>
                    <button onclick="goToSimulation()" class="button-info">è¿”å›æ¨¡æ‹Ÿ</button>
                </div>
            </div>
            
            <!-- å·¥ç¨‹å¸ˆè¯„æµ‹é¡µé¢ -->
            <div class="display-content evaluation-display" id="evaluation-display">
                <h2 class="panel-title">å·¥ç¨‹å¸ˆèƒ½åŠ›è¯„æµ‹</h2>
                <p style="color: #88ffff; text-align: center;">åŸºäºæ‚¨çš„æµ‹è¯•è¡¨ç°å’Œå‚æ•°è°ƒèŠ‚èƒ½åŠ›è¯„ä¼°</p>
                
                <div id="test-result-container" style="display: none;">
                    <!-- æµ‹è¯•ç»“æœä¼šåŠ¨æ€æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                </div>
                
                <!-- æ–°çš„ç½‘æ ¼å¸ƒå±€ -->
                <div class="evaluation-grid">
                    <!-- å·¦ä¾§ï¼šé›·è¾¾å›¾ -->
                    <div class="radar-section">
                        <h3 style="color: #00aaff; margin-top: 0;">èƒ½åŠ›é›·è¾¾å›¾</h3>
                        <div class="radar-container">
                            <canvas id="radarCanvas"></canvas>
                        </div>
                    </div>
                    
                    <!-- å³ä¾§ï¼šæŠ€èƒ½è¯„åˆ† -->
                    <div class="skills-section">
                        <h3 style="color: #00aaff; margin-top: 0;">èƒ½åŠ›ç»´åº¦è¯„åˆ†</h3>
                        
                        <div class="skill-item">
                            <span class="skill-name">å¾®è§‚ç†è§£</span>
                            <span class="skill-value" id="skill1">0%</span>
                            <div class="progress-container" style="margin-top: 5px;">
                                <div class="progress-bar" id="skill1-bar" style="width: 0%;"></div>
                            </div>
                        </div>
                        
                        <div class="skill-item">
                            <span class="skill-name">å®è§‚æŠŠæ¡</span>
                            <span class="skill-value" id="skill2">0%</span>
                            <div class="progress-container" style="margin-top: 5px;">
                                <div class="progress-bar" id="skill2-bar" style="width: 0%;"></div>
                            </div>
                        </div>
                        
                        <div class="skill-item">
                            <span class="skill-name">å‚æ•°è°ƒèŠ‚</span>
                            <span class="skill-value" id="skill3">0%</span>
                            <div class="progress-container" style="margin-top: 5px;">
                                <div class="progress-bar" id="skill3-bar" style="width: 0%;"></div>
                            </div>
                        </div>
                        
                        <div class="skill-item">
                            <span class="skill-name">ç†è®ºåº”ç”¨</span>
                            <span class="skill-value" id="skill4">0%</span>
                            <div class="progress-container" style="margin-top: 5px;">
                                <div class="progress-bar" id="skill4-bar" style="width: 0%;"></div>
                            </div>
                        </div>
                        
                        <div class="skill-item">
                            <span class="skill-name">é—®é¢˜è§£å†³</span>
                            <span class="skill-value" id="skill5">0%</span>
                            <div class="progress-container" style="margin-top: 5px;">
                                <div class="progress-bar" id="skill5-bar" style="width: 0%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å‘å±•å»ºè®® - ç°åœ¨å æ®å…¨éƒ¨å®½åº¦ -->
                <div class="recommendation">
                    <h4 style="color: #ffaa00; margin-top: 0;">å‘å±•å»ºè®®</h4>
                    <p id="recommendation-text">
                        è¯·å…ˆå®ŒæˆçŸ¥è¯†æµ‹è¯•ä»¥è·å¾—ä¸ªæ€§åŒ–å»ºè®®ã€‚
                    </p>
                </div>
                
                <div class="navigation-buttons">
                    <button onclick="goToTest()" class="button-success">è¿”å›æµ‹è¯•</button>
                    <button onclick="goToSimulation()" class="button-info">è¿”å›æ¨¡æ‹Ÿ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== æ¨¡æ‹Ÿå‚æ•° ====================
        let D = 2.0;      // æ‰©æ•£ç³»æ•°ï¼ˆç¦»æ•£æ¨¡å‹å€¼ï¼‰
        const D_macro_scale = 0.00005; // å®è§‚æ‰©æ•£ç¼©æ”¾å› å­ï¼šè¿ç»­ä»‹è´¨Déœ€è¦ç¼©å°20000å€
        let D_macro = D * D_macro_scale; // å®è§‚æ‰©æ•£ç³»æ•°ï¼ˆè¿ç»­ä»‹è´¨å€¼ï¼‰
        
        let N = 300;      // ç²’å­æ•°é‡
        let dt = 0.03;    // æ—¶é—´æ­¥é•¿
        let barCount = 20; // æŸ±çŠ¶å›¾æ•°é‡
        let canvasWidth = 0;
        let canvasHeight = 0;
        const barrierX = 0.5; // éš”æ¿ä½ç½®æ¯”ä¾‹
        let barrierPresent = true;
        let animationRunning = true;
        let animationId = null;
        let simulationTime = 0;
        let diffusionStartTime = null; // æ‰©æ•£å¼€å§‹æ—¶é—´ï¼ˆéš”æ¿ç§»é™¤æ—¶ï¼‰
        let particles = [];
        let microParticle = {x: 0, y: 0, trail: []};
        let macroConc = []; // å®è§‚æµ“åº¦æ•°ç»„ï¼ˆè¯¯å·®å‡½æ•°è§£ï¼‰
        let macroFlux = []; // å®è§‚é€šé‡æ•°ç»„
        
        // å®è§‚æ‰©æ•£å‚æ•°
        let macroActive = true;
        let equilibriumReached = false;
        let testCompleted = false; // æ ‡è®°æµ‹è¯•æ˜¯å¦å®Œæˆ

        // ==================== Canvasä¸Šä¸‹æ–‡ ====================
        let microCtx, mesoCtx, macroCtx, radarCtx;
        
        // ==================== è¯¯å·®å‡½æ•°å®ç° ====================
        // é«˜ç²¾åº¦è¯¯å·®å‡½æ•°è®¡ç®—
        function erf(x) {
            // Abramowitzå’ŒStegunè¿‘ä¼¼å…¬å¼ï¼Œç²¾åº¦çº¦1.5e-7
            const a1 = 0.254829592;
            const a2 = -0.284496736;
            const a3 = 1.421413741;
            const a4 = -1.453152027;
            const a5 = 1.061405429;
            const p = 0.3275911;
            
            const sign = (x < 0) ? -1 : 1;
            x = Math.abs(x);
            
            const t = 1.0 / (1.0 + p * x);
            const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
            
            return sign * y;
        }
        
        // äº’è¡¥è¯¯å·®å‡½æ•°
        function erfc(x) {
            return 1 - erf(x);
        }
        
        // ==================== åˆå§‹åŒ–å‡½æ•° ====================
        function initSimulation() {
            // è·å–ç”»å¸ƒä¸Šä¸‹æ–‡
            microCtx = document.getElementById('microCanvas').getContext('2d');
            mesoCtx = document.getElementById('mesoCanvas').getContext('2d');
            macroCtx = document.getElementById('macroCanvas').getContext('2d');
            radarCtx = document.getElementById('radarCanvas').getContext('2d');
            
            // åˆå§‹åŒ–ç”»å¸ƒå°ºå¯¸
            updateCanvasSize();
            
            // åˆå§‹åŒ–å®è§‚æµ“åº¦ï¼ˆè¯¯å·®å‡½æ•°è§£ï¼‰
            initMacro();
            
            // åˆå§‹åŒ–å¾®è§‚ç²’å­
            microParticle = {
                x: barrierX * canvasWidth * 0.8,
                y: canvasHeight * 0.5,
                trail: []
            };
            
            // åˆå§‹åŒ–ç²’å­
            resetParticles();
            
            // è®¾ç½®æ»‘å—å’ŒæŒ‰é’®
            updateSliders();
            setupButtons();
            
            // å¼€å§‹åŠ¨ç”»
            animate();
        }
        
        // æ›´æ–°ç”»å¸ƒå°ºå¯¸
        function updateCanvasSize() {
            const canvasContainer = document.getElementById('microCanvas').parentElement;
            canvasWidth = canvasContainer.clientWidth - 40;
            canvasHeight = canvasContainer.clientHeight - 40;
            
            // è®¾ç½®æ‰€æœ‰ç”»å¸ƒå°ºå¯¸
            document.getElementById('microCanvas').width = canvasWidth;
            document.getElementById('microCanvas').height = canvasHeight;
            document.getElementById('mesoCanvas').width = canvasWidth;
            document.getElementById('mesoCanvas').height = canvasHeight;
            document.getElementById('macroCanvas').width = canvasWidth;
            document.getElementById('macroCanvas').height = canvasHeight;
        }
        
        // åˆå§‹åŒ–å®è§‚æµ“åº¦ï¼ˆè¯¯å·®å‡½æ•°è§£ï¼‰
        function initMacro() {
            macroConc = new Array(barCount).fill(0);
            macroFlux = new Array(barCount).fill(0);
            const barrierPos = Math.floor(barrierX * barCount);
            
            for (let i = 0; i < barCount; i++) {
                if (i < barrierPos) {
                    macroConc[i] = 1.0; // å·¦ä¾§é«˜æµ“åº¦
                } else {
                    macroConc[i] = 0.0; // å³ä¾§ä½æµ“åº¦
                }
            }
            
            macroActive = true;
            equilibriumReached = false;
            diffusionStartTime = barrierPresent ? null : 0; // è®°å½•æ‰©æ•£å¼€å§‹æ—¶é—´
            
            // æ›´æ–°å®è§‚Då€¼æ˜¾ç¤º
            updateMacroDDisplay();
        }
        
        // æ›´æ–°å®è§‚Då€¼æ˜¾ç¤º
        function updateMacroDDisplay() {
            D_macro = D * D_macro_scale;
            document.getElementById('macro-d-value').textContent = D_macro.toFixed(6);
        }
        
        // æ›´æ–°å®è§‚æµ“åº¦ï¼ˆä½¿ç”¨è¯¯å·®å‡½æ•°è§£æè§£ï¼‰
        function updateMacro() {
            if (!macroActive || barrierPresent) {
                // éš”æ¿å­˜åœ¨æ—¶ï¼Œä¿æŒåˆå§‹æµ“åº¦
                return;
            }
            
            if (diffusionStartTime === null) {
                diffusionStartTime = simulationTime; // è®°å½•éš”æ¿ç§»é™¤çš„æ—¶é—´
            }
            
            const elapsedTime = simulationTime - diffusionStartTime;
            
            if (elapsedTime <= 0) {
                // æ‰©æ•£åˆšå¼€å§‹ï¼Œä¿æŒåˆå§‹æ¡ä»¶
                return;
            }
            
            // ä½¿ç”¨ç¼©æ”¾åçš„å®è§‚æ‰©æ•£ç³»æ•°è®¡ç®—ç‰¹å¾æ‰©æ•£é•¿åº¦
            const diffusionLength = Math.sqrt(4 * D_macro * elapsedTime);
            
            if (diffusionLength === 0) {
                return;
            }
            
            // æ›´æ–°æ‰©æ•£é•¿åº¦æ˜¾ç¤º
            document.getElementById('diffusion-length').textContent = diffusionLength.toFixed(4);
            
            // ä½¿ç”¨è¯¯å·®å‡½æ•°è§£ï¼šC(x,t) = 0.5 * erfc[x/âˆš(4D_macroÂ·t)]
            // å¯¹äºå·¦ä¾§åŒºåŸŸï¼šC(x,t) = 1 - 0.5 * erfc[x/âˆš(4D_macroÂ·t)]
            // å¯¹äºå³ä¾§åŒºåŸŸï¼šC(x,t) = 0.5 * erfc[x/âˆš(4D_macroÂ·t)]
            
            for (let i = 0; i < barCount; i++) {
                // å½’ä¸€åŒ–ä½ç½® (0åˆ°1)
                const normalizedPos = i / barCount;
                // åˆ°éš”æ¿çš„è·ç¦»
                const distanceToBarrier = Math.abs(normalizedPos - barrierX);
                
                // è®¡ç®— xi = x / âˆš(4D_macroÂ·t)
                const xi = distanceToBarrier / diffusionLength;
                
                if (xi > 5) {
                    // xiå¾ˆå¤§æ—¶ï¼Œerfcæ¥è¿‘0
                    if (normalizedPos < barrierX) {
                        macroConc[i] = 1.0; // å·¦ä¾§ä¿æŒé«˜æµ“åº¦
                    } else {
                        macroConc[i] = 0.0; // å³ä¾§ä¿æŒä½æµ“åº¦
                    }
                } else {
                    // è®¡ç®—è¯¯å·®å‡½æ•°è§£
                    const erfcValue = erfc(xi);
                    
                    if (normalizedPos < barrierX) {
                        // å·¦ä¾§ï¼šæµ“åº¦ä»1é€æ¸ä¸‹é™
                        macroConc[i] = 1 - 0.5 * erfcValue;
                    } else {
                        // å³ä¾§ï¼šæµ“åº¦ä»0é€æ¸ä¸Šå‡
                        macroConc[i] = 0.5 * erfcValue;
                    }
                }
                
                // ç¡®ä¿æµ“åº¦åœ¨0-1ä¹‹é—´
                macroConc[i] = Math.max(0, Math.min(1, macroConc[i]));
                
                // è®¡ç®—é€šé‡ï¼ˆè²å…‹ç¬¬ä¸€å®šå¾‹ï¼‰- ä½¿ç”¨å®è§‚D
                if (i > 0 && i < barCount - 1) {
                    const dx = 1.0 / barCount;
                    const dCdx = (macroConc[i+1] - macroConc[i-1]) / (2 * dx);
                    macroFlux[i] = -D_macro * dCdx;
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°å¹³è¡¡
            checkEquilibrium();
        }
        
        // æ£€æŸ¥æ‰©æ•£å¹³è¡¡çŠ¶æ€
        function checkEquilibrium() {
            if (barrierPresent || diffusionStartTime === null) {
                equilibriumReached = false;
                return;
            }
            
            const elapsedTime = simulationTime - diffusionStartTime;
            if (elapsedTime <= 0) {
                equilibriumReached = false;
                return;
            }
            
            // è®¡ç®—æµ“åº¦åˆ†å¸ƒçš„å‡åŒ€æ€§
            let maxDiff = 0;
            let sum = 0;
            
            for (let i = 0; i < barCount; i++) {
                sum += macroConc[i];
                if (i > 0) {
                    const diff = Math.abs(macroConc[i] - macroConc[i-1]);
                    if (diff > maxDiff) maxDiff = diff;
                }
            }
            
            const avgConc = sum / barCount;
            
            // å¹³è¡¡æ¡ä»¶ï¼šæµ“åº¦å·®å¾ˆå°ä¸”å¹³å‡æµ“åº¦æ¥è¿‘0.5
            // ç”±äºæ‰©æ•£ç³»æ•°å°ï¼Œéœ€è¦æ›´é•¿çš„å¹³è¡¡æ—¶é—´ï¼Œæ”¾å®½æ¡ä»¶
            if (maxDiff < 0.01 && Math.abs(avgConc - 0.5) < 0.1) {
                if (!equilibriumReached) {
                    equilibriumReached = true;
                    console.log(`è¾¾åˆ°æ‰©æ•£å¹³è¡¡ï¼Œæ—¶é—´: ${elapsedTime.toFixed(2)}s`);
                }
            } else {
                equilibriumReached = false;
            }
        }

        // ==================== æ»‘å—æ§åˆ¶ ====================
        function updateSliders() {
            // Dæ»‘å—
            document.getElementById('d-slider').oninput = (e) => {
                D = parseFloat(e.target.value);
                document.getElementById('d-value').textContent = D.toFixed(1);
                document.getElementById('d-progress').style.width = ((D - 0.1) / 9.9 * 100) + '%';
                
                // æ›´æ–°å®è§‚Då€¼
                updateMacroDDisplay();
                
                macroActive = true;
                equilibriumReached = false;
            };
            
            // Næ»‘å—
            document.getElementById('n-slider').oninput = (e) => {
                N = parseInt(e.target.value);
                document.getElementById('n-value').textContent = N;
                document.getElementById('n-progress').style.width = ((N - 10) / 990 * 100) + '%';
                resetParticles();
            };
            
            // dtæ»‘å—
            document.getElementById('dt-slider').oninput = (e) => {
                dt = parseFloat(e.target.value);
                document.getElementById('dt-value').textContent = dt.toFixed(2);
                document.getElementById('dt-progress').style.width = ((dt - 0.01) / 0.19 * 100) + '%';
            };
            
            // æŸ±çŠ¶å›¾æ•°é‡æ»‘å—
            document.getElementById('bar-slider').oninput = (e) => {
                barCount = parseInt(e.target.value);
                document.getElementById('bar-value').textContent = barCount;
                document.getElementById('bar-progress').style.width = ((barCount - 5) / 35 * 100) + '%';
                initMacro(); // é‡æ–°åˆå§‹åŒ–å®è§‚æµ“åº¦
            };
            
            // åˆå§‹åŒ–è¿›åº¦æ¡
            document.getElementById('d-progress').style.width = ((D - 0.1) / 9.9 * 100) + '%';
            document.getElementById('n-progress').style.width = ((N - 10) / 990 * 100) + '%';
            document.getElementById('dt-progress').style.width = ((dt - 0.01) / 0.19 * 100) + '%';
            document.getElementById('bar-progress').style.width = ((barCount - 5) / 35 * 100) + '%';
            
            // æ›´æ–°å®è§‚Då€¼æ˜¾ç¤º
            updateMacroDDisplay();
        }

        // ==================== æŒ‰é’®æ§åˆ¶ ====================
        function setupButtons() {
            // å¼€å§‹æŒ‰é’®
            document.getElementById('start-btn').onclick = () => {
                if (!animationRunning) {
                    animationRunning = true;
                    document.getElementById('start-btn').style.display = 'none';
                    document.getElementById('pause-btn').style.display = 'block';
                    animate();
                }
            };
            
            // æš‚åœæŒ‰é’®
            document.getElementById('pause-btn').onclick = () => {
                animationRunning = false;
                document.getElementById('start-btn').style.display = 'block';
                document.getElementById('pause-btn').style.display = 'none';
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
            };
            
            // ç§»é™¤éš”æ¿æŒ‰é’®
            document.getElementById('remove-barrier-btn').onclick = () => {
                barrierPresent = false;
                diffusionStartTime = simulationTime; // è®°å½•æ‰©æ•£å¼€å§‹æ—¶é—´
                document.getElementById('barrier-indicator').style.display = 'none';
                document.getElementById('remove-barrier-btn').disabled = true;
                document.getElementById('barrier-indicator').textContent = 'éš”æ¿å·²ç§»é™¤';
                document.getElementById('barrier-indicator').style.background = 'rgba(0,255,170,0.7)';
                macroActive = true;
                equilibriumReached = false;
                
                // é‡ç½®å®è§‚æµ“åº¦ï¼ˆå¼€å§‹æ‰©æ•£ï¼‰
                initMacro();
            };
            
            // é‡ç½®æŒ‰é’®
            document.getElementById('reset-btn').onclick = () => {
                resetSimulation();
            };
            
            // å•æ­¥æ‰§è¡ŒæŒ‰é’®
            document.getElementById('step-btn').onclick = () => {
                if (!animationRunning) {
                    simulationStep();
                    drawAll();
                }
            };
            
            // æµ‹è¯•æŒ‰é’®
            document.getElementById('test-btn').onclick = () => {
                goToTest();
            };
            
            // è¯„æµ‹æŒ‰é’®
            document.getElementById('eval-btn').onclick = () => {
                goToEvaluation();
            };
            
            // è¿”å›æŒ‰é’®
            document.getElementById('back-btn').onclick = () => {
                goToSimulation();
            };
        }

        // ==================== ç²’å­ç®¡ç† ====================
        function resetParticles() {
            particles = [];
            const barrierPos = barrierX * canvasWidth;
            
            for (let i = 0; i < N; i++) {
                particles.push({
                    x: Math.random() * barrierPos * 0.9,
                    y: Math.random() * canvasHeight,
                    vx: 0,
                    vy: 0,
                    color: `hsl(${Math.random() * 60 + 120}, 100%, 60%)`
                });
            }
        }

        // ==================== é‡ç½®æ¨¡æ‹Ÿ ====================
        function resetSimulation() {
            barrierPresent = true;
            animationRunning = true;
            simulationTime = 0;
            diffusionStartTime = null;
            
            // æ›´æ–°ç”»å¸ƒå°ºå¯¸
            updateCanvasSize();
            
            // é‡ç½®å¾®è§‚ç²’å­
            microParticle = {
                x: barrierX * canvasWidth * 0.8,
                y: canvasHeight * 0.5,
                trail: []
            };
            
            // é‡ç½®ç²’å­
            resetParticles();
            
            // é‡ç½®å®è§‚
            initMacro();
            
            // é‡ç½®æŒ‰é’®çŠ¶æ€
            document.getElementById('remove-barrier-btn').disabled = false;
            document.getElementById('barrier-indicator').style.display = 'block';
            document.getElementById('barrier-indicator').textContent = 'éš”æ¿æ¿€æ´»';
            document.getElementById('barrier-indicator').style.background = 'rgba(255,102,255,0.7)';
            
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('pause-btn').style.display = 'block';
            
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            
            drawAll();
            animate();
        }

        // ==================== ç²’å­è¿åŠ¨ ====================
        function updateParticle(p, isMicro = false) {
            // æé«˜ç²’å­æ´»è·ƒåº¦
            let stepSize = Math.sqrt(2 * D * dt) * 30;
            let newX = p.x + (Math.random() - 0.5) * stepSize * 2;
            let newY = p.y + (Math.random() - 0.5) * stepSize * 2;
            
            // è¾¹ç•Œæ¡ä»¶ï¼ˆåå°„ï¼‰
            if (newX < 0) newX = Math.abs(newX);
            if (newX > canvasWidth) newX = 2 * canvasWidth - newX;
            if (newY < 0) newY = Math.abs(newY);
            if (isMicro) {
                if (newY > canvasHeight) newY = 2 * canvasHeight - newY;
            } else {
                if (newY > canvasHeight) newY = 2 * canvasHeight - newY;
            }
            
            // éš”æ¿æ¡ä»¶
            const barrierPos = barrierX * canvasWidth;
            if (barrierPresent && ((p.x < barrierPos && newX > barrierPos) || (p.x > barrierPos && newX < barrierPos))) {
                newX = p.x; // åœ¨éš”æ¿å¤„åå°„
            }
            
            // æ›´æ–°é€Ÿåº¦ç”¨äºå¯è§†åŒ–
            p.vx = (newX - p.x) / dt;
            p.vy = (newY - p.y) / dt;
            
            p.x = newX;
            p.y = newY;
            
            // ä¸ºå¾®è§‚ç²’å­æ·»åŠ è½¨è¿¹
            if (isMicro) {
                microParticle.trail.push({x: p.x, y: p.y});
                if (microParticle.trail.length > 50) {
                    microParticle.trail.shift();
                }
            }
        }

        // ==================== ç»˜åˆ¶å‡½æ•° ====================
        function drawMicro() {
            microCtx.clearRect(0, 0, canvasWidth, canvasHeight);
            
            // æ¸å˜èƒŒæ™¯
            let gradient = microCtx.createLinearGradient(0, 0, canvasWidth, 0);
            gradient.addColorStop(0, 'rgba(0, 100, 200, 0.3)');
            gradient.addColorStop(0.5, 'rgba(100, 100, 200, 0.1)');
            gradient.addColorStop(1, 'rgba(100, 0, 200, 0.3)');
            microCtx.fillStyle = gradient;
            microCtx.fillRect(0, 0, canvasWidth, canvasHeight);
            
            // ç»˜åˆ¶è½¨è¿¹
            microParticle.trail.forEach((point, i) => {
                let alpha = i / microParticle.trail.length;
                microCtx.beginPath();
                microCtx.arc(point.x, point.y, 2, 0, Math.PI * 2);
                microCtx.fillStyle = `rgba(0, 255, 255, ${alpha * 0.5})`;
                microCtx.fill();
            });
            
            // ç»˜åˆ¶éš”æ¿
            if (barrierPresent) {
                const barrierPos = barrierX * canvasWidth;
                microCtx.strokeStyle = '#ff66ff';
                microCtx.lineWidth = 3;
                microCtx.setLineDash([5, 5]);
                microCtx.beginPath();
                microCtx.moveTo(barrierPos, 0);
                microCtx.lineTo(barrierPos, canvasHeight);
                microCtx.stroke();
                microCtx.setLineDash([]);
            }
            
            // ç»˜åˆ¶ç²’å­
            microCtx.beginPath();
            microCtx.arc(microParticle.x, microParticle.y, 6, 0, Math.PI * 2);
            microCtx.fillStyle = '#00ffff';
            microCtx.fill();
            microCtx.strokeStyle = '#ffffff';
            microCtx.lineWidth = 2;
            microCtx.stroke();
            
            // ç»˜åˆ¶é€Ÿåº¦çŸ¢é‡
            let speed = Math.sqrt(microParticle.vx * microParticle.vx + microParticle.vy * microParticle.vy);
            if (speed > 0.1) {
                microCtx.beginPath();
                microCtx.moveTo(microParticle.x, microParticle.y);
                microCtx.lineTo(
                    microParticle.x + microParticle.vx * 0.05,
                    microParticle.y + microParticle.vy * 0.05
                );
                microCtx.strokeStyle = '#ffff66';
                microCtx.lineWidth = 2;
                microCtx.stroke();
                
                // ç»˜åˆ¶ç®­å¤´
                microCtx.beginPath();
                microCtx.arc(
                    microParticle.x + microParticle.vx * 5,
                    microParticle.y + microParticle.vy * 5,
                    3, 0, Math.PI * 2
                );
                microCtx.fillStyle = '#ffff66';
                microCtx.fill();
            }
        }

        function drawMeso() {
            mesoCtx.clearRect(0, 0, canvasWidth, canvasHeight);
            
            // æµ“åº¦æ¢¯åº¦èƒŒæ™¯
            for (let i = 0; i < canvasWidth; i++) {
                let conc = particles.filter(p => Math.abs(p.x - i) < 5).length / (N * 0.05);
                mesoCtx.fillStyle = `rgba(0, ${Math.min(255, conc * 500)}, 200, 0.1)`;
                mesoCtx.fillRect(i, 0, 1, canvasHeight);
            }
            
            // ç»˜åˆ¶éš”æ¿
            if (barrierPresent) {
                const barrierPos = barrierX * canvasWidth;
                mesoCtx.strokeStyle = '#ff66ff';
                mesoCtx.lineWidth = 3;
                mesoCtx.beginPath();
                mesoCtx.moveTo(barrierPos, 0);
                mesoCtx.lineTo(barrierPos, canvasHeight);
                mesoCtx.stroke();
                
                // å‘å…‰æ•ˆæœ
                mesoCtx.shadowColor = '#ff66ff';
                mesoCtx.shadowBlur = 10;
                mesoCtx.stroke();
                mesoCtx.shadowBlur = 0;
            }
            
            // ç»˜åˆ¶ç²’å­
            particles.forEach(p => {
                mesoCtx.beginPath();
                mesoCtx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                mesoCtx.fillStyle = p.color;
                mesoCtx.fill();
                
                mesoCtx.shadowColor = p.color;
                mesoCtx.shadowBlur = 5;
                mesoCtx.fill();
                mesoCtx.shadowBlur = 0;
            });
            
            // ç›´æ–¹å›¾
            let binSize = Math.max(10, Math.floor(canvasWidth / 50));
            let bins = new Array(Math.ceil(canvasWidth / binSize)).fill(0);
            
            particles.forEach(p => {
                let bin = Math.floor(p.x / binSize);
                if (bin >= 0 && bin < bins.length) {
                    bins[bin]++;
                }
            });
            
            let maxBin = Math.max(...bins) || 1;
            mesoCtx.fillStyle = 'rgba(0, 255, 255, 0.5)';
            for (let i = 0; i < bins.length; i++) {
                let height = (bins[i] / maxBin) * 40;
                mesoCtx.fillRect(i * binSize, canvasHeight - height, binSize - 1, height);
            }
        }

        function drawMacro() {
            macroCtx.clearRect(0, 0, canvasWidth, canvasHeight);
            
            if (macroConc.length === 0) return;
            
            // ç»˜åˆ¶ç½‘æ ¼èƒŒæ™¯
            macroCtx.strokeStyle = 'rgba(0, 170, 255, 0.1)';
            macroCtx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                let y = canvasHeight * (1 - i / 10);
                macroCtx.beginPath();
                macroCtx.moveTo(0, y);
                macroCtx.lineTo(canvasWidth, y);
                macroCtx.stroke();
                
                // ç»˜åˆ¶åˆ»åº¦æ ‡ç­¾
                macroCtx.fillStyle = 'rgba(136, 255, 255, 0.1)';
                macroCtx.font = '10px Arial';
                macroCtx.fillText((i / 10).toFixed(1), 5, y - 2);
            }
            
            // è®¡ç®—æŸ±çŠ¶å›¾å‚æ•°
            const barWidth = canvasWidth / barCount;
            const maxBarHeight = canvasHeight * 0.8;
            const barPadding = barWidth * 0.1;
            const drawWidth = barWidth - barPadding * 2;
            
            // ç»˜åˆ¶æ‰€æœ‰æŸ±çŠ¶å›¾
            for (let i = 0; i < macroConc.length; i++) {
                const barHeight = macroConc[i] * maxBarHeight;
                const x = i * barWidth + barPadding;
                const y = canvasHeight - barHeight;
                
                // åˆ›å»ºæŸ±çŠ¶å›¾æ¸å˜
                const gradient = macroCtx.createLinearGradient(0, y, 0, canvasHeight);
                const conc = macroConc[i];
                
                // æ ¹æ®æµ“åº¦è®¾ç½®é¢œè‰²æ¸å˜ï¼ˆé«˜æµ“åº¦çº¢è‰²ï¼Œä½æµ“åº¦è“è‰²ï¼Œä¸­ç­‰æµ“åº¦ç»¿è‰²ï¼‰
                if (conc > 0.7) {
                    gradient.addColorStop(0, 'rgba(255, 100, 100, 0.9)');
                    gradient.addColorStop(1, 'rgba(255, 50, 50, 0.3)');
                } else if (conc > 0.3) {
                    gradient.addColorStop(0, 'rgba(100, 255, 100, 0.9)');
                    gradient.addColorStop(1, 'rgba(50, 255, 50, 0.3)');
                } else {
                    gradient.addColorStop(0, 'rgba(100, 100, 255, 0.9)');
                    gradient.addColorStop(1, 'rgba(50, 50, 255, 0.3)');
                }
                
                // ç»˜åˆ¶æŸ±ä½“
                macroCtx.fillStyle = gradient;
                macroCtx.fillRect(x, y, drawWidth, barHeight);
                
                // ç»˜åˆ¶æŸ±ä½“è¾¹æ¡†
                macroCtx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                macroCtx.lineWidth = 1;
                macroCtx.strokeRect(x, y, drawWidth, barHeight);
                
                // ç»˜åˆ¶æŸ±ä½“é¡¶éƒ¨æ•°å€¼
                macroCtx.fillStyle = '#ffff66';
                macroCtx.font = 'bold 10px Arial';
                macroCtx.textAlign = 'center';
                macroCtx.fillText(macroConc[i].toFixed(2), x + drawWidth / 2, y - 5);
                
                // ç»˜åˆ¶æŸ±ä½“åº•éƒ¨æ ‡ç­¾
                macroCtx.fillStyle = '#88ffff';
                macroCtx.font = '1px Arial';
                macroCtx.fillText(`ä½ç½® ${i+1}`, x + drawWidth / 2, canvasHeight - 5);
            }
            
            // ç»˜åˆ¶éš”æ¿
            if (barrierPresent) {
                const barrierPos = barrierX * canvasWidth;
                macroCtx.strokeStyle = '#ff66ff';
                macroCtx.lineWidth = 3;
                macroCtx.beginPath();
                macroCtx.moveTo(barrierPos, 0);
                macroCtx.lineTo(barrierPos, canvasHeight);
                macroCtx.stroke();
                
                // æ·»åŠ éš”æ¿æ ‡ç­¾
                macroCtx.fillStyle = '#ff66ff';
                macroCtx.font = 'bold 14px Arial';
                macroCtx.textAlign = 'center';
                macroCtx.fillText('éš”æ¿', barrierPos, 20);
            }
            
            // ç»˜åˆ¶å¹³è¡¡çº¿ï¼ˆ50%æµ“åº¦çº¿ï¼‰
            macroCtx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            macroCtx.setLineDash([5, 5]);
            macroCtx.beginPath();
            const equilibriumY = canvasHeight - maxBarHeight * 0.5;
            macroCtx.moveTo(0, equilibriumY);
            macroCtx.lineTo(canvasWidth, equilibriumY);
            macroCtx.stroke();
            macroCtx.setLineDash([]);
            
            // ç»˜åˆ¶å¹³è¡¡çº¿æ ‡ç­¾
            macroCtx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            macroCtx.font = '10px Arial';
            macroCtx.textAlign = 'left';
            macroCtx.fillText('å¹³è¡¡æµ“åº¦ (0.5)', 5, equilibriumY - 5);
            
            // ç»˜åˆ¶æ‰©æ•£ç®­å¤´ï¼ˆè¡¨ç¤ºç‰©è´¨æµåŠ¨æ–¹å‘ï¼‰
            if (!equilibriumReached && !barrierPresent) {
                // è®¡ç®—å¹³å‡æµ“åº¦æ¢¯åº¦æ–¹å‘
                let leftAvg = 0, rightAvg = 0;
                const mid = Math.floor(macroConc.length / 2);
                for (let i = 0; i < mid; i++) leftAvg += macroConc[i];
                for (let i = mid; i < macroConc.length; i++) rightAvg += macroConc[i];
                leftAvg /= mid;
                rightAvg /= (macroConc.length - mid);
                
                // å¦‚æœå·¦ä¾§å¹³å‡æµ“åº¦é«˜äºå³ä¾§ï¼Œç»˜åˆ¶å‘å³çš„ç®­å¤´
                if (leftAvg > rightAvg) {
                    const arrowX = canvasWidth / 2;
                    const arrowY = canvasHeight * 0.12;
                    
                    macroCtx.fillStyle = 'rgba(255, 255, 100, 1)';
                    macroCtx.font = 'bold 14px Arial';
                    macroCtx.textAlign = 'center';
                    macroCtx.fillText('â†’ æ‰©æ•£æ–¹å‘ â†’', arrowX, arrowY);
                }
            }
            
            // å¦‚æœå·²å¹³è¡¡ï¼Œæ˜¾ç¤ºå¹³è¡¡çŠ¶æ€
            if (equilibriumReached) {
                const elapsedTime = diffusionStartTime ? (simulationTime - diffusionStartTime).toFixed(1) : "0.0";
                macroCtx.fillStyle = 'rgba(0, 255, 170, 0.8)';
                macroCtx.font = 'bold 16px Arial';
                macroCtx.textAlign = 'center';
                macroCtx.fillText('âœ“ å·²è¾¾åˆ°æ‰©æ•£å¹³è¡¡', canvasWidth / 2, 30);
                
                macroCtx.font = '14px Arial';
                macroCtx.fillText(`å¹³è¡¡æ—¶é—´: ${elapsedTime}s`, canvasWidth / 2, 50);
            }
            
            // ç»˜åˆ¶å›¾ä¾‹
            const legendX = canvasWidth - 150;
            const legendY = 50;
            macroCtx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            macroCtx.fillRect(legendX, legendY, 140, 80);
            
            macroCtx.fillStyle = '#ffffff';
            macroCtx.font = 'bold 12px Arial';
            macroCtx.textAlign = 'left';
            macroCtx.fillText('æµ“åº¦å›¾ä¾‹', legendX + 10, legendY + 20);
            
            macroCtx.font = '10px Arial';
            macroCtx.fillStyle = 'rgba(255, 100, 100, 1)';
            macroCtx.fillRect(legendX + 10, legendY + 30, 15, 10);
            macroCtx.fillStyle = '#ffffff';
            macroCtx.fillText('é«˜æµ“åº¦ (>0.7)', legendX + 30, legendY + 38);
            
            macroCtx.fillStyle = 'rgba(100, 255, 100, 1)';
            macroCtx.fillRect(legendX + 10, legendY + 45, 15, 10);
            macroCtx.fillStyle = '#ffffff';
            macroCtx.fillText('ä¸­æµ“åº¦ (0.3-0.7)', legendX + 30, legendY + 53);
            
            macroCtx.fillStyle = 'rgba(100, 100, 255, 1)';
            macroCtx.fillRect(legendX + 10, legendY + 60, 15, 10);
            macroCtx.fillStyle = '#ffffff';
            macroCtx.fillText('ä½æµ“åº¦ (<0.3)', legendX + 30, legendY + 68);
            
            // ç»˜åˆ¶ç†è®ºå…¬å¼
            if (!barrierPresent) {
                const elapsedTime = diffusionStartTime ? (simulationTime - diffusionStartTime).toFixed(1) : "0.0";
                const diffusionLength = Math.sqrt(4 * D_macro * (elapsedTime || 0.001)).toFixed(4);
                
                macroCtx.fillStyle = 'rgba(255, 255, 200, 1)';
                macroCtx.font = 'bold 12px Arial';
                macroCtx.textAlign = 'middle';
                macroCtx.fillText(`ç†è®ºæ¨¡å‹: C(x,t) = 0.5Â·erfc[x/âˆš(4D_macroÂ·t)]`, 20, 15);

            }
        }

        // ==================== ç»˜åˆ¶é›·è¾¾å›¾ ====================
        function drawRadarChart(skillScores) {
            const canvas = document.getElementById('radarCanvas');
            const ctx = radarCtx;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) * 0.7;
            const sides = 5;
            const angle = (Math.PI * 2) / sides;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // æŠ€èƒ½æ•°æ®
            const skills = [
                { name: "å¾®è§‚ç†è§£", value: skillScores[0] },
                { name: "å®è§‚æŠŠæ¡", value: skillScores[1] },
                { name: "å‚æ•°è°ƒèŠ‚", value: skillScores[2] },
                { name: "ç†è®ºåº”ç”¨", value: skillScores[3] },
                { name: "é—®é¢˜è§£å†³", value: skillScores[4] }
            ];
            
            // ç»˜åˆ¶é›·è¾¾å›¾ç½‘æ ¼
            ctx.strokeStyle = 'rgba(0, 170, 255, 0.3)';
            ctx.lineWidth = 1;
            
            // ç»˜åˆ¶åŒå¿ƒå¤šè¾¹å½¢
            for (let level = 1; level <= 5; level++) {
                ctx.beginPath();
                for (let i = 0; i <= sides; i++) {
                    const r = radius * (level / 5);
                    const x = centerX + r * Math.cos(i * angle - Math.PI / 2);
                    const y = centerY + r * Math.sin(i * angle - Math.PI / 2);
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.closePath();
                ctx.stroke();
            }
            
            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = 'rgba(0, 170, 255, 0.5)';
            ctx.lineWidth = 1.5;
            for (let i = 0; i < sides; i++) {
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                const x = centerX + radius * Math.cos(i * angle - Math.PI / 2);
                const y = centerY + radius * Math.sin(i * angle - Math.PI / 2);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                // æ ‡æ³¨æŠ€èƒ½åç§°
                const labelX = centerX + (radius + 20) * Math.cos(i * angle - Math.PI / 2);
                const labelY = centerY + (radius + 20) * Math.sin(i * angle - Math.PI / 2);
                ctx.fillStyle = '#88ffff';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(skills[i].name, labelX, labelY);
            }
            
            // ç»˜åˆ¶æŠ€èƒ½å¤šè¾¹å½¢
            ctx.beginPath();
            for (let i = 0; i < sides; i++) {
                const value = skills[i].value;
                const r = radius * value;
                const x = centerX + r * Math.cos(i * angle - Math.PI / 2);
                const y = centerY + r * Math.sin(i * angle - Math.PI / 2);
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            
            // å¡«å……å¤šè¾¹å½¢
            ctx.fillStyle = 'rgba(0, 170, 255, 0.3)';
            ctx.fill();
            ctx.strokeStyle = '#00aaff';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // ç»˜åˆ¶æ•°æ®ç‚¹
            for (let i = 0; i < sides; i++) {
                const value = skills[i].value;
                const r = radius * value;
                const x = centerX + r * Math.cos(i * angle - Math.PI / 2);
                const y = centerY + r * Math.sin(i * angle - Math.PI / 2);
                
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fillStyle = '#00aaff';
                ctx.fill();
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        }

        // ==================== ç»˜åˆ¶æ‰€æœ‰ ====================
        function drawAll() {
            drawMicro();
            drawMeso();
            drawMacro();
            updateStats();
        }

        // ==================== æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ ====================
        function updateStats() {
            simulationTime += dt;
            document.getElementById('sim-time').textContent = simulationTime.toFixed(1) + ' ç§’';
            
            // æ›´æ–°å®è§‚çŠ¶æ€
            if (barrierPresent) {
                document.getElementById('macro-state').textContent = 'ç­‰å¾…éš”æ¿ç§»é™¤';
                document.getElementById('diffusion-time').textContent = '0.0 ç§’';
            } else {
                const elapsedTime = diffusionStartTime ? (simulationTime - diffusionStartTime).toFixed(1) : "0.0";
                document.getElementById('macro-state').textContent = equilibriumReached ? 'å·²å¹³è¡¡' : 'æ‰©æ•£ä¸­';
                document.getElementById('diffusion-time').textContent = elapsedTime + ' ç§’';
            }
            
            const barrierPos = barrierX * canvasWidth;
            let leftParticles = particles.filter(p => p.x < barrierPos).length;
            let rightParticles = particles.filter(p => p.x >= barrierPos).length;
            let totalParticles = leftParticles + rightParticles;
            
            let leftConc, rightConc;
            if (barrierPresent) {
                leftConc = (leftParticles / N * 100).toFixed(1);
                rightConc = (rightParticles / N * 100).toFixed(1);
            } else {
                leftConc = (leftParticles / totalParticles * 100).toFixed(1);
                rightConc = (rightParticles / totalParticles * 100).toFixed(1);
            }
            
            document.getElementById('left-particles').textContent = leftParticles;
            document.getElementById('right-particles').textContent = rightParticles;
            document.getElementById('left-conc').textContent = leftConc + '%';
            document.getElementById('right-conc').textContent = rightConc + '%';
            
            // è®¡ç®—å¹³è¡¡è¿›åº¦
            let equilibriumProgress = 0;
            if (!barrierPresent && macroConc.length > 0) {
                // è®¡ç®—å·¦ä¾§å’Œå³ä¾§çš„å¹³å‡æµ“åº¦
                const mid = Math.floor(macroConc.length / 2);
                let leftAvg = 0, rightAvg = 0;
                for (let i = 0; i < mid; i++) leftAvg += macroConc[i];
                for (let i = mid; i < macroConc.length; i++) rightAvg += macroConc[i];
                leftAvg /= mid;
                rightAvg /= (macroConc.length - mid);
                
                // è®¡ç®—æµ“åº¦å·®å¼‚
                const diff = Math.abs(leftAvg - rightAvg);
                
                // è®¡ç®—å¹³è¡¡è¿›åº¦
                const initialDiff = 1.0; // åˆå§‹å·®å¼‚ä¸º1.0
                equilibriumProgress = Math.min(100, (1 - diff / initialDiff) * 100).toFixed(1);
                
                if (equilibriumProgress > 99.5) {
                    equilibriumProgress = 100;
                }
            }
            
            document.getElementById('equilibrium').textContent = equilibriumProgress + '%';
            
            // æ›´æ–°ç²’å­ä½ç½®
            document.getElementById('micro-pos').textContent = 
                `(${microParticle.x.toFixed(1)}, ${microParticle.y.toFixed(1)})`;
        }

        // ==================== æ¨¡æ‹Ÿå•æ­¥ ====================
        function simulationStep() {
            updateParticle(microParticle, true);
            particles.forEach(p => updateParticle(p));
            updateMacro();
            updateStats();
        }

        // ==================== åŠ¨ç”»å¾ªç¯ ====================
        function animate() {
            if (!animationRunning) return;
            
            simulationStep();
            drawAll();
            
            animationId = requestAnimationFrame(animate);
        }

        // ==================== é¡µé¢å¯¼èˆª ====================
        function goToSimulation() {
            document.getElementById('simulation-display').classList.add('active');
            document.getElementById('test-display').classList.remove('active');
            document.getElementById('evaluation-display').classList.remove('active');
            document.getElementById('back-btn').style.display = 'none';
            
            // é‡æ–°å¼€å§‹åŠ¨ç”»
            if (!animationRunning) {
                animationRunning = true;
                document.getElementById('start-btn').style.display = 'none';
                document.getElementById('pause-btn').style.display = 'block';
                animate();
            }
            
            // æ›´æ–°ç”»å¸ƒå°ºå¯¸
            updateCanvasSize();
            drawAll();
        }
        
        function goToTest() {
            document.getElementById('simulation-display').classList.remove('active');
            document.getElementById('test-display').classList.add('active');
            document.getElementById('evaluation-display').classList.remove('active');
            document.getElementById('back-btn').style.display = 'block';
            
            // æš‚åœæ¨¡æ‹Ÿ
            if (animationRunning) {
                animationRunning = false;
                document.getElementById('start-btn').style.display = 'block';
                document.getElementById('pause-btn').style.display = 'none';
                if (animationId) cancelAnimationFrame(animationId);
            }
        }
        
        function goToEvaluation() {
            document.getElementById('simulation-display').classList.remove('active');
            document.getElementById('test-display').classList.remove('active');
            document.getElementById('evaluation-display').classList.add('active');
            document.getElementById('back-btn').style.display = 'block';
            
            // å¦‚æœæµ‹è¯•å·²å®Œæˆï¼Œæ›´æ–°è¯„æµ‹
            if (testCompleted) {
                updateEvaluation();
            }
        }

        // ==================== æµ‹è¯•åŠŸèƒ½ ====================
        function submitTest() {
            let score = 0;
            let totalQuestions = 4;
            
            // é—®é¢˜1
            const q1 = document.querySelector('input[name="q1"]:checked');
            if (q1 && q1.value === 'b') {
                score++;
                document.getElementById('explanation-q1').classList.add('show');
            } else {
                document.getElementById('explanation-q1').classList.add('show');
            }
            
            // é—®é¢˜2
            const q2 = document.querySelector('input[name="q2"]:checked');
            if (q2 && q2.value === 'b') {
                score++;
                document.getElementById('explanation-q2').classList.add('show');
            } else {
                document.getElementById('explanation-q2').classList.add('show');
            }
            
            // é—®é¢˜3
            const q3 = document.querySelector('input[name="q3"]:checked');
            if (q3 && q3.value === 'c') {
                score++;
                document.getElementById('explanation-q3').classList.add('show');
            } else {
                document.getElementById('explanation-q3').classList.add('show');
            }
            
            // é—®é¢˜4
            const q4 = document.querySelector('input[name="q4"]:checked');
            if (q4 && q4.value === 'b') {
                score++;
                document.getElementById('explanation-q4').classList.add('show');
            } else {
                document.getElementById('explanation-q4').classList.add('show');
            }
            
            // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
            const percentage = (score / totalQuestions * 100).toFixed(1);
            let resultHtml = `
                <div class="test-result">
                    <h3 style="color: #ff66ff; margin-top: 0;">æµ‹è¯•å®Œæˆï¼</h3>
                    <p style="font-size: 1.2em;">å¾—åˆ†: <strong>${score}/${totalQuestions}</strong></p>
                    <p style="font-size: 1.2em;">æ­£ç¡®ç‡: <strong>${percentage}%</strong></p>
                    <p style="margin-top: 15px;">
                        <button onclick="goToEvaluation()" class="button-success">å‰å¾€å·¥ç¨‹å¸ˆè¯„æµ‹</button>
                    </p>
                </div>
            `;
            
            document.getElementById('test-result-container').innerHTML = resultHtml;
            document.getElementById('test-result-container').style.display = 'block';
            
            // æ ‡è®°æµ‹è¯•å·²å®Œæˆ
            testCompleted = true;
            
            // å¯ç”¨è¯„æµ‹æŒ‰é’®
            document.getElementById('eval-btn').disabled = false;
            
            // ä¿å­˜æµ‹è¯•å¾—åˆ†ç”¨äºè¯„æµ‹
            window.testScore = score;
            window.totalQuestions = totalQuestions;
        }
        
        function showAnswers() {
            // æ˜¾ç¤ºæ‰€æœ‰ç­”æ¡ˆè§£é‡Š
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`explanation-q${i}`).classList.add('show');
            }
        }
        
        // ==================== æ›´æ–°è¯„æµ‹ ====================
        function updateEvaluation() {
            if (!testCompleted) return;
            
            // æ ¹æ®æµ‹è¯•å¾—åˆ†è®¡ç®—èƒ½åŠ›è¯„åˆ†
            const testRatio = window.testScore / window.totalQuestions;
            
            // åŸºç¡€èƒ½åŠ›è¯„åˆ†ï¼ˆåŸºäºæµ‹è¯•å¾—åˆ†å’Œæ¨¡æ‹Ÿå‚æ•°è°ƒèŠ‚ï¼‰
            const paramAdjustmentScore = Math.min(0.9, D / 5); // åŸºäºæ‰©æ•£ç³»æ•°çš„è°ƒèŠ‚èƒ½åŠ›
            const particleCountScore = Math.min(0.8, N / 500); // åŸºäºç²’å­æ•°é‡çš„ç†è§£
            
            // è®¡ç®—å„é¡¹èƒ½åŠ›å¾—åˆ†
            const skillScores = [
                testRatio * 0.7 + 0.3, // å¾®è§‚ç†è§£
                testRatio * 0.8 + 0.2, // å®è§‚æŠŠæ¡
                paramAdjustmentScore, // å‚æ•°è°ƒèŠ‚
                testRatio * 0.6 + 0.4, // ç†è®ºåº”ç”¨
                testRatio * 0.9 + particleCountScore * 0.1 // é—®é¢˜è§£å†³
            ];
            
            // ç¡®ä¿å¾—åˆ†åœ¨0-1ä¹‹é—´
            const adjustedScores = skillScores.map(score => Math.min(0.95, Math.max(0.3, score)));
            
            // æ›´æ–°é›·è¾¾å›¾
            const radarCanvas = document.getElementById('radarCanvas');
            radarCanvas.width = radarCanvas.parentElement.clientWidth;
            radarCanvas.height = 300;
            drawRadarChart(adjustedScores);
            
            // æ›´æ–°æŠ€èƒ½è¯„åˆ†æ˜¾ç¤º
            const skillElements = [
                document.getElementById('skill1'),
                document.getElementById('skill2'),
                document.getElementById('skill3'),
                document.getElementById('skill4'),
                document.getElementById('skill5')
            ];
            
            const barElements = [
                document.getElementById('skill1-bar'),
                document.getElementById('skill2-bar'),
                document.getElementById('skill3-bar'),
                document.getElementById('skill4-bar'),
                document.getElementById('skill5-bar')
            ];
            
            adjustedScores.forEach((score, index) => {
                const percentage = Math.round(score * 100);
                skillElements[index].textContent = `${percentage}%`;
                barElements[index].style.width = `${percentage}%`;
            });
            
            // æ›´æ–°å»ºè®®
            let recommendationText = "";
            const avgScore = adjustedScores.reduce((a, b) => a + b) / adjustedScores.length;
            
            if (avgScore >= 0.85) {
                recommendationText = "ğŸ¯ <strong>å“è¶Šæ°´å¹³</strong><br>æ‚¨å¯¹æ‰©æ•£ç°è±¡æœ‰æ·±å…¥ç†è§£ï¼Œèƒ½å¤Ÿç†Ÿç»ƒåº”ç”¨è¯¯å·®å‡½æ•°è§£å’Œè²å…‹å®šå¾‹ã€‚<br><br><strong>å‘å±•å»ºè®®ï¼š</strong><br>1. æ¢ç´¢å¤šç»´æ‰©æ•£å’Œå¤æ‚è¾¹ç•Œæ¡ä»¶<br>2. ç ”ç©¶éå‡åŒ€ä»‹è´¨ä¸­çš„æ‰©æ•£<br>3. å­¦ä¹ è€¦åˆè¾“è¿ç°è±¡ï¼ˆçƒ­è´¨è€¦åˆï¼‰<br>4. å°è¯•å¼€å‘æ›´å¤æ‚çš„æ‰©æ•£æ¨¡æ‹Ÿç³»ç»Ÿ";
            } else if (avgScore >= 0.70) {
                recommendationText = "ğŸ‘ <strong>ç†Ÿç»ƒæ°´å¹³</strong><br>æ‚¨æŒæ¡äº†æ‰©æ•£çš„åŸºæœ¬åŸç†ï¼Œèƒ½å¤Ÿç†è§£è¯¯å·®å‡½æ•°è§£çš„åº”ç”¨ã€‚<br><br><strong>å‘å±•å»ºè®®ï¼š</strong><br>1. æ·±å…¥ç†è§£è¯¯å·®å‡½æ•°çš„æ•°å­¦æ€§è´¨<br>2. ç ”ç©¶å˜æ‰©æ•£ç³»æ•°é—®é¢˜<br>3. å­¦ä¹ æ•°å€¼æ–¹æ³•æ±‚è§£å¤æ‚æ‰©æ•£æ–¹ç¨‹<br>4. æ¢ç´¢æµ“åº¦åœºéšæ—¶é—´æ¼”åŒ–çš„ç»†èŠ‚";
            } else if (avgScore >= 0.50) {
                recommendationText = "ğŸ“š <strong>åŸºç¡€æ°´å¹³</strong><br>æ‚¨å¯¹æ‰©æ•£ç°è±¡æœ‰åŸºæœ¬ç†è§£ï¼Œéœ€è¦è¿›ä¸€æ­¥åŠ å¼ºç†è®ºå­¦ä¹ ã€‚<br><br><strong>å‘å±•å»ºè®®ï¼š</strong><br>1. å¤ä¹ å¸ƒæœ—è¿åŠ¨ä¸æ‰©æ•£çš„å…³ç³»<br>2. ç†è§£è¯¯å·®å‡½æ•°è§£çš„ç‰©ç†æ„ä¹‰<br>3. å¤šåšæ¨¡æ‹Ÿå®éªŒè§‚å¯Ÿä¸åŒå‚æ•°çš„å½±å“<br>4. å­¦ä¹ è²å…‹å®šå¾‹çš„åº”ç”¨åœºæ™¯";
            } else {
                recommendationText = "ğŸ” <strong>å…¥é—¨æ°´å¹³</strong><br>æ‚¨åˆšå¼€å§‹æ¥è§¦æ‰©æ•£ç°è±¡ï¼Œéœ€è¦å»ºç«‹åŸºæœ¬æ¦‚å¿µæ¡†æ¶ã€‚<br><br><strong>å‘å±•å»ºè®®ï¼š</strong><br>1. ä»å¾®è§‚ç²’å­è¿åŠ¨å¼€å§‹è§‚å¯Ÿ<br>2. ç†è§£éšæœºæ€§ä¸ç»Ÿè®¡è§„å¾‹çš„å…³ç³»<br>3. å°è¯•è°ƒèŠ‚ç®€å•å‚æ•°è§‚å¯Ÿå˜åŒ–<br>4. å­¦ä¹ æ‰©æ•£çš„åŸºæœ¬å®šä¹‰å’Œæœ¯è¯­";
            }
            
            document.getElementById('recommendation-text').innerHTML = recommendationText;
        }

        // ==================== åˆå§‹åŒ– ====================
        function init() {
            // åˆå§‹åŒ–é›·è¾¾å›¾ç”»å¸ƒ
            const radarCanvas = document.getElementById('radarCanvas');
            radarCanvas.width = 400;
            radarCanvas.height = 300;
            
            // åˆå§‹åŒ–æ¨¡æ‹Ÿ
            initSimulation();
            
            // 3ç§’åå¯ç”¨ç§»é™¤éš”æ¿æŒ‰é’®
            setTimeout(() => {
                document.getElementById('remove-barrier-btn').disabled = false;
            }, 3000);
            
            // ç›‘å¬çª—å£å¤§å°å˜åŒ–
            window.addEventListener('resize', () => {
                updateCanvasSize();
                drawAll();
            });
        }

        // å¯åŠ¨ç³»ç»Ÿ
        init();
    </script>


    <!-- åº•éƒ¨ä¿¡æ¯æ  -->
    <div style="
        text-align: center;
        padding: 20px 30px;
        margin-top: 40px;
        color: #93c5fd;
        font-size: 0.9rem;
        border-top: 2px solid rgba(56, 189, 248, 0.5);
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.9));
        border-radius: 15px 15px 0 0;
        box-shadow: 0 -10px 30px rgba(56, 189, 248, 0.1);
        position: relative;
        overflow: hidden;
    ">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, #38bdf8, #0ea5e9, #38bdf8);"></div>
        
        <p style="font-size: 1.3rem; font-weight: bold; margin-bottom: 15px; color: #38bdf8;">
            Fickå®šå¾‹ä¸€ç»´æ‰©æ•£ä¼ è´¨æ¨¡æ‹Ÿ &copy; 2025 | å·¥ç¨‹ç›´è§‰è®­ç»ƒç³»ç»Ÿ | ç‰ˆæœ¬ 1.0 | 
        
        <style="margin-bottom: 12px; color: #cbd5e1;">
             <strong>é‚®ç®±:</strong> xgyanger@qq.com
        </p>
        
      
        <div style="margin-top: 15px; display: flex; justify-content: center; gap: 15px;">
            <span style="color: #ff9e00; font-weight: bold; font-size: 1.1rem;">
                ç‰ˆæƒÂ©2025 AIknow. ä¿ç•™æ‰€æœ‰æƒåˆ© | Copyright Â©2025 AIknow. All rights reserved.
            </span>
        </div>
    </div>

</body>
</html>