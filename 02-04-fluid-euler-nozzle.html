<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç®¡é“æµä½“æ¬§æ‹‰å…¬å¼ä»¿çœŸ - æ•™å­¦è¯„ä»·ç‰ˆ</title>
<style>
:root {
    --primary: #38bdf8;
    --primary-dark: #0ea5e9;
    --secondary: #8b5cf6;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --bg: #0f172a;
    --card: #1e293b;
    --card-light: #2d3748;
    --text: #f8fafc;
    --text-secondary: #94a3b8;
    --border: #334155;
    --local: #a855f7;
    --conv: #f87171;
    --sourceRed: #ef4444;
    --sourceBlue: #3b82f6;
}

* {
    box-sizing: border-box;
    transition: all 0.3s ease;
}

body {
    font-family: 'Segoe UI', 'Microsoft YaHei', system-ui, sans-serif;
    background: linear-gradient(135deg, #0b1220 0%, #1a1f2e 100%);
    color: var(--text);
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    overflow-x: hidden;
}

.bg-pattern {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
        radial-gradient(circle at 20% 30%, rgba(56, 189, 248, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.03) 0%, transparent 40%);
    z-index: -1;
}

.main-container {
    width: 100%;
    max-width: 1500px;
    z-index: 1;
    flex: 1;
    margin-bottom: 30px;
}

#app {
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 25px;
    width: 100%;
}

.card {
    background: rgba(30, 41, 59, 0.85);
    border-radius: 20px;
    padding: 25px;
    border: 1px solid var(--border);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    position: relative;
    backdrop-filter: blur(10px);
}

.card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    border-radius: 20px 20px 0 0;
}

#simulationTitle {
    color: var(--primary);
    margin-bottom: 15px;
    font-size: 1.8rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.math-overlay {
    position: absolute;
    top: 120px;
    right: 40px;
    background: rgba(15, 23, 42, 0.9);
    padding: 15px;
    border-radius: 12px;
    border: 2px solid var(--primary);
    font-size: 1.1rem;
    pointer-events: none;
    z-index: 10;
    backdrop-filter: blur(10px);
    max-width: 350px;
}

.formula-parts {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.formula-part {
    padding: 4px 8px;
    border-radius: 6px;
    font-weight: 600;
}

.local-term {
    background: rgba(168, 85, 247, 0.15);
    color: var(--local);
    border: 1px solid rgba(168, 85, 247, 0.3);
}

.conv-term {
    background: rgba(248, 113, 113, 0.15);
    color: var(--conv);
    border: 1px solid rgba(248, 113, 113, 0.3);
}

.source-term {
    background: rgba(16, 185, 129, 0.15);
    color: var(--success);
    border: 1px solid rgba(16, 185, 129, 0.3);
}

#canvasContainer {
    position: relative;
    background: linear-gradient(180deg, #000 0%, #0f172a 100%);
    border-radius: 16px;
    height: 550px;
    overflow: hidden;
    border: 2px solid var(--border);
    margin-bottom: 15px;
}

canvas {
    width: 100%;
    height: 100%;
    display: block;
}

.pipe-labels {
    position: absolute;
    bottom: 20px;
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
}

.pipe-label {
    background: rgba(15, 23, 42, 0.9);
    padding: 12px 20px;
    border-radius: 10px;
    border: 1px solid;
    font-family: 'Consolas', monospace;
    font-size: 0.9rem;
    backdrop-filter: blur(10px);
    min-width: 280px;
}

.coarse-label {
    border-color: var(--primary);
    color: var(--primary);
}

.fine-label {
    border-color: var(--secondary);
    color: var(--secondary);
}

.label-title {
    font-weight: bold;
    margin-bottom: 5px;
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.label-values {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-top: 5px;
}

.label-value {
    text-align: center;
    flex: 1;
}

.value-name {
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.value-number {
    font-size: 1.1rem;
    font-weight: 600;
    margin-top: 3px;
}

.simulation-info {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-top: 15px;
    padding: 12px;
    background: rgba(15, 23, 42, 0.5);
    border-radius: 10px;
    border: 1px solid var(--border);
}

.control-panel h3 {
    color: var(--primary);
    margin-bottom: 25px;
    font-size: 1.4rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.control-group {
    background: rgba(15, 23, 42, 0.6);
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    border: 1px solid var(--border);
    transition: all 0.3s ease;
}

.control-group:hover {
    border-color: var(--primary);
    box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.2);
}

.control-group label {
    display: block;
    font-size: 0.95rem;
    color: var(--text);
    margin-bottom: 12px;
    font-weight: 500;
}

.value-display {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    align-items: center;
}

.value-number-display {
    font-family: 'Consolas', monospace;
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary);
    background: rgba(56, 189, 248, 0.1);
    padding: 5px 12px;
    border-radius: 8px;
    border: 1px solid rgba(56, 189, 248, 0.3);
}

.unit {
    font-size: 0.9rem;
    color: var(--text-secondary);
}

input[type="range"] {
    width: 100%;
    height: 8px;
    border-radius: 4px;
    background: linear-gradient(90deg, #1e293b, #334155);
    outline: none;
    -webkit-appearance: none;
    cursor: pointer;
    border: 1px solid #475569;
}

input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 22px;
    height: 22px;
    background: var(--primary);
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid white;
    box-shadow: 0 0 10px rgba(56, 189, 248, 0.8);
}

.slider-info {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-top: 8px;
}

.feedback-box {
    margin-top: 20px;
    padding: 20px;
    background: rgba(15, 23, 42, 0.7);
    border-radius: 12px;
    border: 1px solid var(--primary);
    font-size: 0.95rem;
}

.feedback-title {
    color: var(--primary);
    font-weight: 600;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.1rem;
}

.feedback-content {
    line-height: 1.6;
    color: var(--text);
}

.key-insight {
    background: rgba(248, 113, 113, 0.1);
    border-left: 4px solid var(--conv);
    padding: 10px 15px;
    margin: 15px 0;
    border-radius: 0 8px 8px 0;
}

.equation-term {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-weight: 600;
    font-family: 'Consolas', monospace;
}

.term-local {
    background: rgba(168, 85, 247, 0.15);
    color: var(--local);
}

.term-conv {
    background: rgba(248, 113, 113, 0.15);
    color: var(--conv);
}

.term-source {
    background: rgba(16, 185, 129, 0.15);
    color: var(--success);
}

.action-buttons {
    display: flex;
    gap: 15px;
    margin-top: 25px;
}

button {
    flex: 1;
    padding: 15px;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    font-size: 1rem;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

#genReport {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
}

#genReport:hover {
    background: linear-gradient(135deg, var(--primary-dark), var(--primary));
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(56, 189, 248, 0.4);
}

#resetSim {
    background: rgba(71, 85, 105, 0.5);
    color: var(--text);
    border: 1px solid var(--border);
}

#resetSim:hover {
    background: rgba(71, 85, 105, 0.8);
    transform: translateY(-2px);
}

/* Footeræ ·å¼ */
.footer {
    width: 100%;
    max-width: 1500px;
    padding: 20px 0;
    margin-top: 20px;
    border-top: 1px solid var(--border);
    color: var(--text-secondary);
    font-size: 0.9rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    z-index: 1;
}

.footer-content {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    width: 100%;
    gap: 20px;
}

.footer-section {
    flex: 1;
    min-width: 250px;
}

.footer-title {
    color: var(--primary);
    font-size: 1.1rem;
    margin-bottom: 12px;
    font-weight: 600;
}

.footer-links {
    list-style: none;
    padding: 0;
    margin: 0;
}

.footer-links li {
    margin-bottom: 8px;
}

.footer-links a {
    color: var(--text-secondary);
    text-decoration: none;
    transition: color 0.3s ease;
}

.footer-links a:hover {
    color: var(--primary);
}

.contact-info {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.contact-item {
    display: flex;
    align-items: center;
    gap: 10px;
}

.footer-note {
    text-align: center;
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-top: 10px;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    width: 100%;
}

.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(2, 6, 23, 0.95);
    z-index: 100;
    backdrop-filter: blur(10px);
}

.modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    background: var(--card);
    border-radius: 20px;
    z-index: 101;
    overflow: hidden;
    border: 2px solid var(--primary);
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
}

.modal-header {
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    padding: 30px;
    text-align: center;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.modal-title {
    font-size: 2rem;
    font-weight: 700;
    margin: 0 0 10px 0;
    color: white;
}

.modal-subtitle {
    font-size: 1.1rem;
    color: rgba(255, 255, 255, 0.9);
}

.modal-content {
    padding: 30px;
    overflow-y: auto;
    max-height: 60vh;
}

.evaluation-section {
    margin-bottom: 30px;
    padding: 25px;
    background: rgba(15, 23, 42, 0.6);
    border-radius: 12px;
    border: 1px solid var(--border);
}

.section-title {
    font-size: 1.3rem;
    color: var(--primary);
    margin-top: 0;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.parameter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.parameter-card {
    background: rgba(30, 41, 59, 0.8);
    padding: 20px;
    border-radius: 10px;
    border-left: 4px solid var(--primary);
}

.param-name {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin-bottom: 8px;
}

.param-value {
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--primary);
    font-family: 'Consolas', monospace;
}

.insight-box {
    background: rgba(248, 113, 113, 0.1);
    padding: 20px;
    border-radius: 12px;
    margin: 20px 0;
    border: 1px solid rgba(248, 113, 113, 0.3);
}

.insight-title {
    color: var(--conv);
    font-weight: 600;
    margin-bottom: 10px;
}

.recommendation-list {
    padding-left: 20px;
    margin: 15px 0;
}

.recommendation-list li {
    margin-bottom: 10px;
    line-height: 1.5;
}

.highlight {
    color: var(--warning);
    font-weight: 600;
}

.learning-level {
    display: inline-block;
    padding: 8px 20px;
    border-radius: 20px;
    font-weight: 600;
    margin: 10px 0;
}

.level-expert {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
}

.level-intermediate {
    background: linear-gradient(135deg, #f59e0b, #f97316);
    color: white;
}

.level-beginner {
    background: linear-gradient(135deg, #6b7280, #9ca3af);
    color: white;
}

.close-btn {
    display: block;
    width: 100%;
    padding: 18px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    border: none;
    border-radius: 0 0 18px 18px;
    font-weight: 600;
    font-size: 1.1rem;
    cursor: pointer;
    margin-top: 20px;
}

.close-btn:hover {
    background: linear-gradient(135deg, var(--primary-dark), var(--primary));
}

.achievement-badge {
    display: inline-block;
    background: rgba(56, 189, 248, 0.1);
    color: var(--primary);
    padding: 6px 15px;
    border-radius: 20px;
    font-size: 0.9rem;
    margin: 5px;
    border: 1px solid rgba(56, 189, 248, 0.3);
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 1200px) {
    #app {
        grid-template-columns: 1fr;
    }
    
    .pipe-labels {
        flex-direction: column;
        gap: 15px;
        align-items: center;
    }
    
    .pipe-label {
        width: 90%;
    }
}

@media (max-width: 768px) {
    body {
        padding: 10px;
    }
    
    .card {
        padding: 20px;
    }
    
    .math-overlay {
        position: relative;
        top: 0;
        right: 0;
        margin-bottom: 20px;
        max-width: 100%;
    }
    
    .modal {
        width: 95%;
        padding: 15px;
    }
    
    .footer-content {
        flex-direction: column;
        gap: 25px;
    }
    
    .footer-section {
        min-width: 100%;
    }
}
</style>
</head>
<body>
<div class="bg-pattern"></div>

<div class="main-container">
    <div id="app">
        <div class="card">
            <h1 id="simulationTitle">ğŸ§ª æ¬§æ‹‰å…¬å¼ä»¿çœŸ - å˜æˆªé¢ç®¡é“æµä½“åŠ¨åŠ›å­¦</h1>
            
            <div class="math-overlay">
                <div style="font-weight: 600; margin-bottom: 10px; color: var(--primary);">æ¬§æ‹‰å…¬å¼ (æ§åˆ¶ä½“ç§¯æ³•)</div>
                <div class="formula-parts">
                    <span>Dv/Dt =</span>
                    <span class="formula-part local-term">âˆ‚v/âˆ‚t</span>
                    <span>+</span>
                    <span class="formula-part conv-term">(vÂ·âˆ‡)v</span>
                    <span>+</span>
                    <span class="formula-part source-term">S</span>
                </div>
            </div>
            
            <div id="canvasContainer">
                <canvas id="flowCanvas"></canvas>
                <div class="pipe-labels">
                    <div class="pipe-label coarse-label">
                        <div class="label-title">ç²—ç®¡æ®µ (å…¥å£)</div>
                        <div id="coarseLabel" class="label-values">
                            <div class="label-value">
                                <div class="value-name">âˆ‚v/âˆ‚t</div>
                                <div id="localCoarseValue" class="value-number">0.00</div>
                            </div>
                            <div class="label-value">
                                <div class="value-name">(vÂ·âˆ‡)v</div>
                                <div id="convCoarseValue" class="value-number">0.00</div>
                            </div>
                            <div class="label-value">
                                <div class="value-name">æºé¡¹ S</div>
                                <div id="sourceCoarseValue" class="value-number">0.00</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pipe-label fine-label">
                        <div class="label-title">ç»†ç®¡æ®µ (å‡ºå£)</div>
                        <div id="fineLabel" class="label-values">
                            <div class="label-value">
                                <div class="value-name">âˆ‚v/âˆ‚t</div>
                                <div id="localFineValue" class="value-number">0.00</div>
                            </div>
                            <div class="label-value">
                                <div class="value-name">(vÂ·âˆ‡)v</div>
                                <div id="convFineValue" class="value-number">0.00</div>
                            </div>
                            <div class="label-value">
                                <div class="value-name">æºé¡¹ S</div>
                                <div id="sourceFineValue" class="value-number">0.00</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="simulation-info">
                <div style="font-weight: 600; color: var(--primary); margin-bottom: 5px;">ä»¿çœŸè¯´æ˜</div>
                <div>ç®¡é“åˆ†æ®µï¼šç²—ç®¡ 40% / å˜å¾„æ”¶ç¼©åŒº 20% / ç»†ç®¡ 40%</div>
                <div>çº¢è‰²ç²’å­ï¼šå…¥å£æºé¡¹ | è“è‰²ç²’å­ï¼šå˜å¾„åŒºæºé¡¹</div>
                <div>è§‚å¯Ÿä¸åŒæˆªé¢å¤„æ¬§æ‹‰å…¬å¼å„é¡¹çš„å˜åŒ–è§„å¾‹</div>
            </div>
        </div>

        <div class="card control-panel">
            <h3>ğŸ› ï¸ å‚æ•°æ§åˆ¶é¢æ¿</h3>
            
            <div class="control-group">
                <label>æ•´ä½“æµé€Ÿ (m/s)</label>
                <div class="value-display">
                    <span id="flowSpeedDisp" class="value-number-display">1.0</span>
                    <span class="unit">m/s</span>
                </div>
                <input type="range" id="flowSpeed" min="0.1" max="5" step="0.1" value="1">
                <div class="slider-info">
                    <span>ä½é€Ÿ</span>
                    <span>é«˜é€Ÿ</span>
                </div>
            </div>
            
            <div class="control-group">
                <label>çº¢è‰²æºé¡¹å¼ºåº¦ (å…¥å£)</label>
                <div class="value-display">
                    <span id="sourceSpeedDisp" class="value-number-display">20</span>
                    <span class="unit">ç²’å­/s</span>
                </div>
                <input type="range" id="sourceSpeed" min="0" max="60" step="1" value="20">
                <div class="slider-info">
                    <span>æ— æº</span>
                    <span>å¼ºæº</span>
                </div>
            </div>
            
            <div class="control-group">
                <label>è“è‰²æºé¡¹å¼ºåº¦ (å˜å¾„åŒº)</label>
                <div class="value-display">
                    <span id="blueSourceSpeedDisp" class="value-number-display">10</span>
                    <span class="unit">ç²’å­/s</span>
                </div>
                <input type="range" id="blueSourceSpeed" min="0" max="50" step="1" value="10">
                <div class="slider-info">
                    <span>æ— æº</span>
                    <span>å¼ºæº</span>
                </div>
            </div>
            
            <div class="control-group">
                <label>æˆªé¢æ”¶ç¼©æ¯”ä¾‹</label>
                <div class="value-display">
                    <span id="ratioDisp" class="value-number-display">2.5</span>
                    <span class="unit">å€</span>
                </div>
                <input type="range" id="ratioRange" min="1.1" max="4.5" step="0.1" value="2.5">
                <div class="slider-info">
                    <span>è½»å¾®</span>
                    <span>å¼ºçƒˆ</span>
                </div>
            </div>
            
            <div class="feedback-box" id="aiBox">
                <div class="feedback-title">ğŸ’¡ å®æ—¶å·¥ç¨‹æ´å¯Ÿ</div>
                <div id="feedback" class="feedback-content">
                    è°ƒæ•´å‚æ•°è§‚å¯Ÿæ¬§æ‹‰å…¬å¼å„é¡¹å˜åŒ–ã€‚æ³¨æ„<span class="term-local">æœ¬åœ°åŠ é€Ÿåº¦é¡¹</span>ã€
                    <span class="term-conv">è¿ç§»åŠ é€Ÿåº¦é¡¹</span>å’Œ<span class="term-source">æºé¡¹</span>
                    åœ¨ä¸åŒæˆªé¢å¤„çš„å·®å¼‚ã€‚
                </div>
                <div class="key-insight" id="keyInsight">
                    å…³é”®å‘ç°ï¼šæˆªé¢æ”¶ç¼©å¯¼è‡´æµé€Ÿå¢åŠ ï¼Œè¿ç§»é¡¹å¢å¤§ã€‚
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="genReport">
                    <span>ğŸ“Š ç”Ÿæˆè¯„ä¼°æŠ¥å‘Š</span>
                </button>
                <button id="resetSim">
                    <span>ğŸ”„ é‡ç½®ä»¿çœŸ</span>
                </button>
            </div>
        </div>
    </div>
</div>

    
 
<!-- åº•éƒ¨ä¿¡æ¯æ  -->
<div style="
    text-align: center;
    padding: 20px 30px;
    margin-top: 40px;
    color: #e6f7ff;
    font-size: 0.9rem;
    border-top: 2px solid rgba(0, 180, 255, 0.5);
    background: linear-gradient(135deg, rgba(10, 15, 43, 0.95), rgba(18, 26, 58, 0.9));
    border-radius: 15px 15px 0 0;
    box-shadow: 0 -10px 30px rgba(0, 180, 255, 0.1);
    position: relative;
    overflow: hidden;
    /* æ–°å¢ä»¥ä¸‹ï¼Œç¡®ä¿å®Œå…¨å®½åº¦ */
    box-sizing: border-box;
    width: 100%;
    max-width: none;
">    <div style="position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, #00b4ff, #6c8cff, #00b4ff);"></div>
        
    <p style="font-size: 1.1rem; font-weight: bold; margin-bottom: 15px; color: #00b4ff;">

æµä½“åŠ›å­¦æ•™å­¦ä»¿çœŸå¹³å°Â© 2025 | å¾®å…ƒä½“æ¬§æ‹‰å…¬å¼è¯„ä¼°ç³»ç»Ÿ | ç‰ˆæœ¬1.0  |  
    <style="margin-bottom: 12px; color: #cbd5e1;">
        <strong>é‚®ç®±:</strong> xgyanger@qq.com
    <div style="margin-top: 15px;">
        <span style="color: #ffcc00; font-weight: bold; font-size: 1rem;">
            ç‰ˆæƒÂ©2025 AIknow. ä¿ç•™æ‰€æœ‰æƒåˆ© | Copyright Â©2025 AIknow. All rights reserved.
        </span>
    </div>

</footer>

<div id="reportOverlay" class="modal-overlay"></div>
<div id="reportModal" class="modal">
    <div class="modal-header">
        <div class="modal-title">æ¬§æ‹‰å…¬å¼ä»¿çœŸæ¢ç´¢è¯„ä¼°æŠ¥å‘Š</div>
        <div class="modal-subtitle">åŸºäºå½“å‰å®éªŒå‚æ•°çš„æµä½“åŠ¨åŠ›å­¦åˆ†æ</div>
    </div>
    
    <div class="modal-content">
        <div class="evaluation-section">
            <h3 class="section-title">ğŸ“ˆ å½“å‰å®éªŒå‚æ•°</h3>
            <div class="parameter-grid">
                <div class="parameter-card">
                    <div class="param-name">æ•´ä½“æµé€Ÿ</div>
                    <div id="reportFlowSpeed" class="param-value">1.0 m/s</div>
                </div>
                
                <div class="parameter-card">
                    <div class="param-name">çº¢è‰²æºå¼ºåº¦</div>
                    <div id="reportRedSource" class="param-value">20 ç²’å­/s</div>
                </div>
                
                <div class="parameter-card">
                    <div class="param-name">è“è‰²æºå¼ºåº¦</div>
                    <div id="reportBlueSource" class="param-value">10 ç²’å­/s</div>
                </div>
                
                <div class="parameter-card">
                    <div class="param-name">æ”¶ç¼©æ¯”ä¾‹</div>
                    <div id="reportRatio" class="param-value">2.5 å€</div>
                </div>
            </div>
        </div>
        
        <div class="evaluation-section">
            <h3 class="section-title">ğŸ”¬ æ¬§æ‹‰å…¬å¼é¡¹åˆ†æ</h3>
            
            <div class="parameter-grid">
                <div class="parameter-card">
                    <div class="param-name">ç²—ç®¡æ®µæœ¬åœ°é¡¹</div>
                    <div id="reportLocalCoarse" class="param-value">0.00</div>
                    <div class="param-name" style="margin-top: 10px;">çŠ¶æ€</div>
                    <div id="localCoarseStatus" class="param-value">ç¨³å®š</div>
                </div>
                
                <div class="parameter-card">
                    <div class="param-name">ç²—ç®¡æ®µè¿ç§»é¡¹</div>
                    <div id="reportConvCoarse" class="param-value">0.00</div>
                    <div class="param-name" style="margin-top: 10px;">çŠ¶æ€</div>
                    <div id="convCoarseStatus" class="param-value">å‡åŒ€</div>
                </div>
                
                <div class="parameter-card">
                    <div class="param-name">ç»†ç®¡æ®µæœ¬åœ°é¡¹</div>
                    <div id="reportLocalFine" class="param-value">0.00</div>
                    <div class="param-name" style="margin-top: 10px;">çŠ¶æ€</div>
                    <div id="localFineStatus" class="param-value">ç¨³å®š</div>
                </div>
                
                <div class="parameter-card">
                    <div class="param-name">ç»†ç®¡æ®µè¿ç§»é¡¹</div>
                    <div id="reportConvFine" class="param-value">0.00</div>
                    <div class="param-name" style="margin-top: 10px;">çŠ¶æ€</div>
                    <div id="convFineStatus" class="param-value">åŠ é€Ÿ</div>
                </div>
            </div>
            
            <div class="insight-box">
                <div class="insight-title">ğŸ’¡ ç‰©ç†æ´å¯Ÿ</div>
                <div id="physicalInsight">
                    æ ¹æ®è¿ç»­æ–¹ç¨‹ï¼Œæˆªé¢æ”¶ç¼©å¯¼è‡´æµé€Ÿå¢åŠ ã€‚è¿ç§»é¡¹(vÂ·âˆ‡)våæ˜ äº†æµé€Ÿå˜åŒ–å¯¹åŠ é€Ÿåº¦çš„è´¡çŒ®ï¼Œ
                    åœ¨ç»†ç®¡æ®µæ­¤é¡¹å¢å¤§ï¼Œç¬¦åˆç†è®ºé¢„æœŸã€‚
                </div>
            </div>
        </div>
        
        <div class="evaluation-section">
            <h3 class="section-title">ğŸ¯ å­¦ä¹ æ°´å¹³è¯„ä¼°</h3>
            <div id="learningLevel" class="learning-level level-beginner">å®ä¹ å·¥ç¨‹å¸ˆ</div>
            <p id="levelDescription">æ‚¨åˆšå¼€å§‹æ¢ç´¢æ¬§æ‹‰å…¬å¼å„é¡¹çš„å˜åŒ–è§„å¾‹ã€‚</p>
            
            <div style="margin-top: 20px;">
                <div class="section-title" style="font-size: 1.1rem;">ğŸ† å·²è§£é”æˆå°±</div>
                <div id="achievementsList"></div>
            </div>
        </div>
        
        <div class="evaluation-section">
            <h3 class="section-title">ğŸ“š é’ˆå¯¹æ€§å­¦ä¹ å»ºè®®</h3>
            <ul class="recommendation-list" id="recommendations">
                <li>å°è¯•è°ƒæ•´<span class="highlight">æ”¶ç¼©æ¯”ä¾‹</span>ï¼Œè§‚å¯Ÿè¿ç§»é¡¹çš„å˜åŒ–è§„å¾‹</li>
                <li>è®¾ç½®<span class="highlight">è“è‰²æºä¸º0</span>ï¼Œè§‚å¯Ÿçº¯æ”¶ç¼©ç®¡é“çš„æµåŠ¨ç‰¹æ€§</li>
                <li>å¯¹æ¯”<span class="highlight">é«˜é€Ÿå’Œä½é€Ÿ</span>ä¸‹å„é¡¹çš„ç›¸å¯¹å¤§å°å˜åŒ–</li>
            </ul>
        </div>
    </div>
    
    <button id="closeReport" class="close-btn">è¿”å›ä»¿çœŸå®éªŒå®¤</button>
</div>

<script>
// å…¨å±€å˜é‡
const canvas = document.getElementById('flowCanvas');
const ctx = canvas.getContext('2d');
const ratioRange = document.getElementById('ratioRange');
const flowSpeedSlider = document.getElementById('flowSpeed');
const sourceSpeedSlider = document.getElementById('sourceSpeed');
const blueSourceSlider = document.getElementById('blueSourceSpeed');
const reportOverlay = document.getElementById('reportOverlay');
const reportModal = document.getElementById('reportModal');
const closeReportBtn = document.getElementById('closeReport');
const resetSimBtn = document.getElementById('resetSim');
const genReportBtn = document.getElementById('genReport');

// ç²’å­ç³»ç»Ÿ
let particles = [];
let time = 0;
const frameRate = 60;
const deltaT = 1.0; // ç”¨äºæœ¬åœ°åŠ é€Ÿåº¦è®¡ç®—çš„æ—¶é—´é—´éš”

// è¿½è¸ªå™¨ - è®°å½•ç”¨æˆ·æ¢ç´¢è¡Œä¸º
const Tracker = {
    startTime: Date.now(),
    flowSpeeds: new Set(),
    redSources: new Set(),
    blueSources: new Set(),
    ratios: new Set(),
    interactionCount: 0,
    maxLocalCoarse: 0,
    maxConvFine: 0,
    sourceCombinations: new Set(),
    
    logInteraction(type, value) {
        this.interactionCount++;
        
        switch(type) {
            case 'flowSpeed':
                this.flowSpeeds.add(Math.round(value * 10) / 10);
                break;
            case 'redSource':
                this.redSources.add(Math.round(value));
                break;
            case 'blueSource':
                this.blueSources.add(Math.round(value));
                break;
            case 'ratio':
                this.ratios.add(Math.round(value * 10) / 10);
                break;
        }
        
        // è®°å½•æºç»„åˆ
        const red = parseFloat(sourceSpeedSlider.value);
        const blue = parseFloat(blueSourceSlider.value);
        this.sourceCombinations.add(`${red}_${blue}`);
    },
    
    updateExtremes(localCoarse, convFine) {
        if (Math.abs(localCoarse) > Math.abs(this.maxLocalCoarse)) {
            this.maxLocalCoarse = localCoarse;
        }
        if (Math.abs(convFine) > Math.abs(this.maxConvFine)) {
            this.maxConvFine = convFine;
        }
    },
    
    getCoverageScore() {
        // å‚æ•°æ¢ç´¢åº¦ (0-40åˆ†)
        const paramScore = Math.min(40, 
            (this.flowSpeeds.size * 5) + 
            (this.redSources.size * 3) + 
            (this.blueSources.size * 3) + 
            (this.ratios.size * 4));
        
        // ç°è±¡å‘ç°åº¦ (0-30åˆ†)
        let phenomenaScore = 0;
        if (this.maxLocalCoarse !== 0) phenomenaScore += 5;
        if (this.maxConvFine > 0.5) phenomenaScore += 10;
        if (this.sourceCombinations.size >= 3) phenomenaScore += 10;
        if (this.redSources.size >= 3 && this.blueSources.size >= 3) phenomenaScore += 5;
        
        // äº’åŠ¨æ·±åº¦ (0-30åˆ†)
        const interactionScore = Math.min(30, this.interactionCount / 2);
        
        return {
            total: Math.round(paramScore + phenomenaScore + interactionScore),
            param: Math.round(paramScore),
            phenomena: phenomenaScore,
            interaction: Math.round(interactionScore)
        };
    }
};

// åˆå§‹åŒ–ç²’å­ç³»ç»Ÿ
function createParticle(x, h, color = 'red') {
    const relY = Math.random() * 2 - 1;
    const y = h / 2 + relY * h * 0.38;
    const speed = (color === 'red' ? parseFloat(sourceSpeedSlider.value) : parseFloat(blueSourceSlider.value)) + Math.random() * 5;
    const radius = 3 + Math.random() * 2;
    const colorHue = color === 'red' ? 0 : 220;
    return { x, y, relY, speed, colorHue, radius, life: 12000, color, prevSpeeds: [] };
}

function initParticles() {
    particles = [];
    const w = canvas.offsetWidth;
    const h = canvas.offsetHeight;
    
    // åˆ›å»ºåˆå§‹ç²’å­
    for (let i = 0; i < 300; i++) {
        particles.push(createParticle(Math.random() * w, h, 'red'));
        particles.push(createParticle(Math.random() * w * 0.4, h, 'blue'));
    }
}

// è·å–ç®¡é“è¾¹ç•Œ
function getBoundary(x, w, h) {
    const ratio = parseFloat(ratioRange.value);
    const seg1 = w * 0.4, seg2 = w * 0.2, seg3 = w * 0.4;
    const hMax = h * 0.38, hMin = hMax / ratio;
    let currentH = hMax;
    
    if (x <= seg1) {
        currentH = hMax;
    } else if (x <= seg1 + seg2) {
        const t = (x - seg1) / seg2;
        const smoothT = t * t * (3 - 2 * t);
        currentH = hMax + (hMin - hMax) * smoothT;
    } else {
        currentH = hMin;
    }
    
    return { top: h / 2 - currentH, bottom: h / 2 + currentH, h: currentH };
}

// ç»˜åˆ¶å‡½æ•°
function draw() {
    const w = canvas.width = canvas.offsetWidth;
    const h = canvas.height = canvas.offsetHeight;
    time += 2 / frameRate;

    // æ‹–å°¾æ•ˆæœ
    ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
    ctx.fillRect(0, 0, w, h);

    // ç»˜åˆ¶ç®¡é“å£
    ctx.fillStyle = "#0f172a";
    
    const drawWall = (isTop) => {
        ctx.beginPath();
        ctx.moveTo(0, isTop ? 0 : h);
        
        for (let x = 0; x <= w; x += 10) {
            const b = getBoundary(x, w, h);
            ctx.lineTo(x, isTop ? b.top : b.bottom);
        }
        
        ctx.lineTo(w, isTop ? 0 : h);
        ctx.fill();
    };
    
    drawWall(true);
    drawWall(false);
    
    // ç®¡é“å£é«˜å…‰
    ctx.strokeStyle = 'rgba(56, 189, 248, 0.1)';
    ctx.lineWidth = 2;
    
    // ä¸Šå£é¢
    ctx.beginPath();
    ctx.moveTo(0, getBoundary(0, w, h).top);
    for (let x = 0; x <= w; x += 20) {
        const b = getBoundary(x, w, h);
        ctx.lineTo(x, b.top);
    }
    ctx.stroke();
    
    // ä¸‹å£é¢
    ctx.beginPath();
    ctx.moveTo(0, getBoundary(0, w, h).bottom);
    for (let x = 0; x <= w; x += 20) {
        const b = getBoundary(x, w, h);
        ctx.lineTo(x, b.bottom);
    }
    ctx.stroke();

    // æ·»åŠ çº¢è‰²æºç²’å­
    for (let i = 0; i < parseFloat(sourceSpeedSlider.value) / 10; i++) {
        if (particles.length < 2000) {
            particles.push(createParticle(0, h, 'red'));
        }
    }
    
    // æ·»åŠ è“è‰²æºç²’å­ (å˜å¾„åŒº)
    const seg2Start = w * 0.4, seg2End = w * 0.6;
    for (let i = 0; i < parseFloat(blueSourceSlider.value) / 15; i++) {
        if (particles.length < 2000) {
            const relY = Math.random() * 0.4 - 0.2;
            const x = Math.random() * (seg2End - seg2Start) + seg2Start;
            const y = h / 2 + relY * h * 0.38;
            particles.push({
                x, y, relY,
                speed: parseFloat(blueSourceSlider.value),
                colorHue: 220,
                radius: 3 + Math.random() * 2,
                life: 12000,
                color: 'blue',
                prevSpeeds: []
            });
        }
    }

    const globalSpeed = parseFloat(flowSpeedSlider.value);
    let localCoarseSum = 0, convCoarseSum = 0;
    let localFineSum = 0, convFineSum = 0;
    let coarseCount = 0, fineCount = 0;

    // æ›´æ–°å’Œç»˜åˆ¶ç²’å­
    particles = particles.filter(p => {
        const b = getBoundary(p.x, w, h);
        const hRef = (p.x <= w * 0.4) ? h * 0.38 : ((p.x >= w * 0.6) ? h * 0.38 / parseFloat(ratioRange.value) : h * 0.38);
        const vx = p.speed * 0.1 * (h * 0.38) / hRef * (1 - Math.pow(p.relY, 4) * 0.4) * globalSpeed / 2;
        
        p.x += vx;
        p.y = h / 2 + p.relY * b.h;

        // æ›´æ–°é€Ÿåº¦å†å² (ç”¨äºè®¡ç®—æœ¬åœ°åŠ é€Ÿåº¦)
        p.prevSpeeds.push(p.speed);
        const maxHistory = frameRate * deltaT;
        if (p.prevSpeeds.length > maxHistory) {
            p.prevSpeeds.shift();
        }
        
        // è®¡ç®—æœ¬åœ°åŠ é€Ÿåº¦
        let localAcc = 0;
        if (p.prevSpeeds.length >= maxHistory) {
            localAcc = (p.speed - p.prevSpeeds[0]) / deltaT;
        }
        p.localAcc = localAcc;

        // ç»˜åˆ¶ç²’å­
        const brightness = 40 + Math.min(vx * 2, 60);
        const alpha = p.life > 1000 ? 0.8 : p.life / 1250;
        ctx.fillStyle = `hsla(${p.colorHue}, 90%, ${brightness}%, ${alpha})`;
        
        // ç²’å­å…‰æ™•
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius * 1.5, 0, Math.PI * 2);
        ctx.fillStyle = `hsla(${p.colorHue}, 50%, ${brightness}%, ${alpha * 0.3})`;
        ctx.fill();
        
        // ç²’å­ä¸»ä½“
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
        ctx.fillStyle = `hsla(${p.colorHue}, 90%, ${brightness}%, ${alpha})`;
        ctx.fill();
        
        // æ”¶é›†ç»Ÿè®¡ä¿¡æ¯
        if (p.x <= 0.05 * w) { // ç²—ç®¡æ®µ
            localCoarseSum += p.localAcc;
            convCoarseSum += Math.abs(p.x * 0.001);
            coarseCount++;
        } else if (p.x >= 0.95 * w) { // ç»†ç®¡æ®µ
            localFineSum += p.localAcc;
            convFineSum += Math.abs(p.x * 0.001);
            fineCount++;
        }

        // ç²’å­å¯¿å‘½
        p.life -= 0.3;
        return p.life > 0 && p.x <= w;
    });

    // è®¡ç®—å„é¡¹å¹³å‡å€¼
    const localCoarse = coarseCount > 0 ? localCoarseSum / coarseCount : 0;
    const convCoarse = coarseCount > 0 ? convCoarseSum / coarseCount : 0;
    const SCoarse = parseFloat(blueSourceSlider.value) / 10;

    const localFine = fineCount > 0 ? localFineSum / fineCount : 0;
    const convFine = fineCount > 0 ? convFineSum / fineCount : 0;
    const SFine = (parseFloat(sourceSpeedSlider.value) + parseFloat(blueSourceSlider.value)) / 10;

    // æ›´æ–°è¿½è¸ªå™¨
    Tracker.updateExtremes(localCoarse, convFine);

    // æ›´æ–°æ˜¾ç¤º
    document.getElementById('localCoarseValue').textContent = localCoarse.toFixed(2);
    document.getElementById('convCoarseValue').textContent = convCoarse.toFixed(2);
    document.getElementById('sourceCoarseValue').textContent = SCoarse.toFixed(2);
    
    document.getElementById('localFineValue').textContent = localFine.toFixed(2);
    document.getElementById('convFineValue').textContent = convFine.toFixed(2);
    document.getElementById('sourceFineValue').textContent = SFine.toFixed(2);

    // æ›´æ–°åé¦ˆ
    updateFeedback(localCoarse, convCoarse, localFine, convFine, SCoarse, SFine);
    
    // ç»§ç»­åŠ¨ç”»
    requestAnimationFrame(draw);
}

// æ›´æ–°å®æ—¶åé¦ˆ
function updateFeedback(localCoarse, convCoarse, localFine, convFine, SCoarse, SFine) {
    const feedback = document.getElementById('feedback');
    const keyInsight = document.getElementById('keyInsight');
    
    // åŸºæœ¬åé¦ˆ
    let feedbackText = `ç²—ç®¡æ®µ: æœ¬åœ°é¡¹=${localCoarse.toFixed(2)}, è¿ç§»é¡¹=${convCoarse.toFixed(2)}, æºé¡¹=${SCoarse.toFixed(2)}<br>`;
    feedbackText += `ç»†ç®¡æ®µ: æœ¬åœ°é¡¹=${localFine.toFixed(2)}, è¿ç§»é¡¹=${convFine.toFixed(2)}, æºé¡¹=${SFine.toFixed(2)}`;
    
    feedback.innerHTML = feedbackText;
    
    // å…³é”®æ´å¯Ÿ
    let insightText = "";
    const ratio = parseFloat(ratioRange.value);
    
    if (convFine > convCoarse * 1.5) {
        insightText = "å…³é”®å‘ç°: æˆªé¢æ”¶ç¼©å¯¼è‡´æµé€Ÿå¢åŠ ï¼Œè¿ç§»é¡¹æ˜¾è‘—å¢å¤§ã€‚";
    } else if (SFine > SCoarse * 2) {
        insightText = "å…³é”®å‘ç°: æºé¡¹åœ¨ç»†ç®¡æ®µç´¯ç§¯æ•ˆåº”æ˜æ˜¾ã€‚";
    } else if (Math.abs(localFine) > 0.1) {
        insightText = "å…³é”®å‘ç°: ç»†ç®¡æ®µå‡ºç°æ˜æ˜¾çš„æœ¬åœ°åŠ é€Ÿåº¦å˜åŒ–ã€‚";
    } else {
        insightText = "å…³é”®å‘ç°: æˆªé¢æ”¶ç¼©å¯¼è‡´æµé€Ÿå¢åŠ ï¼Œè¿ç§»é¡¹å¢å¤§ã€‚";
    }
    
    keyInsight.textContent = insightText;
}

// ç”Ÿæˆè¯„ä¼°æŠ¥å‘Š
function generateReport() {
    const flowSpeed = parseFloat(flowSpeedSlider.value);
    const redSource = parseFloat(sourceSpeedSlider.value);
    const blueSource = parseFloat(blueSourceSlider.value);
    const ratio = parseFloat(ratioRange.value);
    
    // è·å–å½“å‰å„é¡¹å€¼
    const localCoarse = parseFloat(document.getElementById('localCoarseValue').textContent);
    const convCoarse = parseFloat(document.getElementById('convCoarseValue').textContent);
    const localFine = parseFloat(document.getElementById('localFineValue').textContent);
    const convFine = parseFloat(document.getElementById('convFineValue').textContent);
    
    // æ›´æ–°æŠ¥å‘Šå‚æ•°
    document.getElementById('reportFlowSpeed').textContent = flowSpeed.toFixed(1) + " m/s";
    document.getElementById('reportRedSource').textContent = redSource + " ç²’å­/s";
    document.getElementById('reportBlueSource').textContent = blueSource + " ç²’å­/s";
    document.getElementById('reportRatio').textContent = ratio.toFixed(1) + " å€";
    
    document.getElementById('reportLocalCoarse').textContent = localCoarse.toFixed(2);
    document.getElementById('reportConvCoarse').textContent = convCoarse.toFixed(2);
    document.getElementById('reportLocalFine').textContent = localFine.toFixed(2);
    document.getElementById('reportConvFine').textContent = convFine.toFixed(2);
    
    // æ›´æ–°çŠ¶æ€æè¿°
    document.getElementById('localCoarseStatus').textContent = Math.abs(localCoarse) < 0.1 ? "ç¨³å®š" : "å˜åŒ–ä¸­";
    document.getElementById('convCoarseStatus').textContent = convCoarse < 0.1 ? "å‡åŒ€" : "æœ‰æ¢¯åº¦";
    document.getElementById('localFineStatus').textContent = Math.abs(localFine) < 0.1 ? "ç¨³å®š" : "å˜åŒ–ä¸­";
    document.getElementById('convFineStatus').textContent = convFine > convCoarse * 1.2 ? "åŠ é€Ÿ" : "ç¨³å®š";
    
    // è®¡ç®—å­¦ä¹ æ°´å¹³
    const coverage = Tracker.getCoverageScore();
    let level = "å®ä¹ å·¥ç¨‹å¸ˆ";
    let levelClass = "level-beginner";
    let levelDescription = "";
    
    if (coverage.total >= 70) {
        level = "é«˜çº§å·¥ç¨‹å¸ˆ";
        levelClass = "level-expert";
        levelDescription = "æ‚¨å·²æ·±å…¥ç†è§£æ¬§æ‹‰å…¬å¼å„é¡¹çš„ç‰©ç†æ„ä¹‰å’Œå˜åŒ–è§„å¾‹ã€‚";
    } else if (coverage.total >= 40) {
        level = "ä¸­çº§å·¥ç¨‹å¸ˆ";
        levelClass = "level-intermediate";
        levelDescription = "æ‚¨å·²æŒæ¡æ¬§æ‹‰å…¬å¼çš„åŸºæœ¬è§„å¾‹ï¼Œå¯ä»¥è¿›ä¸€æ­¥æ¢ç´¢å‚æ•°é—´çš„å…³ç³»ã€‚";
    } else {
        levelDescription = "æ‚¨åˆšå¼€å§‹æ¢ç´¢æ¬§æ‹‰å…¬å¼å„é¡¹çš„å˜åŒ–è§„å¾‹ï¼Œå»ºè®®å°è¯•æ›´å¤šå‚æ•°ç»„åˆã€‚";
    }
    
    // æ›´æ–°å­¦ä¹ æ°´å¹³
    const levelElement = document.getElementById('learningLevel');
    levelElement.textContent = level;
    levelElement.className = `learning-level ${levelClass}`;
    document.getElementById('levelDescription').textContent = levelDescription;
    
    // ç”Ÿæˆç‰©ç†æ´å¯Ÿ
    let physicalInsight = "";
    if (convFine > convCoarse * 1.5) {
        physicalInsight = "æ ¹æ®è¿ç»­æ–¹ç¨‹ï¼Œæˆªé¢æ”¶ç¼©å¯¼è‡´æµé€Ÿå¢åŠ ã€‚è¿ç§»é¡¹(vÂ·âˆ‡)våæ˜ äº†æµé€Ÿå˜åŒ–å¯¹åŠ é€Ÿåº¦çš„è´¡çŒ®ï¼Œåœ¨ç»†ç®¡æ®µæ­¤é¡¹æ˜¾è‘—å¢å¤§ï¼Œç¬¦åˆç†è®ºé¢„æœŸã€‚è¿™ä½“ç°äº†æµä½“é€šè¿‡æ”¶ç¼©æˆªé¢æ—¶çš„åŠ é€Ÿæ•ˆåº”ã€‚";
    } else if (redSource > blueSource * 2) {
        physicalInsight = "çº¢è‰²æºé¡¹å ä¸»å¯¼ï¼Œå…¥å£æ•ˆåº”æ˜æ˜¾ã€‚æ¬§æ‹‰å…¬å¼ä¸­çš„æºé¡¹ä½“ç°äº†å¤–éƒ¨è¾“å…¥å¯¹æµä½“åŠ¨é‡çš„å½±å“ï¼Œå½“å‰è®¾ç½®ä¸‹å…¥å£æºé¡¹å¯¹æµåŠ¨çš„å½±å“æ›´ä¸ºæ˜¾è‘—ã€‚";
    } else {
        physicalInsight = "å½“å‰å‚æ•°è®¾ç½®ä¸‹ï¼Œæ¬§æ‹‰å…¬å¼å„é¡¹çš„å˜åŒ–è§„å¾‹ç¬¦åˆä¸å¯å‹ç¼©æµä½“åœ¨å˜æˆªé¢ç®¡é“ä¸­çš„æµåŠ¨ç‰¹æ€§ã€‚æœ¬åœ°åŠ é€Ÿåº¦é¡¹è¾ƒå°ï¼Œè¡¨æ˜æµåŠ¨æ¥è¿‘ç¨³æ€ã€‚";
    }
    
    document.getElementById('physicalInsight').textContent = physicalInsight;
    
    // ç”Ÿæˆæˆå°±åˆ—è¡¨
    const achievementsList = document.getElementById('achievementsList');
    let achievementsHTML = "";
    
    if (Tracker.flowSpeeds.size >= 3) {
        achievementsHTML += '<span class="achievement-badge">ğŸ¯ å¤šæµé€Ÿæ¢ç´¢è€…</span>';
    }
    if (Tracker.sourceCombinations.size >= 4) {
        achievementsHTML += '<span class="achievement-badge">ğŸ§ª æºé¡¹å®éªŒä¸“å®¶</span>';
    }
    if (Tracker.maxConvFine > 1.0) {
        achievementsHTML += '<span class="achievement-badge">âš¡ é«˜è¿ç§»é¡¹å‘ç°è€…</span>';
    }
    if (Tracker.interactionCount >= 20) {
        achievementsHTML += '<span class="achievement-badge">ğŸ”¬ æ·±åº¦æ¢ç´¢è€…</span>';
    }
    
    achievementsList.innerHTML = achievementsHTML || '<span class="achievement-badge">ğŸš€ æ¢ç´¢å¯ç¨‹è€…</span>';
    
    // ç”Ÿæˆé’ˆå¯¹æ€§å»ºè®®
    const recommendations = document.getElementById('recommendations');
    let recommendationsHTML = "";
    
    if (Tracker.ratios.size < 2) {
        recommendationsHTML += "<li>å°è¯•è°ƒæ•´<span class='highlight'>æ”¶ç¼©æ¯”ä¾‹</span>ï¼Œè§‚å¯Ÿè¿ç§»é¡¹çš„å˜åŒ–è§„å¾‹</li>";
    }
    
    if (!Tracker.blueSources.has(0)) {
        recommendationsHTML += "<li>è®¾ç½®<span class='highlight'>è“è‰²æºä¸º0</span>ï¼Œè§‚å¯Ÿçº¯æ”¶ç¼©ç®¡é“çš„æµåŠ¨ç‰¹æ€§</li>";
    }
    
    if (Tracker.flowSpeeds.size < 2) {
        recommendationsHTML += "<li>å¯¹æ¯”<span class='highlight'>é«˜é€Ÿå’Œä½é€Ÿ</span>ä¸‹å„é¡¹çš„ç›¸å¯¹å¤§å°å˜åŒ–</li>";
    }
    
    if (Tracker.redSources.size < 3) {
        recommendationsHTML += "<li>å°è¯•ä¸åŒçš„<span class='highlight'>çº¢è‰²æºå¼ºåº¦</span>ï¼Œè§‚å¯Ÿå¯¹ç»†ç®¡æ®µæºé¡¹çš„ç´¯ç§¯æ•ˆåº”</li>";
    }
    
    // é»˜è®¤å»ºè®®
    if (!recommendationsHTML) {
        recommendationsHTML = `
            <li>å°è¯•<span class='highlight'>æç«¯æ”¶ç¼©æ¯”ä¾‹(>4)</span>ï¼Œè§‚å¯Ÿè¿ç§»é¡¹çš„æ˜¾è‘—å˜åŒ–</li>
            <li>è®¾ç½®<span class='highlight'>ä¸¤ä¸ªæºé¡¹å‡ä¸º0</span>ï¼Œè§‚å¯Ÿæ— æºé¡¹çš„çº¯å¯¹æµæµåŠ¨</li>
            <li>å¯¹æ¯”<span class='highlight'>é«˜æµé€Ÿé«˜æºé¡¹</span>ä¸<span class='highlight'>ä½æµé€Ÿä½æºé¡¹</span>çš„ç»„åˆæ•ˆåº”</li>
        `;
    }
    
    recommendations.innerHTML = recommendationsHTML;
    
    // æ˜¾ç¤ºæŠ¥å‘Š
    reportOverlay.style.display = 'block';
    reportModal.style.display = 'block';
}

// äº‹ä»¶ç›‘å¬
function initEventListeners() {
    // æ»‘å—äº‹ä»¶
    flowSpeedSlider.oninput = () => {
        document.getElementById('flowSpeedDisp').textContent = flowSpeedSlider.value;
        Tracker.logInteraction('flowSpeed', parseFloat(flowSpeedSlider.value));
    };
    
    sourceSpeedSlider.oninput = () => {
        document.getElementById('sourceSpeedDisp').textContent = sourceSpeedSlider.value;
        Tracker.logInteraction('redSource', parseFloat(sourceSpeedSlider.value));
    };
    
    blueSourceSlider.oninput = () => {
        document.getElementById('blueSourceSpeedDisp').textContent = blueSourceSlider.value;
        Tracker.logInteraction('blueSource', parseFloat(blueSourceSlider.value));
    };
    
    ratioRange.oninput = () => {
        document.getElementById('ratioDisp').textContent = ratioRange.value;
        Tracker.logInteraction('ratio', parseFloat(ratioRange.value));
    };
    
    // æŠ¥å‘Šç›¸å…³äº‹ä»¶
    genReportBtn.addEventListener('click', generateReport);
    closeReportBtn.addEventListener('click', () => {
        reportOverlay.style.display = 'none';
        reportModal.style.display = 'none';
    });
    
    reportOverlay.addEventListener('click', () => {
        reportOverlay.style.display = 'none';
        reportModal.style.display = 'none';
    });
    
    // é‡ç½®æŒ‰é’®
    resetSimBtn.addEventListener('click', () => {
        // é‡ç½®æ»‘å—
        flowSpeedSlider.value = 1;
        sourceSpeedSlider.value = 20;
        blueSourceSlider.value = 10;
        ratioRange.value = 2.5;
        
        // æ›´æ–°æ˜¾ç¤º
        document.getElementById('flowSpeedDisp').textContent = '1.0';
        document.getElementById('sourceSpeedDisp').textContent = '20';
        document.getElementById('blueSourceSpeedDisp').textContent = '10';
        document.getElementById('ratioDisp').textContent = '2.5';
        
        // é‡æ–°åˆå§‹åŒ–ç²’å­
        initParticles();
        
        // é‡ç½®è¿½è¸ªå™¨
        Tracker.startTime = Date.now();
        Tracker.flowSpeeds.clear();
        Tracker.redSources.clear();
        Tracker.blueSources.clear();
        Tracker.ratios.clear();
        Tracker.interactionCount = 0;
        Tracker.maxLocalCoarse = 0;
        Tracker.maxConvFine = 0;
        Tracker.sourceCombinations.clear();
    });
    
    // çª—å£å¤§å°è°ƒæ•´
    window.onresize = () => {
        initParticles();
    };
}

// åˆå§‹åŒ–
function init() {
    initParticles();
    initEventListeners();
    draw();
}

// å¯åŠ¨åº”ç”¨
init();
</script>
</body>
</html>